(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))h(_);new MutationObserver(_=>{for(const T of _)if(T.type==="childList")for(const S of T.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&h(S)}).observe(document,{childList:!0,subtree:!0});function n(_){const T={};return _.integrity&&(T.integrity=_.integrity),_.referrerPolicy&&(T.referrerPolicy=_.referrerPolicy),_.crossOrigin==="use-credentials"?T.credentials="include":_.crossOrigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function h(_){if(_.ep)return;_.ep=!0;const T=n(_);fetch(_.href,T)}})();function z0(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var xv={exports:{}},wg={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yb;function QS(){if(yb)return wg;yb=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(h,_,T){var S=null;if(T!==void 0&&(S=""+T),_.key!==void 0&&(S=""+_.key),"key"in _){T={};for(var u in _)u!=="key"&&(T[u]=_[u])}else T=_;return _=T.ref,{$$typeof:r,type:h,key:S,ref:_!==void 0?_:null,props:T}}return wg.Fragment=e,wg.jsx=n,wg.jsxs=n,wg}var vb;function JS(){return vb||(vb=1,xv.exports=QS()),xv.exports}var Tt=JS(),wv={exports:{}},Fi={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bb;function e2(){if(bb)return Fi;bb=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),T=Symbol.for("react.consumer"),S=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),B=Symbol.for("react.memo"),q=Symbol.for("react.lazy"),oe=Symbol.iterator;function ne(xe){return xe===null||typeof xe!="object"?null:(xe=oe&&xe[oe]||xe["@@iterator"],typeof xe=="function"?xe:null)}var K={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},le=Object.assign,Ge={};function tt(xe,lt,Dt){this.props=xe,this.context=lt,this.refs=Ge,this.updater=Dt||K}tt.prototype.isReactComponent={},tt.prototype.setState=function(xe,lt){if(typeof xe!="object"&&typeof xe!="function"&&xe!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,xe,lt,"setState")},tt.prototype.forceUpdate=function(xe){this.updater.enqueueForceUpdate(this,xe,"forceUpdate")};function Ke(){}Ke.prototype=tt.prototype;function ht(xe,lt,Dt){this.props=xe,this.context=lt,this.refs=Ge,this.updater=Dt||K}var bt=ht.prototype=new Ke;bt.constructor=ht,le(bt,tt.prototype),bt.isPureReactComponent=!0;var It=Array.isArray,wt={H:null,A:null,T:null,S:null,V:null},zt=Object.prototype.hasOwnProperty;function Pt(xe,lt,Dt,vt,Zt,ti){return Dt=ti.ref,{$$typeof:r,type:xe,key:lt,ref:Dt!==void 0?Dt:null,props:ti}}function ut(xe,lt){return Pt(xe.type,lt,void 0,void 0,void 0,xe.props)}function Mt(xe){return typeof xe=="object"&&xe!==null&&xe.$$typeof===r}function Ri(xe){var lt={"=":"=0",":":"=2"};return"$"+xe.replace(/[=:]/g,function(Dt){return lt[Dt]})}var bi=/\/+/g;function te(xe,lt){return typeof xe=="object"&&xe!==null&&xe.key!=null?Ri(""+xe.key):lt.toString(36)}function be(){}function Fe(xe){switch(xe.status){case"fulfilled":return xe.value;case"rejected":throw xe.reason;default:switch(typeof xe.status=="string"?xe.then(be,be):(xe.status="pending",xe.then(function(lt){xe.status==="pending"&&(xe.status="fulfilled",xe.value=lt)},function(lt){xe.status==="pending"&&(xe.status="rejected",xe.reason=lt)})),xe.status){case"fulfilled":return xe.value;case"rejected":throw xe.reason}}throw xe}function xt(xe,lt,Dt,vt,Zt){var ti=typeof xe;(ti==="undefined"||ti==="boolean")&&(xe=null);var Jt=!1;if(xe===null)Jt=!0;else switch(ti){case"bigint":case"string":case"number":Jt=!0;break;case"object":switch(xe.$$typeof){case r:case e:Jt=!0;break;case q:return Jt=xe._init,xt(Jt(xe._payload),lt,Dt,vt,Zt)}}if(Jt)return Zt=Zt(xe),Jt=vt===""?"."+te(xe,0):vt,It(Zt)?(Dt="",Jt!=null&&(Dt=Jt.replace(bi,"$&/")+"/"),xt(Zt,lt,Dt,"",function(Fn){return Fn})):Zt!=null&&(Mt(Zt)&&(Zt=ut(Zt,Dt+(Zt.key==null||xe&&xe.key===Zt.key?"":(""+Zt.key).replace(bi,"$&/")+"/")+Jt)),lt.push(Zt)),1;Jt=0;var ar=vt===""?".":vt+":";if(It(xe))for(var zi=0;zi<xe.length;zi++)vt=xe[zi],ti=ar+te(vt,zi),Jt+=xt(vt,lt,Dt,ti,Zt);else if(zi=ne(xe),typeof zi=="function")for(xe=zi.call(xe),zi=0;!(vt=xe.next()).done;)vt=vt.value,ti=ar+te(vt,zi++),Jt+=xt(vt,lt,Dt,ti,Zt);else if(ti==="object"){if(typeof xe.then=="function")return xt(Fe(xe),lt,Dt,vt,Zt);throw lt=String(xe),Error("Objects are not valid as a React child (found: "+(lt==="[object Object]"?"object with keys {"+Object.keys(xe).join(", ")+"}":lt)+"). If you meant to render a collection of children, use an array instead.")}return Jt}function Ae(xe,lt,Dt){if(xe==null)return xe;var vt=[],Zt=0;return xt(xe,vt,"","",function(ti){return lt.call(Dt,ti,Zt++)}),vt}function st(xe){if(xe._status===-1){var lt=xe._result;lt=lt(),lt.then(function(Dt){(xe._status===0||xe._status===-1)&&(xe._status=1,xe._result=Dt)},function(Dt){(xe._status===0||xe._status===-1)&&(xe._status=2,xe._result=Dt)}),xe._status===-1&&(xe._status=0,xe._result=lt)}if(xe._status===1)return xe._result.default;throw xe._result}var Ct=typeof reportError=="function"?reportError:function(xe){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var lt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof xe=="object"&&xe!==null&&typeof xe.message=="string"?String(xe.message):String(xe),error:xe});if(!window.dispatchEvent(lt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",xe);return}console.error(xe)};function yi(){}return Fi.Children={map:Ae,forEach:function(xe,lt,Dt){Ae(xe,function(){lt.apply(this,arguments)},Dt)},count:function(xe){var lt=0;return Ae(xe,function(){lt++}),lt},toArray:function(xe){return Ae(xe,function(lt){return lt})||[]},only:function(xe){if(!Mt(xe))throw Error("React.Children.only expected to receive a single React element child.");return xe}},Fi.Component=tt,Fi.Fragment=n,Fi.Profiler=_,Fi.PureComponent=ht,Fi.StrictMode=h,Fi.Suspense=k,Fi.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=wt,Fi.__COMPILER_RUNTIME={__proto__:null,c:function(xe){return wt.H.useMemoCache(xe)}},Fi.cache=function(xe){return function(){return xe.apply(null,arguments)}},Fi.cloneElement=function(xe,lt,Dt){if(xe==null)throw Error("The argument must be a React element, but you passed "+xe+".");var vt=le({},xe.props),Zt=xe.key,ti=void 0;if(lt!=null)for(Jt in lt.ref!==void 0&&(ti=void 0),lt.key!==void 0&&(Zt=""+lt.key),lt)!zt.call(lt,Jt)||Jt==="key"||Jt==="__self"||Jt==="__source"||Jt==="ref"&&lt.ref===void 0||(vt[Jt]=lt[Jt]);var Jt=arguments.length-2;if(Jt===1)vt.children=Dt;else if(1<Jt){for(var ar=Array(Jt),zi=0;zi<Jt;zi++)ar[zi]=arguments[zi+2];vt.children=ar}return Pt(xe.type,Zt,void 0,void 0,ti,vt)},Fi.createContext=function(xe){return xe={$$typeof:S,_currentValue:xe,_currentValue2:xe,_threadCount:0,Provider:null,Consumer:null},xe.Provider=xe,xe.Consumer={$$typeof:T,_context:xe},xe},Fi.createElement=function(xe,lt,Dt){var vt,Zt={},ti=null;if(lt!=null)for(vt in lt.key!==void 0&&(ti=""+lt.key),lt)zt.call(lt,vt)&&vt!=="key"&&vt!=="__self"&&vt!=="__source"&&(Zt[vt]=lt[vt]);var Jt=arguments.length-2;if(Jt===1)Zt.children=Dt;else if(1<Jt){for(var ar=Array(Jt),zi=0;zi<Jt;zi++)ar[zi]=arguments[zi+2];Zt.children=ar}if(xe&&xe.defaultProps)for(vt in Jt=xe.defaultProps,Jt)Zt[vt]===void 0&&(Zt[vt]=Jt[vt]);return Pt(xe,ti,void 0,void 0,null,Zt)},Fi.createRef=function(){return{current:null}},Fi.forwardRef=function(xe){return{$$typeof:u,render:xe}},Fi.isValidElement=Mt,Fi.lazy=function(xe){return{$$typeof:q,_payload:{_status:-1,_result:xe},_init:st}},Fi.memo=function(xe,lt){return{$$typeof:B,type:xe,compare:lt===void 0?null:lt}},Fi.startTransition=function(xe){var lt=wt.T,Dt={};wt.T=Dt;try{var vt=xe(),Zt=wt.S;Zt!==null&&Zt(Dt,vt),typeof vt=="object"&&vt!==null&&typeof vt.then=="function"&&vt.then(yi,Ct)}catch(ti){Ct(ti)}finally{wt.T=lt}},Fi.unstable_useCacheRefresh=function(){return wt.H.useCacheRefresh()},Fi.use=function(xe){return wt.H.use(xe)},Fi.useActionState=function(xe,lt,Dt){return wt.H.useActionState(xe,lt,Dt)},Fi.useCallback=function(xe,lt){return wt.H.useCallback(xe,lt)},Fi.useContext=function(xe){return wt.H.useContext(xe)},Fi.useDebugValue=function(){},Fi.useDeferredValue=function(xe,lt){return wt.H.useDeferredValue(xe,lt)},Fi.useEffect=function(xe,lt,Dt){var vt=wt.H;if(typeof Dt=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return vt.useEffect(xe,lt)},Fi.useId=function(){return wt.H.useId()},Fi.useImperativeHandle=function(xe,lt,Dt){return wt.H.useImperativeHandle(xe,lt,Dt)},Fi.useInsertionEffect=function(xe,lt){return wt.H.useInsertionEffect(xe,lt)},Fi.useLayoutEffect=function(xe,lt){return wt.H.useLayoutEffect(xe,lt)},Fi.useMemo=function(xe,lt){return wt.H.useMemo(xe,lt)},Fi.useOptimistic=function(xe,lt){return wt.H.useOptimistic(xe,lt)},Fi.useReducer=function(xe,lt,Dt){return wt.H.useReducer(xe,lt,Dt)},Fi.useRef=function(xe){return wt.H.useRef(xe)},Fi.useState=function(xe){return wt.H.useState(xe)},Fi.useSyncExternalStore=function(xe,lt,Dt){return wt.H.useSyncExternalStore(xe,lt,Dt)},Fi.useTransition=function(){return wt.H.useTransition()},Fi.version="19.1.0",Fi}var xb;function k0(){return xb||(xb=1,wv.exports=e2()),wv.exports}var Je=k0(),Sv={exports:{}},Sg={},Tv={exports:{}},Ev={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wb;function t2(){return wb||(wb=1,function(r){function e(Ae,st){var Ct=Ae.length;Ae.push(st);e:for(;0<Ct;){var yi=Ct-1>>>1,xe=Ae[yi];if(0<_(xe,st))Ae[yi]=st,Ae[Ct]=xe,Ct=yi;else break e}}function n(Ae){return Ae.length===0?null:Ae[0]}function h(Ae){if(Ae.length===0)return null;var st=Ae[0],Ct=Ae.pop();if(Ct!==st){Ae[0]=Ct;e:for(var yi=0,xe=Ae.length,lt=xe>>>1;yi<lt;){var Dt=2*(yi+1)-1,vt=Ae[Dt],Zt=Dt+1,ti=Ae[Zt];if(0>_(vt,Ct))Zt<xe&&0>_(ti,vt)?(Ae[yi]=ti,Ae[Zt]=Ct,yi=Zt):(Ae[yi]=vt,Ae[Dt]=Ct,yi=Dt);else if(Zt<xe&&0>_(ti,Ct))Ae[yi]=ti,Ae[Zt]=Ct,yi=Zt;else break e}}return st}function _(Ae,st){var Ct=Ae.sortIndex-st.sortIndex;return Ct!==0?Ct:Ae.id-st.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var T=performance;r.unstable_now=function(){return T.now()}}else{var S=Date,u=S.now();r.unstable_now=function(){return S.now()-u}}var k=[],B=[],q=1,oe=null,ne=3,K=!1,le=!1,Ge=!1,tt=!1,Ke=typeof setTimeout=="function"?setTimeout:null,ht=typeof clearTimeout=="function"?clearTimeout:null,bt=typeof setImmediate<"u"?setImmediate:null;function It(Ae){for(var st=n(B);st!==null;){if(st.callback===null)h(B);else if(st.startTime<=Ae)h(B),st.sortIndex=st.expirationTime,e(k,st);else break;st=n(B)}}function wt(Ae){if(Ge=!1,It(Ae),!le)if(n(k)!==null)le=!0,zt||(zt=!0,te());else{var st=n(B);st!==null&&xt(wt,st.startTime-Ae)}}var zt=!1,Pt=-1,ut=5,Mt=-1;function Ri(){return tt?!0:!(r.unstable_now()-Mt<ut)}function bi(){if(tt=!1,zt){var Ae=r.unstable_now();Mt=Ae;var st=!0;try{e:{le=!1,Ge&&(Ge=!1,ht(Pt),Pt=-1),K=!0;var Ct=ne;try{t:{for(It(Ae),oe=n(k);oe!==null&&!(oe.expirationTime>Ae&&Ri());){var yi=oe.callback;if(typeof yi=="function"){oe.callback=null,ne=oe.priorityLevel;var xe=yi(oe.expirationTime<=Ae);if(Ae=r.unstable_now(),typeof xe=="function"){oe.callback=xe,It(Ae),st=!0;break t}oe===n(k)&&h(k),It(Ae)}else h(k);oe=n(k)}if(oe!==null)st=!0;else{var lt=n(B);lt!==null&&xt(wt,lt.startTime-Ae),st=!1}}break e}finally{oe=null,ne=Ct,K=!1}st=void 0}}finally{st?te():zt=!1}}}var te;if(typeof bt=="function")te=function(){bt(bi)};else if(typeof MessageChannel<"u"){var be=new MessageChannel,Fe=be.port2;be.port1.onmessage=bi,te=function(){Fe.postMessage(null)}}else te=function(){Ke(bi,0)};function xt(Ae,st){Pt=Ke(function(){Ae(r.unstable_now())},st)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(Ae){Ae.callback=null},r.unstable_forceFrameRate=function(Ae){0>Ae||125<Ae?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ut=0<Ae?Math.floor(1e3/Ae):5},r.unstable_getCurrentPriorityLevel=function(){return ne},r.unstable_next=function(Ae){switch(ne){case 1:case 2:case 3:var st=3;break;default:st=ne}var Ct=ne;ne=st;try{return Ae()}finally{ne=Ct}},r.unstable_requestPaint=function(){tt=!0},r.unstable_runWithPriority=function(Ae,st){switch(Ae){case 1:case 2:case 3:case 4:case 5:break;default:Ae=3}var Ct=ne;ne=Ae;try{return st()}finally{ne=Ct}},r.unstable_scheduleCallback=function(Ae,st,Ct){var yi=r.unstable_now();switch(typeof Ct=="object"&&Ct!==null?(Ct=Ct.delay,Ct=typeof Ct=="number"&&0<Ct?yi+Ct:yi):Ct=yi,Ae){case 1:var xe=-1;break;case 2:xe=250;break;case 5:xe=1073741823;break;case 4:xe=1e4;break;default:xe=5e3}return xe=Ct+xe,Ae={id:q++,callback:st,priorityLevel:Ae,startTime:Ct,expirationTime:xe,sortIndex:-1},Ct>yi?(Ae.sortIndex=Ct,e(B,Ae),n(k)===null&&Ae===n(B)&&(Ge?(ht(Pt),Pt=-1):Ge=!0,xt(wt,Ct-yi))):(Ae.sortIndex=xe,e(k,Ae),le||K||(le=!0,zt||(zt=!0,te()))),Ae},r.unstable_shouldYield=Ri,r.unstable_wrapCallback=function(Ae){var st=ne;return function(){var Ct=ne;ne=st;try{return Ae.apply(this,arguments)}finally{ne=Ct}}}}(Ev)),Ev}var Sb;function i2(){return Sb||(Sb=1,Tv.exports=t2()),Tv.exports}var Mv={exports:{}},ts={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Tb;function n2(){if(Tb)return ts;Tb=1;var r=k0();function e(k){var B="https://react.dev/errors/"+k;if(1<arguments.length){B+="?args[]="+encodeURIComponent(arguments[1]);for(var q=2;q<arguments.length;q++)B+="&args[]="+encodeURIComponent(arguments[q])}return"Minified React error #"+k+"; visit "+B+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var h={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},_=Symbol.for("react.portal");function T(k,B,q){var oe=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:_,key:oe==null?null:""+oe,children:k,containerInfo:B,implementation:q}}var S=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(k,B){if(k==="font")return"";if(typeof B=="string")return B==="use-credentials"?B:""}return ts.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=h,ts.createPortal=function(k,B){var q=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!B||B.nodeType!==1&&B.nodeType!==9&&B.nodeType!==11)throw Error(e(299));return T(k,B,null,q)},ts.flushSync=function(k){var B=S.T,q=h.p;try{if(S.T=null,h.p=2,k)return k()}finally{S.T=B,h.p=q,h.d.f()}},ts.preconnect=function(k,B){typeof k=="string"&&(B?(B=B.crossOrigin,B=typeof B=="string"?B==="use-credentials"?B:"":void 0):B=null,h.d.C(k,B))},ts.prefetchDNS=function(k){typeof k=="string"&&h.d.D(k)},ts.preinit=function(k,B){if(typeof k=="string"&&B&&typeof B.as=="string"){var q=B.as,oe=u(q,B.crossOrigin),ne=typeof B.integrity=="string"?B.integrity:void 0,K=typeof B.fetchPriority=="string"?B.fetchPriority:void 0;q==="style"?h.d.S(k,typeof B.precedence=="string"?B.precedence:void 0,{crossOrigin:oe,integrity:ne,fetchPriority:K}):q==="script"&&h.d.X(k,{crossOrigin:oe,integrity:ne,fetchPriority:K,nonce:typeof B.nonce=="string"?B.nonce:void 0})}},ts.preinitModule=function(k,B){if(typeof k=="string")if(typeof B=="object"&&B!==null){if(B.as==null||B.as==="script"){var q=u(B.as,B.crossOrigin);h.d.M(k,{crossOrigin:q,integrity:typeof B.integrity=="string"?B.integrity:void 0,nonce:typeof B.nonce=="string"?B.nonce:void 0})}}else B==null&&h.d.M(k)},ts.preload=function(k,B){if(typeof k=="string"&&typeof B=="object"&&B!==null&&typeof B.as=="string"){var q=B.as,oe=u(q,B.crossOrigin);h.d.L(k,q,{crossOrigin:oe,integrity:typeof B.integrity=="string"?B.integrity:void 0,nonce:typeof B.nonce=="string"?B.nonce:void 0,type:typeof B.type=="string"?B.type:void 0,fetchPriority:typeof B.fetchPriority=="string"?B.fetchPriority:void 0,referrerPolicy:typeof B.referrerPolicy=="string"?B.referrerPolicy:void 0,imageSrcSet:typeof B.imageSrcSet=="string"?B.imageSrcSet:void 0,imageSizes:typeof B.imageSizes=="string"?B.imageSizes:void 0,media:typeof B.media=="string"?B.media:void 0})}},ts.preloadModule=function(k,B){if(typeof k=="string")if(B){var q=u(B.as,B.crossOrigin);h.d.m(k,{as:typeof B.as=="string"&&B.as!=="script"?B.as:void 0,crossOrigin:q,integrity:typeof B.integrity=="string"?B.integrity:void 0})}else h.d.m(k)},ts.requestFormReset=function(k){h.d.r(k)},ts.unstable_batchedUpdates=function(k,B){return k(B)},ts.useFormState=function(k,B,q){return S.H.useFormState(k,B,q)},ts.useFormStatus=function(){return S.H.useHostTransitionStatus()},ts.version="19.1.0",ts}var Eb;function r2(){if(Eb)return Mv.exports;Eb=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),Mv.exports=n2(),Mv.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Mb;function a2(){if(Mb)return Sg;Mb=1;var r=i2(),e=k0(),n=r2();function h(a){var c="https://react.dev/errors/"+a;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)c+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+a+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function _(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function T(a){var c=a,p=a;if(a.alternate)for(;c.return;)c=c.return;else{a=c;do c=a,(c.flags&4098)!==0&&(p=c.return),a=c.return;while(a)}return c.tag===3?p:null}function S(a){if(a.tag===13){var c=a.memoizedState;if(c===null&&(a=a.alternate,a!==null&&(c=a.memoizedState)),c!==null)return c.dehydrated}return null}function u(a){if(T(a)!==a)throw Error(h(188))}function k(a){var c=a.alternate;if(!c){if(c=T(a),c===null)throw Error(h(188));return c!==a?null:a}for(var p=a,v=c;;){var A=p.return;if(A===null)break;var R=A.alternate;if(R===null){if(v=A.return,v!==null){p=v;continue}break}if(A.child===R.child){for(R=A.child;R;){if(R===p)return u(A),a;if(R===v)return u(A),c;R=R.sibling}throw Error(h(188))}if(p.return!==v.return)p=A,v=R;else{for(var G=!1,ee=A.child;ee;){if(ee===p){G=!0,p=A,v=R;break}if(ee===v){G=!0,v=A,p=R;break}ee=ee.sibling}if(!G){for(ee=R.child;ee;){if(ee===p){G=!0,p=R,v=A;break}if(ee===v){G=!0,v=R,p=A;break}ee=ee.sibling}if(!G)throw Error(h(189))}}if(p.alternate!==v)throw Error(h(190))}if(p.tag!==3)throw Error(h(188));return p.stateNode.current===p?a:c}function B(a){var c=a.tag;if(c===5||c===26||c===27||c===6)return a;for(a=a.child;a!==null;){if(c=B(a),c!==null)return c;a=a.sibling}return null}var q=Object.assign,oe=Symbol.for("react.element"),ne=Symbol.for("react.transitional.element"),K=Symbol.for("react.portal"),le=Symbol.for("react.fragment"),Ge=Symbol.for("react.strict_mode"),tt=Symbol.for("react.profiler"),Ke=Symbol.for("react.provider"),ht=Symbol.for("react.consumer"),bt=Symbol.for("react.context"),It=Symbol.for("react.forward_ref"),wt=Symbol.for("react.suspense"),zt=Symbol.for("react.suspense_list"),Pt=Symbol.for("react.memo"),ut=Symbol.for("react.lazy"),Mt=Symbol.for("react.activity"),Ri=Symbol.for("react.memo_cache_sentinel"),bi=Symbol.iterator;function te(a){return a===null||typeof a!="object"?null:(a=bi&&a[bi]||a["@@iterator"],typeof a=="function"?a:null)}var be=Symbol.for("react.client.reference");function Fe(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===be?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case le:return"Fragment";case tt:return"Profiler";case Ge:return"StrictMode";case wt:return"Suspense";case zt:return"SuspenseList";case Mt:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case K:return"Portal";case bt:return(a.displayName||"Context")+".Provider";case ht:return(a._context.displayName||"Context")+".Consumer";case It:var c=a.render;return a=a.displayName,a||(a=c.displayName||c.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case Pt:return c=a.displayName||null,c!==null?c:Fe(a.type)||"Memo";case ut:c=a._payload,a=a._init;try{return Fe(a(c))}catch{}}return null}var xt=Array.isArray,Ae=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,st=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Ct={pending:!1,data:null,method:null,action:null},yi=[],xe=-1;function lt(a){return{current:a}}function Dt(a){0>xe||(a.current=yi[xe],yi[xe]=null,xe--)}function vt(a,c){xe++,yi[xe]=a.current,a.current=c}var Zt=lt(null),ti=lt(null),Jt=lt(null),ar=lt(null);function zi(a,c){switch(vt(Jt,c),vt(ti,a),vt(Zt,null),c.nodeType){case 9:case 11:a=(a=c.documentElement)&&(a=a.namespaceURI)?Df(a):0;break;default:if(a=c.tagName,c=c.namespaceURI)c=Df(c),a=Rf(c,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}Dt(Zt),vt(Zt,a)}function Fn(){Dt(Zt),Dt(ti),Dt(Jt)}function Is(a){a.memoizedState!==null&&vt(ar,a);var c=Zt.current,p=Rf(c,a.type);c!==p&&(vt(ti,a),vt(Zt,p))}function qn(a){ti.current===a&&(Dt(Zt),Dt(ti)),ar.current===a&&(Dt(ar),kt._currentValue=Ct)}var sr=Object.prototype.hasOwnProperty,as=r.unstable_scheduleCallback,Nn=r.unstable_cancelCallback,yl=r.unstable_shouldYield,vl=r.unstable_requestPaint,dr=r.unstable_now,Po=r.unstable_getCurrentPriorityLevel,no=r.unstable_ImmediatePriority,Fa=r.unstable_UserBlockingPriority,fa=r.unstable_NormalPriority,vc=r.unstable_LowPriority,bl=r.unstable_IdlePriority,uu=r.log,xl=r.unstable_setDisableYieldValue,Na=null,Ir=null;function $r(a){if(typeof uu=="function"&&xl(a),Ir&&typeof Ir.setStrictMode=="function")try{Ir.setStrictMode(Na,a)}catch{}}var Wn=Math.clz32?Math.clz32:hu,ro=Math.log,bc=Math.LN2;function hu(a){return a>>>=0,a===0?32:31-(ro(a)/bc|0)|0}var wl=256,Ua=4194304;function De(a){var c=a&42;if(c!==0)return c;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function W(a,c,p){var v=a.pendingLanes;if(v===0)return 0;var A=0,R=a.suspendedLanes,G=a.pingedLanes;a=a.warmLanes;var ee=v&134217727;return ee!==0?(v=ee&~R,v!==0?A=De(v):(G&=ee,G!==0?A=De(G):p||(p=ee&~a,p!==0&&(A=De(p))))):(ee=v&~R,ee!==0?A=De(ee):G!==0?A=De(G):p||(p=v&~a,p!==0&&(A=De(p)))),A===0?0:c!==0&&c!==A&&(c&R)===0&&(R=A&-A,p=c&-c,R>=p||R===32&&(p&4194048)!==0)?c:A}function J(a,c){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&c)===0}function $(a,c){switch(a){case 1:case 2:case 4:case 8:case 64:return c+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function fe(){var a=wl;return wl<<=1,(wl&4194048)===0&&(wl=256),a}function Ee(){var a=Ua;return Ua<<=1,(Ua&62914560)===0&&(Ua=4194304),a}function we(a){for(var c=[],p=0;31>p;p++)c.push(a);return c}function ze(a,c){a.pendingLanes|=c,c!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function Ce(a,c,p,v,A,R){var G=a.pendingLanes;a.pendingLanes=p,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=p,a.entangledLanes&=p,a.errorRecoveryDisabledLanes&=p,a.shellSuspendCounter=0;var ee=a.entanglements,_e=a.expirationTimes,Ne=a.hiddenUpdates;for(p=G&~p;0<p;){var et=31-Wn(p),dt=1<<et;ee[et]=0,_e[et]=-1;var Ve=Ne[et];if(Ve!==null)for(Ne[et]=null,et=0;et<Ve.length;et++){var qe=Ve[et];qe!==null&&(qe.lane&=-536870913)}p&=~dt}v!==0&&Ye(a,v,0),R!==0&&A===0&&a.tag!==0&&(a.suspendedLanes|=R&~(G&~c))}function Ye(a,c,p){a.pendingLanes|=c,a.suspendedLanes&=~c;var v=31-Wn(c);a.entangledLanes|=c,a.entanglements[v]=a.entanglements[v]|1073741824|p&4194090}function Ze(a,c){var p=a.entangledLanes|=c;for(a=a.entanglements;p;){var v=31-Wn(p),A=1<<v;A&c|a[v]&c&&(a[v]|=c),p&=~A}}function Pe(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function nt(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function yt(){var a=st.p;return a!==0?a:(a=window.event,a===void 0?32:ca(a.type))}function St(a,c){var p=st.p;try{return st.p=a,c()}finally{st.p=p}}var je=Math.random().toString(36).slice(2),Vt="__reactFiber$"+je,Ot="__reactProps$"+je,Kt="__reactContainer$"+je,ki="__reactEvents$"+je,ct="__reactListeners$"+je,Bt="__reactHandles$"+je,_t="__reactResources$"+je,ii="__reactMarker$"+je;function In(a){delete a[Vt],delete a[Ot],delete a[ki],delete a[ct],delete a[Bt]}function pa(a){var c=a[Vt];if(c)return c;for(var p=a.parentNode;p;){if(c=p[Kt]||p[Vt]){if(p=c.alternate,c.child!==null||p!==null&&p.child!==null)for(a=_g(a);a!==null;){if(p=a[Vt])return p;a=_g(a)}return c}a=p,p=a.parentNode}return null}function Gt(a){if(a=a[Vt]||a[Kt]){var c=a.tag;if(c===5||c===6||c===13||c===26||c===27||c===3)return a}return null}function $n(a){var c=a.tag;if(c===5||c===26||c===27||c===6)return a.stateNode;throw Error(h(33))}function Xi(a){var c=a[_t];return c||(c=a[_t]={hoistableStyles:new Map,hoistableScripts:new Map}),c}function or(a){a[ii]=!0}var Sl=new Set,ao={};function fr(a,c){rn(a,c),rn(a+"Capture",c)}function rn(a,c){for(ao[a]=c,a=0;a<c.length;a++)Sl.add(c[a])}var Tm=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Tl={},Th={};function zo(a){return sr.call(Th,a)?!0:sr.call(Tl,a)?!1:Tm.test(a)?Th[a]=!0:(Tl[a]=!0,!1)}function so(a,c,p){if(zo(c))if(p===null)a.removeAttribute(c);else{switch(typeof p){case"undefined":case"function":case"symbol":a.removeAttribute(c);return;case"boolean":var v=c.toLowerCase().slice(0,5);if(v!=="data-"&&v!=="aria-"){a.removeAttribute(c);return}}a.setAttribute(c,""+p)}}function du(a,c,p){if(p===null)a.removeAttribute(c);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(c);return}a.setAttribute(c,""+p)}}function Cs(a,c,p,v){if(v===null)a.removeAttribute(p);else{switch(typeof v){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(p);return}a.setAttributeNS(c,p,""+v)}}var Eh,El;function Ml(a){if(Eh===void 0)try{throw Error()}catch(p){var c=p.stack.trim().match(/\n( *(at )?)/);Eh=c&&c[1]||"",El=-1<p.stack.indexOf(`
    at`)?" (<anonymous>)":-1<p.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Eh+a+El}var Bd=!1;function Mh(a,c){if(!a||Bd)return"";Bd=!0;var p=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var v={DetermineComponentFrameRoot:function(){try{if(c){var dt=function(){throw Error()};if(Object.defineProperty(dt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(dt,[])}catch(qe){var Ve=qe}Reflect.construct(a,[],dt)}else{try{dt.call()}catch(qe){Ve=qe}a.call(dt.prototype)}}else{try{throw Error()}catch(qe){Ve=qe}(dt=a())&&typeof dt.catch=="function"&&dt.catch(function(){})}}catch(qe){if(qe&&Ve&&typeof qe.stack=="string")return[qe.stack,Ve.stack]}return[null,null]}};v.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var A=Object.getOwnPropertyDescriptor(v.DetermineComponentFrameRoot,"name");A&&A.configurable&&Object.defineProperty(v.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var R=v.DetermineComponentFrameRoot(),G=R[0],ee=R[1];if(G&&ee){var _e=G.split(`
`),Ne=ee.split(`
`);for(A=v=0;v<_e.length&&!_e[v].includes("DetermineComponentFrameRoot");)v++;for(;A<Ne.length&&!Ne[A].includes("DetermineComponentFrameRoot");)A++;if(v===_e.length||A===Ne.length)for(v=_e.length-1,A=Ne.length-1;1<=v&&0<=A&&_e[v]!==Ne[A];)A--;for(;1<=v&&0<=A;v--,A--)if(_e[v]!==Ne[A]){if(v!==1||A!==1)do if(v--,A--,0>A||_e[v]!==Ne[A]){var et=`
`+_e[v].replace(" at new "," at ");return a.displayName&&et.includes("<anonymous>")&&(et=et.replace("<anonymous>",a.displayName)),et}while(1<=v&&0<=A);break}}}finally{Bd=!1,Error.prepareStackTrace=p}return(p=a?a.displayName||a.name:"")?Ml(p):""}function fu(a){switch(a.tag){case 26:case 27:case 5:return Ml(a.type);case 16:return Ml("Lazy");case 13:return Ml("Suspense");case 19:return Ml("SuspenseList");case 0:case 15:return Mh(a.type,!1);case 11:return Mh(a.type.render,!1);case 1:return Mh(a.type,!0);case 31:return Ml("Activity");default:return""}}function Ld(a){try{var c="";do c+=fu(a),a=a.return;while(a);return c}catch(p){return`
Error generating stack: `+p.message+`
`+p.stack}}function Aa(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function ko(a){var c=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function Fd(a){var c=ko(a)?"checked":"value",p=Object.getOwnPropertyDescriptor(a.constructor.prototype,c),v=""+a[c];if(!a.hasOwnProperty(c)&&typeof p<"u"&&typeof p.get=="function"&&typeof p.set=="function"){var A=p.get,R=p.set;return Object.defineProperty(a,c,{configurable:!0,get:function(){return A.call(this)},set:function(G){v=""+G,R.call(this,G)}}),Object.defineProperty(a,c,{enumerable:p.enumerable}),{getValue:function(){return v},setValue:function(G){v=""+G},stopTracking:function(){a._valueTracker=null,delete a[c]}}}}function pu(a){a._valueTracker||(a._valueTracker=Fd(a))}function Ah(a){if(!a)return!1;var c=a._valueTracker;if(!c)return!0;var p=c.getValue(),v="";return a&&(v=ko(a)?a.checked?"true":"false":a.value),a=v,a!==p?(c.setValue(a),!0):!1}function Al(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var mu=/[\n"\\]/g;function Qn(a){return a.replace(mu,function(c){return"\\"+c.charCodeAt(0).toString(16)+" "})}function wi(a,c,p,v,A,R,G,ee){a.name="",G!=null&&typeof G!="function"&&typeof G!="symbol"&&typeof G!="boolean"?a.type=G:a.removeAttribute("type"),c!=null?G==="number"?(c===0&&a.value===""||a.value!=c)&&(a.value=""+Aa(c)):a.value!==""+Aa(c)&&(a.value=""+Aa(c)):G!=="submit"&&G!=="reset"||a.removeAttribute("value"),c!=null?Ds(a,G,Aa(c)):p!=null?Ds(a,G,Aa(p)):v!=null&&a.removeAttribute("value"),A==null&&R!=null&&(a.defaultChecked=!!R),A!=null&&(a.checked=A&&typeof A!="function"&&typeof A!="symbol"),ee!=null&&typeof ee!="function"&&typeof ee!="symbol"&&typeof ee!="boolean"?a.name=""+Aa(ee):a.removeAttribute("name")}function Oo(a,c,p,v,A,R,G,ee){if(R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"&&(a.type=R),c!=null||p!=null){if(!(R!=="submit"&&R!=="reset"||c!=null))return;p=p!=null?""+Aa(p):"",c=c!=null?""+Aa(c):p,ee||c===a.value||(a.value=c),a.defaultValue=c}v=v??A,v=typeof v!="function"&&typeof v!="symbol"&&!!v,a.checked=ee?a.checked:!!v,a.defaultChecked=!!v,G!=null&&typeof G!="function"&&typeof G!="symbol"&&typeof G!="boolean"&&(a.name=G)}function Ds(a,c,p){c==="number"&&Al(a.ownerDocument)===a||a.defaultValue===""+p||(a.defaultValue=""+p)}function ma(a,c,p,v){if(a=a.options,c){c={};for(var A=0;A<p.length;A++)c["$"+p[A]]=!0;for(p=0;p<a.length;p++)A=c.hasOwnProperty("$"+a[p].value),a[p].selected!==A&&(a[p].selected=A),A&&v&&(a[p].defaultSelected=!0)}else{for(p=""+Aa(p),c=null,A=0;A<a.length;A++){if(a[A].value===p){a[A].selected=!0,v&&(a[A].defaultSelected=!0);return}c!==null||a[A].disabled||(c=a[A])}c!==null&&(c.selected=!0)}}function Il(a,c,p){if(c!=null&&(c=""+Aa(c),c!==a.value&&(a.value=c),p==null)){a.defaultValue!==c&&(a.defaultValue=c);return}a.defaultValue=p!=null?""+Aa(p):""}function Bi(a,c,p,v){if(c==null){if(v!=null){if(p!=null)throw Error(h(92));if(xt(v)){if(1<v.length)throw Error(h(93));v=v[0]}p=v}p==null&&(p=""),c=p}p=Aa(c),a.defaultValue=p,v=a.textContent,v===p&&v!==""&&v!==null&&(a.value=v)}function kr(a,c){if(c){var p=a.firstChild;if(p&&p===a.lastChild&&p.nodeType===3){p.nodeValue=c;return}}a.textContent=c}var gu=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Cl(a,c,p){var v=c.indexOf("--")===0;p==null||typeof p=="boolean"||p===""?v?a.setProperty(c,""):c==="float"?a.cssFloat="":a[c]="":v?a.setProperty(c,p):typeof p!="number"||p===0||gu.has(c)?c==="float"?a.cssFloat=p:a[c]=(""+p).trim():a[c]=p+"px"}function Hr(a,c,p){if(c!=null&&typeof c!="object")throw Error(h(62));if(a=a.style,p!=null){for(var v in p)!p.hasOwnProperty(v)||c!=null&&c.hasOwnProperty(v)||(v.indexOf("--")===0?a.setProperty(v,""):v==="float"?a.cssFloat="":a[v]="");for(var A in c)v=c[A],c.hasOwnProperty(A)&&p[A]!==v&&Cl(a,A,v)}else for(var R in c)c.hasOwnProperty(R)&&Cl(a,R,c[R])}function xr(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Cn=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ih=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Cr(a){return Ih.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}var Yr=null;function lr(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Dl=null,Ia=null;function vn(a){var c=Gt(a);if(c&&(a=c.stateNode)){var p=a[Ot]||null;e:switch(a=c.stateNode,c.type){case"input":if(wi(a,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name),c=p.name,p.type==="radio"&&c!=null){for(p=a;p.parentNode;)p=p.parentNode;for(p=p.querySelectorAll('input[name="'+Qn(""+c)+'"][type="radio"]'),c=0;c<p.length;c++){var v=p[c];if(v!==a&&v.form===a.form){var A=v[Ot]||null;if(!A)throw Error(h(90));wi(v,A.value,A.defaultValue,A.defaultValue,A.checked,A.defaultChecked,A.type,A.name)}}for(c=0;c<p.length;c++)v=p[c],v.form===a.form&&Ah(v)}break e;case"textarea":Il(a,p.value,p.defaultValue);break e;case"select":c=p.value,c!=null&&ma(a,!!p.multiple,c,!1)}}}var Bo=!1;function oo(a,c,p){if(Bo)return a(c,p);Bo=!0;try{var v=a(c);return v}finally{if(Bo=!1,(Dl!==null||Ia!==null)&&(xf(),Dl&&(c=Dl,a=Ia,Ia=Dl=null,vn(c),a)))for(c=0;c<a.length;c++)vn(a[c])}}function lo(a,c){var p=a.stateNode;if(p===null)return null;var v=p[Ot]||null;if(v===null)return null;p=v[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(v=!v.disabled)||(a=a.type,v=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!v;break e;default:a=!1}if(a)return null;if(p&&typeof p!="function")throw Error(h(231,c,typeof p));return p}var Jn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),sn=!1;if(Jn)try{var ga={};Object.defineProperty(ga,"passive",{get:function(){sn=!0}}),window.addEventListener("test",ga,ga),window.removeEventListener("test",ga,ga)}catch{sn=!1}var Ei=null,gi=null,co=null;function Oi(){if(co)return co;var a,c=gi,p=c.length,v,A="value"in Ei?Ei.value:Ei.textContent,R=A.length;for(a=0;a<p&&c[a]===A[a];a++);var G=p-a;for(v=1;v<=G&&c[p-v]===A[R-v];v++);return co=A.slice(a,1<v?1-v:void 0)}function uo(a){var c=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&c===13&&(a=13)):a=c,a===10&&(a=13),32<=a||a===13?a:0}function _a(){return!0}function xc(){return!1}function Dr(a){function c(p,v,A,R,G){this._reactName=p,this._targetInst=A,this.type=v,this.nativeEvent=R,this.target=G,this.currentTarget=null;for(var ee in a)a.hasOwnProperty(ee)&&(p=a[ee],this[ee]=p?p(R):R[ee]);return this.isDefaultPrevented=(R.defaultPrevented!=null?R.defaultPrevented:R.returnValue===!1)?_a:xc,this.isPropagationStopped=xc,this}return q(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var p=this.nativeEvent;p&&(p.preventDefault?p.preventDefault():typeof p.returnValue!="unknown"&&(p.returnValue=!1),this.isDefaultPrevented=_a)},stopPropagation:function(){var p=this.nativeEvent;p&&(p.stopPropagation?p.stopPropagation():typeof p.cancelBubble!="unknown"&&(p.cancelBubble=!0),this.isPropagationStopped=_a)},persist:function(){},isPersistent:_a}),c}var Rs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Lo=Dr(Rs),ho=q({},Rs,{view:0,detail:0}),Ch=Dr(ho),Fo,Dh,ss,pr=q({},ho,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:po,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==ss&&(ss&&a.type==="mousemove"?(Fo=a.screenX-ss.screenX,Dh=a.screenY-ss.screenY):Dh=Fo=0,ss=a),Fo)},movementY:function(a){return"movementY"in a?a.movementY:Dh}}),_u=Dr(pr),qf=q({},pr,{dataTransfer:0}),Xr=Dr(qf),mr=q({},ho,{relatedTarget:0}),Ca=Dr(mr),wc=q({},Rs,{animationName:0,elapsedTime:0,pseudoElement:0}),Nd=Dr(wc),$f=q({},Rs,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),fo=Dr($f),Ud=q({},Rs,{data:0}),Hf=Dr(Ud),Rh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ph={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},os={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Yf(a){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(a):(a=os[a])?!!c[a]:!1}function po(){return Yf}var jd=q({},ho,{key:function(a){if(a.key){var c=Rh[a.key]||a.key;if(c!=="Unidentified")return c}return a.type==="keypress"?(a=uo(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?Ph[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:po,charCode:function(a){return a.type==="keypress"?uo(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?uo(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),Sc=Dr(jd),Vd=q({},pr,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),zh=Dr(Vd),Ps=q({},ho,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:po}),Em=Dr(Ps),Tc=q({},Rs,{propertyName:0,elapsedTime:0,pseudoElement:0}),yu=Dr(Tc),Ec=q({},pr,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),Xf=Dr(Ec),kh=q({},Rs,{newState:0,oldState:0}),Kf=Dr(kh),Mc=[9,13,27,32],Zd=Jn&&"CompositionEvent"in window,Ac=null;Jn&&"documentMode"in document&&(Ac=document.documentMode);var Mm=Jn&&"TextEvent"in window&&!Ac,Gd=Jn&&(!Zd||Ac&&8<Ac&&11>=Ac),vu=" ",Oh=!1;function Bh(a,c){switch(a){case"keyup":return Mc.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function qd(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Rl=!1;function Pl(a,c){switch(a){case"compositionend":return qd(c);case"keypress":return c.which!==32?null:(Oh=!0,vu);case"textInput":return a=c.data,a===vu&&Oh?null:a;default:return null}}function Lh(a,c){if(Rl)return a==="compositionend"||!Zd&&Bh(a,c)?(a=Oi(),co=gi=Ei=null,Rl=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return Gd&&c.locale!=="ko"?null:c.data;default:return null}}var Wf={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ic(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c==="input"?!!Wf[a.type]:c==="textarea"}function Qf(a,c,p,v){Dl?Ia?Ia.push(v):Ia=[v]:Dl=v,c=Lp(c,"onChange"),0<c.length&&(p=new Lo("onChange","change",null,p,v),a.push({event:p,listeners:c}))}var mo=null,Cc=null;function Am(a){es(a,0)}function bu(a){var c=$n(a);if(Ah(c))return a}function Fh(a,c){if(a==="change")return c}var Nh=!1;if(Jn){var xu;if(Jn){var Uh="oninput"in document;if(!Uh){var wu=document.createElement("div");wu.setAttribute("oninput","return;"),Uh=typeof wu.oninput=="function"}xu=Uh}else xu=!1;Nh=xu&&(!document.documentMode||9<document.documentMode)}function ls(){mo&&(mo.detachEvent("onpropertychange",jh),Cc=mo=null)}function jh(a){if(a.propertyName==="value"&&bu(Cc)){var c=[];Qf(c,Cc,a,lr(a)),oo(Am,c)}}function $d(a,c,p){a==="focusin"?(ls(),mo=c,Cc=p,mo.attachEvent("onpropertychange",jh)):a==="focusout"&&ls()}function Hd(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return bu(Cc)}function Jf(a,c){if(a==="click")return bu(c)}function qi(a,c){if(a==="input"||a==="change")return bu(c)}function zl(a,c){return a===c&&(a!==0||1/a===1/c)||a!==a&&c!==c}var ta=typeof Object.is=="function"?Object.is:zl;function Su(a,c){if(ta(a,c))return!0;if(typeof a!="object"||a===null||typeof c!="object"||c===null)return!1;var p=Object.keys(a),v=Object.keys(c);if(p.length!==v.length)return!1;for(v=0;v<p.length;v++){var A=p[v];if(!sr.call(c,A)||!ta(a[A],c[A]))return!1}return!0}function ep(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function tp(a,c){var p=ep(a);a=0;for(var v;p;){if(p.nodeType===3){if(v=a+p.textContent.length,a<=c&&v>=c)return{node:p,offset:c-a};a=v}e:{for(;p;){if(p.nextSibling){p=p.nextSibling;break e}p=p.parentNode}p=void 0}p=ep(p)}}function ip(a,c){return a&&c?a===c?!0:a&&a.nodeType===3?!1:c&&c.nodeType===3?ip(a,c.parentNode):"contains"in a?a.contains(c):a.compareDocumentPosition?!!(a.compareDocumentPosition(c)&16):!1:!1}function Yd(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var c=Al(a.document);c instanceof a.HTMLIFrameElement;){try{var p=typeof c.contentWindow.location.href=="string"}catch{p=!1}if(p)a=c.contentWindow;else break;c=Al(a.document)}return c}function Xd(a){var c=a&&a.nodeName&&a.nodeName.toLowerCase();return c&&(c==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||c==="textarea"||a.contentEditable==="true")}var np=Jn&&"documentMode"in document&&11>=document.documentMode,go=null,Dc=null,No=null,Tu=!1;function Uo(a,c,p){var v=p.window===p?p.document:p.nodeType===9?p:p.ownerDocument;Tu||go==null||go!==Al(v)||(v=go,"selectionStart"in v&&Xd(v)?v={start:v.selectionStart,end:v.selectionEnd}:(v=(v.ownerDocument&&v.ownerDocument.defaultView||window).getSelection(),v={anchorNode:v.anchorNode,anchorOffset:v.anchorOffset,focusNode:v.focusNode,focusOffset:v.focusOffset}),No&&Su(No,v)||(No=v,v=Lp(Dc,"onSelect"),0<v.length&&(c=new Lo("onSelect","select",null,c,p),a.push({event:c,listeners:v}),c.target=go)))}function ja(a,c){var p={};return p[a.toLowerCase()]=c.toLowerCase(),p["Webkit"+a]="webkit"+c,p["Moz"+a]="moz"+c,p}var Or={animationend:ja("Animation","AnimationEnd"),animationiteration:ja("Animation","AnimationIteration"),animationstart:ja("Animation","AnimationStart"),transitionrun:ja("Transition","TransitionRun"),transitionstart:ja("Transition","TransitionStart"),transitioncancel:ja("Transition","TransitionCancel"),transitionend:ja("Transition","TransitionEnd")},Vh={},Kd={};Jn&&(Kd=document.createElement("div").style,"AnimationEvent"in window||(delete Or.animationend.animation,delete Or.animationiteration.animation,delete Or.animationstart.animation),"TransitionEvent"in window||delete Or.transitionend.transition);function _o(a){if(Vh[a])return Vh[a];if(!Or[a])return a;var c=Or[a],p;for(p in c)if(c.hasOwnProperty(p)&&p in Kd)return Vh[a]=c[p];return a}var jo=_o("animationend"),Eu=_o("animationiteration"),Mu=_o("animationstart"),Au=_o("transitionrun"),Zh=_o("transitionstart"),rp=_o("transitioncancel"),kl=_o("transitionend"),Ol=new Map,Gh="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Gh.push("scrollEnd");function Da(a,c){Ol.set(a,c),fr(c,[a])}var Ui=new WeakMap;function ia(a,c){if(typeof a=="object"&&a!==null){var p=Ui.get(a);return p!==void 0?p:(c={value:a,source:c,stack:Ld(c)},Ui.set(a,c),c)}return{value:a,source:c,stack:Ld(c)}}var ya=[],Bl=0,Ll=0;function qh(){for(var a=Bl,c=Ll=Bl=0;c<a;){var p=ya[c];ya[c++]=null;var v=ya[c];ya[c++]=null;var A=ya[c];ya[c++]=null;var R=ya[c];if(ya[c++]=null,v!==null&&A!==null){var G=v.pending;G===null?A.next=A:(A.next=G.next,G.next=A),v.pending=A}R!==0&&Fl(p,A,R)}}function Iu(a,c,p,v){ya[Bl++]=a,ya[Bl++]=c,ya[Bl++]=p,ya[Bl++]=v,Ll|=v,a.lanes|=v,a=a.alternate,a!==null&&(a.lanes|=v)}function $h(a,c,p,v){return Iu(a,c,p,v),Vo(a)}function Rc(a,c){return Iu(a,null,null,c),Vo(a)}function Fl(a,c,p){a.lanes|=p;var v=a.alternate;v!==null&&(v.lanes|=p);for(var A=!1,R=a.return;R!==null;)R.childLanes|=p,v=R.alternate,v!==null&&(v.childLanes|=p),R.tag===22&&(a=R.stateNode,a===null||a._visibility&1||(A=!0)),a=R,R=R.return;return a.tag===3?(R=a.stateNode,A&&c!==null&&(A=31-Wn(p),a=R.hiddenUpdates,v=a[A],v===null?a[A]=[c]:v.push(c),c.lane=p|536870912),R):null}function Vo(a){if(50<Xs)throw Xs=0,md=null,Error(h(185));for(var c=a.return;c!==null;)a=c,c=a.return;return a.tag===3?a.stateNode:null}var yo={};function Wd(a,c,p,v){this.tag=a,this.key=p,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=v,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function na(a,c,p,v){return new Wd(a,c,p,v)}function Hh(a){return a=a.prototype,!(!a||!a.isReactComponent)}function Va(a,c){var p=a.alternate;return p===null?(p=na(a.tag,c,a.key,a.mode),p.elementType=a.elementType,p.type=a.type,p.stateNode=a.stateNode,p.alternate=a,a.alternate=p):(p.pendingProps=c,p.type=a.type,p.flags=0,p.subtreeFlags=0,p.deletions=null),p.flags=a.flags&65011712,p.childLanes=a.childLanes,p.lanes=a.lanes,p.child=a.child,p.memoizedProps=a.memoizedProps,p.memoizedState=a.memoizedState,p.updateQueue=a.updateQueue,c=a.dependencies,p.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},p.sibling=a.sibling,p.index=a.index,p.ref=a.ref,p.refCleanup=a.refCleanup,p}function Pc(a,c){a.flags&=65011714;var p=a.alternate;return p===null?(a.childLanes=0,a.lanes=c,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=p.childLanes,a.lanes=p.lanes,a.child=p.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=p.memoizedProps,a.memoizedState=p.memoizedState,a.updateQueue=p.updateQueue,a.type=p.type,c=p.dependencies,a.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext}),a}function Nl(a,c,p,v,A,R){var G=0;if(v=a,typeof a=="function")Hh(a)&&(G=1);else if(typeof a=="string")G=ie(a,p,Zt.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case Mt:return a=na(31,p,c,A),a.elementType=Mt,a.lanes=R,a;case le:return Ul(p.children,A,R,c);case Ge:G=8,A|=24;break;case tt:return a=na(12,p,c,A|2),a.elementType=tt,a.lanes=R,a;case wt:return a=na(13,p,c,A),a.elementType=wt,a.lanes=R,a;case zt:return a=na(19,p,c,A),a.elementType=zt,a.lanes=R,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case Ke:case bt:G=10;break e;case ht:G=9;break e;case It:G=11;break e;case Pt:G=14;break e;case ut:G=16,v=null;break e}G=29,p=Error(h(130,a===null?"null":typeof a,"")),v=null}return c=na(G,p,c,A),c.elementType=a,c.type=v,c.lanes=R,c}function Ul(a,c,p,v){return a=na(7,a,v,c),a.lanes=p,a}function Cu(a,c,p){return a=na(6,a,null,c),a.lanes=p,a}function Yh(a,c,p){return c=na(4,a.children!==null?a.children:[],a.key,c),c.lanes=p,c.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},c}var Zo=[],zs=0,jl=null,Vl=0,ra=[],Br=0,Za=null,vo=1,ks="";function on(a,c){Zo[zs++]=Vl,Zo[zs++]=jl,jl=a,Vl=c}function Go(a,c,p){ra[Br++]=vo,ra[Br++]=ks,ra[Br++]=Za,Za=a;var v=vo;a=ks;var A=32-Wn(v)-1;v&=~(1<<A),p+=1;var R=32-Wn(c)+A;if(30<R){var G=A-A%5;R=(v&(1<<G)-1).toString(32),v>>=G,A-=G,vo=1<<32-Wn(c)+A|p<<A|v,ks=R+a}else vo=1<<R|p<<A|v,ks=a}function va(a){a.return!==null&&(on(a,1),Go(a,1,0))}function Du(a){for(;a===jl;)jl=Zo[--zs],Zo[zs]=null,Vl=Zo[--zs],Zo[zs]=null;for(;a===Za;)Za=ra[--Br],ra[Br]=null,ks=ra[--Br],ra[Br]=null,vo=ra[--Br],ra[Br]=null}var Rr=null,Un=null,Pi=!1,cs=null,Ra=!1,Ru=Error(h(519));function qo(a){var c=Error(h(418,""));throw zc(ia(c,a)),Ru}function Xh(a){var c=a.stateNode,p=a.type,v=a.memoizedProps;switch(c[Vt]=a,c[Ot]=v,p){case"dialog":Ci("cancel",c),Ci("close",c);break;case"iframe":case"object":case"embed":Ci("load",c);break;case"video":case"audio":for(p=0;p<ih.length;p++)Ci(ih[p],c);break;case"source":Ci("error",c);break;case"img":case"image":case"link":Ci("error",c),Ci("load",c);break;case"details":Ci("toggle",c);break;case"input":Ci("invalid",c),Oo(c,v.value,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name,!0),pu(c);break;case"select":Ci("invalid",c);break;case"textarea":Ci("invalid",c),Bi(c,v.value,v.defaultValue,v.children),pu(c)}p=v.children,typeof p!="string"&&typeof p!="number"&&typeof p!="bigint"||c.textContent===""+p||v.suppressHydrationWarning===!0||hg(c.textContent,p)?(v.popover!=null&&(Ci("beforetoggle",c),Ci("toggle",c)),v.onScroll!=null&&Ci("scroll",c),v.onScrollEnd!=null&&Ci("scrollend",c),v.onClick!=null&&(c.onclick=Fp),c=!0):c=!1,c||qo(a)}function Kh(a){for(Rr=a.return;Rr;)switch(Rr.tag){case 5:case 13:Ra=!1;return;case 27:case 3:Ra=!0;return;default:Rr=Rr.return}}function Os(a){if(a!==Rr)return!1;if(!Pi)return Kh(a),Pi=!0,!1;var c=a.tag,p;if((p=c!==3&&c!==27)&&((p=c===5)&&(p=a.type,p=!(p!=="form"&&p!=="button")||dg(a.type,a.memoizedProps)),p=!p),p&&Un&&qo(a),Kh(a),c===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(h(317));e:{for(a=a.nextSibling,c=0;a;){if(a.nodeType===8)if(p=a.data,p==="/$"){if(c===0){Un=vs(a.nextSibling);break e}c--}else p!=="$"&&p!=="$!"&&p!=="$?"||c++;a=a.nextSibling}Un=null}}else c===27?(c=Un,cc(a.type)?(a=Pf,Pf=null,Un=a):Un=c):Un=Rr?vs(a.stateNode.nextSibling):null;return!0}function us(){Un=Rr=null,Pi=!1}function Qd(){var a=cs;return a!==null&&(wa===null?wa=a:wa.push.apply(wa,a),cs=null),a}function zc(a){cs===null?cs=[a]:cs.push(a)}var Wh=lt(null),$o=null,Bs=null;function Pa(a,c,p){vt(Wh,c._currentValue),c._currentValue=p}function ba(a){a._currentValue=Wh.current,Dt(Wh)}function Pr(a,c,p){for(;a!==null;){var v=a.alternate;if((a.childLanes&c)!==c?(a.childLanes|=c,v!==null&&(v.childLanes|=c)):v!==null&&(v.childLanes&c)!==c&&(v.childLanes|=c),a===p)break;a=a.return}}function Ho(a,c,p,v){var A=a.child;for(A!==null&&(A.return=a);A!==null;){var R=A.dependencies;if(R!==null){var G=A.child;R=R.firstContext;e:for(;R!==null;){var ee=R;R=A;for(var _e=0;_e<c.length;_e++)if(ee.context===c[_e]){R.lanes|=p,ee=R.alternate,ee!==null&&(ee.lanes|=p),Pr(R.return,p,a),v||(G=null);break e}R=ee.next}}else if(A.tag===18){if(G=A.return,G===null)throw Error(h(341));G.lanes|=p,R=G.alternate,R!==null&&(R.lanes|=p),Pr(G,p,a),G=null}else G=A.child;if(G!==null)G.return=A;else for(G=A;G!==null;){if(G===a){G=null;break}if(A=G.sibling,A!==null){A.return=G.return,G=A;break}G=G.return}A=G}}function Kr(a,c,p,v){a=null;for(var A=c,R=!1;A!==null;){if(!R){if((A.flags&524288)!==0)R=!0;else if((A.flags&262144)!==0)break}if(A.tag===10){var G=A.alternate;if(G===null)throw Error(h(387));if(G=G.memoizedProps,G!==null){var ee=A.type;ta(A.pendingProps.value,G.value)||(a!==null?a.push(ee):a=[ee])}}else if(A===ar.current){if(G=A.alternate,G===null)throw Error(h(387));G.memoizedState.memoizedState!==A.memoizedState.memoizedState&&(a!==null?a.push(kt):a=[kt])}A=A.return}a!==null&&Ho(c,a,p,v),c.flags|=262144}function za(a){for(a=a.firstContext;a!==null;){if(!ta(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function Yo(a){$o=a,Bs=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function an(a){return Qh($o,a)}function Ls(a,c){return $o===null&&Yo(a),Qh(a,c)}function Qh(a,c){var p=c._currentValue;if(c={context:c,memoizedValue:p,next:null},Bs===null){if(a===null)throw Error(h(308));Bs=c,a.dependencies={lanes:0,firstContext:c},a.flags|=524288}else Bs=Bs.next=c;return p}var Im=typeof AbortController<"u"?AbortController:function(){var a=[],c=this.signal={aborted:!1,addEventListener:function(p,v){a.push(v)}};this.abort=function(){c.aborted=!0,a.forEach(function(p){return p()})}},Jd=r.unstable_scheduleCallback,Cm=r.unstable_NormalPriority,jn={$$typeof:bt,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Zl(){return{controller:new Im,data:new Map,refCount:0}}function Lr(a){a.refCount--,a.refCount===0&&Jd(Cm,function(){a.controller.abort()})}var Rt=null,Jh=0,hs=0,Gl=null;function ql(a,c){if(Rt===null){var p=Rt=[];Jh=0,hs=Pp(),Gl={status:"pending",value:void 0,then:function(v){p.push(v)}}}return Jh++,c.then(bo,bo),c}function bo(){if(--Jh===0&&Rt!==null){Gl!==null&&(Gl.status="fulfilled");var a=Rt;Rt=null,hs=0,Gl=null;for(var c=0;c<a.length;c++)(0,a[c])()}}function ef(a,c){var p=[],v={status:"pending",value:null,reason:null,then:function(A){p.push(A)}};return a.then(function(){v.status="fulfilled",v.value=c;for(var A=0;A<p.length;A++)(0,p[A])(c)},function(A){for(v.status="rejected",v.reason=A,A=0;A<p.length;A++)(0,p[A])(void 0)}),v}var Mi=Ae.S;Ae.S=function(a,c){typeof c=="object"&&c!==null&&typeof c.then=="function"&&ql(a,c),Mi!==null&&Mi(a,c)};var Fs=lt(null);function ed(){var a=Fs.current;return a!==null?a:Rn.pooledCache}function Xo(a,c){c===null?vt(Fs,Fs.current):vt(Fs,c.pool)}function tf(){var a=ed();return a===null?null:{parent:jn._currentValue,pool:a}}var Pu=Error(h(460)),td=Error(h(474)),kc=Error(h(542)),zu={then:function(){}};function nf(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Oc(){}function ap(a,c,p){switch(p=a[p],p===void 0?a.push(c):p!==c&&(c.then(Oc,Oc),c=p),c.status){case"fulfilled":return c.value;case"rejected":throw a=c.reason,fn(a),a;default:if(typeof c.status=="string")c.then(Oc,Oc);else{if(a=Rn,a!==null&&100<a.shellSuspendCounter)throw Error(h(482));a=c,a.status="pending",a.then(function(v){if(c.status==="pending"){var A=c;A.status="fulfilled",A.value=v}},function(v){if(c.status==="pending"){var A=c;A.status="rejected",A.reason=v}})}switch(c.status){case"fulfilled":return c.value;case"rejected":throw a=c.reason,fn(a),a}throw ku=c,Pu}}var ku=null;function Ns(){if(ku===null)throw Error(h(459));var a=ku;return ku=null,a}function fn(a){if(a===Pu||a===kc)throw Error(h(483))}var Ga=!1;function Bc(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function $l(a,c){a=a.updateQueue,c.updateQueue===a&&(c.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function xo(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function ds(a,c,p){var v=a.updateQueue;if(v===null)return null;if(v=v.shared,(cn&2)!==0){var A=v.pending;return A===null?c.next=c:(c.next=A.next,A.next=c),v.pending=c,c=Vo(a),Fl(a,null,p),c}return Iu(a,v,c,p),Vo(a)}function Ou(a,c,p){if(c=c.updateQueue,c!==null&&(c=c.shared,(p&4194048)!==0)){var v=c.lanes;v&=a.pendingLanes,p|=v,c.lanes=p,Ze(a,p)}}function qa(a,c){var p=a.updateQueue,v=a.alternate;if(v!==null&&(v=v.updateQueue,p===v)){var A=null,R=null;if(p=p.firstBaseUpdate,p!==null){do{var G={lane:p.lane,tag:p.tag,payload:p.payload,callback:null,next:null};R===null?A=R=G:R=R.next=G,p=p.next}while(p!==null);R===null?A=R=c:R=R.next=c}else A=R=c;p={baseState:v.baseState,firstBaseUpdate:A,lastBaseUpdate:R,shared:v.shared,callbacks:v.callbacks},a.updateQueue=p;return}a=p.lastBaseUpdate,a===null?p.firstBaseUpdate=c:a.next=c,p.lastBaseUpdate=c}var Hl=!1;function Nt(){if(Hl){var a=Gl;if(a!==null)throw a}}function qt(a,c,p,v){Hl=!1;var A=a.updateQueue;Ga=!1;var R=A.firstBaseUpdate,G=A.lastBaseUpdate,ee=A.shared.pending;if(ee!==null){A.shared.pending=null;var _e=ee,Ne=_e.next;_e.next=null,G===null?R=Ne:G.next=Ne,G=_e;var et=a.alternate;et!==null&&(et=et.updateQueue,ee=et.lastBaseUpdate,ee!==G&&(ee===null?et.firstBaseUpdate=Ne:ee.next=Ne,et.lastBaseUpdate=_e))}if(R!==null){var dt=A.baseState;G=0,et=Ne=_e=null,ee=R;do{var Ve=ee.lane&-536870913,qe=Ve!==ee.lane;if(qe?(Zi&Ve)===Ve:(v&Ve)===Ve){Ve!==0&&Ve===hs&&(Hl=!0),et!==null&&(et=et.next={lane:0,tag:ee.tag,payload:ee.payload,callback:null,next:null});e:{var ui=a,ri=ee;Ve=c;var Si=p;switch(ri.tag){case 1:if(ui=ri.payload,typeof ui=="function"){dt=ui.call(Si,dt,Ve);break e}dt=ui;break e;case 3:ui.flags=ui.flags&-65537|128;case 0:if(ui=ri.payload,Ve=typeof ui=="function"?ui.call(Si,dt,Ve):ui,Ve==null)break e;dt=q({},dt,Ve);break e;case 2:Ga=!0}}Ve=ee.callback,Ve!==null&&(a.flags|=64,qe&&(a.flags|=8192),qe=A.callbacks,qe===null?A.callbacks=[Ve]:qe.push(Ve))}else qe={lane:Ve,tag:ee.tag,payload:ee.payload,callback:ee.callback,next:null},et===null?(Ne=et=qe,_e=dt):et=et.next=qe,G|=Ve;if(ee=ee.next,ee===null){if(ee=A.shared.pending,ee===null)break;qe=ee,ee=qe.next,qe.next=null,A.lastBaseUpdate=qe,A.shared.pending=null}}while(!0);et===null&&(_e=dt),A.baseState=_e,A.firstBaseUpdate=Ne,A.lastBaseUpdate=et,R===null&&(A.shared.lanes=0),Gc|=G,a.lanes=G,a.memoizedState=dt}}function Bu(a,c){if(typeof a!="function")throw Error(h(191,a));a.call(c)}function id(a,c){var p=a.callbacks;if(p!==null)for(a.callbacks=null,a=0;a<p.length;a++)Bu(p[a],c)}var Ko=lt(null),Fr=lt(0);function rf(a,c){a=ol,vt(Fr,a),vt(Ko,c),ol=a|c.baseLanes}function Nr(){vt(Fr,ol),vt(Ko,Ko.current)}function af(){ol=Fr.current,Dt(Ko),Dt(Fr)}var $a=0,Ht=null,ni=null,cr=null,Wo=!1,aa=!1,Us=!1,Qo=0,Jo=0,Ha=null,sf=0;function bn(){throw Error(h(321))}function wo(a,c){if(c===null)return!1;for(var p=0;p<c.length&&p<a.length;p++)if(!ta(a[p],c[p]))return!1;return!0}function Lu(a,c,p,v,A,R){return $a=R,Ht=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,Ae.H=a===null||a.memoizedState===null?sp:cf,Us=!1,R=p(v,A),Us=!1,aa&&(R=el(c,p,v,A)),Fu(a),R}function Fu(a){Ae.H=Gs;var c=ni!==null&&ni.next!==null;if($a=0,cr=ni=Ht=null,Wo=!1,Jo=0,Ha=null,c)throw Error(h(300));a===null||Ur||(a=a.dependencies,a!==null&&za(a)&&(Ur=!0))}function el(a,c,p,v){Ht=a;var A=0;do{if(aa&&(Ha=null),Jo=0,aa=!1,25<=A)throw Error(h(301));if(A+=1,cr=ni=null,a.updateQueue!=null){var R=a.updateQueue;R.lastEffect=null,R.events=null,R.stores=null,R.memoCache!=null&&(R.memoCache.index=0)}Ae.H=uf,R=c(p,v)}while(aa);return R}function of(){var a=Ae.H,c=a.useState()[0];return c=typeof c.then=="function"?f(c):c,a=a.useState()[0],(ni!==null?ni.memoizedState:null)!==a&&(Ht.flags|=1024),c}function Nu(){var a=Qo!==0;return Qo=0,a}function Yl(a,c,p){c.updateQueue=a.updateQueue,c.flags&=-2053,a.lanes&=~p}function Uu(a){if(Wo){for(a=a.memoizedState;a!==null;){var c=a.queue;c!==null&&(c.pending=null),a=a.next}Wo=!1}$a=0,cr=ni=Ht=null,aa=!1,Jo=Qo=0,Ha=null}function y(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return cr===null?Ht.memoizedState=cr=a:cr=cr.next=a,cr}function t(){if(ni===null){var a=Ht.alternate;a=a!==null?a.memoizedState:null}else a=ni.next;var c=cr===null?Ht.memoizedState:cr.next;if(c!==null)cr=c,ni=a;else{if(a===null)throw Ht.alternate===null?Error(h(467)):Error(h(310));ni=a,a={memoizedState:ni.memoizedState,baseState:ni.baseState,baseQueue:ni.baseQueue,queue:ni.queue,next:null},cr===null?Ht.memoizedState=cr=a:cr=cr.next=a}return cr}function s(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function f(a){var c=Jo;return Jo+=1,Ha===null&&(Ha=[]),a=ap(Ha,a,c),c=Ht,(cr===null?c.memoizedState:cr.next)===null&&(c=c.alternate,Ae.H=c===null||c.memoizedState===null?sp:cf),a}function m(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return f(a);if(a.$$typeof===bt)return an(a)}throw Error(h(438,String(a)))}function b(a){var c=null,p=Ht.updateQueue;if(p!==null&&(c=p.memoCache),c==null){var v=Ht.alternate;v!==null&&(v=v.updateQueue,v!==null&&(v=v.memoCache,v!=null&&(c={data:v.data.map(function(A){return A.slice()}),index:0})))}if(c==null&&(c={data:[],index:0}),p===null&&(p=s(),Ht.updateQueue=p),p.memoCache=c,p=c.data[c.index],p===void 0)for(p=c.data[c.index]=Array(a),v=0;v<a;v++)p[v]=Ri;return c.index++,p}function E(a,c){return typeof c=="function"?c(a):c}function I(a){var c=t();return D(c,ni,a)}function D(a,c,p){var v=a.queue;if(v===null)throw Error(h(311));v.lastRenderedReducer=p;var A=a.baseQueue,R=v.pending;if(R!==null){if(A!==null){var G=A.next;A.next=R.next,R.next=G}c.baseQueue=A=R,v.pending=null}if(R=a.baseState,A===null)a.memoizedState=R;else{c=A.next;var ee=G=null,_e=null,Ne=c,et=!1;do{var dt=Ne.lane&-536870913;if(dt!==Ne.lane?(Zi&dt)===dt:($a&dt)===dt){var Ve=Ne.revertLane;if(Ve===0)_e!==null&&(_e=_e.next={lane:0,revertLane:0,action:Ne.action,hasEagerState:Ne.hasEagerState,eagerState:Ne.eagerState,next:null}),dt===hs&&(et=!0);else if(($a&Ve)===Ve){Ne=Ne.next,Ve===hs&&(et=!0);continue}else dt={lane:0,revertLane:Ne.revertLane,action:Ne.action,hasEagerState:Ne.hasEagerState,eagerState:Ne.eagerState,next:null},_e===null?(ee=_e=dt,G=R):_e=_e.next=dt,Ht.lanes|=Ve,Gc|=Ve;dt=Ne.action,Us&&p(R,dt),R=Ne.hasEagerState?Ne.eagerState:p(R,dt)}else Ve={lane:dt,revertLane:Ne.revertLane,action:Ne.action,hasEagerState:Ne.hasEagerState,eagerState:Ne.eagerState,next:null},_e===null?(ee=_e=Ve,G=R):_e=_e.next=Ve,Ht.lanes|=dt,Gc|=dt;Ne=Ne.next}while(Ne!==null&&Ne!==c);if(_e===null?G=R:_e.next=ee,!ta(R,a.memoizedState)&&(Ur=!0,et&&(p=Gl,p!==null)))throw p;a.memoizedState=R,a.baseState=G,a.baseQueue=_e,v.lastRenderedState=R}return A===null&&(v.lanes=0),[a.memoizedState,v.dispatch]}function z(a){var c=t(),p=c.queue;if(p===null)throw Error(h(311));p.lastRenderedReducer=a;var v=p.dispatch,A=p.pending,R=c.memoizedState;if(A!==null){p.pending=null;var G=A=A.next;do R=a(R,G.action),G=G.next;while(G!==A);ta(R,c.memoizedState)||(Ur=!0),c.memoizedState=R,c.baseQueue===null&&(c.baseState=R),p.lastRenderedState=R}return[R,v]}function F(a,c,p){var v=Ht,A=t(),R=Pi;if(R){if(p===void 0)throw Error(h(407));p=p()}else p=c();var G=!ta((ni||A).memoizedState,p);G&&(A.memoizedState=p,Ur=!0),A=A.queue;var ee=Y.bind(null,v,A,a);if(Li(2048,8,ee,[a]),A.getSnapshot!==c||G||cr!==null&&cr.memoizedState.tag&1){if(v.flags|=2048,mt(9,it(),N.bind(null,v,A,p,c),null),Rn===null)throw Error(h(349));R||($a&124)!==0||U(v,c,p)}return p}function U(a,c,p){a.flags|=16384,a={getSnapshot:c,value:p},c=Ht.updateQueue,c===null?(c=s(),Ht.updateQueue=c,c.stores=[a]):(p=c.stores,p===null?c.stores=[a]:p.push(a))}function N(a,c,p,v){c.value=p,c.getSnapshot=v,Q(c)&&se(a)}function Y(a,c,p){return p(function(){Q(c)&&se(a)})}function Q(a){var c=a.getSnapshot;a=a.value;try{var p=c();return!ta(a,p)}catch{return!0}}function se(a){var c=Rc(a,2);c!==null&&Sa(c,a,2)}function ae(a){var c=y();if(typeof a=="function"){var p=a;if(a=p(),Us){$r(!0);try{p()}finally{$r(!1)}}}return c.memoizedState=c.baseState=a,c.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:E,lastRenderedState:a},c}function ce(a,c,p,v){return a.baseState=p,D(a,ni,typeof v=="function"?v:E)}function he(a,c,p,v,A){if(Wi(a))throw Error(h(485));if(a=c.action,a!==null){var R={payload:A,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(G){R.listeners.push(G)}};Ae.T!==null?p(!0):R.isTransition=!1,v(R),p=c.pending,p===null?(R.next=c.pending=R,me(c,R)):(R.next=p.next,c.pending=p.next=R)}}function me(a,c){var p=c.action,v=c.payload,A=a.state;if(c.isTransition){var R=Ae.T,G={};Ae.T=G;try{var ee=p(A,v),_e=Ae.S;_e!==null&&_e(G,ee),ge(a,c,ee)}catch(Ne){Me(a,c,Ne)}finally{Ae.T=R}}else try{R=p(A,v),ge(a,c,R)}catch(Ne){Me(a,c,Ne)}}function ge(a,c,p){p!==null&&typeof p=="object"&&typeof p.then=="function"?p.then(function(v){ye(a,c,v)},function(v){return Me(a,c,v)}):ye(a,c,p)}function ye(a,c,p){c.status="fulfilled",c.value=p,Se(c),a.state=p,c=a.pending,c!==null&&(p=c.next,p===c?a.pending=null:(p=p.next,c.next=p,me(a,p)))}function Me(a,c,p){var v=a.pending;if(a.pending=null,v!==null){v=v.next;do c.status="rejected",c.reason=p,Se(c),c=c.next;while(c!==v)}a.action=null}function Se(a){a=a.listeners;for(var c=0;c<a.length;c++)(0,a[c])()}function Le(a,c){return c}function Oe(a,c){if(Pi){var p=Rn.formState;if(p!==null){e:{var v=Ht;if(Pi){if(Un){t:{for(var A=Un,R=Ra;A.nodeType!==8;){if(!R){A=null;break t}if(A=vs(A.nextSibling),A===null){A=null;break t}}R=A.data,A=R==="F!"||R==="F"?A:null}if(A){Un=vs(A.nextSibling),v=A.data==="F!";break e}}qo(v)}v=!1}v&&(c=p[0])}}return p=y(),p.memoizedState=p.baseState=c,v={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Le,lastRenderedState:c},p.queue=v,p=Vn.bind(null,Ht,v),v.dispatch=p,v=ae(!1),R=er.bind(null,Ht,!1,v.queue),v=y(),A={state:c,dispatch:null,action:a,pending:null},v.queue=A,p=he.bind(null,Ht,A,R,p),A.dispatch=p,v.memoizedState=a,[c,p,!1]}function Xe(a){var c=t();return We(c,ni,a)}function We(a,c,p){if(c=D(a,c,Le)[0],a=I(E)[0],typeof c=="object"&&c!==null&&typeof c.then=="function")try{var v=f(c)}catch(G){throw G===Pu?kc:G}else v=c;c=t();var A=c.queue,R=A.dispatch;return p!==c.memoizedState&&(Ht.flags|=2048,mt(9,it(),He.bind(null,A,p),null)),[v,R,a]}function He(a,c){a.action=c}function gt(a){var c=t(),p=ni;if(p!==null)return We(c,p,a);t(),c=c.memoizedState,p=t();var v=p.queue.dispatch;return p.memoizedState=a,[c,v,!1]}function mt(a,c,p,v){return a={tag:a,create:p,deps:v,inst:c,next:null},c=Ht.updateQueue,c===null&&(c=s(),Ht.updateQueue=c),p=c.lastEffect,p===null?c.lastEffect=a.next=a:(v=p.next,p.next=a,a.next=v,c.lastEffect=a),a}function it(){return{destroy:void 0,resource:void 0}}function Lt(){return t().memoizedState}function ai(a,c,p,v){var A=y();v=v===void 0?null:v,Ht.flags|=a,A.memoizedState=mt(1|c,it(),p,v)}function Li(a,c,p,v){var A=t();v=v===void 0?null:v;var R=A.memoizedState.inst;ni!==null&&v!==null&&wo(v,ni.memoizedState.deps)?A.memoizedState=mt(c,R,p,v):(Ht.flags|=a,A.memoizedState=mt(1|c,R,p,v))}function vi(a,c){ai(8390656,8,a,c)}function en(a,c){Li(2048,8,a,c)}function ln(a,c){return Li(4,2,a,c)}function pn(a,c){return Li(4,4,a,c)}function Ki(a,c){if(typeof c=="function"){a=a();var p=c(a);return function(){typeof p=="function"?p():c(null)}}if(c!=null)return a=a(),c.current=a,function(){c.current=null}}function tn(a,c,p){p=p!=null?p.concat([a]):null,Li(4,4,Ki.bind(null,c,a),p)}function Hn(){}function gr(a,c){var p=t();c=c===void 0?null:c;var v=p.memoizedState;return c!==null&&wo(c,v[1])?v[0]:(p.memoizedState=[a,c],a)}function wr(a,c){var p=t();c=c===void 0?null:c;var v=p.memoizedState;if(c!==null&&wo(c,v[1]))return v[0];if(v=a(),Us){$r(!0);try{a()}finally{$r(!1)}}return p.memoizedState=[v,c],v}function Wr(a,c,p){return p===void 0||($a&1073741824)!==0?a.memoizedState=c:(a.memoizedState=p,a=Qu(),Ht.lanes|=a,Gc|=a,p)}function js(a,c,p,v){return ta(p,c)?p:Ko.current!==null?(a=Wr(a,p,v),ta(a,c)||(Ur=!0),a):($a&42)===0?(Ur=!0,a.memoizedState=p):(a=Qu(),Ht.lanes|=a,Gc|=a,c)}function fs(a,c,p,v,A){var R=st.p;st.p=R!==0&&8>R?R:8;var G=Ae.T,ee={};Ae.T=ee,er(a,!1,c,p);try{var _e=A(),Ne=Ae.S;if(Ne!==null&&Ne(ee,_e),_e!==null&&typeof _e=="object"&&typeof _e.then=="function"){var et=ef(_e,v);mn(a,c,et,la(a))}else mn(a,c,v,la(a))}catch(dt){mn(a,c,{then:function(){},status:"rejected",reason:dt},la())}finally{st.p=R,Ae.T=G}}function tl(){}function Vs(a,c,p,v){if(a.tag!==5)throw Error(h(476));var A=il(a).queue;fs(a,A,c,Ct,p===null?tl:function(){return ps(a),p(v)})}function il(a){var c=a.memoizedState;if(c!==null)return c;c={memoizedState:Ct,baseState:Ct,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:E,lastRenderedState:Ct},next:null};var p={};return c.next={memoizedState:p,baseState:p,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:E,lastRenderedState:p},next:null},a.memoizedState=c,a=a.alternate,a!==null&&(a.memoizedState=c),c}function ps(a){var c=il(a).next.queue;mn(a,c,{},la())}function ms(){return an(kt)}function xa(){return t().memoizedState}function Zs(){return t().memoizedState}function Xl(a){for(var c=a.return;c!==null;){switch(c.tag){case 24:case 3:var p=la();a=xo(p);var v=ds(c,a,p);v!==null&&(Sa(v,c,p),Ou(v,c,p)),c={cache:Zl()},a.payload=c;return}c=c.return}}function Kl(a,c,p){var v=la();p={lane:v,revertLane:0,action:p,hasEagerState:!1,eagerState:null,next:null},Wi(a)?So(c,p):(p=$h(a,c,p,v),p!==null&&(Sa(p,a,v),lf(p,c,v)))}function Vn(a,c,p){var v=la();mn(a,c,p,v)}function mn(a,c,p,v){var A={lane:v,revertLane:0,action:p,hasEagerState:!1,eagerState:null,next:null};if(Wi(a))So(c,A);else{var R=a.alternate;if(a.lanes===0&&(R===null||R.lanes===0)&&(R=c.lastRenderedReducer,R!==null))try{var G=c.lastRenderedState,ee=R(G,p);if(A.hasEagerState=!0,A.eagerState=ee,ta(ee,G))return Iu(a,c,A,0),Rn===null&&qh(),!1}catch{}finally{}if(p=$h(a,c,A,v),p!==null)return Sa(p,a,v),lf(p,c,v),!0}return!1}function er(a,c,p,v){if(v={lane:2,revertLane:Pp(),action:v,hasEagerState:!1,eagerState:null,next:null},Wi(a)){if(c)throw Error(h(479))}else c=$h(a,p,v,2),c!==null&&Sa(c,a,2)}function Wi(a){var c=a.alternate;return a===Ht||c!==null&&c===Ht}function So(a,c){aa=Wo=!0;var p=a.pending;p===null?c.next=c:(c.next=p.next,p.next=c),a.pending=c}function lf(a,c,p){if((p&4194048)!==0){var v=c.lanes;v&=a.pendingLanes,p|=v,c.lanes=p,Ze(a,p)}}var Gs={readContext:an,use:m,useCallback:bn,useContext:bn,useEffect:bn,useImperativeHandle:bn,useLayoutEffect:bn,useInsertionEffect:bn,useMemo:bn,useReducer:bn,useRef:bn,useState:bn,useDebugValue:bn,useDeferredValue:bn,useTransition:bn,useSyncExternalStore:bn,useId:bn,useHostTransitionStatus:bn,useFormState:bn,useActionState:bn,useOptimistic:bn,useMemoCache:bn,useCacheRefresh:bn},sp={readContext:an,use:m,useCallback:function(a,c){return y().memoizedState=[a,c===void 0?null:c],a},useContext:an,useEffect:vi,useImperativeHandle:function(a,c,p){p=p!=null?p.concat([a]):null,ai(4194308,4,Ki.bind(null,c,a),p)},useLayoutEffect:function(a,c){return ai(4194308,4,a,c)},useInsertionEffect:function(a,c){ai(4,2,a,c)},useMemo:function(a,c){var p=y();c=c===void 0?null:c;var v=a();if(Us){$r(!0);try{a()}finally{$r(!1)}}return p.memoizedState=[v,c],v},useReducer:function(a,c,p){var v=y();if(p!==void 0){var A=p(c);if(Us){$r(!0);try{p(c)}finally{$r(!1)}}}else A=c;return v.memoizedState=v.baseState=A,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:A},v.queue=a,a=a.dispatch=Kl.bind(null,Ht,a),[v.memoizedState,a]},useRef:function(a){var c=y();return a={current:a},c.memoizedState=a},useState:function(a){a=ae(a);var c=a.queue,p=Vn.bind(null,Ht,c);return c.dispatch=p,[a.memoizedState,p]},useDebugValue:Hn,useDeferredValue:function(a,c){var p=y();return Wr(p,a,c)},useTransition:function(){var a=ae(!1);return a=fs.bind(null,Ht,a.queue,!0,!1),y().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,c,p){var v=Ht,A=y();if(Pi){if(p===void 0)throw Error(h(407));p=p()}else{if(p=c(),Rn===null)throw Error(h(349));(Zi&124)!==0||U(v,c,p)}A.memoizedState=p;var R={value:p,getSnapshot:c};return A.queue=R,vi(Y.bind(null,v,R,a),[a]),v.flags|=2048,mt(9,it(),N.bind(null,v,R,p,c),null),p},useId:function(){var a=y(),c=Rn.identifierPrefix;if(Pi){var p=ks,v=vo;p=(v&~(1<<32-Wn(v)-1)).toString(32)+p,c=""+c+"R"+p,p=Qo++,0<p&&(c+="H"+p.toString(32)),c+=""}else p=sf++,c=""+c+"r"+p.toString(32)+"";return a.memoizedState=c},useHostTransitionStatus:ms,useFormState:Oe,useActionState:Oe,useOptimistic:function(a){var c=y();c.memoizedState=c.baseState=a;var p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return c.queue=p,c=er.bind(null,Ht,!0,p),p.dispatch=c,[a,c]},useMemoCache:b,useCacheRefresh:function(){return y().memoizedState=Xl.bind(null,Ht)}},cf={readContext:an,use:m,useCallback:gr,useContext:an,useEffect:en,useImperativeHandle:tn,useInsertionEffect:ln,useLayoutEffect:pn,useMemo:wr,useReducer:I,useRef:Lt,useState:function(){return I(E)},useDebugValue:Hn,useDeferredValue:function(a,c){var p=t();return js(p,ni.memoizedState,a,c)},useTransition:function(){var a=I(E)[0],c=t().memoizedState;return[typeof a=="boolean"?a:f(a),c]},useSyncExternalStore:F,useId:xa,useHostTransitionStatus:ms,useFormState:Xe,useActionState:Xe,useOptimistic:function(a,c){var p=t();return ce(p,ni,a,c)},useMemoCache:b,useCacheRefresh:Zs},uf={readContext:an,use:m,useCallback:gr,useContext:an,useEffect:en,useImperativeHandle:tn,useInsertionEffect:ln,useLayoutEffect:pn,useMemo:wr,useReducer:z,useRef:Lt,useState:function(){return z(E)},useDebugValue:Hn,useDeferredValue:function(a,c){var p=t();return ni===null?Wr(p,a,c):js(p,ni.memoizedState,a,c)},useTransition:function(){var a=z(E)[0],c=t().memoizedState;return[typeof a=="boolean"?a:f(a),c]},useSyncExternalStore:F,useId:xa,useHostTransitionStatus:ms,useFormState:gt,useActionState:gt,useOptimistic:function(a,c){var p=t();return ni!==null?ce(p,ni,a,c):(p.baseState=a,[a,p.queue.dispatch])},useMemoCache:b,useCacheRefresh:Zs},ka=null,Ya=0;function gs(a){var c=Ya;return Ya+=1,ka===null&&(ka=[]),ap(ka,a,c)}function Wl(a,c){c=c.props.ref,a.ref=c!==void 0?c:null}function Lc(a,c){throw c.$$typeof===oe?Error(h(525)):(a=Object.prototype.toString.call(c),Error(h(31,a==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":a)))}function ju(a){var c=a._init;return c(a._payload)}function Vu(a){function c(Re,Ie){if(a){var ke=Re.deletions;ke===null?(Re.deletions=[Ie],Re.flags|=16):ke.push(Ie)}}function p(Re,Ie){if(!a)return null;for(;Ie!==null;)c(Re,Ie),Ie=Ie.sibling;return null}function v(Re){for(var Ie=new Map;Re!==null;)Re.key!==null?Ie.set(Re.key,Re):Ie.set(Re.index,Re),Re=Re.sibling;return Ie}function A(Re,Ie){return Re=Va(Re,Ie),Re.index=0,Re.sibling=null,Re}function R(Re,Ie,ke){return Re.index=ke,a?(ke=Re.alternate,ke!==null?(ke=ke.index,ke<Ie?(Re.flags|=67108866,Ie):ke):(Re.flags|=67108866,Ie)):(Re.flags|=1048576,Ie)}function G(Re){return a&&Re.alternate===null&&(Re.flags|=67108866),Re}function ee(Re,Ie,ke,rt){return Ie===null||Ie.tag!==6?(Ie=Cu(ke,Re.mode,rt),Ie.return=Re,Ie):(Ie=A(Ie,ke),Ie.return=Re,Ie)}function _e(Re,Ie,ke,rt){var Ft=ke.type;return Ft===le?et(Re,Ie,ke.props.children,rt,ke.key):Ie!==null&&(Ie.elementType===Ft||typeof Ft=="object"&&Ft!==null&&Ft.$$typeof===ut&&ju(Ft)===Ie.type)?(Ie=A(Ie,ke.props),Wl(Ie,ke),Ie.return=Re,Ie):(Ie=Nl(ke.type,ke.key,ke.props,null,Re.mode,rt),Wl(Ie,ke),Ie.return=Re,Ie)}function Ne(Re,Ie,ke,rt){return Ie===null||Ie.tag!==4||Ie.stateNode.containerInfo!==ke.containerInfo||Ie.stateNode.implementation!==ke.implementation?(Ie=Yh(ke,Re.mode,rt),Ie.return=Re,Ie):(Ie=A(Ie,ke.children||[]),Ie.return=Re,Ie)}function et(Re,Ie,ke,rt,Ft){return Ie===null||Ie.tag!==7?(Ie=Ul(ke,Re.mode,rt,Ft),Ie.return=Re,Ie):(Ie=A(Ie,ke),Ie.return=Re,Ie)}function dt(Re,Ie,ke){if(typeof Ie=="string"&&Ie!==""||typeof Ie=="number"||typeof Ie=="bigint")return Ie=Cu(""+Ie,Re.mode,ke),Ie.return=Re,Ie;if(typeof Ie=="object"&&Ie!==null){switch(Ie.$$typeof){case ne:return ke=Nl(Ie.type,Ie.key,Ie.props,null,Re.mode,ke),Wl(ke,Ie),ke.return=Re,ke;case K:return Ie=Yh(Ie,Re.mode,ke),Ie.return=Re,Ie;case ut:var rt=Ie._init;return Ie=rt(Ie._payload),dt(Re,Ie,ke)}if(xt(Ie)||te(Ie))return Ie=Ul(Ie,Re.mode,ke,null),Ie.return=Re,Ie;if(typeof Ie.then=="function")return dt(Re,gs(Ie),ke);if(Ie.$$typeof===bt)return dt(Re,Ls(Re,Ie),ke);Lc(Re,Ie)}return null}function Ve(Re,Ie,ke,rt){var Ft=Ie!==null?Ie.key:null;if(typeof ke=="string"&&ke!==""||typeof ke=="number"||typeof ke=="bigint")return Ft!==null?null:ee(Re,Ie,""+ke,rt);if(typeof ke=="object"&&ke!==null){switch(ke.$$typeof){case ne:return ke.key===Ft?_e(Re,Ie,ke,rt):null;case K:return ke.key===Ft?Ne(Re,Ie,ke,rt):null;case ut:return Ft=ke._init,ke=Ft(ke._payload),Ve(Re,Ie,ke,rt)}if(xt(ke)||te(ke))return Ft!==null?null:et(Re,Ie,ke,rt,null);if(typeof ke.then=="function")return Ve(Re,Ie,gs(ke),rt);if(ke.$$typeof===bt)return Ve(Re,Ie,Ls(Re,ke),rt);Lc(Re,ke)}return null}function qe(Re,Ie,ke,rt,Ft){if(typeof rt=="string"&&rt!==""||typeof rt=="number"||typeof rt=="bigint")return Re=Re.get(ke)||null,ee(Ie,Re,""+rt,Ft);if(typeof rt=="object"&&rt!==null){switch(rt.$$typeof){case ne:return Re=Re.get(rt.key===null?ke:rt.key)||null,_e(Ie,Re,rt,Ft);case K:return Re=Re.get(rt.key===null?ke:rt.key)||null,Ne(Ie,Re,rt,Ft);case ut:var $i=rt._init;return rt=$i(rt._payload),qe(Re,Ie,ke,rt,Ft)}if(xt(rt)||te(rt))return Re=Re.get(ke)||null,et(Ie,Re,rt,Ft,null);if(typeof rt.then=="function")return qe(Re,Ie,ke,gs(rt),Ft);if(rt.$$typeof===bt)return qe(Re,Ie,ke,Ls(Ie,rt),Ft);Lc(Ie,rt)}return null}function ui(Re,Ie,ke,rt){for(var Ft=null,$i=null,ei=Ie,hi=Ie=0,Ea=null;ei!==null&&hi<ke.length;hi++){ei.index>hi?(Ea=ei,ei=null):Ea=ei.sibling;var un=Ve(Re,ei,ke[hi],rt);if(un===null){ei===null&&(ei=Ea);break}a&&ei&&un.alternate===null&&c(Re,ei),Ie=R(un,Ie,hi),$i===null?Ft=un:$i.sibling=un,$i=un,ei=Ea}if(hi===ke.length)return p(Re,ei),Pi&&on(Re,hi),Ft;if(ei===null){for(;hi<ke.length;hi++)ei=dt(Re,ke[hi],rt),ei!==null&&(Ie=R(ei,Ie,hi),$i===null?Ft=ei:$i.sibling=ei,$i=ei);return Pi&&on(Re,hi),Ft}for(ei=v(ei);hi<ke.length;hi++)Ea=qe(ei,Re,hi,ke[hi],rt),Ea!==null&&(a&&Ea.alternate!==null&&ei.delete(Ea.key===null?hi:Ea.key),Ie=R(Ea,Ie,hi),$i===null?Ft=Ea:$i.sibling=Ea,$i=Ea);return a&&ei.forEach(function(wd){return c(Re,wd)}),Pi&&on(Re,hi),Ft}function ri(Re,Ie,ke,rt){if(ke==null)throw Error(h(151));for(var Ft=null,$i=null,ei=Ie,hi=Ie=0,Ea=null,un=ke.next();ei!==null&&!un.done;hi++,un=ke.next()){ei.index>hi?(Ea=ei,ei=null):Ea=ei.sibling;var wd=Ve(Re,ei,un.value,rt);if(wd===null){ei===null&&(ei=Ea);break}a&&ei&&wd.alternate===null&&c(Re,ei),Ie=R(wd,Ie,hi),$i===null?Ft=wd:$i.sibling=wd,$i=wd,ei=Ea}if(un.done)return p(Re,ei),Pi&&on(Re,hi),Ft;if(ei===null){for(;!un.done;hi++,un=ke.next())un=dt(Re,un.value,rt),un!==null&&(Ie=R(un,Ie,hi),$i===null?Ft=un:$i.sibling=un,$i=un);return Pi&&on(Re,hi),Ft}for(ei=v(ei);!un.done;hi++,un=ke.next())un=qe(ei,Re,hi,un.value,rt),un!==null&&(a&&un.alternate!==null&&ei.delete(un.key===null?hi:un.key),Ie=R(un,Ie,hi),$i===null?Ft=un:$i.sibling=un,$i=un);return a&&ei.forEach(function(WS){return c(Re,WS)}),Pi&&on(Re,hi),Ft}function Si(Re,Ie,ke,rt){if(typeof ke=="object"&&ke!==null&&ke.type===le&&ke.key===null&&(ke=ke.props.children),typeof ke=="object"&&ke!==null){switch(ke.$$typeof){case ne:e:{for(var Ft=ke.key;Ie!==null;){if(Ie.key===Ft){if(Ft=ke.type,Ft===le){if(Ie.tag===7){p(Re,Ie.sibling),rt=A(Ie,ke.props.children),rt.return=Re,Re=rt;break e}}else if(Ie.elementType===Ft||typeof Ft=="object"&&Ft!==null&&Ft.$$typeof===ut&&ju(Ft)===Ie.type){p(Re,Ie.sibling),rt=A(Ie,ke.props),Wl(rt,ke),rt.return=Re,Re=rt;break e}p(Re,Ie);break}else c(Re,Ie);Ie=Ie.sibling}ke.type===le?(rt=Ul(ke.props.children,Re.mode,rt,ke.key),rt.return=Re,Re=rt):(rt=Nl(ke.type,ke.key,ke.props,null,Re.mode,rt),Wl(rt,ke),rt.return=Re,Re=rt)}return G(Re);case K:e:{for(Ft=ke.key;Ie!==null;){if(Ie.key===Ft)if(Ie.tag===4&&Ie.stateNode.containerInfo===ke.containerInfo&&Ie.stateNode.implementation===ke.implementation){p(Re,Ie.sibling),rt=A(Ie,ke.children||[]),rt.return=Re,Re=rt;break e}else{p(Re,Ie);break}else c(Re,Ie);Ie=Ie.sibling}rt=Yh(ke,Re.mode,rt),rt.return=Re,Re=rt}return G(Re);case ut:return Ft=ke._init,ke=Ft(ke._payload),Si(Re,Ie,ke,rt)}if(xt(ke))return ui(Re,Ie,ke,rt);if(te(ke)){if(Ft=te(ke),typeof Ft!="function")throw Error(h(150));return ke=Ft.call(ke),ri(Re,Ie,ke,rt)}if(typeof ke.then=="function")return Si(Re,Ie,gs(ke),rt);if(ke.$$typeof===bt)return Si(Re,Ie,Ls(Re,ke),rt);Lc(Re,ke)}return typeof ke=="string"&&ke!==""||typeof ke=="number"||typeof ke=="bigint"?(ke=""+ke,Ie!==null&&Ie.tag===6?(p(Re,Ie.sibling),rt=A(Ie,ke),rt.return=Re,Re=rt):(p(Re,Ie),rt=Cu(ke,Re.mode,rt),rt.return=Re,Re=rt),G(Re)):p(Re,Ie)}return function(Re,Ie,ke,rt){try{Ya=0;var Ft=Si(Re,Ie,ke,rt);return ka=null,Ft}catch(ei){if(ei===Pu||ei===kc)throw ei;var $i=na(29,ei,null,Re.mode);return $i.lanes=rt,$i.return=Re,$i}finally{}}}var nd=Vu(!0),Dm=Vu(!1),qs=lt(null),$s=null;function Fc(a){var c=a.alternate;vt(Yn,Yn.current&1),vt(qs,a),$s===null&&(c===null||Ko.current!==null||c.memoizedState!==null)&&($s=a)}function op(a){if(a.tag===22){if(vt(Yn,Yn.current),vt(qs,a),$s===null){var c=a.alternate;c!==null&&c.memoizedState!==null&&($s=a)}}else Ql()}function Ql(){vt(Yn,Yn.current),vt(qs,qs.current)}function nl(a){Dt(qs),$s===a&&($s=null),Dt(Yn)}var Yn=lt(0);function lp(a){for(var c=a;c!==null;){if(c.tag===13){var p=c.memoizedState;if(p!==null&&(p=p.dehydrated,p===null||p.data==="$?"||gg(p)))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if((c.flags&128)!==0)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}function Zu(a,c,p,v){c=a.memoizedState,p=p(v,c),p=p==null?c:q({},c,p),a.memoizedState=p,a.lanes===0&&(a.updateQueue.baseState=p)}var rd={enqueueSetState:function(a,c,p){a=a._reactInternals;var v=la(),A=xo(v);A.payload=c,p!=null&&(A.callback=p),c=ds(a,A,v),c!==null&&(Sa(c,a,v),Ou(c,a,v))},enqueueReplaceState:function(a,c,p){a=a._reactInternals;var v=la(),A=xo(v);A.tag=1,A.payload=c,p!=null&&(A.callback=p),c=ds(a,A,v),c!==null&&(Sa(c,a,v),Ou(c,a,v))},enqueueForceUpdate:function(a,c){a=a._reactInternals;var p=la(),v=xo(p);v.tag=2,c!=null&&(v.callback=c),c=ds(a,v,p),c!==null&&(Sa(c,a,p),Ou(c,a,p))}};function hf(a,c,p,v,A,R,G){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(v,R,G):c.prototype&&c.prototype.isPureReactComponent?!Su(p,v)||!Su(A,R):!0}function Rm(a,c,p,v){a=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(p,v),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(p,v),c.state!==a&&rd.enqueueReplaceState(c,c.state,null)}function Nc(a,c){var p=c;if("ref"in c){p={};for(var v in c)v!=="ref"&&(p[v]=c[v])}if(a=a.defaultProps){p===c&&(p=q({},p));for(var A in a)p[A]===void 0&&(p[A]=a[A])}return p}var cp=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var c=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(c))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)};function c_(a){cp(a)}function Pm(a){console.error(a)}function zm(a){cp(a)}function df(a,c){try{var p=a.onUncaughtError;p(c.value,{componentStack:c.stack})}catch(v){setTimeout(function(){throw v})}}function u_(a,c,p){try{var v=a.onCaughtError;v(p.value,{componentStack:p.stack,errorBoundary:c.tag===1?c.stateNode:null})}catch(A){setTimeout(function(){throw A})}}function ff(a,c,p){return p=xo(p),p.tag=3,p.payload={element:null},p.callback=function(){df(a,c)},p}function km(a){return a=xo(a),a.tag=3,a}function up(a,c,p,v){var A=p.type.getDerivedStateFromError;if(typeof A=="function"){var R=v.value;a.payload=function(){return A(R)},a.callback=function(){u_(c,p,v)}}var G=p.stateNode;G!==null&&typeof G.componentDidCatch=="function"&&(a.callback=function(){u_(c,p,v),typeof A!="function"&&(qc===null?qc=new Set([this]):qc.add(this));var ee=v.stack;this.componentDidCatch(v.value,{componentStack:ee!==null?ee:""})})}function pf(a,c,p,v,A){if(p.flags|=32768,v!==null&&typeof v=="object"&&typeof v.then=="function"){if(c=p.alternate,c!==null&&Kr(c,p,A,!0),p=qs.current,p!==null){switch(p.tag){case 13:return $s===null?ig():p.alternate===null&&_r===0&&(_r=3),p.flags&=-257,p.flags|=65536,p.lanes=A,v===zu?p.flags|=16384:(c=p.updateQueue,c===null?p.updateQueue=new Set([v]):c.add(v),Tf(a,v,A)),!1;case 22:return p.flags|=65536,v===zu?p.flags|=16384:(c=p.updateQueue,c===null?(c={transitions:null,markerInstances:null,retryQueue:new Set([v])},p.updateQueue=c):(p=c.retryQueue,p===null?c.retryQueue=new Set([v]):p.add(v)),Tf(a,v,A)),!1}throw Error(h(435,p.tag))}return Tf(a,v,A),ig(),!1}if(Pi)return c=qs.current,c!==null?((c.flags&65536)===0&&(c.flags|=256),c.flags|=65536,c.lanes=A,v!==Ru&&(a=Error(h(422),{cause:v}),zc(ia(a,p)))):(v!==Ru&&(c=Error(h(423),{cause:v}),zc(ia(c,p))),a=a.current.alternate,a.flags|=65536,A&=-A,a.lanes|=A,v=ia(v,p),A=ff(a.stateNode,v,A),qa(a,A),_r!==4&&(_r=2)),!1;var R=Error(h(520),{cause:v});if(R=ia(R,p),Xn===null?Xn=[R]:Xn.push(R),_r!==4&&(_r=2),c===null)return!0;v=ia(v,p),p=c;do{switch(p.tag){case 3:return p.flags|=65536,a=A&-A,p.lanes|=a,a=ff(p.stateNode,v,a),qa(p,a),!1;case 1:if(c=p.type,R=p.stateNode,(p.flags&128)===0&&(typeof c.getDerivedStateFromError=="function"||R!==null&&typeof R.componentDidCatch=="function"&&(qc===null||!qc.has(R))))return p.flags|=65536,A&=-A,p.lanes|=A,A=km(A),up(A,a,p,v),qa(p,A),!1}p=p.return}while(p!==null);return!1}var Xa=Error(h(461)),Ur=!1;function jr(a,c,p,v){c.child=a===null?Dm(c,null,p,v):nd(c,a.child,p,v)}function h_(a,c,p,v,A){p=p.render;var R=c.ref;if("ref"in v){var G={};for(var ee in v)ee!=="ref"&&(G[ee]=v[ee])}else G=v;return Yo(c),v=Lu(a,c,p,G,R,A),ee=Nu(),a!==null&&!Ur?(Yl(a,c,A),rl(a,c,A)):(Pi&&ee&&va(c),c.flags|=1,jr(a,c,v,A),c.child)}function Om(a,c,p,v,A){if(a===null){var R=p.type;return typeof R=="function"&&!Hh(R)&&R.defaultProps===void 0&&p.compare===null?(c.tag=15,c.type=R,d_(a,c,R,v,A)):(a=Nl(p.type,null,v,c,c.mode,A),a.ref=c.ref,a.return=c,c.child=a)}if(R=a.child,!qu(a,A)){var G=R.memoizedProps;if(p=p.compare,p=p!==null?p:Su,p(G,v)&&a.ref===c.ref)return rl(a,c,A)}return c.flags|=1,a=Va(R,v),a.ref=c.ref,a.return=c,c.child=a}function d_(a,c,p,v,A){if(a!==null){var R=a.memoizedProps;if(Su(R,v)&&a.ref===c.ref)if(Ur=!1,c.pendingProps=v=R,qu(a,A))(a.flags&131072)!==0&&(Ur=!0);else return c.lanes=a.lanes,rl(a,c,A)}return mf(a,c,p,v,A)}function f_(a,c,p){var v=c.pendingProps,A=v.children,R=a!==null?a.memoizedState:null;if(v.mode==="hidden"){if((c.flags&128)!==0){if(v=R!==null?R.baseLanes|p:p,a!==null){for(A=c.child=a.child,R=0;A!==null;)R=R|A.lanes|A.childLanes,A=A.sibling;c.childLanes=R&~v}else c.childLanes=0,c.child=null;return p_(a,c,v,p)}if((p&536870912)!==0)c.memoizedState={baseLanes:0,cachePool:null},a!==null&&Xo(c,R!==null?R.cachePool:null),R!==null?rf(c,R):Nr(),op(c);else return c.lanes=c.childLanes=536870912,p_(a,c,R!==null?R.baseLanes|p:p,p)}else R!==null?(Xo(c,R.cachePool),rf(c,R),Ql(),c.memoizedState=null):(a!==null&&Xo(c,null),Nr(),Ql());return jr(a,c,A,p),c.child}function p_(a,c,p,v){var A=ed();return A=A===null?null:{parent:jn._currentValue,pool:A},c.memoizedState={baseLanes:p,cachePool:A},a!==null&&Xo(c,null),Nr(),op(c),a!==null&&Kr(a,c,v,!0),null}function hp(a,c){var p=c.ref;if(p===null)a!==null&&a.ref!==null&&(c.flags|=4194816);else{if(typeof p!="function"&&typeof p!="object")throw Error(h(284));(a===null||a.ref!==p)&&(c.flags|=4194816)}}function mf(a,c,p,v,A){return Yo(c),p=Lu(a,c,p,v,void 0,A),v=Nu(),a!==null&&!Ur?(Yl(a,c,A),rl(a,c,A)):(Pi&&v&&va(c),c.flags|=1,jr(a,c,p,A),c.child)}function dp(a,c,p,v,A,R){return Yo(c),c.updateQueue=null,p=el(c,v,p,A),Fu(a),v=Nu(),a!==null&&!Ur?(Yl(a,c,R),rl(a,c,R)):(Pi&&v&&va(c),c.flags|=1,jr(a,c,p,R),c.child)}function Bm(a,c,p,v,A){if(Yo(c),c.stateNode===null){var R=yo,G=p.contextType;typeof G=="object"&&G!==null&&(R=an(G)),R=new p(v,R),c.memoizedState=R.state!==null&&R.state!==void 0?R.state:null,R.updater=rd,c.stateNode=R,R._reactInternals=c,R=c.stateNode,R.props=v,R.state=c.memoizedState,R.refs={},Bc(c),G=p.contextType,R.context=typeof G=="object"&&G!==null?an(G):yo,R.state=c.memoizedState,G=p.getDerivedStateFromProps,typeof G=="function"&&(Zu(c,p,G,v),R.state=c.memoizedState),typeof p.getDerivedStateFromProps=="function"||typeof R.getSnapshotBeforeUpdate=="function"||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(G=R.state,typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount(),G!==R.state&&rd.enqueueReplaceState(R,R.state,null),qt(c,v,R,A),Nt(),R.state=c.memoizedState),typeof R.componentDidMount=="function"&&(c.flags|=4194308),v=!0}else if(a===null){R=c.stateNode;var ee=c.memoizedProps,_e=Nc(p,ee);R.props=_e;var Ne=R.context,et=p.contextType;G=yo,typeof et=="object"&&et!==null&&(G=an(et));var dt=p.getDerivedStateFromProps;et=typeof dt=="function"||typeof R.getSnapshotBeforeUpdate=="function",ee=c.pendingProps!==ee,et||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(ee||Ne!==G)&&Rm(c,R,v,G),Ga=!1;var Ve=c.memoizedState;R.state=Ve,qt(c,v,R,A),Nt(),Ne=c.memoizedState,ee||Ve!==Ne||Ga?(typeof dt=="function"&&(Zu(c,p,dt,v),Ne=c.memoizedState),(_e=Ga||hf(c,p,_e,v,Ve,Ne,G))?(et||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount()),typeof R.componentDidMount=="function"&&(c.flags|=4194308)):(typeof R.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=v,c.memoizedState=Ne),R.props=v,R.state=Ne,R.context=G,v=_e):(typeof R.componentDidMount=="function"&&(c.flags|=4194308),v=!1)}else{R=c.stateNode,$l(a,c),G=c.memoizedProps,et=Nc(p,G),R.props=et,dt=c.pendingProps,Ve=R.context,Ne=p.contextType,_e=yo,typeof Ne=="object"&&Ne!==null&&(_e=an(Ne)),ee=p.getDerivedStateFromProps,(Ne=typeof ee=="function"||typeof R.getSnapshotBeforeUpdate=="function")||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(G!==dt||Ve!==_e)&&Rm(c,R,v,_e),Ga=!1,Ve=c.memoizedState,R.state=Ve,qt(c,v,R,A),Nt();var qe=c.memoizedState;G!==dt||Ve!==qe||Ga||a!==null&&a.dependencies!==null&&za(a.dependencies)?(typeof ee=="function"&&(Zu(c,p,ee,v),qe=c.memoizedState),(et=Ga||hf(c,p,et,v,Ve,qe,_e)||a!==null&&a.dependencies!==null&&za(a.dependencies))?(Ne||typeof R.UNSAFE_componentWillUpdate!="function"&&typeof R.componentWillUpdate!="function"||(typeof R.componentWillUpdate=="function"&&R.componentWillUpdate(v,qe,_e),typeof R.UNSAFE_componentWillUpdate=="function"&&R.UNSAFE_componentWillUpdate(v,qe,_e)),typeof R.componentDidUpdate=="function"&&(c.flags|=4),typeof R.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof R.componentDidUpdate!="function"||G===a.memoizedProps&&Ve===a.memoizedState||(c.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||G===a.memoizedProps&&Ve===a.memoizedState||(c.flags|=1024),c.memoizedProps=v,c.memoizedState=qe),R.props=v,R.state=qe,R.context=_e,v=et):(typeof R.componentDidUpdate!="function"||G===a.memoizedProps&&Ve===a.memoizedState||(c.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||G===a.memoizedProps&&Ve===a.memoizedState||(c.flags|=1024),v=!1)}return R=v,hp(a,c),v=(c.flags&128)!==0,R||v?(R=c.stateNode,p=v&&typeof p.getDerivedStateFromError!="function"?null:R.render(),c.flags|=1,a!==null&&v?(c.child=nd(c,a.child,null,A),c.child=nd(c,null,p,A)):jr(a,c,p,A),c.memoizedState=R.state,a=c.child):a=rl(a,c,A),a}function Uc(a,c,p,v){return us(),c.flags|=256,jr(a,c,p,v),c.child}var Gu={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Lm(a){return{baseLanes:a,cachePool:tf()}}function Fm(a,c,p){return a=a!==null?a.childLanes&~p:0,c&&(a|=Ja),a}function m_(a,c,p){var v=c.pendingProps,A=!1,R=(c.flags&128)!==0,G;if((G=R)||(G=a!==null&&a.memoizedState===null?!1:(Yn.current&2)!==0),G&&(A=!0,c.flags&=-129),G=(c.flags&32)!==0,c.flags&=-33,a===null){if(Pi){if(A?Fc(c):Ql(),Pi){var ee=Un,_e;if(_e=ee){e:{for(_e=ee,ee=Ra;_e.nodeType!==8;){if(!ee){ee=null;break e}if(_e=vs(_e.nextSibling),_e===null){ee=null;break e}}ee=_e}ee!==null?(c.memoizedState={dehydrated:ee,treeContext:Za!==null?{id:vo,overflow:ks}:null,retryLane:536870912,hydrationErrors:null},_e=na(18,null,null,0),_e.stateNode=ee,_e.return=c,c.child=_e,Rr=c,Un=null,_e=!0):_e=!1}_e||qo(c)}if(ee=c.memoizedState,ee!==null&&(ee=ee.dehydrated,ee!==null))return gg(ee)?c.lanes=32:c.lanes=536870912,null;nl(c)}return ee=v.children,v=v.fallback,A?(Ql(),A=c.mode,ee=fp({mode:"hidden",children:ee},A),v=Ul(v,A,p,null),ee.return=c,v.return=c,ee.sibling=v,c.child=ee,A=c.child,A.memoizedState=Lm(p),A.childLanes=Fm(a,G,p),c.memoizedState=Gu,v):(Fc(c),Nm(c,ee))}if(_e=a.memoizedState,_e!==null&&(ee=_e.dehydrated,ee!==null)){if(R)c.flags&256?(Fc(c),c.flags&=-257,c=Um(a,c,p)):c.memoizedState!==null?(Ql(),c.child=a.child,c.flags|=128,c=null):(Ql(),A=v.fallback,ee=c.mode,v=fp({mode:"visible",children:v.children},ee),A=Ul(A,ee,p,null),A.flags|=2,v.return=c,A.return=c,v.sibling=A,c.child=v,nd(c,a.child,null,p),v=c.child,v.memoizedState=Lm(p),v.childLanes=Fm(a,G,p),c.memoizedState=Gu,c=A);else if(Fc(c),gg(ee)){if(G=ee.nextSibling&&ee.nextSibling.dataset,G)var Ne=G.dgst;G=Ne,v=Error(h(419)),v.stack="",v.digest=G,zc({value:v,source:null,stack:null}),c=Um(a,c,p)}else if(Ur||Kr(a,c,p,!1),G=(p&a.childLanes)!==0,Ur||G){if(G=Rn,G!==null&&(v=p&-p,v=(v&42)!==0?1:Pe(v),v=(v&(G.suspendedLanes|p))!==0?0:v,v!==0&&v!==_e.retryLane))throw _e.retryLane=v,Rc(a,v),Sa(G,a,v),Xa;ee.data==="$?"||ig(),c=Um(a,c,p)}else ee.data==="$?"?(c.flags|=192,c.child=a.child,c=null):(a=_e.treeContext,Un=vs(ee.nextSibling),Rr=c,Pi=!0,cs=null,Ra=!1,a!==null&&(ra[Br++]=vo,ra[Br++]=ks,ra[Br++]=Za,vo=a.id,ks=a.overflow,Za=c),c=Nm(c,v.children),c.flags|=4096);return c}return A?(Ql(),A=v.fallback,ee=c.mode,_e=a.child,Ne=_e.sibling,v=Va(_e,{mode:"hidden",children:v.children}),v.subtreeFlags=_e.subtreeFlags&65011712,Ne!==null?A=Va(Ne,A):(A=Ul(A,ee,p,null),A.flags|=2),A.return=c,v.return=c,v.sibling=A,c.child=v,v=A,A=c.child,ee=a.child.memoizedState,ee===null?ee=Lm(p):(_e=ee.cachePool,_e!==null?(Ne=jn._currentValue,_e=_e.parent!==Ne?{parent:Ne,pool:Ne}:_e):_e=tf(),ee={baseLanes:ee.baseLanes|p,cachePool:_e}),A.memoizedState=ee,A.childLanes=Fm(a,G,p),c.memoizedState=Gu,v):(Fc(c),p=a.child,a=p.sibling,p=Va(p,{mode:"visible",children:v.children}),p.return=c,p.sibling=null,a!==null&&(G=c.deletions,G===null?(c.deletions=[a],c.flags|=16):G.push(a)),c.child=p,c.memoizedState=null,p)}function Nm(a,c){return c=fp({mode:"visible",children:c},a.mode),c.return=a,a.child=c}function fp(a,c){return a=na(22,a,null,c),a.lanes=0,a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},a}function Um(a,c,p){return nd(c,a.child,null,p),a=Nm(c,c.pendingProps.children),a.flags|=2,c.memoizedState=null,a}function g_(a,c,p){a.lanes|=c;var v=a.alternate;v!==null&&(v.lanes|=c),Pr(a.return,c,p)}function gf(a,c,p,v,A){var R=a.memoizedState;R===null?a.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:v,tail:p,tailMode:A}:(R.isBackwards=c,R.rendering=null,R.renderingStartTime=0,R.last=v,R.tail=p,R.tailMode=A)}function __(a,c,p){var v=c.pendingProps,A=v.revealOrder,R=v.tail;if(jr(a,c,v.children,p),v=Yn.current,(v&2)!==0)v=v&1|2,c.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=c.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&g_(a,p,c);else if(a.tag===19)g_(a,p,c);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===c)break e;for(;a.sibling===null;){if(a.return===null||a.return===c)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}v&=1}switch(vt(Yn,v),A){case"forwards":for(p=c.child,A=null;p!==null;)a=p.alternate,a!==null&&lp(a)===null&&(A=p),p=p.sibling;p=A,p===null?(A=c.child,c.child=null):(A=p.sibling,p.sibling=null),gf(c,!1,A,p,R);break;case"backwards":for(p=null,A=c.child,c.child=null;A!==null;){if(a=A.alternate,a!==null&&lp(a)===null){c.child=A;break}a=A.sibling,A.sibling=p,p=A,A=a}gf(c,!0,p,null,R);break;case"together":gf(c,!1,null,null,void 0);break;default:c.memoizedState=null}return c.child}function rl(a,c,p){if(a!==null&&(c.dependencies=a.dependencies),Gc|=c.lanes,(p&c.childLanes)===0)if(a!==null){if(Kr(a,c,p,!1),(p&c.childLanes)===0)return null}else return null;if(a!==null&&c.child!==a.child)throw Error(h(153));if(c.child!==null){for(a=c.child,p=Va(a,a.pendingProps),c.child=p,p.return=c;a.sibling!==null;)a=a.sibling,p=p.sibling=Va(a,a.pendingProps),p.return=c;p.sibling=null}return c.child}function qu(a,c){return(a.lanes&c)!==0?!0:(a=a.dependencies,!!(a!==null&&za(a)))}function fv(a,c,p){switch(c.tag){case 3:zi(c,c.stateNode.containerInfo),Pa(c,jn,a.memoizedState.cache),us();break;case 27:case 5:Is(c);break;case 4:zi(c,c.stateNode.containerInfo);break;case 10:Pa(c,c.type,c.memoizedProps.value);break;case 13:var v=c.memoizedState;if(v!==null)return v.dehydrated!==null?(Fc(c),c.flags|=128,null):(p&c.child.childLanes)!==0?m_(a,c,p):(Fc(c),a=rl(a,c,p),a!==null?a.sibling:null);Fc(c);break;case 19:var A=(a.flags&128)!==0;if(v=(p&c.childLanes)!==0,v||(Kr(a,c,p,!1),v=(p&c.childLanes)!==0),A){if(v)return __(a,c,p);c.flags|=128}if(A=c.memoizedState,A!==null&&(A.rendering=null,A.tail=null,A.lastEffect=null),vt(Yn,Yn.current),v)break;return null;case 22:case 23:return c.lanes=0,f_(a,c,p);case 24:Pa(c,jn,a.memoizedState.cache)}return rl(a,c,p)}function tr(a,c,p){if(a!==null)if(a.memoizedProps!==c.pendingProps)Ur=!0;else{if(!qu(a,p)&&(c.flags&128)===0)return Ur=!1,fv(a,c,p);Ur=(a.flags&131072)!==0}else Ur=!1,Pi&&(c.flags&1048576)!==0&&Go(c,Vl,c.index);switch(c.lanes=0,c.tag){case 16:e:{a=c.pendingProps;var v=c.elementType,A=v._init;if(v=A(v._payload),c.type=v,typeof v=="function")Hh(v)?(a=Nc(v,a),c.tag=1,c=Bm(null,c,v,a,p)):(c.tag=0,c=mf(null,c,v,a,p));else{if(v!=null){if(A=v.$$typeof,A===It){c.tag=11,c=h_(null,c,v,a,p);break e}else if(A===Pt){c.tag=14,c=Om(null,c,v,a,p);break e}}throw c=Fe(v)||v,Error(h(306,c,""))}}return c;case 0:return mf(a,c,c.type,c.pendingProps,p);case 1:return v=c.type,A=Nc(v,c.pendingProps),Bm(a,c,v,A,p);case 3:e:{if(zi(c,c.stateNode.containerInfo),a===null)throw Error(h(387));v=c.pendingProps;var R=c.memoizedState;A=R.element,$l(a,c),qt(c,v,null,p);var G=c.memoizedState;if(v=G.cache,Pa(c,jn,v),v!==R.cache&&Ho(c,[jn],p,!0),Nt(),v=G.element,R.isDehydrated)if(R={element:v,isDehydrated:!1,cache:G.cache},c.updateQueue.baseState=R,c.memoizedState=R,c.flags&256){c=Uc(a,c,v,p);break e}else if(v!==A){A=ia(Error(h(424)),c),zc(A),c=Uc(a,c,v,p);break e}else{switch(a=c.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(Un=vs(a.firstChild),Rr=c,Pi=!0,cs=null,Ra=!0,p=Dm(c,null,v,p),c.child=p;p;)p.flags=p.flags&-3|4096,p=p.sibling}else{if(us(),v===A){c=rl(a,c,p);break e}jr(a,c,v,p)}c=c.child}return c;case 26:return hp(a,c),a===null?(p=M(c.type,null,c.pendingProps,null))?c.memoizedState=p:Pi||(p=c.type,a=c.pendingProps,v=rh(Jt.current).createElement(p),v[Vt]=c,v[Ot]=a,Tr(v,p,a),or(v),c.stateNode=v):c.memoizedState=M(c.type,a.memoizedProps,c.pendingProps,a.memoizedState),null;case 27:return Is(c),a===null&&Pi&&(v=c.stateNode=vd(c.type,c.pendingProps,Jt.current),Rr=c,Ra=!0,A=Un,cc(c.type)?(Pf=A,Un=vs(v.firstChild)):Un=A),jr(a,c,c.pendingProps.children,p),hp(a,c),a===null&&(c.flags|=4194304),c.child;case 5:return a===null&&Pi&&((A=v=Un)&&(v=Z_(v,c.type,c.pendingProps,Ra),v!==null?(c.stateNode=v,Rr=c,Un=vs(v.firstChild),Ra=!1,A=!0):A=!1),A||qo(c)),Is(c),A=c.type,R=c.pendingProps,G=a!==null?a.memoizedProps:null,v=R.children,dg(A,R)?v=null:G!==null&&dg(A,G)&&(c.flags|=32),c.memoizedState!==null&&(A=Lu(a,c,of,null,null,p),kt._currentValue=A),hp(a,c),jr(a,c,v,p),c.child;case 6:return a===null&&Pi&&((a=p=Un)&&(p=G_(p,c.pendingProps,Ra),p!==null?(c.stateNode=p,Rr=c,Un=null,a=!0):a=!1),a||qo(c)),null;case 13:return m_(a,c,p);case 4:return zi(c,c.stateNode.containerInfo),v=c.pendingProps,a===null?c.child=nd(c,null,v,p):jr(a,c,v,p),c.child;case 11:return h_(a,c,c.type,c.pendingProps,p);case 7:return jr(a,c,c.pendingProps,p),c.child;case 8:return jr(a,c,c.pendingProps.children,p),c.child;case 12:return jr(a,c,c.pendingProps.children,p),c.child;case 10:return v=c.pendingProps,Pa(c,c.type,v.value),jr(a,c,v.children,p),c.child;case 9:return A=c.type._context,v=c.pendingProps.children,Yo(c),A=an(A),v=v(A),c.flags|=1,jr(a,c,v,p),c.child;case 14:return Om(a,c,c.type,c.pendingProps,p);case 15:return d_(a,c,c.type,c.pendingProps,p);case 19:return __(a,c,p);case 31:return v=c.pendingProps,p=c.mode,v={mode:v.mode,children:v.children},a===null?(p=fp(v,p),p.ref=c.ref,c.child=p,p.return=c,c=p):(p=Va(a.child,v),p.ref=c.ref,c.child=p,p.return=c,c=p),c;case 22:return f_(a,c,p);case 24:return Yo(c),v=an(jn),a===null?(A=ed(),A===null&&(A=Rn,R=Zl(),A.pooledCache=R,R.refCount++,R!==null&&(A.pooledCacheLanes|=p),A=R),c.memoizedState={parent:v,cache:A},Bc(c),Pa(c,jn,A)):((a.lanes&p)!==0&&($l(a,c),qt(c,null,null,p),Nt()),A=a.memoizedState,R=c.memoizedState,A.parent!==v?(A={parent:v,cache:v},c.memoizedState=A,c.lanes===0&&(c.memoizedState=c.updateQueue.baseState=A),Pa(c,jn,v)):(v=R.cache,Pa(c,jn,v),v!==A.cache&&Ho(c,[jn],p,!0))),jr(a,c,c.pendingProps.children,p),c.child;case 29:throw c.pendingProps}throw Error(h(156,c.tag))}function Ka(a){a.flags|=4}function jm(a,c){if(c.type!=="stylesheet"||(c.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!pe(c)){if(c=qs.current,c!==null&&((Zi&4194048)===Zi?$s!==null:(Zi&62914560)!==Zi&&(Zi&536870912)===0||c!==$s))throw ku=zu,td;a.flags|=8192}}function $u(a,c){c!==null&&(a.flags|=4),a.flags&16384&&(c=a.tag!==22?Ee():536870912,a.lanes|=c,Ku|=c)}function jc(a,c){if(!Pi)switch(a.tailMode){case"hidden":c=a.tail;for(var p=null;c!==null;)c.alternate!==null&&(p=c),c=c.sibling;p===null?a.tail=null:p.sibling=null;break;case"collapsed":p=a.tail;for(var v=null;p!==null;)p.alternate!==null&&(v=p),p=p.sibling;v===null?c||a.tail===null?a.tail=null:a.tail.sibling=null:v.sibling=null}}function Dn(a){var c=a.alternate!==null&&a.alternate.child===a.child,p=0,v=0;if(c)for(var A=a.child;A!==null;)p|=A.lanes|A.childLanes,v|=A.subtreeFlags&65011712,v|=A.flags&65011712,A.return=a,A=A.sibling;else for(A=a.child;A!==null;)p|=A.lanes|A.childLanes,v|=A.subtreeFlags,v|=A.flags,A.return=a,A=A.sibling;return a.subtreeFlags|=v,a.childLanes=p,c}function y_(a,c,p){var v=c.pendingProps;switch(Du(c),c.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Dn(c),null;case 1:return Dn(c),null;case 3:return p=c.stateNode,v=null,a!==null&&(v=a.memoizedState.cache),c.memoizedState.cache!==v&&(c.flags|=2048),ba(jn),Fn(),p.pendingContext&&(p.context=p.pendingContext,p.pendingContext=null),(a===null||a.child===null)&&(Os(c)?Ka(c):a===null||a.memoizedState.isDehydrated&&(c.flags&256)===0||(c.flags|=1024,Qd())),Dn(c),null;case 26:return p=c.memoizedState,a===null?(Ka(c),p!==null?(Dn(c),jm(c,p)):(Dn(c),c.flags&=-16777217)):p?p!==a.memoizedState?(Ka(c),Dn(c),jm(c,p)):(Dn(c),c.flags&=-16777217):(a.memoizedProps!==v&&Ka(c),Dn(c),c.flags&=-16777217),null;case 27:qn(c),p=Jt.current;var A=c.type;if(a!==null&&c.stateNode!=null)a.memoizedProps!==v&&Ka(c);else{if(!v){if(c.stateNode===null)throw Error(h(166));return Dn(c),null}a=Zt.current,Os(c)?Xh(c):(a=vd(A,v,p),c.stateNode=a,Ka(c))}return Dn(c),null;case 5:if(qn(c),p=c.type,a!==null&&c.stateNode!=null)a.memoizedProps!==v&&Ka(c);else{if(!v){if(c.stateNode===null)throw Error(h(166));return Dn(c),null}if(a=Zt.current,Os(c))Xh(c);else{switch(A=rh(Jt.current),a){case 1:a=A.createElementNS("http://www.w3.org/2000/svg",p);break;case 2:a=A.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;default:switch(p){case"svg":a=A.createElementNS("http://www.w3.org/2000/svg",p);break;case"math":a=A.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;case"script":a=A.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild);break;case"select":a=typeof v.is=="string"?A.createElement("select",{is:v.is}):A.createElement("select"),v.multiple?a.multiple=!0:v.size&&(a.size=v.size);break;default:a=typeof v.is=="string"?A.createElement(p,{is:v.is}):A.createElement(p)}}a[Vt]=c,a[Ot]=v;e:for(A=c.child;A!==null;){if(A.tag===5||A.tag===6)a.appendChild(A.stateNode);else if(A.tag!==4&&A.tag!==27&&A.child!==null){A.child.return=A,A=A.child;continue}if(A===c)break e;for(;A.sibling===null;){if(A.return===null||A.return===c)break e;A=A.return}A.sibling.return=A.return,A=A.sibling}c.stateNode=a;e:switch(Tr(a,p,v),p){case"button":case"input":case"select":case"textarea":a=!!v.autoFocus;break e;case"img":a=!0;break e;default:a=!1}a&&Ka(c)}}return Dn(c),c.flags&=-16777217,null;case 6:if(a&&c.stateNode!=null)a.memoizedProps!==v&&Ka(c);else{if(typeof v!="string"&&c.stateNode===null)throw Error(h(166));if(a=Jt.current,Os(c)){if(a=c.stateNode,p=c.memoizedProps,v=null,A=Rr,A!==null)switch(A.tag){case 27:case 5:v=A.memoizedProps}a[Vt]=c,a=!!(a.nodeValue===p||v!==null&&v.suppressHydrationWarning===!0||hg(a.nodeValue,p)),a||qo(c)}else a=rh(a).createTextNode(v),a[Vt]=c,c.stateNode=a}return Dn(c),null;case 13:if(v=c.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(A=Os(c),v!==null&&v.dehydrated!==null){if(a===null){if(!A)throw Error(h(318));if(A=c.memoizedState,A=A!==null?A.dehydrated:null,!A)throw Error(h(317));A[Vt]=c}else us(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;Dn(c),A=!1}else A=Qd(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=A),A=!0;if(!A)return c.flags&256?(nl(c),c):(nl(c),null)}if(nl(c),(c.flags&128)!==0)return c.lanes=p,c;if(p=v!==null,a=a!==null&&a.memoizedState!==null,p){v=c.child,A=null,v.alternate!==null&&v.alternate.memoizedState!==null&&v.alternate.memoizedState.cachePool!==null&&(A=v.alternate.memoizedState.cachePool.pool);var R=null;v.memoizedState!==null&&v.memoizedState.cachePool!==null&&(R=v.memoizedState.cachePool.pool),R!==A&&(v.flags|=2048)}return p!==a&&p&&(c.child.flags|=8192),$u(c,c.updateQueue),Dn(c),null;case 4:return Fn(),a===null&&Op(c.stateNode.containerInfo),Dn(c),null;case 10:return ba(c.type),Dn(c),null;case 19:if(Dt(Yn),A=c.memoizedState,A===null)return Dn(c),null;if(v=(c.flags&128)!==0,R=A.rendering,R===null)if(v)jc(A,!1);else{if(_r!==0||a!==null&&(a.flags&128)!==0)for(a=c.child;a!==null;){if(R=lp(a),R!==null){for(c.flags|=128,jc(A,!1),a=R.updateQueue,c.updateQueue=a,$u(c,a),c.subtreeFlags=0,a=p,p=c.child;p!==null;)Pc(p,a),p=p.sibling;return vt(Yn,Yn.current&1|2),c.child}a=a.sibling}A.tail!==null&&dr()>dd&&(c.flags|=128,v=!0,jc(A,!1),c.lanes=4194304)}else{if(!v)if(a=lp(R),a!==null){if(c.flags|=128,v=!0,a=a.updateQueue,c.updateQueue=a,$u(c,a),jc(A,!0),A.tail===null&&A.tailMode==="hidden"&&!R.alternate&&!Pi)return Dn(c),null}else 2*dr()-A.renderingStartTime>dd&&p!==536870912&&(c.flags|=128,v=!0,jc(A,!1),c.lanes=4194304);A.isBackwards?(R.sibling=c.child,c.child=R):(a=A.last,a!==null?a.sibling=R:c.child=R,A.last=R)}return A.tail!==null?(c=A.tail,A.rendering=c,A.tail=c.sibling,A.renderingStartTime=dr(),c.sibling=null,a=Yn.current,vt(Yn,v?a&1|2:a&1),c):(Dn(c),null);case 22:case 23:return nl(c),af(),v=c.memoizedState!==null,a!==null?a.memoizedState!==null!==v&&(c.flags|=8192):v&&(c.flags|=8192),v?(p&536870912)!==0&&(c.flags&128)===0&&(Dn(c),c.subtreeFlags&6&&(c.flags|=8192)):Dn(c),p=c.updateQueue,p!==null&&$u(c,p.retryQueue),p=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(p=a.memoizedState.cachePool.pool),v=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(v=c.memoizedState.cachePool.pool),v!==p&&(c.flags|=2048),a!==null&&Dt(Fs),null;case 24:return p=null,a!==null&&(p=a.memoizedState.cache),c.memoizedState.cache!==p&&(c.flags|=2048),ba(jn),Dn(c),null;case 25:return null;case 30:return null}throw Error(h(156,c.tag))}function v_(a,c){switch(Du(c),c.tag){case 1:return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 3:return ba(jn),Fn(),a=c.flags,(a&65536)!==0&&(a&128)===0?(c.flags=a&-65537|128,c):null;case 26:case 27:case 5:return qn(c),null;case 13:if(nl(c),a=c.memoizedState,a!==null&&a.dehydrated!==null){if(c.alternate===null)throw Error(h(340));us()}return a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 19:return Dt(Yn),null;case 4:return Fn(),null;case 10:return ba(c.type),null;case 22:case 23:return nl(c),af(),a!==null&&Dt(Fs),a=c.flags,a&65536?(c.flags=a&-65537|128,c):null;case 24:return ba(jn),null;case 25:return null;default:return null}}function ad(a,c){switch(Du(c),c.tag){case 3:ba(jn),Fn();break;case 26:case 27:case 5:qn(c);break;case 4:Fn();break;case 13:nl(c);break;case 19:Dt(Yn);break;case 10:ba(c.type);break;case 22:case 23:nl(c),af(),a!==null&&Dt(Fs);break;case 24:ba(jn)}}function Hu(a,c){try{var p=c.updateQueue,v=p!==null?p.lastEffect:null;if(v!==null){var A=v.next;p=A;do{if((p.tag&a)===a){v=void 0;var R=p.create,G=p.inst;v=R(),G.destroy=v}p=p.next}while(p!==A)}}catch(ee){Pn(c,c.return,ee)}}function _s(a,c,p){try{var v=c.updateQueue,A=v!==null?v.lastEffect:null;if(A!==null){var R=A.next;v=R;do{if((v.tag&a)===a){var G=v.inst,ee=G.destroy;if(ee!==void 0){G.destroy=void 0,A=c;var _e=p,Ne=ee;try{Ne()}catch(et){Pn(A,_e,et)}}}v=v.next}while(v!==R)}}catch(et){Pn(c,c.return,et)}}function _f(a){var c=a.updateQueue;if(c!==null){var p=a.stateNode;try{id(c,p)}catch(v){Pn(a,a.return,v)}}}function Yu(a,c,p){p.props=Nc(a.type,a.memoizedProps),p.state=a.memoizedState;try{p.componentWillUnmount()}catch(v){Pn(a,c,v)}}function Jl(a,c){try{var p=a.ref;if(p!==null){switch(a.tag){case 26:case 27:case 5:var v=a.stateNode;break;case 30:v=a.stateNode;break;default:v=a.stateNode}typeof p=="function"?a.refCleanup=p(v):p.current=v}}catch(A){Pn(a,c,A)}}function al(a,c){var p=a.ref,v=a.refCleanup;if(p!==null)if(typeof v=="function")try{v()}catch(A){Pn(a,c,A)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof p=="function")try{p(null)}catch(A){Pn(a,c,A)}else p.current=null}function Vm(a){var c=a.type,p=a.memoizedProps,v=a.stateNode;try{e:switch(c){case"button":case"input":case"select":case"textarea":p.autoFocus&&v.focus();break e;case"img":p.src?v.src=p.src:p.srcSet&&(v.srcset=p.srcSet)}}catch(A){Pn(a,a.return,A)}}function ec(a,c,p){try{var v=a.stateNode;j_(v,a.type,p,c),v[Ot]=c}catch(A){Pn(a,a.return,A)}}function b_(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&cc(a.type)||a.tag===4}function pp(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||b_(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&cc(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function Xu(a,c,p){var v=a.tag;if(v===5||v===6)a=a.stateNode,c?(p.nodeType===9?p.body:p.nodeName==="HTML"?p.ownerDocument.body:p).insertBefore(a,c):(c=p.nodeType===9?p.body:p.nodeName==="HTML"?p.ownerDocument.body:p,c.appendChild(a),p=p._reactRootContainer,p!=null||c.onclick!==null||(c.onclick=Fp));else if(v!==4&&(v===27&&cc(a.type)&&(p=a.stateNode,c=null),a=a.child,a!==null))for(Xu(a,c,p),a=a.sibling;a!==null;)Xu(a,c,p),a=a.sibling}function sd(a,c,p){var v=a.tag;if(v===5||v===6)a=a.stateNode,c?p.insertBefore(a,c):p.appendChild(a);else if(v!==4&&(v===27&&cc(a.type)&&(p=a.stateNode),a=a.child,a!==null))for(sd(a,c,p),a=a.sibling;a!==null;)sd(a,c,p),a=a.sibling}function Zm(a){var c=a.stateNode,p=a.memoizedProps;try{for(var v=a.type,A=c.attributes;A.length;)c.removeAttributeNode(A[0]);Tr(c,v,p),c[Vt]=a,c[Ot]=p}catch(R){Pn(a,a.return,R)}}var sl=!1,Sr=!1,Gm=!1,x_=typeof WeakSet=="function"?WeakSet:Set,Qr=null;function pv(a,c){if(a=a.containerInfo,yd=Ta,a=Yd(a),Xd(a)){if("selectionStart"in a)var p={start:a.selectionStart,end:a.selectionEnd};else e:{p=(p=a.ownerDocument)&&p.defaultView||window;var v=p.getSelection&&p.getSelection();if(v&&v.rangeCount!==0){p=v.anchorNode;var A=v.anchorOffset,R=v.focusNode;v=v.focusOffset;try{p.nodeType,R.nodeType}catch{p=null;break e}var G=0,ee=-1,_e=-1,Ne=0,et=0,dt=a,Ve=null;t:for(;;){for(var qe;dt!==p||A!==0&&dt.nodeType!==3||(ee=G+A),dt!==R||v!==0&&dt.nodeType!==3||(_e=G+v),dt.nodeType===3&&(G+=dt.nodeValue.length),(qe=dt.firstChild)!==null;)Ve=dt,dt=qe;for(;;){if(dt===a)break t;if(Ve===p&&++Ne===A&&(ee=G),Ve===R&&++et===v&&(_e=G),(qe=dt.nextSibling)!==null)break;dt=Ve,Ve=dt.parentNode}dt=qe}p=ee===-1||_e===-1?null:{start:ee,end:_e}}else p=null}p=p||{start:0,end:0}}else p=null;for(Up={focusedElem:a,selectionRange:p},Ta=!1,Qr=c;Qr!==null;)if(c=Qr,a=c.child,(c.subtreeFlags&1024)!==0&&a!==null)a.return=c,Qr=a;else for(;Qr!==null;){switch(c=Qr,R=c.alternate,a=c.flags,c.tag){case 0:break;case 11:case 15:break;case 1:if((a&1024)!==0&&R!==null){a=void 0,p=c,A=R.memoizedProps,R=R.memoizedState,v=p.stateNode;try{var ui=Nc(p.type,A,p.elementType===p.type);a=v.getSnapshotBeforeUpdate(ui,R),v.__reactInternalSnapshotBeforeUpdate=a}catch(ri){Pn(p,p.return,ri)}}break;case 3:if((a&1024)!==0){if(a=c.stateNode.containerInfo,p=a.nodeType,p===9)mg(a);else if(p===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":mg(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(h(163))}if(a=c.sibling,a!==null){a.return=c.return,Qr=a;break}Qr=c.return}}function mp(a,c,p){var v=p.flags;switch(p.tag){case 0:case 11:case 15:Ys(a,p),v&4&&Hu(5,p);break;case 1:if(Ys(a,p),v&4)if(a=p.stateNode,c===null)try{a.componentDidMount()}catch(G){Pn(p,p.return,G)}else{var A=Nc(p.type,c.memoizedProps);c=c.memoizedState;try{a.componentDidUpdate(A,c,a.__reactInternalSnapshotBeforeUpdate)}catch(G){Pn(p,p.return,G)}}v&64&&_f(p),v&512&&Jl(p,p.return);break;case 3:if(Ys(a,p),v&64&&(a=p.updateQueue,a!==null)){if(c=null,p.child!==null)switch(p.child.tag){case 27:case 5:c=p.child.stateNode;break;case 1:c=p.child.stateNode}try{id(a,c)}catch(G){Pn(p,p.return,G)}}break;case 27:c===null&&v&4&&Zm(p);case 26:case 5:Ys(a,p),c===null&&v&4&&Vm(p),v&512&&Jl(p,p.return);break;case 12:Ys(a,p);break;case 13:Ys(a,p),v&4&&Hm(a,p),v&64&&(a=p.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(p=R_.bind(null,p),q_(a,p))));break;case 22:if(v=p.memoizedState!==null||sl,!v){c=c!==null&&c.memoizedState!==null||Sr,A=sl;var R=Sr;sl=v,(Sr=c)&&!R?Vc(a,p,(p.subtreeFlags&8772)!==0):Ys(a,p),sl=A,Sr=R}break;case 30:break;default:Ys(a,p)}}function qm(a){var c=a.alternate;c!==null&&(a.alternate=null,qm(c)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(c=a.stateNode,c!==null&&In(c)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var Zn=null,Oa=!1;function To(a,c,p){for(p=p.child;p!==null;)$m(a,c,p),p=p.sibling}function $m(a,c,p){if(Ir&&typeof Ir.onCommitFiberUnmount=="function")try{Ir.onCommitFiberUnmount(Na,p)}catch{}switch(p.tag){case 26:Sr||al(p,c),To(a,c,p),p.memoizedState?p.memoizedState.count--:p.stateNode&&(p=p.stateNode,p.parentNode.removeChild(p));break;case 27:Sr||al(p,c);var v=Zn,A=Oa;cc(p.type)&&(Zn=p.stateNode,Oa=!1),To(a,c,p),sh(p.stateNode),Zn=v,Oa=A;break;case 5:Sr||al(p,c);case 6:if(v=Zn,A=Oa,Zn=null,To(a,c,p),Zn=v,Oa=A,Zn!==null)if(Oa)try{(Zn.nodeType===9?Zn.body:Zn.nodeName==="HTML"?Zn.ownerDocument.body:Zn).removeChild(p.stateNode)}catch(R){Pn(p,c,R)}else try{Zn.removeChild(p.stateNode)}catch(R){Pn(p,c,R)}break;case 18:Zn!==null&&(Oa?(a=Zn,jp(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,p.stateNode),xd(a)):jp(Zn,p.stateNode));break;case 4:v=Zn,A=Oa,Zn=p.stateNode.containerInfo,Oa=!0,To(a,c,p),Zn=v,Oa=A;break;case 0:case 11:case 14:case 15:Sr||_s(2,p,c),Sr||_s(4,p,c),To(a,c,p);break;case 1:Sr||(al(p,c),v=p.stateNode,typeof v.componentWillUnmount=="function"&&Yu(p,c,v)),To(a,c,p);break;case 21:To(a,c,p);break;case 22:Sr=(v=Sr)||p.memoizedState!==null,To(a,c,p),Sr=v;break;default:To(a,c,p)}}function Hm(a,c){if(c.memoizedState===null&&(a=c.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{xd(a)}catch(p){Pn(c,c.return,p)}}function gp(a){switch(a.tag){case 13:case 19:var c=a.stateNode;return c===null&&(c=a.stateNode=new x_),c;case 22:return a=a.stateNode,c=a._retryCache,c===null&&(c=a._retryCache=new x_),c;default:throw Error(h(435,a.tag))}}function _p(a,c){var p=gp(a);c.forEach(function(v){var A=P_.bind(null,a,v);p.has(v)||(p.add(v),v.then(A,A))})}function Wa(a,c){var p=c.deletions;if(p!==null)for(var v=0;v<p.length;v++){var A=p[v],R=a,G=c,ee=G;e:for(;ee!==null;){switch(ee.tag){case 27:if(cc(ee.type)){Zn=ee.stateNode,Oa=!1;break e}break;case 5:Zn=ee.stateNode,Oa=!1;break e;case 3:case 4:Zn=ee.stateNode.containerInfo,Oa=!0;break e}ee=ee.return}if(Zn===null)throw Error(h(160));$m(R,G,A),Zn=null,Oa=!1,R=A.alternate,R!==null&&(R.return=null),A.return=null}if(c.subtreeFlags&13878)for(c=c.child;c!==null;)od(c,a),c=c.sibling}var Hs=null;function od(a,c){var p=a.alternate,v=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:Wa(c,a),ys(a),v&4&&(_s(3,a,a.return),Hu(3,a),_s(5,a,a.return));break;case 1:Wa(c,a),ys(a),v&512&&(Sr||p===null||al(p,p.return)),v&64&&sl&&(a=a.updateQueue,a!==null&&(v=a.callbacks,v!==null&&(p=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=p===null?v:p.concat(v))));break;case 26:var A=Hs;if(Wa(c,a),ys(a),v&512&&(Sr||p===null||al(p,p.return)),v&4){var R=p!==null?p.memoizedState:null;if(v=a.memoizedState,p===null)if(v===null)if(a.stateNode===null){e:{v=a.type,p=a.memoizedProps,A=A.ownerDocument||A;t:switch(v){case"title":R=A.getElementsByTagName("title")[0],(!R||R[ii]||R[Vt]||R.namespaceURI==="http://www.w3.org/2000/svg"||R.hasAttribute("itemprop"))&&(R=A.createElement(v),A.head.insertBefore(R,A.querySelector("head > title"))),Tr(R,v,p),R[Vt]=a,or(R),v=R;break e;case"link":var G=de("link","href",A).get(v+(p.href||""));if(G){for(var ee=0;ee<G.length;ee++)if(R=G[ee],R.getAttribute("href")===(p.href==null||p.href===""?null:p.href)&&R.getAttribute("rel")===(p.rel==null?null:p.rel)&&R.getAttribute("title")===(p.title==null?null:p.title)&&R.getAttribute("crossorigin")===(p.crossOrigin==null?null:p.crossOrigin)){G.splice(ee,1);break t}}R=A.createElement(v),Tr(R,v,p),A.head.appendChild(R);break;case"meta":if(G=de("meta","content",A).get(v+(p.content||""))){for(ee=0;ee<G.length;ee++)if(R=G[ee],R.getAttribute("content")===(p.content==null?null:""+p.content)&&R.getAttribute("name")===(p.name==null?null:p.name)&&R.getAttribute("property")===(p.property==null?null:p.property)&&R.getAttribute("http-equiv")===(p.httpEquiv==null?null:p.httpEquiv)&&R.getAttribute("charset")===(p.charSet==null?null:p.charSet)){G.splice(ee,1);break t}}R=A.createElement(v),Tr(R,v,p),A.head.appendChild(R);break;default:throw Error(h(468,v))}R[Vt]=a,or(R),v=R}a.stateNode=v}else V(A,a.type,a.stateNode);else a.stateNode=H(A,v,a.memoizedProps);else R!==v?(R===null?p.stateNode!==null&&(p=p.stateNode,p.parentNode.removeChild(p)):R.count--,v===null?V(A,a.type,a.stateNode):H(A,v,a.memoizedProps)):v===null&&a.stateNode!==null&&ec(a,a.memoizedProps,p.memoizedProps)}break;case 27:Wa(c,a),ys(a),v&512&&(Sr||p===null||al(p,p.return)),p!==null&&v&4&&ec(a,a.memoizedProps,p.memoizedProps);break;case 5:if(Wa(c,a),ys(a),v&512&&(Sr||p===null||al(p,p.return)),a.flags&32){A=a.stateNode;try{kr(A,"")}catch(qe){Pn(a,a.return,qe)}}v&4&&a.stateNode!=null&&(A=a.memoizedProps,ec(a,A,p!==null?p.memoizedProps:A)),v&1024&&(Gm=!0);break;case 6:if(Wa(c,a),ys(a),v&4){if(a.stateNode===null)throw Error(h(162));v=a.memoizedProps,p=a.stateNode;try{p.nodeValue=v}catch(qe){Pn(a,a.return,qe)}}break;case 3:if(ve=null,A=Hs,Hs=oh(c.containerInfo),Wa(c,a),Hs=A,ys(a),v&4&&p!==null&&p.memoizedState.isDehydrated)try{xd(c.containerInfo)}catch(qe){Pn(a,a.return,qe)}Gm&&(Gm=!1,yp(a));break;case 4:v=Hs,Hs=oh(a.stateNode.containerInfo),Wa(c,a),ys(a),Hs=v;break;case 12:Wa(c,a),ys(a);break;case 13:Wa(c,a),ys(a),a.child.flags&8192&&a.memoizedState!==null!=(p!==null&&p.memoizedState!==null)&&(wp=dr()),v&4&&(v=a.updateQueue,v!==null&&(a.updateQueue=null,_p(a,v)));break;case 22:A=a.memoizedState!==null;var _e=p!==null&&p.memoizedState!==null,Ne=sl,et=Sr;if(sl=Ne||A,Sr=et||_e,Wa(c,a),Sr=et,sl=Ne,ys(a),v&8192)e:for(c=a.stateNode,c._visibility=A?c._visibility&-2:c._visibility|1,A&&(p===null||_e||sl||Sr||tc(a)),p=null,c=a;;){if(c.tag===5||c.tag===26){if(p===null){_e=p=c;try{if(R=_e.stateNode,A)G=R.style,typeof G.setProperty=="function"?G.setProperty("display","none","important"):G.display="none";else{ee=_e.stateNode;var dt=_e.memoizedProps.style,Ve=dt!=null&&dt.hasOwnProperty("display")?dt.display:null;ee.style.display=Ve==null||typeof Ve=="boolean"?"":(""+Ve).trim()}}catch(qe){Pn(_e,_e.return,qe)}}}else if(c.tag===6){if(p===null){_e=c;try{_e.stateNode.nodeValue=A?"":_e.memoizedProps}catch(qe){Pn(_e,_e.return,qe)}}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===a)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===a)break e;for(;c.sibling===null;){if(c.return===null||c.return===a)break e;p===c&&(p=null),c=c.return}p===c&&(p=null),c.sibling.return=c.return,c=c.sibling}v&4&&(v=a.updateQueue,v!==null&&(p=v.retryQueue,p!==null&&(v.retryQueue=null,_p(a,p))));break;case 19:Wa(c,a),ys(a),v&4&&(v=a.updateQueue,v!==null&&(a.updateQueue=null,_p(a,v)));break;case 30:break;case 21:break;default:Wa(c,a),ys(a)}}function ys(a){var c=a.flags;if(c&2){try{for(var p,v=a.return;v!==null;){if(b_(v)){p=v;break}v=v.return}if(p==null)throw Error(h(160));switch(p.tag){case 27:var A=p.stateNode,R=pp(a);sd(a,R,A);break;case 5:var G=p.stateNode;p.flags&32&&(kr(G,""),p.flags&=-33);var ee=pp(a);sd(a,ee,G);break;case 3:case 4:var _e=p.stateNode.containerInfo,Ne=pp(a);Xu(a,Ne,_e);break;default:throw Error(h(161))}}catch(et){Pn(a,a.return,et)}a.flags&=-3}c&4096&&(a.flags&=-4097)}function yp(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var c=a;yp(c),c.tag===5&&c.flags&1024&&c.stateNode.reset(),a=a.sibling}}function Ys(a,c){if(c.subtreeFlags&8772)for(c=c.child;c!==null;)mp(a,c.alternate,c),c=c.sibling}function tc(a){for(a=a.child;a!==null;){var c=a;switch(c.tag){case 0:case 11:case 14:case 15:_s(4,c,c.return),tc(c);break;case 1:al(c,c.return);var p=c.stateNode;typeof p.componentWillUnmount=="function"&&Yu(c,c.return,p),tc(c);break;case 27:sh(c.stateNode);case 26:case 5:al(c,c.return),tc(c);break;case 22:c.memoizedState===null&&tc(c);break;case 30:tc(c);break;default:tc(c)}a=a.sibling}}function Vc(a,c,p){for(p=p&&(c.subtreeFlags&8772)!==0,c=c.child;c!==null;){var v=c.alternate,A=a,R=c,G=R.flags;switch(R.tag){case 0:case 11:case 15:Vc(A,R,p),Hu(4,R);break;case 1:if(Vc(A,R,p),v=R,A=v.stateNode,typeof A.componentDidMount=="function")try{A.componentDidMount()}catch(Ne){Pn(v,v.return,Ne)}if(v=R,A=v.updateQueue,A!==null){var ee=v.stateNode;try{var _e=A.shared.hiddenCallbacks;if(_e!==null)for(A.shared.hiddenCallbacks=null,A=0;A<_e.length;A++)Bu(_e[A],ee)}catch(Ne){Pn(v,v.return,Ne)}}p&&G&64&&_f(R),Jl(R,R.return);break;case 27:Zm(R);case 26:case 5:Vc(A,R,p),p&&v===null&&G&4&&Vm(R),Jl(R,R.return);break;case 12:Vc(A,R,p);break;case 13:Vc(A,R,p),p&&G&4&&Hm(A,R);break;case 22:R.memoizedState===null&&Vc(A,R,p),Jl(R,R.return);break;case 30:break;default:Vc(A,R,p)}c=c.sibling}}function Ym(a,c){var p=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(p=a.memoizedState.cachePool.pool),a=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(a=c.memoizedState.cachePool.pool),a!==p&&(a!=null&&a.refCount++,p!=null&&Lr(p))}function vp(a,c){a=null,c.alternate!==null&&(a=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==a&&(c.refCount++,a!=null&&Lr(a))}function Eo(a,c,p,v){if(c.subtreeFlags&10256)for(c=c.child;c!==null;)w_(a,c,p,v),c=c.sibling}function w_(a,c,p,v){var A=c.flags;switch(c.tag){case 0:case 11:case 15:Eo(a,c,p,v),A&2048&&Hu(9,c);break;case 1:Eo(a,c,p,v);break;case 3:Eo(a,c,p,v),A&2048&&(a=null,c.alternate!==null&&(a=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==a&&(c.refCount++,a!=null&&Lr(a)));break;case 12:if(A&2048){Eo(a,c,p,v),a=c.stateNode;try{var R=c.memoizedProps,G=R.id,ee=R.onPostCommit;typeof ee=="function"&&ee(G,c.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(_e){Pn(c,c.return,_e)}}else Eo(a,c,p,v);break;case 13:Eo(a,c,p,v);break;case 23:break;case 22:R=c.stateNode,G=c.alternate,c.memoizedState!==null?R._visibility&2?Eo(a,c,p,v):ic(a,c):R._visibility&2?Eo(a,c,p,v):(R._visibility|=2,ld(a,c,p,v,(c.subtreeFlags&10256)!==0)),A&2048&&Ym(G,c);break;case 24:Eo(a,c,p,v),A&2048&&vp(c.alternate,c);break;default:Eo(a,c,p,v)}}function ld(a,c,p,v,A){for(A=A&&(c.subtreeFlags&10256)!==0,c=c.child;c!==null;){var R=a,G=c,ee=p,_e=v,Ne=G.flags;switch(G.tag){case 0:case 11:case 15:ld(R,G,ee,_e,A),Hu(8,G);break;case 23:break;case 22:var et=G.stateNode;G.memoizedState!==null?et._visibility&2?ld(R,G,ee,_e,A):ic(R,G):(et._visibility|=2,ld(R,G,ee,_e,A)),A&&Ne&2048&&Ym(G.alternate,G);break;case 24:ld(R,G,ee,_e,A),A&&Ne&2048&&vp(G.alternate,G);break;default:ld(R,G,ee,_e,A)}c=c.sibling}}function ic(a,c){if(c.subtreeFlags&10256)for(c=c.child;c!==null;){var p=a,v=c,A=v.flags;switch(v.tag){case 22:ic(p,v),A&2048&&Ym(v.alternate,v);break;case 24:ic(p,v),A&2048&&vp(v.alternate,v);break;default:ic(p,v)}c=c.sibling}}var cd=8192;function ud(a){if(a.subtreeFlags&cd)for(a=a.child;a!==null;)S_(a),a=a.sibling}function S_(a){switch(a.tag){case 26:ud(a),a.flags&cd&&a.memoizedState!==null&&Ue(Hs,a.memoizedState,a.memoizedProps);break;case 5:ud(a);break;case 3:case 4:var c=Hs;Hs=oh(a.stateNode.containerInfo),ud(a),Hs=c;break;case 22:a.memoizedState===null&&(c=a.alternate,c!==null&&c.memoizedState!==null?(c=cd,cd=16777216,ud(a),cd=c):ud(a));break;default:ud(a)}}function T_(a){var c=a.alternate;if(c!==null&&(a=c.child,a!==null)){c.child=null;do c=a.sibling,a.sibling=null,a=c;while(a!==null)}}function yf(a){var c=a.deletions;if((a.flags&16)!==0){if(c!==null)for(var p=0;p<c.length;p++){var v=c[p];Qr=v,Xm(v,a)}T_(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)E_(a),a=a.sibling}function E_(a){switch(a.tag){case 0:case 11:case 15:yf(a),a.flags&2048&&_s(9,a,a.return);break;case 3:yf(a);break;case 12:yf(a);break;case 22:var c=a.stateNode;a.memoizedState!==null&&c._visibility&2&&(a.return===null||a.return.tag!==13)?(c._visibility&=-3,bp(a)):yf(a);break;default:yf(a)}}function bp(a){var c=a.deletions;if((a.flags&16)!==0){if(c!==null)for(var p=0;p<c.length;p++){var v=c[p];Qr=v,Xm(v,a)}T_(a)}for(a=a.child;a!==null;){switch(c=a,c.tag){case 0:case 11:case 15:_s(8,c,c.return),bp(c);break;case 22:p=c.stateNode,p._visibility&2&&(p._visibility&=-3,bp(c));break;default:bp(c)}a=a.sibling}}function Xm(a,c){for(;Qr!==null;){var p=Qr;switch(p.tag){case 0:case 11:case 15:_s(8,p,c);break;case 23:case 22:if(p.memoizedState!==null&&p.memoizedState.cachePool!==null){var v=p.memoizedState.cachePool.pool;v!=null&&v.refCount++}break;case 24:Lr(p.memoizedState.cache)}if(v=p.child,v!==null)v.return=p,Qr=v;else e:for(p=a;Qr!==null;){v=Qr;var A=v.sibling,R=v.return;if(qm(v),v===p){Qr=null;break e}if(A!==null){A.return=R,Qr=A;break e}Qr=R}}}var Km={getCacheForType:function(a){var c=an(jn),p=c.data.get(a);return p===void 0&&(p=a(),c.data.set(a,p)),p}},M_=typeof WeakMap=="function"?WeakMap:Map,cn=0,Rn=null,Vi=null,Zi=0,gn=0,Qa=null,Zc=!1,hd=!1,Wm=!1,ol=0,_r=0,Gc=0,Mo=0,xp=0,Ja=0,Ku=0,Xn=null,wa=null,Qm=!1,wp=0,dd=1/0,fd=null,qc=null,sa=0,$c=null,pd=null,Wu=0,oa=0,vf=null,Jm=null,Xs=0,md=null;function la(){if((cn&2)!==0&&Zi!==0)return Zi&-Zi;if(Ae.T!==null){var a=hs;return a!==0?a:Pp()}return yt()}function Qu(){Ja===0&&(Ja=(Zi&536870912)===0||Pi?fe():536870912);var a=qs.current;return a!==null&&(a.flags|=32),Ja}function Sa(a,c,p){(a===Rn&&(gn===2||gn===9)||a.cancelPendingCommit!==null)&&(Ju(a,0),nc(a,Zi,Ja,!1)),ze(a,p),((cn&2)===0||a!==Rn)&&(a===Rn&&((cn&2)===0&&(Mo|=p),_r===4&&nc(a,Zi,Ja,!1)),ll(a))}function bf(a,c,p){if((cn&6)!==0)throw Error(h(327));var v=!p&&(c&124)===0&&(c&a.expiredLanes)===0||J(a,c),A=v?_v(a,c):Ep(a,c,!0),R=v;do{if(A===0){hd&&!v&&nc(a,c,0,!1);break}else{if(p=a.current.alternate,R&&!mv(p)){A=Ep(a,c,!1),R=!1;continue}if(A===2){if(R=c,a.errorRecoveryDisabledLanes&R)var G=0;else G=a.pendingLanes&-536870913,G=G!==0?G:G&536870912?536870912:0;if(G!==0){c=G;e:{var ee=a;A=Xn;var _e=ee.current.memoizedState.isDehydrated;if(_e&&(Ju(ee,G).flags|=256),G=Ep(ee,G,!1),G!==2){if(Wm&&!_e){ee.errorRecoveryDisabledLanes|=R,Mo|=R,A=4;break e}R=wa,wa=A,R!==null&&(wa===null?wa=R:wa.push.apply(wa,R))}A=G}if(R=!1,A!==2)continue}}if(A===1){Ju(a,0),nc(a,c,0,!0);break}e:{switch(v=a,R=A,R){case 0:case 1:throw Error(h(345));case 4:if((c&4194048)!==c)break;case 6:nc(v,c,Ja,!Zc);break e;case 2:wa=null;break;case 3:case 5:break;default:throw Error(h(329))}if((c&62914560)===c&&(A=wp+300-dr(),10<A)){if(nc(v,c,Ja,!Zc),W(v,0,!0)!==0)break e;v.timeoutHandle=ah(A_.bind(null,v,p,wa,fd,Qm,c,Ja,Mo,Ku,Zc,R,2,-0,0),A);break e}A_(v,p,wa,fd,Qm,c,Ja,Mo,Ku,Zc,R,0,-0,0)}}break}while(!0);ll(a)}function A_(a,c,p,v,A,R,G,ee,_e,Ne,et,dt,Ve,qe){if(a.timeoutHandle=-1,dt=c.subtreeFlags,(dt&8192||(dt&16785408)===16785408)&&(Be={stylesheets:null,count:0,unsuspend:ot},S_(c),dt=$e(),dt!==null)){a.cancelPendingCommit=dt(Ao.bind(null,a,c,R,p,v,A,G,ee,_e,et,1,Ve,qe)),nc(a,R,G,!Ne);return}Ao(a,c,R,p,v,A,G,ee,_e)}function mv(a){for(var c=a;;){var p=c.tag;if((p===0||p===11||p===15)&&c.flags&16384&&(p=c.updateQueue,p!==null&&(p=p.stores,p!==null)))for(var v=0;v<p.length;v++){var A=p[v],R=A.getSnapshot;A=A.value;try{if(!ta(R(),A))return!1}catch{return!1}}if(p=c.child,c.subtreeFlags&16384&&p!==null)p.return=c,c=p;else{if(c===a)break;for(;c.sibling===null;){if(c.return===null||c.return===a)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function nc(a,c,p,v){c&=~xp,c&=~Mo,a.suspendedLanes|=c,a.pingedLanes&=~c,v&&(a.warmLanes|=c),v=a.expirationTimes;for(var A=c;0<A;){var R=31-Wn(A),G=1<<R;v[R]=-1,A&=~G}p!==0&&Ye(a,p,c)}function xf(){return(cn&6)===0?(Mf(0),!1):!0}function eg(){if(Vi!==null){if(gn===0)var a=Vi.return;else a=Vi,Bs=$o=null,Uu(a),ka=null,Ya=0,a=Vi;for(;a!==null;)ad(a.alternate,a),a=a.return;Vi=null}}function Ju(a,c){var p=a.timeoutHandle;p!==-1&&(a.timeoutHandle=-1,Jr(p)),p=a.cancelPendingCommit,p!==null&&(a.cancelPendingCommit=null,p()),eg(),Rn=a,Vi=p=Va(a.current,null),Zi=c,gn=0,Qa=null,Zc=!1,hd=J(a,c),Wm=!1,Ku=Ja=xp=Mo=Gc=_r=0,wa=Xn=null,Qm=!1,(c&8)!==0&&(c|=c&32);var v=a.entangledLanes;if(v!==0)for(a=a.entanglements,v&=c;0<v;){var A=31-Wn(v),R=1<<A;c|=a[A],v&=~R}return ol=c,qh(),p}function tg(a,c){Ht=null,Ae.H=Gs,c===Pu||c===kc?(c=Ns(),gn=3):c===td?(c=Ns(),gn=4):gn=c===Xa?8:c!==null&&typeof c=="object"&&typeof c.then=="function"?6:1,Qa=c,Vi===null&&(_r=1,df(a,ia(c,a.current)))}function Sp(){var a=Ae.H;return Ae.H=Gs,a===null?Gs:a}function Tp(){var a=Ae.A;return Ae.A=Km,a}function ig(){_r=4,Zc||(Zi&4194048)!==Zi&&qs.current!==null||(hd=!0),(Gc&134217727)===0&&(Mo&134217727)===0||Rn===null||nc(Rn,Zi,Ja,!1)}function Ep(a,c,p){var v=cn;cn|=2;var A=Sp(),R=Tp();(Rn!==a||Zi!==c)&&(fd=null,Ju(a,c)),c=!1;var G=_r;e:do try{if(gn!==0&&Vi!==null){var ee=Vi,_e=Qa;switch(gn){case 8:eg(),G=6;break e;case 3:case 2:case 9:case 6:qs.current===null&&(c=!0);var Ne=gn;if(gn=0,Qa=null,eh(a,ee,_e,Ne),p&&hd){G=0;break e}break;default:Ne=gn,gn=0,Qa=null,eh(a,ee,_e,Ne)}}gv(),G=_r;break}catch(et){tg(a,et)}while(!0);return c&&a.shellSuspendCounter++,Bs=$o=null,cn=v,Ae.H=A,Ae.A=R,Vi===null&&(Rn=null,Zi=0,qh()),G}function gv(){for(;Vi!==null;)I_(Vi)}function _v(a,c){var p=cn;cn|=2;var v=Sp(),A=Tp();Rn!==a||Zi!==c?(fd=null,dd=dr()+500,Ju(a,c)):hd=J(a,c);e:do try{if(gn!==0&&Vi!==null){c=Vi;var R=Qa;t:switch(gn){case 1:gn=0,Qa=null,eh(a,c,R,1);break;case 2:case 9:if(nf(R)){gn=0,Qa=null,C_(c);break}c=function(){gn!==2&&gn!==9||Rn!==a||(gn=7),ll(a)},R.then(c,c);break e;case 3:gn=7;break e;case 4:gn=5;break e;case 7:nf(R)?(gn=0,Qa=null,C_(c)):(gn=0,Qa=null,eh(a,c,R,7));break;case 5:var G=null;switch(Vi.tag){case 26:G=Vi.memoizedState;case 5:case 27:var ee=Vi;if(!G||pe(G)){gn=0,Qa=null;var _e=ee.sibling;if(_e!==null)Vi=_e;else{var Ne=ee.return;Ne!==null?(Vi=Ne,wf(Ne)):Vi=null}break t}}gn=0,Qa=null,eh(a,c,R,5);break;case 6:gn=0,Qa=null,eh(a,c,R,6);break;case 8:eg(),_r=6;break e;default:throw Error(h(462))}}yv();break}catch(et){tg(a,et)}while(!0);return Bs=$o=null,Ae.H=v,Ae.A=A,cn=p,Vi!==null?0:(Rn=null,Zi=0,qh(),_r)}function yv(){for(;Vi!==null&&!yl();)I_(Vi)}function I_(a){var c=tr(a.alternate,a,ol);a.memoizedProps=a.pendingProps,c===null?wf(a):Vi=c}function C_(a){var c=a,p=c.alternate;switch(c.tag){case 15:case 0:c=dp(p,c,c.pendingProps,c.type,void 0,Zi);break;case 11:c=dp(p,c,c.pendingProps,c.type.render,c.ref,Zi);break;case 5:Uu(c);default:ad(p,c),c=Vi=Pc(c,ol),c=tr(p,c,ol)}a.memoizedProps=a.pendingProps,c===null?wf(a):Vi=c}function eh(a,c,p,v){Bs=$o=null,Uu(c),ka=null,Ya=0;var A=c.return;try{if(pf(a,A,c,p,Zi)){_r=1,df(a,ia(p,a.current)),Vi=null;return}}catch(R){if(A!==null)throw Vi=A,R;_r=1,df(a,ia(p,a.current)),Vi=null;return}c.flags&32768?(Pi||v===1?a=!0:hd||(Zi&536870912)!==0?a=!1:(Zc=a=!0,(v===2||v===9||v===3||v===6)&&(v=qs.current,v!==null&&v.tag===13&&(v.flags|=16384))),gd(c,a)):wf(c)}function wf(a){var c=a;do{if((c.flags&32768)!==0){gd(c,Zc);return}a=c.return;var p=y_(c.alternate,c,ol);if(p!==null){Vi=p;return}if(c=c.sibling,c!==null){Vi=c;return}Vi=c=a}while(c!==null);_r===0&&(_r=5)}function gd(a,c){do{var p=v_(a.alternate,a);if(p!==null){p.flags&=32767,Vi=p;return}if(p=a.return,p!==null&&(p.flags|=32768,p.subtreeFlags=0,p.deletions=null),!c&&(a=a.sibling,a!==null)){Vi=a;return}Vi=a=p}while(a!==null);_r=6,Vi=null}function Ao(a,c,p,v,A,R,G,ee,_e){a.cancelPendingCommit=null;do Ap();while(sa!==0);if((cn&6)!==0)throw Error(h(327));if(c!==null){if(c===a.current)throw Error(h(177));if(R=c.lanes|c.childLanes,R|=Ll,Ce(a,p,R,G,ee,_e),a===Rn&&(Vi=Rn=null,Zi=0),pd=c,$c=a,Wu=p,oa=R,vf=A,Jm=v,(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,ag(fa,function(){return Sf(),null})):(a.callbackNode=null,a.callbackPriority=0),v=(c.flags&13878)!==0,(c.subtreeFlags&13878)!==0||v){v=Ae.T,Ae.T=null,A=st.p,st.p=2,G=cn,cn|=4;try{pv(a,c,p)}finally{cn=G,st.p=A,Ae.T=v}}sa=1,rc(),ng(),Mp()}}function rc(){if(sa===1){sa=0;var a=$c,c=pd,p=(c.flags&13878)!==0;if((c.subtreeFlags&13878)!==0||p){p=Ae.T,Ae.T=null;var v=st.p;st.p=2;var A=cn;cn|=4;try{od(c,a);var R=Up,G=Yd(a.containerInfo),ee=R.focusedElem,_e=R.selectionRange;if(G!==ee&&ee&&ee.ownerDocument&&ip(ee.ownerDocument.documentElement,ee)){if(_e!==null&&Xd(ee)){var Ne=_e.start,et=_e.end;if(et===void 0&&(et=Ne),"selectionStart"in ee)ee.selectionStart=Ne,ee.selectionEnd=Math.min(et,ee.value.length);else{var dt=ee.ownerDocument||document,Ve=dt&&dt.defaultView||window;if(Ve.getSelection){var qe=Ve.getSelection(),ui=ee.textContent.length,ri=Math.min(_e.start,ui),Si=_e.end===void 0?ri:Math.min(_e.end,ui);!qe.extend&&ri>Si&&(G=Si,Si=ri,ri=G);var Re=tp(ee,ri),Ie=tp(ee,Si);if(Re&&Ie&&(qe.rangeCount!==1||qe.anchorNode!==Re.node||qe.anchorOffset!==Re.offset||qe.focusNode!==Ie.node||qe.focusOffset!==Ie.offset)){var ke=dt.createRange();ke.setStart(Re.node,Re.offset),qe.removeAllRanges(),ri>Si?(qe.addRange(ke),qe.extend(Ie.node,Ie.offset)):(ke.setEnd(Ie.node,Ie.offset),qe.addRange(ke))}}}}for(dt=[],qe=ee;qe=qe.parentNode;)qe.nodeType===1&&dt.push({element:qe,left:qe.scrollLeft,top:qe.scrollTop});for(typeof ee.focus=="function"&&ee.focus(),ee=0;ee<dt.length;ee++){var rt=dt[ee];rt.element.scrollLeft=rt.left,rt.element.scrollTop=rt.top}}Ta=!!yd,Up=yd=null}finally{cn=A,st.p=v,Ae.T=p}}a.current=c,sa=2}}function ng(){if(sa===2){sa=0;var a=$c,c=pd,p=(c.flags&8772)!==0;if((c.subtreeFlags&8772)!==0||p){p=Ae.T,Ae.T=null;var v=st.p;st.p=2;var A=cn;cn|=4;try{mp(a,c.alternate,c)}finally{cn=A,st.p=v,Ae.T=p}}sa=3}}function Mp(){if(sa===4||sa===3){sa=0,vl();var a=$c,c=pd,p=Wu,v=Jm;(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?sa=5:(sa=0,pd=$c=null,D_(a,a.pendingLanes));var A=a.pendingLanes;if(A===0&&(qc=null),nt(p),c=c.stateNode,Ir&&typeof Ir.onCommitFiberRoot=="function")try{Ir.onCommitFiberRoot(Na,c,void 0,(c.current.flags&128)===128)}catch{}if(v!==null){c=Ae.T,A=st.p,st.p=2,Ae.T=null;try{for(var R=a.onRecoverableError,G=0;G<v.length;G++){var ee=v[G];R(ee.value,{componentStack:ee.stack})}}finally{Ae.T=c,st.p=A}}(Wu&3)!==0&&Ap(),ll(a),A=a.pendingLanes,(p&4194090)!==0&&(A&42)!==0?a===md?Xs++:(Xs=0,md=a):Xs=0,Mf(0)}}function D_(a,c){(a.pooledCacheLanes&=c)===0&&(c=a.pooledCache,c!=null&&(a.pooledCache=null,Lr(c)))}function Ap(a){return rc(),ng(),Mp(),Sf()}function Sf(){if(sa!==5)return!1;var a=$c,c=oa;oa=0;var p=nt(Wu),v=Ae.T,A=st.p;try{st.p=32>p?32:p,Ae.T=null,p=vf,vf=null;var R=$c,G=Wu;if(sa=0,pd=$c=null,Wu=0,(cn&6)!==0)throw Error(h(331));var ee=cn;if(cn|=4,E_(R.current),w_(R,R.current,G,p),cn=ee,Mf(0,!1),Ir&&typeof Ir.onPostCommitFiberRoot=="function")try{Ir.onPostCommitFiberRoot(Na,R)}catch{}return!0}finally{st.p=A,Ae.T=v,D_(a,c)}}function Ip(a,c,p){c=ia(p,c),c=ff(a.stateNode,c,2),a=ds(a,c,2),a!==null&&(ze(a,2),ll(a))}function Pn(a,c,p){if(a.tag===3)Ip(a,a,p);else for(;c!==null;){if(c.tag===3){Ip(c,a,p);break}else if(c.tag===1){var v=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof v.componentDidCatch=="function"&&(qc===null||!qc.has(v))){a=ia(p,a),p=km(2),v=ds(c,p,2),v!==null&&(up(p,v,c,a),ze(v,2),ll(v));break}}c=c.return}}function Tf(a,c,p){var v=a.pingCache;if(v===null){v=a.pingCache=new M_;var A=new Set;v.set(c,A)}else A=v.get(c),A===void 0&&(A=new Set,v.set(c,A));A.has(p)||(Wm=!0,A.add(p),a=rg.bind(null,a,c,p),c.then(a,a))}function rg(a,c,p){var v=a.pingCache;v!==null&&v.delete(c),a.pingedLanes|=a.suspendedLanes&p,a.warmLanes&=~p,Rn===a&&(Zi&p)===p&&(_r===4||_r===3&&(Zi&62914560)===Zi&&300>dr()-wp?(cn&2)===0&&Ju(a,0):xp|=p,Ku===Zi&&(Ku=0)),ll(a)}function th(a,c){c===0&&(c=Ee()),a=Rc(a,c),a!==null&&(ze(a,c),ll(a))}function R_(a){var c=a.memoizedState,p=0;c!==null&&(p=c.retryLane),th(a,p)}function P_(a,c){var p=0;switch(a.tag){case 13:var v=a.stateNode,A=a.memoizedState;A!==null&&(p=A.retryLane);break;case 19:v=a.stateNode;break;case 22:v=a.stateNode._retryCache;break;default:throw Error(h(314))}v!==null&&v.delete(c),th(a,p)}function ag(a,c){return as(a,c)}var Ef=null,ac=null,Cp=!1,Dp=!1,sg=!1,Hc=0;function ll(a){a!==ac&&a.next===null&&(ac===null?Ef=ac=a:ac=ac.next=a),Dp=!0,Cp||(Cp=!0,O_())}function Mf(a,c){if(!sg&&Dp){sg=!0;do for(var p=!1,v=Ef;v!==null;){if(a!==0){var A=v.pendingLanes;if(A===0)var R=0;else{var G=v.suspendedLanes,ee=v.pingedLanes;R=(1<<31-Wn(42|a)+1)-1,R&=A&~(G&~ee),R=R&201326741?R&201326741|1:R?R|2:0}R!==0&&(p=!0,sc(v,R))}else R=Zi,R=W(v,v===Rn?R:0,v.cancelPendingCommit!==null||v.timeoutHandle!==-1),(R&3)===0||J(v,R)||(p=!0,sc(v,R));v=v.next}while(p);sg=!1}}function vv(){z_()}function z_(){Dp=Cp=!1;var a=0;Hc!==0&&(bv()&&(a=Hc),Hc=0);for(var c=dr(),p=null,v=Ef;v!==null;){var A=v.next,R=k_(v,c);R===0?(v.next=null,p===null?Ef=A:p.next=A,A===null&&(ac=p)):(p=v,(a!==0||(R&3)!==0)&&(Dp=!0)),v=A}Mf(a)}function k_(a,c){for(var p=a.suspendedLanes,v=a.pingedLanes,A=a.expirationTimes,R=a.pendingLanes&-62914561;0<R;){var G=31-Wn(R),ee=1<<G,_e=A[G];_e===-1?((ee&p)===0||(ee&v)!==0)&&(A[G]=$(ee,c)):_e<=c&&(a.expiredLanes|=ee),R&=~ee}if(c=Rn,p=Zi,p=W(a,a===c?p:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),v=a.callbackNode,p===0||a===c&&(gn===2||gn===9)||a.cancelPendingCommit!==null)return v!==null&&v!==null&&Nn(v),a.callbackNode=null,a.callbackPriority=0;if((p&3)===0||J(a,p)){if(c=p&-p,c===a.callbackPriority)return c;switch(v!==null&&Nn(v),nt(p)){case 2:case 8:p=Fa;break;case 32:p=fa;break;case 268435456:p=bl;break;default:p=fa}return v=Rp.bind(null,a),p=as(p,v),a.callbackPriority=c,a.callbackNode=p,c}return v!==null&&v!==null&&Nn(v),a.callbackPriority=2,a.callbackNode=null,2}function Rp(a,c){if(sa!==0&&sa!==5)return a.callbackNode=null,a.callbackPriority=0,null;var p=a.callbackNode;if(Ap()&&a.callbackNode!==p)return null;var v=Zi;return v=W(a,a===Rn?v:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),v===0?null:(bf(a,v,c),k_(a,dr()),a.callbackNode!=null&&a.callbackNode===p?Rp.bind(null,a):null)}function sc(a,c){if(Ap())return null;bf(a,c,!0)}function O_(){pg(function(){(cn&6)!==0?as(no,vv):z_()})}function Pp(){return Hc===0&&(Hc=fe()),Hc}function og(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:Cr(""+a)}function lg(a,c){var p=c.ownerDocument.createElement("input");return p.name=c.name,p.value=c.value,a.id&&p.setAttribute("form",a.id),c.parentNode.insertBefore(p,c),a=new FormData(a),p.parentNode.removeChild(p),a}function B_(a,c,p,v,A){if(c==="submit"&&p&&p.stateNode===A){var R=og((A[Ot]||null).action),G=v.submitter;G&&(c=(c=G[Ot]||null)?og(c.formAction):G.getAttribute("formAction"),c!==null&&(R=c,G=null));var ee=new Lo("action","action",null,v,A);a.push({event:ee,listeners:[{instance:null,listener:function(){if(v.defaultPrevented){if(Hc!==0){var _e=G?lg(A,G):new FormData(A);Vs(p,{pending:!0,data:_e,method:A.method,action:R},null,_e)}}else typeof R=="function"&&(ee.preventDefault(),_e=G?lg(A,G):new FormData(A),Vs(p,{pending:!0,data:_e,method:A.method,action:R},R,_e))},currentTarget:A}]})}}for(var Af=0;Af<Gh.length;Af++){var zp=Gh[Af],If=zp.toLowerCase(),L_=zp[0].toUpperCase()+zp.slice(1);Da(If,"on"+L_)}Da(jo,"onAnimationEnd"),Da(Eu,"onAnimationIteration"),Da(Mu,"onAnimationStart"),Da("dblclick","onDoubleClick"),Da("focusin","onFocus"),Da("focusout","onBlur"),Da(Au,"onTransitionRun"),Da(Zh,"onTransitionStart"),Da(rp,"onTransitionCancel"),Da(kl,"onTransitionEnd"),rn("onMouseEnter",["mouseout","mouseover"]),rn("onMouseLeave",["mouseout","mouseover"]),rn("onPointerEnter",["pointerout","pointerover"]),rn("onPointerLeave",["pointerout","pointerover"]),fr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),fr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),fr("onBeforeInput",["compositionend","keypress","textInput","paste"]),fr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),fr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),fr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ih="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),F_=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(ih));function es(a,c){c=(c&4)!==0;for(var p=0;p<a.length;p++){var v=a[p],A=v.event;v=v.listeners;e:{var R=void 0;if(c)for(var G=v.length-1;0<=G;G--){var ee=v[G],_e=ee.instance,Ne=ee.currentTarget;if(ee=ee.listener,_e!==R&&A.isPropagationStopped())break e;R=ee,A.currentTarget=Ne;try{R(A)}catch(et){cp(et)}A.currentTarget=null,R=_e}else for(G=0;G<v.length;G++){if(ee=v[G],_e=ee.instance,Ne=ee.currentTarget,ee=ee.listener,_e!==R&&A.isPropagationStopped())break e;R=ee,A.currentTarget=Ne;try{R(A)}catch(et){cp(et)}A.currentTarget=null,R=_e}}}}function Ci(a,c){var p=c[ki];p===void 0&&(p=c[ki]=new Set);var v=a+"__bubble";p.has(v)||(cg(c,a,2,!1),p.add(v))}function kp(a,c,p){var v=0;c&&(v|=4),cg(p,a,v,c)}var Cf="_reactListening"+Math.random().toString(36).slice(2);function Op(a){if(!a[Cf]){a[Cf]=!0,Sl.forEach(function(p){p!=="selectionchange"&&(F_.has(p)||kp(p,!1,a),kp(p,!0,a))});var c=a.nodeType===9?a:a.ownerDocument;c===null||c[Cf]||(c[Cf]=!0,kp("selectionchange",!1,c))}}function cg(a,c,p,v){switch(ca(c)){case 2:var A=Ba;break;case 8:A=Zr;break;default:A=wn}p=A.bind(null,c,p,a),A=void 0,!sn||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(A=!0),v?A!==void 0?a.addEventListener(c,p,{capture:!0,passive:A}):a.addEventListener(c,p,!0):A!==void 0?a.addEventListener(c,p,{passive:A}):a.addEventListener(c,p,!1)}function Bp(a,c,p,v,A){var R=v;if((c&1)===0&&(c&2)===0&&v!==null)e:for(;;){if(v===null)return;var G=v.tag;if(G===3||G===4){var ee=v.stateNode.containerInfo;if(ee===A)break;if(G===4)for(G=v.return;G!==null;){var _e=G.tag;if((_e===3||_e===4)&&G.stateNode.containerInfo===A)return;G=G.return}for(;ee!==null;){if(G=pa(ee),G===null)return;if(_e=G.tag,_e===5||_e===6||_e===26||_e===27){v=R=G;continue e}ee=ee.parentNode}}v=v.return}oo(function(){var Ne=R,et=lr(p),dt=[];e:{var Ve=Ol.get(a);if(Ve!==void 0){var qe=Lo,ui=a;switch(a){case"keypress":if(uo(p)===0)break e;case"keydown":case"keyup":qe=Sc;break;case"focusin":ui="focus",qe=Ca;break;case"focusout":ui="blur",qe=Ca;break;case"beforeblur":case"afterblur":qe=Ca;break;case"click":if(p.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":qe=_u;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":qe=Xr;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":qe=Em;break;case jo:case Eu:case Mu:qe=Nd;break;case kl:qe=yu;break;case"scroll":case"scrollend":qe=Ch;break;case"wheel":qe=Xf;break;case"copy":case"cut":case"paste":qe=fo;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":qe=zh;break;case"toggle":case"beforetoggle":qe=Kf}var ri=(c&4)!==0,Si=!ri&&(a==="scroll"||a==="scrollend"),Re=ri?Ve!==null?Ve+"Capture":null:Ve;ri=[];for(var Ie=Ne,ke;Ie!==null;){var rt=Ie;if(ke=rt.stateNode,rt=rt.tag,rt!==5&&rt!==26&&rt!==27||ke===null||Re===null||(rt=lo(Ie,Re),rt!=null&&ri.push(_d(Ie,rt,ke))),Si)break;Ie=Ie.return}0<ri.length&&(Ve=new qe(Ve,ui,null,p,et),dt.push({event:Ve,listeners:ri}))}}if((c&7)===0){e:{if(Ve=a==="mouseover"||a==="pointerover",qe=a==="mouseout"||a==="pointerout",Ve&&p!==Yr&&(ui=p.relatedTarget||p.fromElement)&&(pa(ui)||ui[Kt]))break e;if((qe||Ve)&&(Ve=et.window===et?et:(Ve=et.ownerDocument)?Ve.defaultView||Ve.parentWindow:window,qe?(ui=p.relatedTarget||p.toElement,qe=Ne,ui=ui?pa(ui):null,ui!==null&&(Si=T(ui),ri=ui.tag,ui!==Si||ri!==5&&ri!==27&&ri!==6)&&(ui=null)):(qe=null,ui=Ne),qe!==ui)){if(ri=_u,rt="onMouseLeave",Re="onMouseEnter",Ie="mouse",(a==="pointerout"||a==="pointerover")&&(ri=zh,rt="onPointerLeave",Re="onPointerEnter",Ie="pointer"),Si=qe==null?Ve:$n(qe),ke=ui==null?Ve:$n(ui),Ve=new ri(rt,Ie+"leave",qe,p,et),Ve.target=Si,Ve.relatedTarget=ke,rt=null,pa(et)===Ne&&(ri=new ri(Re,Ie+"enter",ui,p,et),ri.target=ke,ri.relatedTarget=Si,rt=ri),Si=rt,qe&&ui)t:{for(ri=qe,Re=ui,Ie=0,ke=ri;ke;ke=nh(ke))Ie++;for(ke=0,rt=Re;rt;rt=nh(rt))ke++;for(;0<Ie-ke;)ri=nh(ri),Ie--;for(;0<ke-Ie;)Re=nh(Re),ke--;for(;Ie--;){if(ri===Re||Re!==null&&ri===Re.alternate)break t;ri=nh(ri),Re=nh(Re)}ri=null}else ri=null;qe!==null&&oc(dt,Ve,qe,ri,!1),ui!==null&&Si!==null&&oc(dt,Si,ui,ri,!0)}}e:{if(Ve=Ne?$n(Ne):window,qe=Ve.nodeName&&Ve.nodeName.toLowerCase(),qe==="select"||qe==="input"&&Ve.type==="file")var Ft=Fh;else if(Ic(Ve))if(Nh)Ft=qi;else{Ft=Hd;var $i=$d}else qe=Ve.nodeName,!qe||qe.toLowerCase()!=="input"||Ve.type!=="checkbox"&&Ve.type!=="radio"?Ne&&xr(Ne.elementType)&&(Ft=Fh):Ft=Jf;if(Ft&&(Ft=Ft(a,Ne))){Qf(dt,Ft,p,et);break e}$i&&$i(a,Ve,Ne),a==="focusout"&&Ne&&Ve.type==="number"&&Ne.memoizedProps.value!=null&&Ds(Ve,"number",Ve.value)}switch($i=Ne?$n(Ne):window,a){case"focusin":(Ic($i)||$i.contentEditable==="true")&&(go=$i,Dc=Ne,No=null);break;case"focusout":No=Dc=go=null;break;case"mousedown":Tu=!0;break;case"contextmenu":case"mouseup":case"dragend":Tu=!1,Uo(dt,p,et);break;case"selectionchange":if(np)break;case"keydown":case"keyup":Uo(dt,p,et)}var ei;if(Zd)e:{switch(a){case"compositionstart":var hi="onCompositionStart";break e;case"compositionend":hi="onCompositionEnd";break e;case"compositionupdate":hi="onCompositionUpdate";break e}hi=void 0}else Rl?Bh(a,p)&&(hi="onCompositionEnd"):a==="keydown"&&p.keyCode===229&&(hi="onCompositionStart");hi&&(Gd&&p.locale!=="ko"&&(Rl||hi!=="onCompositionStart"?hi==="onCompositionEnd"&&Rl&&(ei=Oi()):(Ei=et,gi="value"in Ei?Ei.value:Ei.textContent,Rl=!0)),$i=Lp(Ne,hi),0<$i.length&&(hi=new Hf(hi,a,null,p,et),dt.push({event:hi,listeners:$i}),ei?hi.data=ei:(ei=qd(p),ei!==null&&(hi.data=ei)))),(ei=Mm?Pl(a,p):Lh(a,p))&&(hi=Lp(Ne,"onBeforeInput"),0<hi.length&&($i=new Hf("onBeforeInput","beforeinput",null,p,et),dt.push({event:$i,listeners:hi}),$i.data=ei)),B_(dt,a,Ne,p,et)}es(dt,c)})}function _d(a,c,p){return{instance:a,listener:c,currentTarget:p}}function Lp(a,c){for(var p=c+"Capture",v=[];a!==null;){var A=a,R=A.stateNode;if(A=A.tag,A!==5&&A!==26&&A!==27||R===null||(A=lo(a,p),A!=null&&v.unshift(_d(a,A,R)),A=lo(a,c),A!=null&&v.push(_d(a,A,R))),a.tag===3)return v;a=a.return}return[]}function nh(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function oc(a,c,p,v,A){for(var R=c._reactName,G=[];p!==null&&p!==v;){var ee=p,_e=ee.alternate,Ne=ee.stateNode;if(ee=ee.tag,_e!==null&&_e===v)break;ee!==5&&ee!==26&&ee!==27||Ne===null||(_e=Ne,A?(Ne=lo(p,R),Ne!=null&&G.unshift(_d(p,Ne,_e))):A||(Ne=lo(p,R),Ne!=null&&G.push(_d(p,Ne,_e)))),p=p.return}G.length!==0&&a.push({event:c,listeners:G})}var N_=/\r\n?/g,U_=/\u0000|\uFFFD/g;function ug(a){return(typeof a=="string"?a:""+a).replace(N_,`
`).replace(U_,"")}function hg(a,c){return c=ug(c),ug(a)===c}function Fp(){}function xn(a,c,p,v,A,R){switch(p){case"children":typeof v=="string"?c==="body"||c==="textarea"&&v===""||kr(a,v):(typeof v=="number"||typeof v=="bigint")&&c!=="body"&&kr(a,""+v);break;case"className":du(a,"class",v);break;case"tabIndex":du(a,"tabindex",v);break;case"dir":case"role":case"viewBox":case"width":case"height":du(a,p,v);break;case"style":Hr(a,v,R);break;case"data":if(c!=="object"){du(a,"data",v);break}case"src":case"href":if(v===""&&(c!=="a"||p!=="href")){a.removeAttribute(p);break}if(v==null||typeof v=="function"||typeof v=="symbol"||typeof v=="boolean"){a.removeAttribute(p);break}v=Cr(""+v),a.setAttribute(p,v);break;case"action":case"formAction":if(typeof v=="function"){a.setAttribute(p,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof R=="function"&&(p==="formAction"?(c!=="input"&&xn(a,c,"name",A.name,A,null),xn(a,c,"formEncType",A.formEncType,A,null),xn(a,c,"formMethod",A.formMethod,A,null),xn(a,c,"formTarget",A.formTarget,A,null)):(xn(a,c,"encType",A.encType,A,null),xn(a,c,"method",A.method,A,null),xn(a,c,"target",A.target,A,null)));if(v==null||typeof v=="symbol"||typeof v=="boolean"){a.removeAttribute(p);break}v=Cr(""+v),a.setAttribute(p,v);break;case"onClick":v!=null&&(a.onclick=Fp);break;case"onScroll":v!=null&&Ci("scroll",a);break;case"onScrollEnd":v!=null&&Ci("scrollend",a);break;case"dangerouslySetInnerHTML":if(v!=null){if(typeof v!="object"||!("__html"in v))throw Error(h(61));if(p=v.__html,p!=null){if(A.children!=null)throw Error(h(60));a.innerHTML=p}}break;case"multiple":a.multiple=v&&typeof v!="function"&&typeof v!="symbol";break;case"muted":a.muted=v&&typeof v!="function"&&typeof v!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(v==null||typeof v=="function"||typeof v=="boolean"||typeof v=="symbol"){a.removeAttribute("xlink:href");break}p=Cr(""+v),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",p);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":v!=null&&typeof v!="function"&&typeof v!="symbol"?a.setAttribute(p,""+v):a.removeAttribute(p);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":v&&typeof v!="function"&&typeof v!="symbol"?a.setAttribute(p,""):a.removeAttribute(p);break;case"capture":case"download":v===!0?a.setAttribute(p,""):v!==!1&&v!=null&&typeof v!="function"&&typeof v!="symbol"?a.setAttribute(p,v):a.removeAttribute(p);break;case"cols":case"rows":case"size":case"span":v!=null&&typeof v!="function"&&typeof v!="symbol"&&!isNaN(v)&&1<=v?a.setAttribute(p,v):a.removeAttribute(p);break;case"rowSpan":case"start":v==null||typeof v=="function"||typeof v=="symbol"||isNaN(v)?a.removeAttribute(p):a.setAttribute(p,v);break;case"popover":Ci("beforetoggle",a),Ci("toggle",a),so(a,"popover",v);break;case"xlinkActuate":Cs(a,"http://www.w3.org/1999/xlink","xlink:actuate",v);break;case"xlinkArcrole":Cs(a,"http://www.w3.org/1999/xlink","xlink:arcrole",v);break;case"xlinkRole":Cs(a,"http://www.w3.org/1999/xlink","xlink:role",v);break;case"xlinkShow":Cs(a,"http://www.w3.org/1999/xlink","xlink:show",v);break;case"xlinkTitle":Cs(a,"http://www.w3.org/1999/xlink","xlink:title",v);break;case"xlinkType":Cs(a,"http://www.w3.org/1999/xlink","xlink:type",v);break;case"xmlBase":Cs(a,"http://www.w3.org/XML/1998/namespace","xml:base",v);break;case"xmlLang":Cs(a,"http://www.w3.org/XML/1998/namespace","xml:lang",v);break;case"xmlSpace":Cs(a,"http://www.w3.org/XML/1998/namespace","xml:space",v);break;case"is":so(a,"is",v);break;case"innerText":case"textContent":break;default:(!(2<p.length)||p[0]!=="o"&&p[0]!=="O"||p[1]!=="n"&&p[1]!=="N")&&(p=Cn.get(p)||p,so(a,p,v))}}function Np(a,c,p,v,A,R){switch(p){case"style":Hr(a,v,R);break;case"dangerouslySetInnerHTML":if(v!=null){if(typeof v!="object"||!("__html"in v))throw Error(h(61));if(p=v.__html,p!=null){if(A.children!=null)throw Error(h(60));a.innerHTML=p}}break;case"children":typeof v=="string"?kr(a,v):(typeof v=="number"||typeof v=="bigint")&&kr(a,""+v);break;case"onScroll":v!=null&&Ci("scroll",a);break;case"onScrollEnd":v!=null&&Ci("scrollend",a);break;case"onClick":v!=null&&(a.onclick=Fp);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!ao.hasOwnProperty(p))e:{if(p[0]==="o"&&p[1]==="n"&&(A=p.endsWith("Capture"),c=p.slice(2,A?p.length-7:void 0),R=a[Ot]||null,R=R!=null?R[p]:null,typeof R=="function"&&a.removeEventListener(c,R,A),typeof v=="function")){typeof R!="function"&&R!==null&&(p in a?a[p]=null:a.hasAttribute(p)&&a.removeAttribute(p)),a.addEventListener(c,v,A);break e}p in a?a[p]=v:v===!0?a.setAttribute(p,""):so(a,p,v)}}}function Tr(a,c,p){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ci("error",a),Ci("load",a);var v=!1,A=!1,R;for(R in p)if(p.hasOwnProperty(R)){var G=p[R];if(G!=null)switch(R){case"src":v=!0;break;case"srcSet":A=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(h(137,c));default:xn(a,c,R,G,p,null)}}A&&xn(a,c,"srcSet",p.srcSet,p,null),v&&xn(a,c,"src",p.src,p,null);return;case"input":Ci("invalid",a);var ee=R=G=A=null,_e=null,Ne=null;for(v in p)if(p.hasOwnProperty(v)){var et=p[v];if(et!=null)switch(v){case"name":A=et;break;case"type":G=et;break;case"checked":_e=et;break;case"defaultChecked":Ne=et;break;case"value":R=et;break;case"defaultValue":ee=et;break;case"children":case"dangerouslySetInnerHTML":if(et!=null)throw Error(h(137,c));break;default:xn(a,c,v,et,p,null)}}Oo(a,R,ee,_e,Ne,G,A,!1),pu(a);return;case"select":Ci("invalid",a),v=G=R=null;for(A in p)if(p.hasOwnProperty(A)&&(ee=p[A],ee!=null))switch(A){case"value":R=ee;break;case"defaultValue":G=ee;break;case"multiple":v=ee;default:xn(a,c,A,ee,p,null)}c=R,p=G,a.multiple=!!v,c!=null?ma(a,!!v,c,!1):p!=null&&ma(a,!!v,p,!0);return;case"textarea":Ci("invalid",a),R=A=v=null;for(G in p)if(p.hasOwnProperty(G)&&(ee=p[G],ee!=null))switch(G){case"value":v=ee;break;case"defaultValue":A=ee;break;case"children":R=ee;break;case"dangerouslySetInnerHTML":if(ee!=null)throw Error(h(91));break;default:xn(a,c,G,ee,p,null)}Bi(a,v,A,R),pu(a);return;case"option":for(_e in p)if(p.hasOwnProperty(_e)&&(v=p[_e],v!=null))switch(_e){case"selected":a.selected=v&&typeof v!="function"&&typeof v!="symbol";break;default:xn(a,c,_e,v,p,null)}return;case"dialog":Ci("beforetoggle",a),Ci("toggle",a),Ci("cancel",a),Ci("close",a);break;case"iframe":case"object":Ci("load",a);break;case"video":case"audio":for(v=0;v<ih.length;v++)Ci(ih[v],a);break;case"image":Ci("error",a),Ci("load",a);break;case"details":Ci("toggle",a);break;case"embed":case"source":case"link":Ci("error",a),Ci("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Ne in p)if(p.hasOwnProperty(Ne)&&(v=p[Ne],v!=null))switch(Ne){case"children":case"dangerouslySetInnerHTML":throw Error(h(137,c));default:xn(a,c,Ne,v,p,null)}return;default:if(xr(c)){for(et in p)p.hasOwnProperty(et)&&(v=p[et],v!==void 0&&Np(a,c,et,v,p,void 0));return}}for(ee in p)p.hasOwnProperty(ee)&&(v=p[ee],v!=null&&xn(a,c,ee,v,p,null))}function j_(a,c,p,v){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var A=null,R=null,G=null,ee=null,_e=null,Ne=null,et=null;for(qe in p){var dt=p[qe];if(p.hasOwnProperty(qe)&&dt!=null)switch(qe){case"checked":break;case"value":break;case"defaultValue":_e=dt;default:v.hasOwnProperty(qe)||xn(a,c,qe,null,v,dt)}}for(var Ve in v){var qe=v[Ve];if(dt=p[Ve],v.hasOwnProperty(Ve)&&(qe!=null||dt!=null))switch(Ve){case"type":R=qe;break;case"name":A=qe;break;case"checked":Ne=qe;break;case"defaultChecked":et=qe;break;case"value":G=qe;break;case"defaultValue":ee=qe;break;case"children":case"dangerouslySetInnerHTML":if(qe!=null)throw Error(h(137,c));break;default:qe!==dt&&xn(a,c,Ve,qe,v,dt)}}wi(a,G,ee,_e,Ne,et,R,A);return;case"select":qe=G=ee=Ve=null;for(R in p)if(_e=p[R],p.hasOwnProperty(R)&&_e!=null)switch(R){case"value":break;case"multiple":qe=_e;default:v.hasOwnProperty(R)||xn(a,c,R,null,v,_e)}for(A in v)if(R=v[A],_e=p[A],v.hasOwnProperty(A)&&(R!=null||_e!=null))switch(A){case"value":Ve=R;break;case"defaultValue":ee=R;break;case"multiple":G=R;default:R!==_e&&xn(a,c,A,R,v,_e)}c=ee,p=G,v=qe,Ve!=null?ma(a,!!p,Ve,!1):!!v!=!!p&&(c!=null?ma(a,!!p,c,!0):ma(a,!!p,p?[]:"",!1));return;case"textarea":qe=Ve=null;for(ee in p)if(A=p[ee],p.hasOwnProperty(ee)&&A!=null&&!v.hasOwnProperty(ee))switch(ee){case"value":break;case"children":break;default:xn(a,c,ee,null,v,A)}for(G in v)if(A=v[G],R=p[G],v.hasOwnProperty(G)&&(A!=null||R!=null))switch(G){case"value":Ve=A;break;case"defaultValue":qe=A;break;case"children":break;case"dangerouslySetInnerHTML":if(A!=null)throw Error(h(91));break;default:A!==R&&xn(a,c,G,A,v,R)}Il(a,Ve,qe);return;case"option":for(var ui in p)if(Ve=p[ui],p.hasOwnProperty(ui)&&Ve!=null&&!v.hasOwnProperty(ui))switch(ui){case"selected":a.selected=!1;break;default:xn(a,c,ui,null,v,Ve)}for(_e in v)if(Ve=v[_e],qe=p[_e],v.hasOwnProperty(_e)&&Ve!==qe&&(Ve!=null||qe!=null))switch(_e){case"selected":a.selected=Ve&&typeof Ve!="function"&&typeof Ve!="symbol";break;default:xn(a,c,_e,Ve,v,qe)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ri in p)Ve=p[ri],p.hasOwnProperty(ri)&&Ve!=null&&!v.hasOwnProperty(ri)&&xn(a,c,ri,null,v,Ve);for(Ne in v)if(Ve=v[Ne],qe=p[Ne],v.hasOwnProperty(Ne)&&Ve!==qe&&(Ve!=null||qe!=null))switch(Ne){case"children":case"dangerouslySetInnerHTML":if(Ve!=null)throw Error(h(137,c));break;default:xn(a,c,Ne,Ve,v,qe)}return;default:if(xr(c)){for(var Si in p)Ve=p[Si],p.hasOwnProperty(Si)&&Ve!==void 0&&!v.hasOwnProperty(Si)&&Np(a,c,Si,void 0,v,Ve);for(et in v)Ve=v[et],qe=p[et],!v.hasOwnProperty(et)||Ve===qe||Ve===void 0&&qe===void 0||Np(a,c,et,Ve,v,qe);return}}for(var Re in p)Ve=p[Re],p.hasOwnProperty(Re)&&Ve!=null&&!v.hasOwnProperty(Re)&&xn(a,c,Re,null,v,Ve);for(dt in v)Ve=v[dt],qe=p[dt],!v.hasOwnProperty(dt)||Ve===qe||Ve==null&&qe==null||xn(a,c,dt,Ve,v,qe)}var yd=null,Up=null;function rh(a){return a.nodeType===9?a:a.ownerDocument}function Df(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Rf(a,c){if(a===0)switch(c){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&c==="foreignObject"?0:a}function dg(a,c){return a==="textarea"||a==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.children=="bigint"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var fg=null;function bv(){var a=window.event;return a&&a.type==="popstate"?a===fg?!1:(fg=a,!0):(fg=null,!1)}var ah=typeof setTimeout=="function"?setTimeout:void 0,Jr=typeof clearTimeout=="function"?clearTimeout:void 0,lc=typeof Promise=="function"?Promise:void 0,pg=typeof queueMicrotask=="function"?queueMicrotask:typeof lc<"u"?function(a){return lc.resolve(null).then(a).catch(V_)}:ah;function V_(a){setTimeout(function(){throw a})}function cc(a){return a==="head"}function jp(a,c){var p=c,v=0,A=0;do{var R=p.nextSibling;if(a.removeChild(p),R&&R.nodeType===8)if(p=R.data,p==="/$"){if(0<v&&8>v){p=v;var G=a.ownerDocument;if(p&1&&sh(G.documentElement),p&2&&sh(G.body),p&4)for(p=G.head,sh(p),G=p.firstChild;G;){var ee=G.nextSibling,_e=G.nodeName;G[ii]||_e==="SCRIPT"||_e==="STYLE"||_e==="LINK"&&G.rel.toLowerCase()==="stylesheet"||p.removeChild(G),G=ee}}if(A===0){a.removeChild(R),xd(c);return}A--}else p==="$"||p==="$?"||p==="$!"?A++:v=p.charCodeAt(0)-48;else v=0;p=R}while(p);xd(c)}function mg(a){var c=a.firstChild;for(c&&c.nodeType===10&&(c=c.nextSibling);c;){var p=c;switch(c=c.nextSibling,p.nodeName){case"HTML":case"HEAD":case"BODY":mg(p),In(p);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(p.rel.toLowerCase()==="stylesheet")continue}a.removeChild(p)}}function Z_(a,c,p,v){for(;a.nodeType===1;){var A=p;if(a.nodeName.toLowerCase()!==c.toLowerCase()){if(!v&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(v){if(!a[ii])switch(c){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(R=a.getAttribute("rel"),R==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(R!==A.rel||a.getAttribute("href")!==(A.href==null||A.href===""?null:A.href)||a.getAttribute("crossorigin")!==(A.crossOrigin==null?null:A.crossOrigin)||a.getAttribute("title")!==(A.title==null?null:A.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(R=a.getAttribute("src"),(R!==(A.src==null?null:A.src)||a.getAttribute("type")!==(A.type==null?null:A.type)||a.getAttribute("crossorigin")!==(A.crossOrigin==null?null:A.crossOrigin))&&R&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(c==="input"&&a.type==="hidden"){var R=A.name==null?null:""+A.name;if(A.type==="hidden"&&a.getAttribute("name")===R)return a}else return a;if(a=vs(a.nextSibling),a===null)break}return null}function G_(a,c,p){if(c==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!p||(a=vs(a.nextSibling),a===null))return null;return a}function gg(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState==="complete"}function q_(a,c){var p=a.ownerDocument;if(a.data!=="$?"||p.readyState==="complete")c();else{var v=function(){c(),p.removeEventListener("DOMContentLoaded",v)};p.addEventListener("DOMContentLoaded",v),a._reactRetry=v}}function vs(a){for(;a!=null;a=a.nextSibling){var c=a.nodeType;if(c===1||c===3)break;if(c===8){if(c=a.data,c==="$"||c==="$!"||c==="$?"||c==="F!"||c==="F")break;if(c==="/$")return null}}return a}var Pf=null;function _g(a){a=a.previousSibling;for(var c=0;a;){if(a.nodeType===8){var p=a.data;if(p==="$"||p==="$!"||p==="$?"){if(c===0)return a;c--}else p==="/$"&&c++}a=a.previousSibling}return null}function vd(a,c,p){switch(c=rh(p),a){case"html":if(a=c.documentElement,!a)throw Error(h(452));return a;case"head":if(a=c.head,!a)throw Error(h(453));return a;case"body":if(a=c.body,!a)throw Error(h(454));return a;default:throw Error(h(451))}}function sh(a){for(var c=a.attributes;c.length;)a.removeAttributeNode(c[0]);In(a)}var bs=new Map,Vp=new Set;function oh(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var xs=st.d;st.d={f:yg,r:vg,D:o,C:i,L:l,m:d,X:x,S:g,M:w};function yg(){var a=xs.f(),c=xf();return a||c}function vg(a){var c=Gt(a);c!==null&&c.tag===5&&c.type==="form"?ps(c):xs.r(a)}var Yc=typeof document>"u"?null:document;function $_(a,c,p){var v=Yc;if(v&&typeof c=="string"&&c){var A=Qn(c);A='link[rel="'+a+'"][href="'+A+'"]',typeof p=="string"&&(A+='[crossorigin="'+p+'"]'),Vp.has(A)||(Vp.add(A),a={rel:a,crossOrigin:p,href:c},v.querySelector(A)===null&&(c=v.createElement("link"),Tr(c,"link",a),or(c),v.head.appendChild(c)))}}function o(a){xs.D(a),$_("dns-prefetch",a,null)}function i(a,c){xs.C(a,c),$_("preconnect",a,c)}function l(a,c,p){xs.L(a,c,p);var v=Yc;if(v&&a&&c){var A='link[rel="preload"][as="'+Qn(c)+'"]';c==="image"&&p&&p.imageSrcSet?(A+='[imagesrcset="'+Qn(p.imageSrcSet)+'"]',typeof p.imageSizes=="string"&&(A+='[imagesizes="'+Qn(p.imageSizes)+'"]')):A+='[href="'+Qn(a)+'"]';var R=A;switch(c){case"style":R=C(a);break;case"script":R=j(a)}bs.has(R)||(a=q({rel:"preload",href:c==="image"&&p&&p.imageSrcSet?void 0:a,as:c},p),bs.set(R,a),v.querySelector(A)!==null||c==="style"&&v.querySelector(P(R))||c==="script"&&v.querySelector(Z(R))||(c=v.createElement("link"),Tr(c,"link",a),or(c),v.head.appendChild(c)))}}function d(a,c){xs.m(a,c);var p=Yc;if(p&&a){var v=c&&typeof c.as=="string"?c.as:"script",A='link[rel="modulepreload"][as="'+Qn(v)+'"][href="'+Qn(a)+'"]',R=A;switch(v){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":R=j(a)}if(!bs.has(R)&&(a=q({rel:"modulepreload",href:a},c),bs.set(R,a),p.querySelector(A)===null)){switch(v){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(p.querySelector(Z(R)))return}v=p.createElement("link"),Tr(v,"link",a),or(v),p.head.appendChild(v)}}}function g(a,c,p){xs.S(a,c,p);var v=Yc;if(v&&a){var A=Xi(v).hoistableStyles,R=C(a);c=c||"default";var G=A.get(R);if(!G){var ee={loading:0,preload:null};if(G=v.querySelector(P(R)))ee.loading=5;else{a=q({rel:"stylesheet",href:a,"data-precedence":c},p),(p=bs.get(R))&&re(a,p);var _e=G=v.createElement("link");or(_e),Tr(_e,"link",a),_e._p=new Promise(function(Ne,et){_e.onload=Ne,_e.onerror=et}),_e.addEventListener("load",function(){ee.loading|=1}),_e.addEventListener("error",function(){ee.loading|=2}),ee.loading|=4,X(G,c,v)}G={type:"stylesheet",instance:G,count:1,state:ee},A.set(R,G)}}}function x(a,c){xs.X(a,c);var p=Yc;if(p&&a){var v=Xi(p).hoistableScripts,A=j(a),R=v.get(A);R||(R=p.querySelector(Z(A)),R||(a=q({src:a,async:!0},c),(c=bs.get(A))&&ue(a,c),R=p.createElement("script"),or(R),Tr(R,"link",a),p.head.appendChild(R)),R={type:"script",instance:R,count:1,state:null},v.set(A,R))}}function w(a,c){xs.M(a,c);var p=Yc;if(p&&a){var v=Xi(p).hoistableScripts,A=j(a),R=v.get(A);R||(R=p.querySelector(Z(A)),R||(a=q({src:a,async:!0,type:"module"},c),(c=bs.get(A))&&ue(a,c),R=p.createElement("script"),or(R),Tr(R,"link",a),p.head.appendChild(R)),R={type:"script",instance:R,count:1,state:null},v.set(A,R))}}function M(a,c,p,v){var A=(A=Jt.current)?oh(A):null;if(!A)throw Error(h(446));switch(a){case"meta":case"title":return null;case"style":return typeof p.precedence=="string"&&typeof p.href=="string"?(c=C(p.href),p=Xi(A).hoistableStyles,v=p.get(c),v||(v={type:"style",instance:null,count:0,state:null},p.set(c,v)),v):{type:"void",instance:null,count:0,state:null};case"link":if(p.rel==="stylesheet"&&typeof p.href=="string"&&typeof p.precedence=="string"){a=C(p.href);var R=Xi(A).hoistableStyles,G=R.get(a);if(G||(A=A.ownerDocument||A,G={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},R.set(a,G),(R=A.querySelector(P(a)))&&!R._p&&(G.instance=R,G.state.loading=5),bs.has(a)||(p={rel:"preload",as:"style",href:p.href,crossOrigin:p.crossOrigin,integrity:p.integrity,media:p.media,hrefLang:p.hrefLang,referrerPolicy:p.referrerPolicy},bs.set(a,p),R||L(A,a,p,G.state))),c&&v===null)throw Error(h(528,""));return G}if(c&&v!==null)throw Error(h(529,""));return null;case"script":return c=p.async,p=p.src,typeof p=="string"&&c&&typeof c!="function"&&typeof c!="symbol"?(c=j(p),p=Xi(A).hoistableScripts,v=p.get(c),v||(v={type:"script",instance:null,count:0,state:null},p.set(c,v)),v):{type:"void",instance:null,count:0,state:null};default:throw Error(h(444,a))}}function C(a){return'href="'+Qn(a)+'"'}function P(a){return'link[rel="stylesheet"]['+a+"]"}function O(a){return q({},a,{"data-precedence":a.precedence,precedence:null})}function L(a,c,p,v){a.querySelector('link[rel="preload"][as="style"]['+c+"]")?v.loading=1:(c=a.createElement("link"),v.preload=c,c.addEventListener("load",function(){return v.loading|=1}),c.addEventListener("error",function(){return v.loading|=2}),Tr(c,"link",p),or(c),a.head.appendChild(c))}function j(a){return'[src="'+Qn(a)+'"]'}function Z(a){return"script[async]"+a}function H(a,c,p){if(c.count++,c.instance===null)switch(c.type){case"style":var v=a.querySelector('style[data-href~="'+Qn(p.href)+'"]');if(v)return c.instance=v,or(v),v;var A=q({},p,{"data-href":p.href,"data-precedence":p.precedence,href:null,precedence:null});return v=(a.ownerDocument||a).createElement("style"),or(v),Tr(v,"style",A),X(v,p.precedence,a),c.instance=v;case"stylesheet":A=C(p.href);var R=a.querySelector(P(A));if(R)return c.state.loading|=4,c.instance=R,or(R),R;v=O(p),(A=bs.get(A))&&re(v,A),R=(a.ownerDocument||a).createElement("link"),or(R);var G=R;return G._p=new Promise(function(ee,_e){G.onload=ee,G.onerror=_e}),Tr(R,"link",v),c.state.loading|=4,X(R,p.precedence,a),c.instance=R;case"script":return R=j(p.src),(A=a.querySelector(Z(R)))?(c.instance=A,or(A),A):(v=p,(A=bs.get(R))&&(v=q({},p),ue(v,A)),a=a.ownerDocument||a,A=a.createElement("script"),or(A),Tr(A,"link",v),a.head.appendChild(A),c.instance=A);case"void":return null;default:throw Error(h(443,c.type))}else c.type==="stylesheet"&&(c.state.loading&4)===0&&(v=c.instance,c.state.loading|=4,X(v,p.precedence,a));return c.instance}function X(a,c,p){for(var v=p.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),A=v.length?v[v.length-1]:null,R=A,G=0;G<v.length;G++){var ee=v[G];if(ee.dataset.precedence===c)R=ee;else if(R!==A)break}R?R.parentNode.insertBefore(a,R.nextSibling):(c=p.nodeType===9?p.head:p,c.insertBefore(a,c.firstChild))}function re(a,c){a.crossOrigin==null&&(a.crossOrigin=c.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=c.referrerPolicy),a.title==null&&(a.title=c.title)}function ue(a,c){a.crossOrigin==null&&(a.crossOrigin=c.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=c.referrerPolicy),a.integrity==null&&(a.integrity=c.integrity)}var ve=null;function de(a,c,p){if(ve===null){var v=new Map,A=ve=new Map;A.set(p,v)}else A=ve,v=A.get(p),v||(v=new Map,A.set(p,v));if(v.has(a))return v;for(v.set(a,null),p=p.getElementsByTagName(a),A=0;A<p.length;A++){var R=p[A];if(!(R[ii]||R[Vt]||a==="link"&&R.getAttribute("rel")==="stylesheet")&&R.namespaceURI!=="http://www.w3.org/2000/svg"){var G=R.getAttribute(c)||"";G=a+G;var ee=v.get(G);ee?ee.push(R):v.set(G,[R])}}return v}function V(a,c,p){a=a.ownerDocument||a,a.head.insertBefore(p,c==="title"?a.querySelector("head > title"):null)}function ie(a,c,p){if(p===1||c.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof c.precedence!="string"||typeof c.href!="string"||c.href==="")break;return!0;case"link":if(typeof c.rel!="string"||typeof c.href!="string"||c.href===""||c.onLoad||c.onError)break;switch(c.rel){case"stylesheet":return a=c.disabled,typeof c.precedence=="string"&&a==null;default:return!0}case"script":if(c.async&&typeof c.async!="function"&&typeof c.async!="symbol"&&!c.onLoad&&!c.onError&&c.src&&typeof c.src=="string")return!0}return!1}function pe(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}var Be=null;function ot(){}function Ue(a,c,p){if(Be===null)throw Error(h(475));var v=Be;if(c.type==="stylesheet"&&(typeof p.media!="string"||matchMedia(p.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var A=C(p.href),R=a.querySelector(P(A));if(R){a=R._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(v.count++,v=ft.bind(v),a.then(v,v)),c.state.loading|=4,c.instance=R,or(R);return}R=a.ownerDocument||a,p=O(p),(A=bs.get(A))&&re(p,A),R=R.createElement("link"),or(R);var G=R;G._p=new Promise(function(ee,_e){G.onload=ee,G.onerror=_e}),Tr(R,"link",p),c.instance=R}v.stylesheets===null&&(v.stylesheets=new Map),v.stylesheets.set(c,a),(a=c.state.preload)&&(c.state.loading&3)===0&&(v.count++,c=ft.bind(v),a.addEventListener("load",c),a.addEventListener("error",c))}}function $e(){if(Be===null)throw Error(h(475));var a=Be;return a.stylesheets&&a.count===0&&pt(a,a.stylesheets),0<a.count?function(c){var p=setTimeout(function(){if(a.stylesheets&&pt(a,a.stylesheets),a.unsuspend){var v=a.unsuspend;a.unsuspend=null,v()}},6e4);return a.unsuspend=c,function(){a.unsuspend=null,clearTimeout(p)}}:null}function ft(){if(this.count--,this.count===0){if(this.stylesheets)pt(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var at=null;function pt(a,c){a.stylesheets=null,a.unsuspend!==null&&(a.count++,at=new Map,c.forEach(Qe,a),at=null,ft.call(a))}function Qe(a,c){if(!(c.state.loading&4)){var p=at.get(a);if(p)var v=p.get(null);else{p=new Map,at.set(a,p);for(var A=a.querySelectorAll("link[data-precedence],style[data-precedence]"),R=0;R<A.length;R++){var G=A[R];(G.nodeName==="LINK"||G.getAttribute("media")!=="not all")&&(p.set(G.dataset.precedence,G),v=G)}v&&p.set(null,v)}A=c.instance,G=A.getAttribute("data-precedence"),R=p.get(G)||v,R===v&&p.set(null,A),p.set(G,A),this.count++,v=ft.bind(this),A.addEventListener("load",v),A.addEventListener("error",v),R?R.parentNode.insertBefore(A,R.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(A,a.firstChild)),c.state.loading|=4}}var kt={$$typeof:bt,Provider:null,Consumer:null,_currentValue:Ct,_currentValue2:Ct,_threadCount:0};function Xt(a,c,p,v,A,R,G,ee){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=we(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=we(0),this.hiddenUpdates=we(null),this.identifierPrefix=v,this.onUncaughtError=A,this.onCaughtError=R,this.onRecoverableError=G,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ee,this.incompleteTransitions=new Map}function $t(a,c,p,v,A,R,G,ee,_e,Ne,et,dt){return a=new Xt(a,c,p,G,ee,_e,Ne,dt),c=1,R===!0&&(c|=24),R=na(3,null,null,c),a.current=R,R.stateNode=a,c=Zl(),c.refCount++,a.pooledCache=c,c.refCount++,R.memoizedState={element:v,isDehydrated:p,cache:c},Bc(R),a}function Ut(a){return a?(a=yo,a):yo}function Di(a,c,p,v,A,R){A=Ut(A),v.context===null?v.context=A:v.pendingContext=A,v=xo(c),v.payload={element:p},R=R===void 0?null:R,R!==null&&(v.callback=R),p=ds(a,v,c),p!==null&&(Sa(p,a,c),Ou(p,a,c))}function Gn(a,c){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var p=a.retryLane;a.retryLane=p!==0&&p<c?p:c}}function ur(a,c){Gn(a,c),(a=a.alternate)&&Gn(a,c)}function Vr(a){if(a.tag===13){var c=Rc(a,67108864);c!==null&&Sa(c,a,67108864),ur(a,67108864)}}var Ta=!0;function Ba(a,c,p,v){var A=Ae.T;Ae.T=null;var R=st.p;try{st.p=2,wn(a,c,p,v)}finally{st.p=R,Ae.T=A}}function Zr(a,c,p,v){var A=Ae.T;Ae.T=null;var R=st.p;try{st.p=8,wn(a,c,p,v)}finally{st.p=R,Ae.T=A}}function wn(a,c,p,v){if(Ta){var A=yr(v);if(A===null)Bp(a,c,v,vr,p),Ks(a,v);else if(Io(A,a,c,p,v))v.stopPropagation();else if(Ks(a,v),c&4&&-1<Tn.indexOf(a)){for(;A!==null;){var R=Gt(A);if(R!==null)switch(R.tag){case 3:if(R=R.stateNode,R.current.memoizedState.isDehydrated){var G=De(R.pendingLanes);if(G!==0){var ee=R;for(ee.pendingLanes|=2,ee.entangledLanes|=2;G;){var _e=1<<31-Wn(G);ee.entanglements[1]|=_e,G&=~_e}ll(R),(cn&6)===0&&(dd=dr()+500,Mf(0))}}break;case 13:ee=Rc(R,2),ee!==null&&Sa(ee,R,2),xf(),ur(R,2)}if(R=yr(v),R===null&&Bp(a,c,v,vr,p),R===A)break;A=R}A!==null&&v.stopPropagation()}else Bp(a,c,v,null,p)}}function yr(a){return a=lr(a),Er(a)}var vr=null;function Er(a){if(vr=null,a=pa(a),a!==null){var c=T(a);if(c===null)a=null;else{var p=c.tag;if(p===13){if(a=S(c),a!==null)return a;a=null}else if(p===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;a=null}else c!==a&&(a=null)}}return vr=a,null}function ca(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Po()){case no:return 2;case Fa:return 8;case fa:case vc:return 32;case bl:return 268435456;default:return 32}default:return 32}}var La=!1,zn=null,br=null,Sn=null,ir=new Map,nr=new Map,_n=[],Tn="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Ks(a,c){switch(a){case"focusin":case"focusout":zn=null;break;case"dragenter":case"dragleave":br=null;break;case"mouseover":case"mouseout":Sn=null;break;case"pointerover":case"pointerout":ir.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":nr.delete(c.pointerId)}}function cl(a,c,p,v,A,R){return a===null||a.nativeEvent!==R?(a={blockedOn:c,domEventName:p,eventSystemFlags:v,nativeEvent:R,targetContainers:[A]},c!==null&&(c=Gt(c),c!==null&&Vr(c)),a):(a.eventSystemFlags|=v,c=a.targetContainers,A!==null&&c.indexOf(A)===-1&&c.push(A),a)}function Io(a,c,p,v,A){switch(c){case"focusin":return zn=cl(zn,a,c,p,v,A),!0;case"dragenter":return br=cl(br,a,c,p,v,A),!0;case"mouseover":return Sn=cl(Sn,a,c,p,v,A),!0;case"pointerover":var R=A.pointerId;return ir.set(R,cl(ir.get(R)||null,a,c,p,v,A)),!0;case"gotpointercapture":return R=A.pointerId,nr.set(R,cl(nr.get(R)||null,a,c,p,v,A)),!0}return!1}function H_(a){var c=pa(a.target);if(c!==null){var p=T(c);if(p!==null){if(c=p.tag,c===13){if(c=S(p),c!==null){a.blockedOn=c,St(a.priority,function(){if(p.tag===13){var v=la();v=Pe(v);var A=Rc(p,v);A!==null&&Sa(A,p,v),ur(p,v)}});return}}else if(c===3&&p.stateNode.current.memoizedState.isDehydrated){a.blockedOn=p.tag===3?p.stateNode.containerInfo:null;return}}}a.blockedOn=null}function uc(a){if(a.blockedOn!==null)return!1;for(var c=a.targetContainers;0<c.length;){var p=yr(a.nativeEvent);if(p===null){p=a.nativeEvent;var v=new p.constructor(p.type,p);Yr=v,p.target.dispatchEvent(v),Yr=null}else return c=Gt(p),c!==null&&Vr(c),a.blockedOn=p,!1;c.shift()}return!0}function Xc(a,c,p){uc(a)&&p.delete(c)}function bd(){La=!1,zn!==null&&uc(zn)&&(zn=null),br!==null&&uc(br)&&(br=null),Sn!==null&&uc(Sn)&&(Sn=null),ir.forEach(Xc),nr.forEach(Xc)}function hc(a,c){a.blockedOn===c&&(a.blockedOn=null,La||(La=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,bd)))}var dc=null;function bg(a){dc!==a&&(dc=a,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){dc===a&&(dc=null);for(var c=0;c<a.length;c+=3){var p=a[c],v=a[c+1],A=a[c+2];if(typeof v!="function"){if(Er(v||p)===null)continue;break}var R=Gt(p);R!==null&&(a.splice(c,3),c-=3,Vs(R,{pending:!0,data:A,method:p.method,action:v},v,A))}}))}function xd(a){function c(_e){return hc(_e,a)}zn!==null&&hc(zn,a),br!==null&&hc(br,a),Sn!==null&&hc(Sn,a),ir.forEach(c),nr.forEach(c);for(var p=0;p<_n.length;p++){var v=_n[p];v.blockedOn===a&&(v.blockedOn=null)}for(;0<_n.length&&(p=_n[0],p.blockedOn===null);)H_(p),p.blockedOn===null&&_n.shift();if(p=(a.ownerDocument||a).$$reactFormReplay,p!=null)for(v=0;v<p.length;v+=3){var A=p[v],R=p[v+1],G=A[Ot]||null;if(typeof R=="function")G||bg(p);else if(G){var ee=null;if(R&&R.hasAttribute("formAction")){if(A=R,G=R[Ot]||null)ee=G.formAction;else if(Er(A)!==null)continue}else ee=G.action;typeof ee=="function"?p[v+1]=ee:(p.splice(v,3),v-=3),bg(p)}}}function Zp(a){this._internalRoot=a}zf.prototype.render=Zp.prototype.render=function(a){var c=this._internalRoot;if(c===null)throw Error(h(409));var p=c.current,v=la();Di(p,v,a,c,null,null)},zf.prototype.unmount=Zp.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var c=a.containerInfo;Di(a.current,2,null,a,null,null),xf(),c[Kt]=null}};function zf(a){this._internalRoot=a}zf.prototype.unstable_scheduleHydration=function(a){if(a){var c=yt();a={blockedOn:null,target:a,priority:c};for(var p=0;p<_n.length&&c!==0&&c<_n[p].priority;p++);_n.splice(p,0,a),p===0&&H_(a)}};var Gp=e.version;if(Gp!=="19.1.0")throw Error(h(527,Gp,"19.1.0"));st.findDOMNode=function(a){var c=a._reactInternals;if(c===void 0)throw typeof a.render=="function"?Error(h(188)):(a=Object.keys(a).join(","),Error(h(268,a)));return a=k(c),a=a!==null?B(a):null,a=a===null?null:a.stateNode,a};var xg={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:Ae,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ws=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ws.isDisabled&&Ws.supportsFiber)try{Na=Ws.inject(xg),Ir=Ws}catch{}}return Sg.createRoot=function(a,c){if(!_(a))throw Error(h(299));var p=!1,v="",A=c_,R=Pm,G=zm,ee=null;return c!=null&&(c.unstable_strictMode===!0&&(p=!0),c.identifierPrefix!==void 0&&(v=c.identifierPrefix),c.onUncaughtError!==void 0&&(A=c.onUncaughtError),c.onCaughtError!==void 0&&(R=c.onCaughtError),c.onRecoverableError!==void 0&&(G=c.onRecoverableError),c.unstable_transitionCallbacks!==void 0&&(ee=c.unstable_transitionCallbacks)),c=$t(a,1,!1,null,null,p,v,A,R,G,ee,null),a[Kt]=c.current,Op(a),new Zp(c)},Sg.hydrateRoot=function(a,c,p){if(!_(a))throw Error(h(299));var v=!1,A="",R=c_,G=Pm,ee=zm,_e=null,Ne=null;return p!=null&&(p.unstable_strictMode===!0&&(v=!0),p.identifierPrefix!==void 0&&(A=p.identifierPrefix),p.onUncaughtError!==void 0&&(R=p.onUncaughtError),p.onCaughtError!==void 0&&(G=p.onCaughtError),p.onRecoverableError!==void 0&&(ee=p.onRecoverableError),p.unstable_transitionCallbacks!==void 0&&(_e=p.unstable_transitionCallbacks),p.formState!==void 0&&(Ne=p.formState)),c=$t(a,1,!0,c,p??null,v,A,R,G,ee,_e,Ne),c.context=Ut(null),p=c.current,v=la(),v=Pe(v),A=xo(v),A.callback=null,ds(p,A,v),p=v,c.current.lanes=p,ze(c,p),ll(c),a[Kt]=c.current,Op(a),new zf(c)},Sg.version="19.1.0",Sg}var Ab;function s2(){if(Ab)return Sv.exports;Ab=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),Sv.exports=a2(),Sv.exports}var o2=s2(),Tg={},Ib;function l2(){if(Ib)return Tg;Ib=1,Object.defineProperty(Tg,"__esModule",{value:!0}),Tg.parse=S,Tg.serialize=B;const r=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,e=/^[\u0021-\u003A\u003C-\u007E]*$/,n=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,h=/^[\u0020-\u003A\u003D-\u007E]*$/,_=Object.prototype.toString,T=(()=>{const ne=function(){};return ne.prototype=Object.create(null),ne})();function S(ne,K){const le=new T,Ge=ne.length;if(Ge<2)return le;const tt=(K==null?void 0:K.decode)||q;let Ke=0;do{const ht=ne.indexOf("=",Ke);if(ht===-1)break;const bt=ne.indexOf(";",Ke),It=bt===-1?Ge:bt;if(ht>It){Ke=ne.lastIndexOf(";",ht-1)+1;continue}const wt=u(ne,Ke,ht),zt=k(ne,ht,wt),Pt=ne.slice(wt,zt);if(le[Pt]===void 0){let ut=u(ne,ht+1,It),Mt=k(ne,It,ut);const Ri=tt(ne.slice(ut,Mt));le[Pt]=Ri}Ke=It+1}while(Ke<Ge);return le}function u(ne,K,le){do{const Ge=ne.charCodeAt(K);if(Ge!==32&&Ge!==9)return K}while(++K<le);return le}function k(ne,K,le){for(;K>le;){const Ge=ne.charCodeAt(--K);if(Ge!==32&&Ge!==9)return K+1}return le}function B(ne,K,le){const Ge=(le==null?void 0:le.encode)||encodeURIComponent;if(!r.test(ne))throw new TypeError(`argument name is invalid: ${ne}`);const tt=Ge(K);if(!e.test(tt))throw new TypeError(`argument val is invalid: ${K}`);let Ke=ne+"="+tt;if(!le)return Ke;if(le.maxAge!==void 0){if(!Number.isInteger(le.maxAge))throw new TypeError(`option maxAge is invalid: ${le.maxAge}`);Ke+="; Max-Age="+le.maxAge}if(le.domain){if(!n.test(le.domain))throw new TypeError(`option domain is invalid: ${le.domain}`);Ke+="; Domain="+le.domain}if(le.path){if(!h.test(le.path))throw new TypeError(`option path is invalid: ${le.path}`);Ke+="; Path="+le.path}if(le.expires){if(!oe(le.expires)||!Number.isFinite(le.expires.valueOf()))throw new TypeError(`option expires is invalid: ${le.expires}`);Ke+="; Expires="+le.expires.toUTCString()}if(le.httpOnly&&(Ke+="; HttpOnly"),le.secure&&(Ke+="; Secure"),le.partitioned&&(Ke+="; Partitioned"),le.priority)switch(typeof le.priority=="string"?le.priority.toLowerCase():void 0){case"low":Ke+="; Priority=Low";break;case"medium":Ke+="; Priority=Medium";break;case"high":Ke+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${le.priority}`)}if(le.sameSite)switch(typeof le.sameSite=="string"?le.sameSite.toLowerCase():le.sameSite){case!0:case"strict":Ke+="; SameSite=Strict";break;case"lax":Ke+="; SameSite=Lax";break;case"none":Ke+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${le.sameSite}`)}return Ke}function q(ne){if(ne.indexOf("%")===-1)return ne;try{return decodeURIComponent(ne)}catch{return ne}}function oe(ne){return _.call(ne)==="[object Date]"}return Tg}l2();var Cb="popstate";function c2(r={}){function e(_,T){let{pathname:S="/",search:u="",hash:k=""}=bm(_.location.hash.substring(1));return!S.startsWith("/")&&!S.startsWith(".")&&(S="/"+S),t0("",{pathname:S,search:u,hash:k},T.state&&T.state.usr||null,T.state&&T.state.key||"default")}function n(_,T){let S=_.document.querySelector("base"),u="";if(S&&S.getAttribute("href")){let k=_.location.href,B=k.indexOf("#");u=B===-1?k:k.slice(0,B)}return u+"#"+(typeof T=="string"?T:Fg(T))}function h(_,T){_c(_.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(T)})`)}return h2(e,n,h,r)}function da(r,e){if(r===!1||r===null||typeof r>"u")throw new Error(e)}function _c(r,e){if(!r){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function u2(){return Math.random().toString(36).substring(2,10)}function Db(r,e){return{usr:r.state,key:r.key,idx:e}}function t0(r,e,n=null,h){return{pathname:typeof r=="string"?r:r.pathname,search:"",hash:"",...typeof e=="string"?bm(e):e,state:n,key:e&&e.key||h||u2()}}function Fg({pathname:r="/",search:e="",hash:n=""}){return e&&e!=="?"&&(r+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(r+=n.charAt(0)==="#"?n:"#"+n),r}function bm(r){let e={};if(r){let n=r.indexOf("#");n>=0&&(e.hash=r.substring(n),r=r.substring(0,n));let h=r.indexOf("?");h>=0&&(e.search=r.substring(h),r=r.substring(0,h)),r&&(e.pathname=r)}return e}function h2(r,e,n,h={}){let{window:_=document.defaultView,v5Compat:T=!1}=h,S=_.history,u="POP",k=null,B=q();B==null&&(B=0,S.replaceState({...S.state,idx:B},""));function q(){return(S.state||{idx:null}).idx}function oe(){u="POP";let tt=q(),Ke=tt==null?null:tt-B;B=tt,k&&k({action:u,location:Ge.location,delta:Ke})}function ne(tt,Ke){u="PUSH";let ht=t0(Ge.location,tt,Ke);n&&n(ht,tt),B=q()+1;let bt=Db(ht,B),It=Ge.createHref(ht);try{S.pushState(bt,"",It)}catch(wt){if(wt instanceof DOMException&&wt.name==="DataCloneError")throw wt;_.location.assign(It)}T&&k&&k({action:u,location:Ge.location,delta:1})}function K(tt,Ke){u="REPLACE";let ht=t0(Ge.location,tt,Ke);n&&n(ht,tt),B=q();let bt=Db(ht,B),It=Ge.createHref(ht);S.replaceState(bt,"",It),T&&k&&k({action:u,location:Ge.location,delta:0})}function le(tt){return d2(tt)}let Ge={get action(){return u},get location(){return r(_,S)},listen(tt){if(k)throw new Error("A history only accepts one active listener");return _.addEventListener(Cb,oe),k=tt,()=>{_.removeEventListener(Cb,oe),k=null}},createHref(tt){return e(_,tt)},createURL:le,encodeLocation(tt){let Ke=le(tt);return{pathname:Ke.pathname,search:Ke.search,hash:Ke.hash}},push:ne,replace:K,go(tt){return S.go(tt)}};return Ge}function d2(r,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),da(n,"No window.location.(origin|href) available to create URL");let h=typeof r=="string"?r:Fg(r);return h=h.replace(/ $/,"%20"),!e&&h.startsWith("//")&&(h=n+h),new URL(h,n)}function Zx(r,e,n="/"){return f2(r,e,n,!1)}function f2(r,e,n,h){let _=typeof e=="string"?bm(e):e,T=yh(_.pathname||"/",n);if(T==null)return null;let S=Gx(r);p2(S);let u=null;for(let k=0;u==null&&k<S.length;++k){let B=E2(T);u=S2(S[k],B,h)}return u}function Gx(r,e=[],n=[],h=""){let _=(T,S,u)=>{let k={relativePath:u===void 0?T.path||"":u,caseSensitive:T.caseSensitive===!0,childrenIndex:S,route:T};k.relativePath.startsWith("/")&&(da(k.relativePath.startsWith(h),`Absolute route path "${k.relativePath}" nested under path "${h}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),k.relativePath=k.relativePath.slice(h.length));let B=gh([h,k.relativePath]),q=n.concat(k);T.children&&T.children.length>0&&(da(T.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${B}".`),Gx(T.children,e,q,B)),!(T.path==null&&!T.index)&&e.push({path:B,score:x2(B,T.index),routesMeta:q})};return r.forEach((T,S)=>{var u;if(T.path===""||!((u=T.path)!=null&&u.includes("?")))_(T,S);else for(let k of qx(T.path))_(T,S,k)}),e}function qx(r){let e=r.split("/");if(e.length===0)return[];let[n,...h]=e,_=n.endsWith("?"),T=n.replace(/\?$/,"");if(h.length===0)return _?[T,""]:[T];let S=qx(h.join("/")),u=[];return u.push(...S.map(k=>k===""?T:[T,k].join("/"))),_&&u.push(...S),u.map(k=>r.startsWith("/")&&k===""?"/":k)}function p2(r){r.sort((e,n)=>e.score!==n.score?n.score-e.score:w2(e.routesMeta.map(h=>h.childrenIndex),n.routesMeta.map(h=>h.childrenIndex)))}var m2=/^:[\w-]+$/,g2=3,_2=2,y2=1,v2=10,b2=-2,Rb=r=>r==="*";function x2(r,e){let n=r.split("/"),h=n.length;return n.some(Rb)&&(h+=b2),e&&(h+=_2),n.filter(_=>!Rb(_)).reduce((_,T)=>_+(m2.test(T)?g2:T===""?y2:v2),h)}function w2(r,e){return r.length===e.length&&r.slice(0,-1).every((h,_)=>h===e[_])?r[r.length-1]-e[e.length-1]:0}function S2(r,e,n=!1){let{routesMeta:h}=r,_={},T="/",S=[];for(let u=0;u<h.length;++u){let k=h[u],B=u===h.length-1,q=T==="/"?e:e.slice(T.length)||"/",oe=my({path:k.relativePath,caseSensitive:k.caseSensitive,end:B},q),ne=k.route;if(!oe&&B&&n&&!h[h.length-1].route.index&&(oe=my({path:k.relativePath,caseSensitive:k.caseSensitive,end:!1},q)),!oe)return null;Object.assign(_,oe.params),S.push({params:_,pathname:gh([T,oe.pathname]),pathnameBase:C2(gh([T,oe.pathnameBase])),route:ne}),oe.pathnameBase!=="/"&&(T=gh([T,oe.pathnameBase]))}return S}function my(r,e){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[n,h]=T2(r.path,r.caseSensitive,r.end),_=e.match(n);if(!_)return null;let T=_[0],S=T.replace(/(.)\/+$/,"$1"),u=_.slice(1);return{params:h.reduce((B,{paramName:q,isOptional:oe},ne)=>{if(q==="*"){let le=u[ne]||"";S=T.slice(0,T.length-le.length).replace(/(.)\/+$/,"$1")}const K=u[ne];return oe&&!K?B[q]=void 0:B[q]=(K||"").replace(/%2F/g,"/"),B},{}),pathname:T,pathnameBase:S,pattern:r}}function T2(r,e=!1,n=!0){_c(r==="*"||!r.endsWith("*")||r.endsWith("/*"),`Route path "${r}" will be treated as if it were "${r.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${r.replace(/\*$/,"/*")}".`);let h=[],_="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(S,u,k)=>(h.push({paramName:u,isOptional:k!=null}),k?"/?([^\\/]+)?":"/([^\\/]+)"));return r.endsWith("*")?(h.push({paramName:"*"}),_+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?_+="\\/*$":r!==""&&r!=="/"&&(_+="(?:(?=\\/|$))"),[new RegExp(_,e?void 0:"i"),h]}function E2(r){try{return r.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return _c(!1,`The URL path "${r}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),r}}function yh(r,e){if(e==="/")return r;if(!r.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,h=r.charAt(n);return h&&h!=="/"?null:r.slice(n)||"/"}function M2(r,e="/"){let{pathname:n,search:h="",hash:_=""}=typeof r=="string"?bm(r):r;return{pathname:n?n.startsWith("/")?n:A2(n,e):e,search:D2(h),hash:R2(_)}}function A2(r,e){let n=e.replace(/\/+$/,"").split("/");return r.split("/").forEach(_=>{_===".."?n.length>1&&n.pop():_!=="."&&n.push(_)}),n.length>1?n.join("/"):"/"}function Av(r,e,n,h){return`Cannot include a '${r}' character in a manually specified \`to.${e}\` field [${JSON.stringify(h)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function I2(r){return r.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function $x(r){let e=I2(r);return e.map((n,h)=>h===e.length-1?n.pathname:n.pathnameBase)}function Hx(r,e,n,h=!1){let _;typeof r=="string"?_=bm(r):(_={...r},da(!_.pathname||!_.pathname.includes("?"),Av("?","pathname","search",_)),da(!_.pathname||!_.pathname.includes("#"),Av("#","pathname","hash",_)),da(!_.search||!_.search.includes("#"),Av("#","search","hash",_)));let T=r===""||_.pathname==="",S=T?"/":_.pathname,u;if(S==null)u=n;else{let oe=e.length-1;if(!h&&S.startsWith("..")){let ne=S.split("/");for(;ne[0]==="..";)ne.shift(),oe-=1;_.pathname=ne.join("/")}u=oe>=0?e[oe]:"/"}let k=M2(_,u),B=S&&S!=="/"&&S.endsWith("/"),q=(T||S===".")&&n.endsWith("/");return!k.pathname.endsWith("/")&&(B||q)&&(k.pathname+="/"),k}var gh=r=>r.join("/").replace(/\/\/+/g,"/"),C2=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),D2=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,R2=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function P2(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}var Yx=["POST","PUT","PATCH","DELETE"];new Set(Yx);var z2=["GET",...Yx];new Set(z2);var xm=Je.createContext(null);xm.displayName="DataRouter";var iv=Je.createContext(null);iv.displayName="DataRouterState";var Xx=Je.createContext({isTransitioning:!1});Xx.displayName="ViewTransition";var k2=Je.createContext(new Map);k2.displayName="Fetchers";var O2=Je.createContext(null);O2.displayName="Await";var cu=Je.createContext(null);cu.displayName="Navigation";var nv=Je.createContext(null);nv.displayName="Location";var bh=Je.createContext({outlet:null,matches:[],isDataRoute:!1});bh.displayName="Route";var O0=Je.createContext(null);O0.displayName="RouteError";function B2(r,{relative:e}={}){da(i_(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:h}=Je.useContext(cu),{hash:_,pathname:T,search:S}=n_(r,{relative:e}),u=T;return n!=="/"&&(u=T==="/"?n:gh([n,T])),h.createHref({pathname:u,search:S,hash:_})}function i_(){return Je.useContext(nv)!=null}function Vf(){return da(i_(),"useLocation() may be used only in the context of a <Router> component."),Je.useContext(nv).location}var Kx="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Wx(r){Je.useContext(cu).static||Je.useLayoutEffect(r)}function L2(){let{isDataRoute:r}=Je.useContext(bh);return r?K2():F2()}function F2(){da(i_(),"useNavigate() may be used only in the context of a <Router> component.");let r=Je.useContext(xm),{basename:e,navigator:n}=Je.useContext(cu),{matches:h}=Je.useContext(bh),{pathname:_}=Vf(),T=JSON.stringify($x(h)),S=Je.useRef(!1);return Wx(()=>{S.current=!0}),Je.useCallback((k,B={})=>{if(_c(S.current,Kx),!S.current)return;if(typeof k=="number"){n.go(k);return}let q=Hx(k,JSON.parse(T),_,B.relative==="path");r==null&&e!=="/"&&(q.pathname=q.pathname==="/"?e:gh([e,q.pathname])),(B.replace?n.replace:n.push)(q,B.state,B)},[e,n,T,_,r])}Je.createContext(null);function n_(r,{relative:e}={}){let{matches:n}=Je.useContext(bh),{pathname:h}=Vf(),_=JSON.stringify($x(n));return Je.useMemo(()=>Hx(r,JSON.parse(_),h,e==="path"),[r,_,h,e])}function N2(r,e,n,h){da(i_(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:_,static:T}=Je.useContext(cu),{matches:S}=Je.useContext(bh),u=S[S.length-1],k=u?u.params:{},B=u?u.pathname:"/",q=u?u.pathnameBase:"/",oe=u&&u.route;{let ht=oe&&oe.path||"";Qx(B,!oe||ht.endsWith("*")||ht.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${B}" (under <Route path="${ht}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${ht}"> to <Route path="${ht==="/"?"*":`${ht}/*`}">.`)}let ne=Vf(),K;K=ne;let le=K.pathname||"/",Ge=le;if(q!=="/"){let ht=q.replace(/^\//,"").split("/");Ge="/"+le.replace(/^\//,"").split("/").slice(ht.length).join("/")}let tt=!T&&n&&n.matches&&n.matches.length>0?n.matches:Zx(r,{pathname:Ge});return _c(oe||tt!=null,`No routes matched location "${K.pathname}${K.search}${K.hash}" `),_c(tt==null||tt[tt.length-1].route.element!==void 0||tt[tt.length-1].route.Component!==void 0||tt[tt.length-1].route.lazy!==void 0,`Matched leaf route at location "${K.pathname}${K.search}${K.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),G2(tt&&tt.map(ht=>Object.assign({},ht,{params:Object.assign({},k,ht.params),pathname:gh([q,_.encodeLocation?_.encodeLocation(ht.pathname).pathname:ht.pathname]),pathnameBase:ht.pathnameBase==="/"?q:gh([q,_.encodeLocation?_.encodeLocation(ht.pathnameBase).pathname:ht.pathnameBase])})),S,n,h)}function U2(){let r=X2(),e=P2(r)?`${r.status} ${r.statusText}`:r instanceof Error?r.message:JSON.stringify(r),n=r instanceof Error?r.stack:null,h="rgba(200,200,200, 0.5)",_={padding:"0.5rem",backgroundColor:h},T={padding:"2px 4px",backgroundColor:h},S=null;return console.error("Error handled by React Router default ErrorBoundary:",r),S=Je.createElement(Je.Fragment,null,Je.createElement("p",null," Hey developer "),Je.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Je.createElement("code",{style:T},"ErrorBoundary")," or"," ",Je.createElement("code",{style:T},"errorElement")," prop on your route.")),Je.createElement(Je.Fragment,null,Je.createElement("h2",null,"Unexpected Application Error!"),Je.createElement("h3",{style:{fontStyle:"italic"}},e),n?Je.createElement("pre",{style:_},n):null,S)}var j2=Je.createElement(U2,null),V2=class extends Je.Component{constructor(r){super(r),this.state={location:r.location,revalidation:r.revalidation,error:r.error}}static getDerivedStateFromError(r){return{error:r}}static getDerivedStateFromProps(r,e){return e.location!==r.location||e.revalidation!=="idle"&&r.revalidation==="idle"?{error:r.error,location:r.location,revalidation:r.revalidation}:{error:r.error!==void 0?r.error:e.error,location:e.location,revalidation:r.revalidation||e.revalidation}}componentDidCatch(r,e){console.error("React Router caught the following error during render",r,e)}render(){return this.state.error!==void 0?Je.createElement(bh.Provider,{value:this.props.routeContext},Je.createElement(O0.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function Z2({routeContext:r,match:e,children:n}){let h=Je.useContext(xm);return h&&h.static&&h.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(h.staticContext._deepestRenderedBoundaryId=e.route.id),Je.createElement(bh.Provider,{value:r},n)}function G2(r,e=[],n=null,h=null){if(r==null){if(!n)return null;if(n.errors)r=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)r=n.matches;else return null}let _=r,T=n==null?void 0:n.errors;if(T!=null){let k=_.findIndex(B=>B.route.id&&(T==null?void 0:T[B.route.id])!==void 0);da(k>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(T).join(",")}`),_=_.slice(0,Math.min(_.length,k+1))}let S=!1,u=-1;if(n)for(let k=0;k<_.length;k++){let B=_[k];if((B.route.HydrateFallback||B.route.hydrateFallbackElement)&&(u=k),B.route.id){let{loaderData:q,errors:oe}=n,ne=B.route.loader&&!q.hasOwnProperty(B.route.id)&&(!oe||oe[B.route.id]===void 0);if(B.route.lazy||ne){S=!0,u>=0?_=_.slice(0,u+1):_=[_[0]];break}}}return _.reduceRight((k,B,q)=>{let oe,ne=!1,K=null,le=null;n&&(oe=T&&B.route.id?T[B.route.id]:void 0,K=B.route.errorElement||j2,S&&(u<0&&q===0?(Qx("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),ne=!0,le=null):u===q&&(ne=!0,le=B.route.hydrateFallbackElement||null)));let Ge=e.concat(_.slice(0,q+1)),tt=()=>{let Ke;return oe?Ke=K:ne?Ke=le:B.route.Component?Ke=Je.createElement(B.route.Component,null):B.route.element?Ke=B.route.element:Ke=k,Je.createElement(Z2,{match:B,routeContext:{outlet:k,matches:Ge,isDataRoute:n!=null},children:Ke})};return n&&(B.route.ErrorBoundary||B.route.errorElement||q===0)?Je.createElement(V2,{location:n.location,revalidation:n.revalidation,component:K,error:oe,children:tt(),routeContext:{outlet:null,matches:Ge,isDataRoute:!0}}):tt()},null)}function B0(r){return`${r} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function q2(r){let e=Je.useContext(xm);return da(e,B0(r)),e}function $2(r){let e=Je.useContext(iv);return da(e,B0(r)),e}function H2(r){let e=Je.useContext(bh);return da(e,B0(r)),e}function L0(r){let e=H2(r),n=e.matches[e.matches.length-1];return da(n.route.id,`${r} can only be used on routes that contain a unique "id"`),n.route.id}function Y2(){return L0("useRouteId")}function X2(){var h;let r=Je.useContext(O0),e=$2("useRouteError"),n=L0("useRouteError");return r!==void 0?r:(h=e.errors)==null?void 0:h[n]}function K2(){let{router:r}=q2("useNavigate"),e=L0("useNavigate"),n=Je.useRef(!1);return Wx(()=>{n.current=!0}),Je.useCallback(async(_,T={})=>{_c(n.current,Kx),n.current&&(typeof _=="number"?r.navigate(_):await r.navigate(_,{fromRouteId:e,...T}))},[r,e])}var Pb={};function Qx(r,e,n){!e&&!Pb[r]&&(Pb[r]=!0,_c(!1,n))}Je.memo(W2);function W2({routes:r,future:e,state:n}){return N2(r,void 0,n,e)}function Q2({basename:r="/",children:e=null,location:n,navigationType:h="POP",navigator:_,static:T=!1}){da(!i_(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let S=r.replace(/^\/*/,"/"),u=Je.useMemo(()=>({basename:S,navigator:_,static:T,future:{}}),[S,_,T]);typeof n=="string"&&(n=bm(n));let{pathname:k="/",search:B="",hash:q="",state:oe=null,key:ne="default"}=n,K=Je.useMemo(()=>{let le=yh(k,S);return le==null?null:{location:{pathname:le,search:B,hash:q,state:oe,key:ne},navigationType:h}},[S,k,B,q,oe,ne,h]);return _c(K!=null,`<Router basename="${S}"> is not able to match the URL "${k}${B}${q}" because it does not start with the basename, so the <Router> won't render anything.`),K==null?null:Je.createElement(cu.Provider,{value:u},Je.createElement(nv.Provider,{children:e,value:K}))}var ey="get",ty="application/x-www-form-urlencoded";function rv(r){return r!=null&&typeof r.tagName=="string"}function J2(r){return rv(r)&&r.tagName.toLowerCase()==="button"}function eT(r){return rv(r)&&r.tagName.toLowerCase()==="form"}function tT(r){return rv(r)&&r.tagName.toLowerCase()==="input"}function iT(r){return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}function nT(r,e){return r.button===0&&(!e||e==="_self")&&!iT(r)}var Y_=null;function rT(){if(Y_===null)try{new FormData(document.createElement("form"),0),Y_=!1}catch{Y_=!0}return Y_}var aT=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Iv(r){return r!=null&&!aT.has(r)?(_c(!1,`"${r}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${ty}"`),null):r}function sT(r,e){let n,h,_,T,S;if(eT(r)){let u=r.getAttribute("action");h=u?yh(u,e):null,n=r.getAttribute("method")||ey,_=Iv(r.getAttribute("enctype"))||ty,T=new FormData(r)}else if(J2(r)||tT(r)&&(r.type==="submit"||r.type==="image")){let u=r.form;if(u==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let k=r.getAttribute("formaction")||u.getAttribute("action");if(h=k?yh(k,e):null,n=r.getAttribute("formmethod")||u.getAttribute("method")||ey,_=Iv(r.getAttribute("formenctype"))||Iv(u.getAttribute("enctype"))||ty,T=new FormData(u,r),!rT()){let{name:B,type:q,value:oe}=r;if(q==="image"){let ne=B?`${B}.`:"";T.append(`${ne}x`,"0"),T.append(`${ne}y`,"0")}else B&&T.append(B,oe)}}else{if(rv(r))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=ey,h=null,_=ty,S=r}return T&&_==="text/plain"&&(S=T,T=void 0),{action:h,method:n.toLowerCase(),encType:_,formData:T,body:S}}function F0(r,e){if(r===!1||r===null||typeof r>"u")throw new Error(e)}async function oT(r,e){if(r.id in e)return e[r.id];try{let n=await import(r.module);return e[r.id]=n,n}catch(n){return console.error(`Error loading route module \`${r.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function lT(r){return r==null?!1:r.href==null?r.rel==="preload"&&typeof r.imageSrcSet=="string"&&typeof r.imageSizes=="string":typeof r.rel=="string"&&typeof r.href=="string"}async function cT(r,e,n){let h=await Promise.all(r.map(async _=>{let T=e.routes[_.route.id];if(T){let S=await oT(T,n);return S.links?S.links():[]}return[]}));return fT(h.flat(1).filter(lT).filter(_=>_.rel==="stylesheet"||_.rel==="preload").map(_=>_.rel==="stylesheet"?{..._,rel:"prefetch",as:"style"}:{..._,rel:"prefetch"}))}function zb(r,e,n,h,_,T){let S=(k,B)=>n[B]?k.route.id!==n[B].route.id:!0,u=(k,B)=>{var q;return n[B].pathname!==k.pathname||((q=n[B].route.path)==null?void 0:q.endsWith("*"))&&n[B].params["*"]!==k.params["*"]};return T==="assets"?e.filter((k,B)=>S(k,B)||u(k,B)):T==="data"?e.filter((k,B)=>{var oe;let q=h.routes[k.route.id];if(!q||!q.hasLoader)return!1;if(S(k,B)||u(k,B))return!0;if(k.route.shouldRevalidate){let ne=k.route.shouldRevalidate({currentUrl:new URL(_.pathname+_.search+_.hash,window.origin),currentParams:((oe=n[0])==null?void 0:oe.params)||{},nextUrl:new URL(r,window.origin),nextParams:k.params,defaultShouldRevalidate:!0});if(typeof ne=="boolean")return ne}return!0}):[]}function uT(r,e,{includeHydrateFallback:n}={}){return hT(r.map(h=>{let _=e.routes[h.route.id];if(!_)return[];let T=[_.module];return _.clientActionModule&&(T=T.concat(_.clientActionModule)),_.clientLoaderModule&&(T=T.concat(_.clientLoaderModule)),n&&_.hydrateFallbackModule&&(T=T.concat(_.hydrateFallbackModule)),_.imports&&(T=T.concat(_.imports)),T}).flat(1))}function hT(r){return[...new Set(r)]}function dT(r){let e={},n=Object.keys(r).sort();for(let h of n)e[h]=r[h];return e}function fT(r,e){let n=new Set;return new Set(e),r.reduce((h,_)=>{let T=JSON.stringify(dT(_));return n.has(T)||(n.add(T),h.push({key:T,link:_})),h},[])}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var pT=new Set([100,101,204,205]);function mT(r,e){let n=typeof r=="string"?new URL(r,typeof window>"u"?"server://singlefetch/":window.location.origin):r;return n.pathname==="/"?n.pathname="_root.data":e&&yh(n.pathname,e)==="/"?n.pathname=`${e.replace(/\/$/,"")}/_root.data`:n.pathname=`${n.pathname.replace(/\/$/,"")}.data`,n}function Jx(){let r=Je.useContext(xm);return F0(r,"You must render this element inside a <DataRouterContext.Provider> element"),r}function gT(){let r=Je.useContext(iv);return F0(r,"You must render this element inside a <DataRouterStateContext.Provider> element"),r}var N0=Je.createContext(void 0);N0.displayName="FrameworkContext";function e1(){let r=Je.useContext(N0);return F0(r,"You must render this element inside a <HydratedRouter> element"),r}function _T(r,e){let n=Je.useContext(N0),[h,_]=Je.useState(!1),[T,S]=Je.useState(!1),{onFocus:u,onBlur:k,onMouseEnter:B,onMouseLeave:q,onTouchStart:oe}=e,ne=Je.useRef(null);Je.useEffect(()=>{if(r==="render"&&S(!0),r==="viewport"){let Ge=Ke=>{Ke.forEach(ht=>{S(ht.isIntersecting)})},tt=new IntersectionObserver(Ge,{threshold:.5});return ne.current&&tt.observe(ne.current),()=>{tt.disconnect()}}},[r]),Je.useEffect(()=>{if(h){let Ge=setTimeout(()=>{S(!0)},100);return()=>{clearTimeout(Ge)}}},[h]);let K=()=>{_(!0)},le=()=>{_(!1),S(!1)};return n?r!=="intent"?[T,ne,{}]:[T,ne,{onFocus:Eg(u,K),onBlur:Eg(k,le),onMouseEnter:Eg(B,K),onMouseLeave:Eg(q,le),onTouchStart:Eg(oe,K)}]:[!1,ne,{}]}function Eg(r,e){return n=>{r&&r(n),n.defaultPrevented||e(n)}}function yT({page:r,...e}){let{router:n}=Jx(),h=Je.useMemo(()=>Zx(n.routes,r,n.basename),[n.routes,r,n.basename]);return h?Je.createElement(bT,{page:r,matches:h,...e}):null}function vT(r){let{manifest:e,routeModules:n}=e1(),[h,_]=Je.useState([]);return Je.useEffect(()=>{let T=!1;return cT(r,e,n).then(S=>{T||_(S)}),()=>{T=!0}},[r,e,n]),h}function bT({page:r,matches:e,...n}){let h=Vf(),{manifest:_,routeModules:T}=e1(),{basename:S}=Jx(),{loaderData:u,matches:k}=gT(),B=Je.useMemo(()=>zb(r,e,k,_,h,"data"),[r,e,k,_,h]),q=Je.useMemo(()=>zb(r,e,k,_,h,"assets"),[r,e,k,_,h]),oe=Je.useMemo(()=>{if(r===h.pathname+h.search+h.hash)return[];let le=new Set,Ge=!1;if(e.forEach(Ke=>{var bt;let ht=_.routes[Ke.route.id];!ht||!ht.hasLoader||(!B.some(It=>It.route.id===Ke.route.id)&&Ke.route.id in u&&((bt=T[Ke.route.id])!=null&&bt.shouldRevalidate)||ht.hasClientLoader?Ge=!0:le.add(Ke.route.id))}),le.size===0)return[];let tt=mT(r,S);return Ge&&le.size>0&&tt.searchParams.set("_routes",e.filter(Ke=>le.has(Ke.route.id)).map(Ke=>Ke.route.id).join(",")),[tt.pathname+tt.search]},[S,u,h,_,B,e,r,T]),ne=Je.useMemo(()=>uT(q,_),[q,_]),K=vT(q);return Je.createElement(Je.Fragment,null,oe.map(le=>Je.createElement("link",{key:le,rel:"prefetch",as:"fetch",href:le,...n})),ne.map(le=>Je.createElement("link",{key:le,rel:"modulepreload",href:le,...n})),K.map(({key:le,link:Ge})=>Je.createElement("link",{key:le,...Ge})))}function xT(...r){return e=>{r.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var t1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{t1&&(window.__reactRouterVersion="7.6.0")}catch{}function wT({basename:r,children:e,window:n}){let h=Je.useRef();h.current==null&&(h.current=c2({window:n,v5Compat:!0}));let _=h.current,[T,S]=Je.useState({action:_.action,location:_.location}),u=Je.useCallback(k=>{Je.startTransition(()=>S(k))},[S]);return Je.useLayoutEffect(()=>_.listen(u),[_,u]),Je.createElement(Q2,{basename:r,children:e,location:T.location,navigationType:T.action,navigator:_})}var i1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,n1=Je.forwardRef(function({onClick:e,discover:n="render",prefetch:h="none",relative:_,reloadDocument:T,replace:S,state:u,target:k,to:B,preventScrollReset:q,viewTransition:oe,...ne},K){let{basename:le}=Je.useContext(cu),Ge=typeof B=="string"&&i1.test(B),tt,Ke=!1;if(typeof B=="string"&&Ge&&(tt=B,t1))try{let Mt=new URL(window.location.href),Ri=B.startsWith("//")?new URL(Mt.protocol+B):new URL(B),bi=yh(Ri.pathname,le);Ri.origin===Mt.origin&&bi!=null?B=bi+Ri.search+Ri.hash:Ke=!0}catch{_c(!1,`<Link to="${B}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let ht=B2(B,{relative:_}),[bt,It,wt]=_T(h,ne),zt=MT(B,{replace:S,state:u,target:k,preventScrollReset:q,relative:_,viewTransition:oe});function Pt(Mt){e&&e(Mt),Mt.defaultPrevented||zt(Mt)}let ut=Je.createElement("a",{...ne,...wt,href:tt||ht,onClick:Ke||T?e:Pt,ref:xT(K,It),target:k,"data-discover":!Ge&&n==="render"?"true":void 0});return bt&&!Ge?Je.createElement(Je.Fragment,null,ut,Je.createElement(yT,{page:ht})):ut});n1.displayName="Link";var ST=Je.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:h="",end:_=!1,style:T,to:S,viewTransition:u,children:k,...B},q){let oe=n_(S,{relative:B.relative}),ne=Vf(),K=Je.useContext(iv),{navigator:le,basename:Ge}=Je.useContext(cu),tt=K!=null&&RT(oe)&&u===!0,Ke=le.encodeLocation?le.encodeLocation(oe).pathname:oe.pathname,ht=ne.pathname,bt=K&&K.navigation&&K.navigation.location?K.navigation.location.pathname:null;n||(ht=ht.toLowerCase(),bt=bt?bt.toLowerCase():null,Ke=Ke.toLowerCase()),bt&&Ge&&(bt=yh(bt,Ge)||bt);const It=Ke!=="/"&&Ke.endsWith("/")?Ke.length-1:Ke.length;let wt=ht===Ke||!_&&ht.startsWith(Ke)&&ht.charAt(It)==="/",zt=bt!=null&&(bt===Ke||!_&&bt.startsWith(Ke)&&bt.charAt(Ke.length)==="/"),Pt={isActive:wt,isPending:zt,isTransitioning:tt},ut=wt?e:void 0,Mt;typeof h=="function"?Mt=h(Pt):Mt=[h,wt?"active":null,zt?"pending":null,tt?"transitioning":null].filter(Boolean).join(" ");let Ri=typeof T=="function"?T(Pt):T;return Je.createElement(n1,{...B,"aria-current":ut,className:Mt,ref:q,style:Ri,to:S,viewTransition:u},typeof k=="function"?k(Pt):k)});ST.displayName="NavLink";var TT=Je.forwardRef(({discover:r="render",fetcherKey:e,navigate:n,reloadDocument:h,replace:_,state:T,method:S=ey,action:u,onSubmit:k,relative:B,preventScrollReset:q,viewTransition:oe,...ne},K)=>{let le=CT(),Ge=DT(u,{relative:B}),tt=S.toLowerCase()==="get"?"get":"post",Ke=typeof u=="string"&&i1.test(u),ht=bt=>{if(k&&k(bt),bt.defaultPrevented)return;bt.preventDefault();let It=bt.nativeEvent.submitter,wt=(It==null?void 0:It.getAttribute("formmethod"))||S;le(It||bt.currentTarget,{fetcherKey:e,method:wt,navigate:n,replace:_,state:T,relative:B,preventScrollReset:q,viewTransition:oe})};return Je.createElement("form",{ref:K,method:tt,action:Ge,onSubmit:h?k:ht,...ne,"data-discover":!Ke&&r==="render"?"true":void 0})});TT.displayName="Form";function ET(r){return`${r} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function r1(r){let e=Je.useContext(xm);return da(e,ET(r)),e}function MT(r,{target:e,replace:n,state:h,preventScrollReset:_,relative:T,viewTransition:S}={}){let u=L2(),k=Vf(),B=n_(r,{relative:T});return Je.useCallback(q=>{if(nT(q,e)){q.preventDefault();let oe=n!==void 0?n:Fg(k)===Fg(B);u(r,{replace:oe,state:h,preventScrollReset:_,relative:T,viewTransition:S})}},[k,u,B,n,h,e,r,_,T,S])}var AT=0,IT=()=>`__${String(++AT)}__`;function CT(){let{router:r}=r1("useSubmit"),{basename:e}=Je.useContext(cu),n=Y2();return Je.useCallback(async(h,_={})=>{let{action:T,method:S,encType:u,formData:k,body:B}=sT(h,e);if(_.navigate===!1){let q=_.fetcherKey||IT();await r.fetch(q,n,_.action||T,{preventScrollReset:_.preventScrollReset,formData:k,body:B,formMethod:_.method||S,formEncType:_.encType||u,flushSync:_.flushSync})}else await r.navigate(_.action||T,{preventScrollReset:_.preventScrollReset,formData:k,body:B,formMethod:_.method||S,formEncType:_.encType||u,replace:_.replace,state:_.state,fromRouteId:n,flushSync:_.flushSync,viewTransition:_.viewTransition})},[r,e,n])}function DT(r,{relative:e}={}){let{basename:n}=Je.useContext(cu),h=Je.useContext(bh);da(h,"useFormAction must be used inside a RouteContext");let[_]=h.matches.slice(-1),T={...n_(r||".",{relative:e})},S=Vf();if(r==null){T.search=S.search;let u=new URLSearchParams(T.search),k=u.getAll("index");if(k.some(q=>q==="")){u.delete("index"),k.filter(oe=>oe).forEach(oe=>u.append("index",oe));let q=u.toString();T.search=q?`?${q}`:""}}return(!r||r===".")&&_.route.index&&(T.search=T.search?T.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(T.pathname=T.pathname==="/"?n:gh([n,T.pathname])),Fg(T)}function RT(r,e={}){let n=Je.useContext(Xx);da(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:h}=r1("useViewTransitionState"),_=n_(r,{relative:e.relative});if(!n.isTransitioning)return!1;let T=yh(n.currentLocation.pathname,h)||n.currentLocation.pathname,S=yh(n.nextLocation.pathname,h)||n.nextLocation.pathname;return my(_.pathname,S)!=null||my(_.pathname,T)!=null}[...pT];var a1="vercel.ai.error",PT=Symbol.for(a1),s1,zT=class o1 extends Error{constructor({name:e,message:n,cause:h}){super(n),this[s1]=!0,this.name=e,this.cause=h}static isInstance(e){return o1.hasMarker(e,a1)}static hasMarker(e,n){const h=Symbol.for(n);return e!=null&&typeof e=="object"&&h in e&&typeof e[h]=="boolean"&&e[h]===!0}};s1=PT;var Id=zT;function l1(r){return r==null?"unknown error":typeof r=="string"?r:r instanceof Error?r.message:JSON.stringify(r)}var c1="AI_InvalidArgumentError",u1=`vercel.ai.error.${c1}`,kT=Symbol.for(u1),h1,OT=class extends Id{constructor({message:r,cause:e,argument:n}){super({name:c1,message:r,cause:e}),this[h1]=!0,this.argument=n}static isInstance(r){return Id.hasMarker(r,u1)}};h1=kT;var d1="AI_JSONParseError",f1=`vercel.ai.error.${d1}`,BT=Symbol.for(f1),p1,kb=class extends Id{constructor({text:r,cause:e}){super({name:d1,message:`JSON parsing failed: Text: ${r}.
Error message: ${l1(e)}`,cause:e}),this[p1]=!0,this.text=r}static isInstance(r){return Id.hasMarker(r,f1)}};p1=BT;var m1="AI_TypeValidationError",g1=`vercel.ai.error.${m1}`,LT=Symbol.for(g1),_1,FT=class i0 extends Id{constructor({value:e,cause:n}){super({name:m1,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${l1(n)}`,cause:n}),this[_1]=!0,this.value=e}static isInstance(e){return Id.hasMarker(e,g1)}static wrap({value:e,cause:n}){return i0.isInstance(n)&&n.value===e?n:new i0({value:e,cause:n})}};_1=LT;var Ob=FT;let NT=(r,e=21)=>(n=e)=>{let h="",_=n|0;for(;_--;)h+=r[Math.random()*r.length|0];return h};var kf={exports:{}},Bb;function UT(){if(Bb)return kf.exports;Bb=1;const r=typeof Buffer<"u",e=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,n=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function h(u,k,B){B==null&&k!==null&&typeof k=="object"&&(B=k,k=void 0),r&&Buffer.isBuffer(u)&&(u=u.toString()),u&&u.charCodeAt(0)===65279&&(u=u.slice(1));const q=JSON.parse(u,k);if(q===null||typeof q!="object")return q;const oe=B&&B.protoAction||"error",ne=B&&B.constructorAction||"error";if(oe==="ignore"&&ne==="ignore")return q;if(oe!=="ignore"&&ne!=="ignore"){if(e.test(u)===!1&&n.test(u)===!1)return q}else if(oe!=="ignore"&&ne==="ignore"){if(e.test(u)===!1)return q}else if(n.test(u)===!1)return q;return _(q,{protoAction:oe,constructorAction:ne,safe:B&&B.safe})}function _(u,{protoAction:k="error",constructorAction:B="error",safe:q}={}){let oe=[u];for(;oe.length;){const ne=oe;oe=[];for(const K of ne){if(k!=="ignore"&&Object.prototype.hasOwnProperty.call(K,"__proto__")){if(q===!0)return null;if(k==="error")throw new SyntaxError("Object contains forbidden prototype property");delete K.__proto__}if(B!=="ignore"&&Object.prototype.hasOwnProperty.call(K,"constructor")&&Object.prototype.hasOwnProperty.call(K.constructor,"prototype")){if(q===!0)return null;if(B==="error")throw new SyntaxError("Object contains forbidden prototype property");delete K.constructor}for(const le in K){const Ge=K[le];Ge&&typeof Ge=="object"&&oe.push(Ge)}}}return u}function T(u,k,B){const q=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return h(u,k,B)}finally{Error.stackTraceLimit=q}}function S(u,k){const B=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return h(u,k,{safe:!0})}catch{return null}finally{Error.stackTraceLimit=B}}return kf.exports=T,kf.exports.default=T,kf.exports.parse=T,kf.exports.safeParse=S,kf.exports.scan=_,kf.exports}var jT=UT();const VT=z0(jT);function ZT(r){return new ReadableStream({async pull(e){try{const{value:n,done:h}=await r.next();h?e.close():e.enqueue(n)}catch(n){e.error(n)}},cancel(){}})}var Zf=({prefix:r,size:e=16,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:h="-"}={})=>{const _=NT(n,e);if(r==null)return _;if(n.includes(h))throw new OT({argument:"separator",message:`The separator "${h}" must not be part of the alphabet "${n}".`});return T=>`${r}${h}${_(T)}`};Zf();var gy=Symbol.for("vercel.ai.validator");function GT(r){return{[gy]:!0,validate:r}}function qT(r){return typeof r=="object"&&r!==null&&gy in r&&r[gy]===!0&&"validate"in r}function $T(r){return qT(r)?r:HT(r)}function HT(r){return GT(e=>{const n=r.safeParse(e);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}})}function y1({value:r,schema:e}){const n=$T(e);try{if(n.validate==null)return{success:!0,value:r};const h=n.validate(r);return h.success?h:{success:!1,error:Ob.wrap({value:r,cause:h.error})}}catch(h){return{success:!1,error:Ob.wrap({value:r,cause:h})}}}function n0({text:r,schema:e}){try{const n=VT.parse(r);if(e==null)return{success:!0,value:n,rawValue:n};const h=y1({value:n,schema:e});return h.success?{...h,rawValue:n}:h}catch(n){return{success:!1,error:kb.isInstance(n)?n:new kb({text:r,cause:n})}}}var hn;(function(r){r.assertEqual=_=>{};function e(_){}r.assertIs=e;function n(_){throw new Error}r.assertNever=n,r.arrayToEnum=_=>{const T={};for(const S of _)T[S]=S;return T},r.getValidEnumValues=_=>{const T=r.objectKeys(_).filter(u=>typeof _[_[u]]!="number"),S={};for(const u of T)S[u]=_[u];return r.objectValues(S)},r.objectValues=_=>r.objectKeys(_).map(function(T){return _[T]}),r.objectKeys=typeof Object.keys=="function"?_=>Object.keys(_):_=>{const T=[];for(const S in _)Object.prototype.hasOwnProperty.call(_,S)&&T.push(S);return T},r.find=(_,T)=>{for(const S of _)if(T(S))return S},r.isInteger=typeof Number.isInteger=="function"?_=>Number.isInteger(_):_=>typeof _=="number"&&Number.isFinite(_)&&Math.floor(_)===_;function h(_,T=" | "){return _.map(S=>typeof S=="string"?`'${S}'`:S).join(T)}r.joinValues=h,r.jsonStringifyReplacer=(_,T)=>typeof T=="bigint"?T.toString():T})(hn||(hn={}));var Lb;(function(r){r.mergeShapes=(e,n)=>({...e,...n})})(Lb||(Lb={}));const Yt=hn.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Ed=r=>{switch(typeof r){case"undefined":return Yt.undefined;case"string":return Yt.string;case"number":return Number.isNaN(r)?Yt.nan:Yt.number;case"boolean":return Yt.boolean;case"function":return Yt.function;case"bigint":return Yt.bigint;case"symbol":return Yt.symbol;case"object":return Array.isArray(r)?Yt.array:r===null?Yt.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?Yt.promise:typeof Map<"u"&&r instanceof Map?Yt.map:typeof Set<"u"&&r instanceof Set?Yt.set:typeof Date<"u"&&r instanceof Date?Yt.date:Yt.object;default:return Yt.unknown}},Et=hn.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class vh extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=h=>{this.issues=[...this.issues,h]},this.addIssues=(h=[])=>{this.issues=[...this.issues,...h]};const n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=e}format(e){const n=e||function(T){return T.message},h={_errors:[]},_=T=>{for(const S of T.issues)if(S.code==="invalid_union")S.unionErrors.map(_);else if(S.code==="invalid_return_type")_(S.returnTypeError);else if(S.code==="invalid_arguments")_(S.argumentsError);else if(S.path.length===0)h._errors.push(n(S));else{let u=h,k=0;for(;k<S.path.length;){const B=S.path[k];k===S.path.length-1?(u[B]=u[B]||{_errors:[]},u[B]._errors.push(n(S))):u[B]=u[B]||{_errors:[]},u=u[B],k++}}};return _(this),h}static assert(e){if(!(e instanceof vh))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,hn.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=n=>n.message){const n={},h=[];for(const _ of this.issues)_.path.length>0?(n[_.path[0]]=n[_.path[0]]||[],n[_.path[0]].push(e(_))):h.push(e(_));return{formErrors:h,fieldErrors:n}}get formErrors(){return this.flatten()}}vh.create=r=>new vh(r);const r0=(r,e)=>{let n;switch(r.code){case Et.invalid_type:r.received===Yt.undefined?n="Required":n=`Expected ${r.expected}, received ${r.received}`;break;case Et.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(r.expected,hn.jsonStringifyReplacer)}`;break;case Et.unrecognized_keys:n=`Unrecognized key(s) in object: ${hn.joinValues(r.keys,", ")}`;break;case Et.invalid_union:n="Invalid input";break;case Et.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${hn.joinValues(r.options)}`;break;case Et.invalid_enum_value:n=`Invalid enum value. Expected ${hn.joinValues(r.options)}, received '${r.received}'`;break;case Et.invalid_arguments:n="Invalid function arguments";break;case Et.invalid_return_type:n="Invalid function return type";break;case Et.invalid_date:n="Invalid date";break;case Et.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(n=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?n=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?n=`Invalid input: must end with "${r.validation.endsWith}"`:hn.assertNever(r.validation):r.validation!=="regex"?n=`Invalid ${r.validation}`:n="Invalid";break;case Et.too_small:r.type==="array"?n=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?n=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?n=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?n=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:n="Invalid input";break;case Et.too_big:r.type==="array"?n=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?n=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?n=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?n=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?n=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:n="Invalid input";break;case Et.custom:n="Invalid input";break;case Et.invalid_intersection_types:n="Intersection results could not be merged";break;case Et.not_multiple_of:n=`Number must be a multiple of ${r.multipleOf}`;break;case Et.not_finite:n="Number must be finite";break;default:n=e.defaultError,hn.assertNever(r)}return{message:n}};let YT=r0;function XT(){return YT}const KT=r=>{const{data:e,path:n,errorMaps:h,issueData:_}=r,T=[...n,..._.path||[]],S={..._,path:T};if(_.message!==void 0)return{..._,path:T,message:_.message};let u="";const k=h.filter(B=>!!B).slice().reverse();for(const B of k)u=B(S,{data:e,defaultError:u}).message;return{..._,path:T,message:u}};function jt(r,e){const n=XT(),h=KT({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,n,n===r0?void 0:r0].filter(_=>!!_)});r.common.issues.push(h)}class Ms{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,n){const h=[];for(const _ of n){if(_.status==="aborted")return Ai;_.status==="dirty"&&e.dirty(),h.push(_.value)}return{status:e.value,value:h}}static async mergeObjectAsync(e,n){const h=[];for(const _ of n){const T=await _.key,S=await _.value;h.push({key:T,value:S})}return Ms.mergeObjectSync(e,h)}static mergeObjectSync(e,n){const h={};for(const _ of n){const{key:T,value:S}=_;if(T.status==="aborted"||S.status==="aborted")return Ai;T.status==="dirty"&&e.dirty(),S.status==="dirty"&&e.dirty(),T.value!=="__proto__"&&(typeof S.value<"u"||_.alwaysSet)&&(h[T.value]=S.value)}return{status:e.value,value:h}}}const Ai=Object.freeze({status:"aborted"}),Ig=r=>({status:"dirty",value:r}),_l=r=>({status:"valid",value:r}),Fb=r=>r.status==="aborted",Nb=r=>r.status==="dirty",um=r=>r.status==="valid",_y=r=>typeof Promise<"u"&&r instanceof Promise;var Wt;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(Wt||(Wt={}));class au{constructor(e,n,h,_){this._cachedPath=[],this.parent=e,this.data=n,this._path=h,this._key=_}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Ub=(r,e)=>{if(um(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const n=new vh(r.common.issues);return this._error=n,this._error}}};function ji(r){if(!r)return{};const{errorMap:e,invalid_type_error:n,required_error:h,description:_}=r;if(e&&(n||h))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:_}:{errorMap:(S,u)=>{const{message:k}=r;return S.code==="invalid_enum_value"?{message:k??u.defaultError}:typeof u.data>"u"?{message:k??h??u.defaultError}:S.code!=="invalid_type"?{message:u.defaultError}:{message:k??n??u.defaultError}},description:_}}class Ji{get description(){return this._def.description}_getType(e){return Ed(e.data)}_getOrReturnCtx(e,n){return n||{common:e.parent.common,data:e.data,parsedType:Ed(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ms,ctx:{common:e.parent.common,data:e.data,parsedType:Ed(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const n=this._parse(e);if(_y(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(e){const n=this._parse(e);return Promise.resolve(n)}parse(e,n){const h=this.safeParse(e,n);if(h.success)return h.data;throw h.error}safeParse(e,n){const h={common:{issues:[],async:(n==null?void 0:n.async)??!1,contextualErrorMap:n==null?void 0:n.errorMap},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ed(e)},_=this._parseSync({data:e,path:h.path,parent:h});return Ub(h,_)}"~validate"(e){var h,_;const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ed(e)};if(!this["~standard"].async)try{const T=this._parseSync({data:e,path:[],parent:n});return um(T)?{value:T.value}:{issues:n.common.issues}}catch(T){(_=(h=T==null?void 0:T.message)==null?void 0:h.toLowerCase())!=null&&_.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(T=>um(T)?{value:T.value}:{issues:n.common.issues})}async parseAsync(e,n){const h=await this.safeParseAsync(e,n);if(h.success)return h.data;throw h.error}async safeParseAsync(e,n){const h={common:{issues:[],contextualErrorMap:n==null?void 0:n.errorMap,async:!0},path:(n==null?void 0:n.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ed(e)},_=this._parse({data:e,path:h.path,parent:h}),T=await(_y(_)?_:Promise.resolve(_));return Ub(h,T)}refine(e,n){const h=_=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(_):n;return this._refinement((_,T)=>{const S=e(_),u=()=>T.addIssue({code:Et.custom,...h(_)});return typeof Promise<"u"&&S instanceof Promise?S.then(k=>k?!0:(u(),!1)):S?!0:(u(),!1)})}refinement(e,n){return this._refinement((h,_)=>e(h)?!0:(_.addIssue(typeof n=="function"?n(h,_):n),!1))}_refinement(e){return new fm({schema:this,typeName:At.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return _h.create(this,this._def)}nullable(){return pm.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ru.create(this)}promise(){return wy.create(this,this._def)}or(e){return vy.create([this,e],this._def)}and(e){return by.create(this,e,this._def)}transform(e){return new fm({...ji(this._def),schema:this,typeName:At.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const n=typeof e=="function"?e:()=>e;return new h0({...ji(this._def),innerType:this,defaultValue:n,typeName:At.ZodDefault})}brand(){return new vE({typeName:At.ZodBranded,type:this,...ji(this._def)})}catch(e){const n=typeof e=="function"?e:()=>e;return new d0({...ji(this._def),innerType:this,catchValue:n,typeName:At.ZodCatch})}describe(e){const n=this.constructor;return new n({...this._def,description:e})}pipe(e){return U0.create(this,e)}readonly(){return f0.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const WT=/^c[^\s-]{8,}$/i,QT=/^[0-9a-z]+$/,JT=/^[0-9A-HJKMNP-TV-Z]{26}$/i,eE=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,tE=/^[a-z0-9_-]{21}$/i,iE=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,nE=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,rE=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,aE="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Cv;const sE=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,oE=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,lE=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,cE=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,uE=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,hE=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,v1="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",dE=new RegExp(`^${v1}$`);function b1(r){let e="[0-5]\\d";r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`);const n=r.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${n}`}function fE(r){return new RegExp(`^${b1(r)}$`)}function pE(r){let e=`${v1}T${b1(r)}`;const n=[];return n.push(r.local?"Z?":"Z"),r.offset&&n.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${n.join("|")})`,new RegExp(`^${e}$`)}function mE(r,e){return!!((e==="v4"||!e)&&sE.test(r)||(e==="v6"||!e)&&lE.test(r))}function gE(r,e){if(!iE.test(r))return!1;try{const[n]=r.split("."),h=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),_=JSON.parse(atob(h));return!(typeof _!="object"||_===null||"typ"in _&&(_==null?void 0:_.typ)!=="JWT"||!_.alg||e&&_.alg!==e)}catch{return!1}}function _E(r,e){return!!((e==="v4"||!e)&&oE.test(r)||(e==="v6"||!e)&&cE.test(r))}class mh extends Ji{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==Yt.string){const T=this._getOrReturnCtx(e);return jt(T,{code:Et.invalid_type,expected:Yt.string,received:T.parsedType}),Ai}const h=new Ms;let _;for(const T of this._def.checks)if(T.kind==="min")e.data.length<T.value&&(_=this._getOrReturnCtx(e,_),jt(_,{code:Et.too_small,minimum:T.value,type:"string",inclusive:!0,exact:!1,message:T.message}),h.dirty());else if(T.kind==="max")e.data.length>T.value&&(_=this._getOrReturnCtx(e,_),jt(_,{code:Et.too_big,maximum:T.value,type:"string",inclusive:!0,exact:!1,message:T.message}),h.dirty());else if(T.kind==="length"){const S=e.data.length>T.value,u=e.data.length<T.value;(S||u)&&(_=this._getOrReturnCtx(e,_),S?jt(_,{code:Et.too_big,maximum:T.value,type:"string",inclusive:!0,exact:!0,message:T.message}):u&&jt(_,{code:Et.too_small,minimum:T.value,type:"string",inclusive:!0,exact:!0,message:T.message}),h.dirty())}else if(T.kind==="email")rE.test(e.data)||(_=this._getOrReturnCtx(e,_),jt(_,{validation:"email",code:Et.invalid_string,message:T.message}),h.dirty());else if(T.kind==="emoji")Cv||(Cv=new RegExp(aE,"u")),Cv.test(e.data)||(_=this._getOrReturnCtx(e,_),jt(_,{validation:"emoji",code:Et.invalid_string,message:T.message}),h.dirty());else if(T.kind==="uuid")eE.test(e.data)||(_=this._getOrReturnCtx(e,_),jt(_,{validation:"uuid",code:Et.invalid_string,message:T.message}),h.dirty());else if(T.kind==="nanoid")tE.test(e.data)||(_=this._getOrReturnCtx(e,_),jt(_,{validation:"nanoid",code:Et.invalid_string,message:T.message}),h.dirty());else if(T.kind==="cuid")WT.test(e.data)||(_=this._getOrReturnCtx(e,_),jt(_,{validation:"cuid",code:Et.invalid_string,message:T.message}),h.dirty());else if(T.kind==="cuid2")QT.test(e.data)||(_=this._getOrReturnCtx(e,_),jt(_,{validation:"cuid2",code:Et.invalid_string,message:T.message}),h.dirty());else if(T.kind==="ulid")JT.test(e.data)||(_=this._getOrReturnCtx(e,_),jt(_,{validation:"ulid",code:Et.invalid_string,message:T.message}),h.dirty());else if(T.kind==="url")try{new URL(e.data)}catch{_=this._getOrReturnCtx(e,_),jt(_,{validation:"url",code:Et.invalid_string,message:T.message}),h.dirty()}else T.kind==="regex"?(T.regex.lastIndex=0,T.regex.test(e.data)||(_=this._getOrReturnCtx(e,_),jt(_,{validation:"regex",code:Et.invalid_string,message:T.message}),h.dirty())):T.kind==="trim"?e.data=e.data.trim():T.kind==="includes"?e.data.includes(T.value,T.position)||(_=this._getOrReturnCtx(e,_),jt(_,{code:Et.invalid_string,validation:{includes:T.value,position:T.position},message:T.message}),h.dirty()):T.kind==="toLowerCase"?e.data=e.data.toLowerCase():T.kind==="toUpperCase"?e.data=e.data.toUpperCase():T.kind==="startsWith"?e.data.startsWith(T.value)||(_=this._getOrReturnCtx(e,_),jt(_,{code:Et.invalid_string,validation:{startsWith:T.value},message:T.message}),h.dirty()):T.kind==="endsWith"?e.data.endsWith(T.value)||(_=this._getOrReturnCtx(e,_),jt(_,{code:Et.invalid_string,validation:{endsWith:T.value},message:T.message}),h.dirty()):T.kind==="datetime"?pE(T).test(e.data)||(_=this._getOrReturnCtx(e,_),jt(_,{code:Et.invalid_string,validation:"datetime",message:T.message}),h.dirty()):T.kind==="date"?dE.test(e.data)||(_=this._getOrReturnCtx(e,_),jt(_,{code:Et.invalid_string,validation:"date",message:T.message}),h.dirty()):T.kind==="time"?fE(T).test(e.data)||(_=this._getOrReturnCtx(e,_),jt(_,{code:Et.invalid_string,validation:"time",message:T.message}),h.dirty()):T.kind==="duration"?nE.test(e.data)||(_=this._getOrReturnCtx(e,_),jt(_,{validation:"duration",code:Et.invalid_string,message:T.message}),h.dirty()):T.kind==="ip"?mE(e.data,T.version)||(_=this._getOrReturnCtx(e,_),jt(_,{validation:"ip",code:Et.invalid_string,message:T.message}),h.dirty()):T.kind==="jwt"?gE(e.data,T.alg)||(_=this._getOrReturnCtx(e,_),jt(_,{validation:"jwt",code:Et.invalid_string,message:T.message}),h.dirty()):T.kind==="cidr"?_E(e.data,T.version)||(_=this._getOrReturnCtx(e,_),jt(_,{validation:"cidr",code:Et.invalid_string,message:T.message}),h.dirty()):T.kind==="base64"?uE.test(e.data)||(_=this._getOrReturnCtx(e,_),jt(_,{validation:"base64",code:Et.invalid_string,message:T.message}),h.dirty()):T.kind==="base64url"?hE.test(e.data)||(_=this._getOrReturnCtx(e,_),jt(_,{validation:"base64url",code:Et.invalid_string,message:T.message}),h.dirty()):hn.assertNever(T);return{status:h.value,value:e.data}}_regex(e,n,h){return this.refinement(_=>e.test(_),{validation:n,code:Et.invalid_string,...Wt.errToObj(h)})}_addCheck(e){return new mh({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Wt.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Wt.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Wt.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Wt.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...Wt.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Wt.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Wt.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Wt.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...Wt.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...Wt.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...Wt.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Wt.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...Wt.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...Wt.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...Wt.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...Wt.errToObj(e)})}regex(e,n){return this._addCheck({kind:"regex",regex:e,...Wt.errToObj(n)})}includes(e,n){return this._addCheck({kind:"includes",value:e,position:n==null?void 0:n.position,...Wt.errToObj(n==null?void 0:n.message)})}startsWith(e,n){return this._addCheck({kind:"startsWith",value:e,...Wt.errToObj(n)})}endsWith(e,n){return this._addCheck({kind:"endsWith",value:e,...Wt.errToObj(n)})}min(e,n){return this._addCheck({kind:"min",value:e,...Wt.errToObj(n)})}max(e,n){return this._addCheck({kind:"max",value:e,...Wt.errToObj(n)})}length(e,n){return this._addCheck({kind:"length",value:e,...Wt.errToObj(n)})}nonempty(e){return this.min(1,Wt.errToObj(e))}trim(){return new mh({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new mh({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new mh({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxLength(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}mh.create=r=>new mh({checks:[],typeName:At.ZodString,coerce:(r==null?void 0:r.coerce)??!1,...ji(r)});function yE(r,e){const n=(r.toString().split(".")[1]||"").length,h=(e.toString().split(".")[1]||"").length,_=n>h?n:h,T=Number.parseInt(r.toFixed(_).replace(".","")),S=Number.parseInt(e.toFixed(_).replace(".",""));return T%S/10**_}class hm extends Ji{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==Yt.number){const T=this._getOrReturnCtx(e);return jt(T,{code:Et.invalid_type,expected:Yt.number,received:T.parsedType}),Ai}let h;const _=new Ms;for(const T of this._def.checks)T.kind==="int"?hn.isInteger(e.data)||(h=this._getOrReturnCtx(e,h),jt(h,{code:Et.invalid_type,expected:"integer",received:"float",message:T.message}),_.dirty()):T.kind==="min"?(T.inclusive?e.data<T.value:e.data<=T.value)&&(h=this._getOrReturnCtx(e,h),jt(h,{code:Et.too_small,minimum:T.value,type:"number",inclusive:T.inclusive,exact:!1,message:T.message}),_.dirty()):T.kind==="max"?(T.inclusive?e.data>T.value:e.data>=T.value)&&(h=this._getOrReturnCtx(e,h),jt(h,{code:Et.too_big,maximum:T.value,type:"number",inclusive:T.inclusive,exact:!1,message:T.message}),_.dirty()):T.kind==="multipleOf"?yE(e.data,T.value)!==0&&(h=this._getOrReturnCtx(e,h),jt(h,{code:Et.not_multiple_of,multipleOf:T.value,message:T.message}),_.dirty()):T.kind==="finite"?Number.isFinite(e.data)||(h=this._getOrReturnCtx(e,h),jt(h,{code:Et.not_finite,message:T.message}),_.dirty()):hn.assertNever(T);return{status:_.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,Wt.toString(n))}gt(e,n){return this.setLimit("min",e,!1,Wt.toString(n))}lte(e,n){return this.setLimit("max",e,!0,Wt.toString(n))}lt(e,n){return this.setLimit("max",e,!1,Wt.toString(n))}setLimit(e,n,h,_){return new hm({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:h,message:Wt.toString(_)}]})}_addCheck(e){return new hm({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Wt.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Wt.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Wt.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Wt.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Wt.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:Wt.toString(n)})}finite(e){return this._addCheck({kind:"finite",message:Wt.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Wt.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Wt.toString(e)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&hn.isInteger(e.value))}get isFinite(){let e=null,n=null;for(const h of this._def.checks){if(h.kind==="finite"||h.kind==="int"||h.kind==="multipleOf")return!0;h.kind==="min"?(n===null||h.value>n)&&(n=h.value):h.kind==="max"&&(e===null||h.value<e)&&(e=h.value)}return Number.isFinite(n)&&Number.isFinite(e)}}hm.create=r=>new hm({checks:[],typeName:At.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1,...ji(r)});class Ng extends Ji{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==Yt.bigint)return this._getInvalidInput(e);let h;const _=new Ms;for(const T of this._def.checks)T.kind==="min"?(T.inclusive?e.data<T.value:e.data<=T.value)&&(h=this._getOrReturnCtx(e,h),jt(h,{code:Et.too_small,type:"bigint",minimum:T.value,inclusive:T.inclusive,message:T.message}),_.dirty()):T.kind==="max"?(T.inclusive?e.data>T.value:e.data>=T.value)&&(h=this._getOrReturnCtx(e,h),jt(h,{code:Et.too_big,type:"bigint",maximum:T.value,inclusive:T.inclusive,message:T.message}),_.dirty()):T.kind==="multipleOf"?e.data%T.value!==BigInt(0)&&(h=this._getOrReturnCtx(e,h),jt(h,{code:Et.not_multiple_of,multipleOf:T.value,message:T.message}),_.dirty()):hn.assertNever(T);return{status:_.value,value:e.data}}_getInvalidInput(e){const n=this._getOrReturnCtx(e);return jt(n,{code:Et.invalid_type,expected:Yt.bigint,received:n.parsedType}),Ai}gte(e,n){return this.setLimit("min",e,!0,Wt.toString(n))}gt(e,n){return this.setLimit("min",e,!1,Wt.toString(n))}lte(e,n){return this.setLimit("max",e,!0,Wt.toString(n))}lt(e,n){return this.setLimit("max",e,!1,Wt.toString(n))}setLimit(e,n,h,_){return new Ng({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:h,message:Wt.toString(_)}]})}_addCheck(e){return new Ng({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Wt.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Wt.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Wt.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Wt.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:Wt.toString(n)})}get minValue(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}}Ng.create=r=>new Ng({checks:[],typeName:At.ZodBigInt,coerce:(r==null?void 0:r.coerce)??!1,...ji(r)});class a0 extends Ji{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==Yt.boolean){const h=this._getOrReturnCtx(e);return jt(h,{code:Et.invalid_type,expected:Yt.boolean,received:h.parsedType}),Ai}return _l(e.data)}}a0.create=r=>new a0({typeName:At.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1,...ji(r)});class yy extends Ji{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==Yt.date){const T=this._getOrReturnCtx(e);return jt(T,{code:Et.invalid_type,expected:Yt.date,received:T.parsedType}),Ai}if(Number.isNaN(e.data.getTime())){const T=this._getOrReturnCtx(e);return jt(T,{code:Et.invalid_date}),Ai}const h=new Ms;let _;for(const T of this._def.checks)T.kind==="min"?e.data.getTime()<T.value&&(_=this._getOrReturnCtx(e,_),jt(_,{code:Et.too_small,message:T.message,inclusive:!0,exact:!1,minimum:T.value,type:"date"}),h.dirty()):T.kind==="max"?e.data.getTime()>T.value&&(_=this._getOrReturnCtx(e,_),jt(_,{code:Et.too_big,message:T.message,inclusive:!0,exact:!1,maximum:T.value,type:"date"}),h.dirty()):hn.assertNever(T);return{status:h.value,value:new Date(e.data.getTime())}}_addCheck(e){return new yy({...this._def,checks:[...this._def.checks,e]})}min(e,n){return this._addCheck({kind:"min",value:e.getTime(),message:Wt.toString(n)})}max(e,n){return this._addCheck({kind:"max",value:e.getTime(),message:Wt.toString(n)})}get minDate(){let e=null;for(const n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e!=null?new Date(e):null}}yy.create=r=>new yy({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:At.ZodDate,...ji(r)});class jb extends Ji{_parse(e){if(this._getType(e)!==Yt.symbol){const h=this._getOrReturnCtx(e);return jt(h,{code:Et.invalid_type,expected:Yt.symbol,received:h.parsedType}),Ai}return _l(e.data)}}jb.create=r=>new jb({typeName:At.ZodSymbol,...ji(r)});class Vb extends Ji{_parse(e){if(this._getType(e)!==Yt.undefined){const h=this._getOrReturnCtx(e);return jt(h,{code:Et.invalid_type,expected:Yt.undefined,received:h.parsedType}),Ai}return _l(e.data)}}Vb.create=r=>new Vb({typeName:At.ZodUndefined,...ji(r)});class s0 extends Ji{_parse(e){if(this._getType(e)!==Yt.null){const h=this._getOrReturnCtx(e);return jt(h,{code:Et.invalid_type,expected:Yt.null,received:h.parsedType}),Ai}return _l(e.data)}}s0.create=r=>new s0({typeName:At.ZodNull,...ji(r)});class Ug extends Ji{constructor(){super(...arguments),this._any=!0}_parse(e){return _l(e.data)}}Ug.create=r=>new Ug({typeName:At.ZodAny,...ji(r)});class o0 extends Ji{constructor(){super(...arguments),this._unknown=!0}_parse(e){return _l(e.data)}}o0.create=r=>new o0({typeName:At.ZodUnknown,...ji(r)});class Cd extends Ji{_parse(e){const n=this._getOrReturnCtx(e);return jt(n,{code:Et.invalid_type,expected:Yt.never,received:n.parsedType}),Ai}}Cd.create=r=>new Cd({typeName:At.ZodNever,...ji(r)});class Zb extends Ji{_parse(e){if(this._getType(e)!==Yt.undefined){const h=this._getOrReturnCtx(e);return jt(h,{code:Et.invalid_type,expected:Yt.void,received:h.parsedType}),Ai}return _l(e.data)}}Zb.create=r=>new Zb({typeName:At.ZodVoid,...ji(r)});class ru extends Ji{_parse(e){const{ctx:n,status:h}=this._processInputParams(e),_=this._def;if(n.parsedType!==Yt.array)return jt(n,{code:Et.invalid_type,expected:Yt.array,received:n.parsedType}),Ai;if(_.exactLength!==null){const S=n.data.length>_.exactLength.value,u=n.data.length<_.exactLength.value;(S||u)&&(jt(n,{code:S?Et.too_big:Et.too_small,minimum:u?_.exactLength.value:void 0,maximum:S?_.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:_.exactLength.message}),h.dirty())}if(_.minLength!==null&&n.data.length<_.minLength.value&&(jt(n,{code:Et.too_small,minimum:_.minLength.value,type:"array",inclusive:!0,exact:!1,message:_.minLength.message}),h.dirty()),_.maxLength!==null&&n.data.length>_.maxLength.value&&(jt(n,{code:Et.too_big,maximum:_.maxLength.value,type:"array",inclusive:!0,exact:!1,message:_.maxLength.message}),h.dirty()),n.common.async)return Promise.all([...n.data].map((S,u)=>_.type._parseAsync(new au(n,S,n.path,u)))).then(S=>Ms.mergeArray(h,S));const T=[...n.data].map((S,u)=>_.type._parseSync(new au(n,S,n.path,u)));return Ms.mergeArray(h,T)}get element(){return this._def.type}min(e,n){return new ru({...this._def,minLength:{value:e,message:Wt.toString(n)}})}max(e,n){return new ru({...this._def,maxLength:{value:e,message:Wt.toString(n)}})}length(e,n){return new ru({...this._def,exactLength:{value:e,message:Wt.toString(n)}})}nonempty(e){return this.min(1,e)}}ru.create=(r,e)=>new ru({type:r,minLength:null,maxLength:null,exactLength:null,typeName:At.ZodArray,...ji(e)});function Hp(r){if(r instanceof ea){const e={};for(const n in r.shape){const h=r.shape[n];e[n]=_h.create(Hp(h))}return new ea({...r._def,shape:()=>e})}else return r instanceof ru?new ru({...r._def,type:Hp(r.element)}):r instanceof _h?_h.create(Hp(r.unwrap())):r instanceof pm?pm.create(Hp(r.unwrap())):r instanceof Nf?Nf.create(r.items.map(e=>Hp(e))):r}class ea extends Ji{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),n=hn.objectKeys(e);return this._cached={shape:e,keys:n},this._cached}_parse(e){if(this._getType(e)!==Yt.object){const B=this._getOrReturnCtx(e);return jt(B,{code:Et.invalid_type,expected:Yt.object,received:B.parsedType}),Ai}const{status:h,ctx:_}=this._processInputParams(e),{shape:T,keys:S}=this._getCached(),u=[];if(!(this._def.catchall instanceof Cd&&this._def.unknownKeys==="strip"))for(const B in _.data)S.includes(B)||u.push(B);const k=[];for(const B of S){const q=T[B],oe=_.data[B];k.push({key:{status:"valid",value:B},value:q._parse(new au(_,oe,_.path,B)),alwaysSet:B in _.data})}if(this._def.catchall instanceof Cd){const B=this._def.unknownKeys;if(B==="passthrough")for(const q of u)k.push({key:{status:"valid",value:q},value:{status:"valid",value:_.data[q]}});else if(B==="strict")u.length>0&&(jt(_,{code:Et.unrecognized_keys,keys:u}),h.dirty());else if(B!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const B=this._def.catchall;for(const q of u){const oe=_.data[q];k.push({key:{status:"valid",value:q},value:B._parse(new au(_,oe,_.path,q)),alwaysSet:q in _.data})}}return _.common.async?Promise.resolve().then(async()=>{const B=[];for(const q of k){const oe=await q.key,ne=await q.value;B.push({key:oe,value:ne,alwaysSet:q.alwaysSet})}return B}).then(B=>Ms.mergeObjectSync(h,B)):Ms.mergeObjectSync(h,k)}get shape(){return this._def.shape()}strict(e){return Wt.errToObj,new ea({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(n,h)=>{var T,S;const _=((S=(T=this._def).errorMap)==null?void 0:S.call(T,n,h).message)??h.defaultError;return n.code==="unrecognized_keys"?{message:Wt.errToObj(e).message??_}:{message:_}}}:{}})}strip(){return new ea({...this._def,unknownKeys:"strip"})}passthrough(){return new ea({...this._def,unknownKeys:"passthrough"})}extend(e){return new ea({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ea({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:At.ZodObject})}setKey(e,n){return this.augment({[e]:n})}catchall(e){return new ea({...this._def,catchall:e})}pick(e){const n={};for(const h of hn.objectKeys(e))e[h]&&this.shape[h]&&(n[h]=this.shape[h]);return new ea({...this._def,shape:()=>n})}omit(e){const n={};for(const h of hn.objectKeys(this.shape))e[h]||(n[h]=this.shape[h]);return new ea({...this._def,shape:()=>n})}deepPartial(){return Hp(this)}partial(e){const n={};for(const h of hn.objectKeys(this.shape)){const _=this.shape[h];e&&!e[h]?n[h]=_:n[h]=_.optional()}return new ea({...this._def,shape:()=>n})}required(e){const n={};for(const h of hn.objectKeys(this.shape))if(e&&!e[h])n[h]=this.shape[h];else{let T=this.shape[h];for(;T instanceof _h;)T=T._def.innerType;n[h]=T}return new ea({...this._def,shape:()=>n})}keyof(){return x1(hn.objectKeys(this.shape))}}ea.create=(r,e)=>new ea({shape:()=>r,unknownKeys:"strip",catchall:Cd.create(),typeName:At.ZodObject,...ji(e)});ea.strictCreate=(r,e)=>new ea({shape:()=>r,unknownKeys:"strict",catchall:Cd.create(),typeName:At.ZodObject,...ji(e)});ea.lazycreate=(r,e)=>new ea({shape:r,unknownKeys:"strip",catchall:Cd.create(),typeName:At.ZodObject,...ji(e)});class vy extends Ji{_parse(e){const{ctx:n}=this._processInputParams(e),h=this._def.options;function _(T){for(const u of T)if(u.result.status==="valid")return u.result;for(const u of T)if(u.result.status==="dirty")return n.common.issues.push(...u.ctx.common.issues),u.result;const S=T.map(u=>new vh(u.ctx.common.issues));return jt(n,{code:Et.invalid_union,unionErrors:S}),Ai}if(n.common.async)return Promise.all(h.map(async T=>{const S={...n,common:{...n.common,issues:[]},parent:null};return{result:await T._parseAsync({data:n.data,path:n.path,parent:S}),ctx:S}})).then(_);{let T;const S=[];for(const k of h){const B={...n,common:{...n.common,issues:[]},parent:null},q=k._parseSync({data:n.data,path:n.path,parent:B});if(q.status==="valid")return q;q.status==="dirty"&&!T&&(T={result:q,ctx:B}),B.common.issues.length&&S.push(B.common.issues)}if(T)return n.common.issues.push(...T.ctx.common.issues),T.result;const u=S.map(k=>new vh(k));return jt(n,{code:Et.invalid_union,unionErrors:u}),Ai}}get options(){return this._def.options}}vy.create=(r,e)=>new vy({options:r,typeName:At.ZodUnion,...ji(e)});function l0(r,e){const n=Ed(r),h=Ed(e);if(r===e)return{valid:!0,data:r};if(n===Yt.object&&h===Yt.object){const _=hn.objectKeys(e),T=hn.objectKeys(r).filter(u=>_.indexOf(u)!==-1),S={...r,...e};for(const u of T){const k=l0(r[u],e[u]);if(!k.valid)return{valid:!1};S[u]=k.data}return{valid:!0,data:S}}else if(n===Yt.array&&h===Yt.array){if(r.length!==e.length)return{valid:!1};const _=[];for(let T=0;T<r.length;T++){const S=r[T],u=e[T],k=l0(S,u);if(!k.valid)return{valid:!1};_.push(k.data)}return{valid:!0,data:_}}else return n===Yt.date&&h===Yt.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}class by extends Ji{_parse(e){const{status:n,ctx:h}=this._processInputParams(e),_=(T,S)=>{if(Fb(T)||Fb(S))return Ai;const u=l0(T.value,S.value);return u.valid?((Nb(T)||Nb(S))&&n.dirty(),{status:n.value,value:u.data}):(jt(h,{code:Et.invalid_intersection_types}),Ai)};return h.common.async?Promise.all([this._def.left._parseAsync({data:h.data,path:h.path,parent:h}),this._def.right._parseAsync({data:h.data,path:h.path,parent:h})]).then(([T,S])=>_(T,S)):_(this._def.left._parseSync({data:h.data,path:h.path,parent:h}),this._def.right._parseSync({data:h.data,path:h.path,parent:h}))}}by.create=(r,e,n)=>new by({left:r,right:e,typeName:At.ZodIntersection,...ji(n)});class Nf extends Ji{_parse(e){const{status:n,ctx:h}=this._processInputParams(e);if(h.parsedType!==Yt.array)return jt(h,{code:Et.invalid_type,expected:Yt.array,received:h.parsedType}),Ai;if(h.data.length<this._def.items.length)return jt(h,{code:Et.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Ai;!this._def.rest&&h.data.length>this._def.items.length&&(jt(h,{code:Et.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());const T=[...h.data].map((S,u)=>{const k=this._def.items[u]||this._def.rest;return k?k._parse(new au(h,S,h.path,u)):null}).filter(S=>!!S);return h.common.async?Promise.all(T).then(S=>Ms.mergeArray(n,S)):Ms.mergeArray(n,T)}get items(){return this._def.items}rest(e){return new Nf({...this._def,rest:e})}}Nf.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Nf({items:r,typeName:At.ZodTuple,rest:null,...ji(e)})};class xy extends Ji{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:h}=this._processInputParams(e);if(h.parsedType!==Yt.object)return jt(h,{code:Et.invalid_type,expected:Yt.object,received:h.parsedType}),Ai;const _=[],T=this._def.keyType,S=this._def.valueType;for(const u in h.data)_.push({key:T._parse(new au(h,u,h.path,u)),value:S._parse(new au(h,h.data[u],h.path,u)),alwaysSet:u in h.data});return h.common.async?Ms.mergeObjectAsync(n,_):Ms.mergeObjectSync(n,_)}get element(){return this._def.valueType}static create(e,n,h){return n instanceof Ji?new xy({keyType:e,valueType:n,typeName:At.ZodRecord,...ji(h)}):new xy({keyType:mh.create(),valueType:e,typeName:At.ZodRecord,...ji(n)})}}class Gb extends Ji{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:n,ctx:h}=this._processInputParams(e);if(h.parsedType!==Yt.map)return jt(h,{code:Et.invalid_type,expected:Yt.map,received:h.parsedType}),Ai;const _=this._def.keyType,T=this._def.valueType,S=[...h.data.entries()].map(([u,k],B)=>({key:_._parse(new au(h,u,h.path,[B,"key"])),value:T._parse(new au(h,k,h.path,[B,"value"]))}));if(h.common.async){const u=new Map;return Promise.resolve().then(async()=>{for(const k of S){const B=await k.key,q=await k.value;if(B.status==="aborted"||q.status==="aborted")return Ai;(B.status==="dirty"||q.status==="dirty")&&n.dirty(),u.set(B.value,q.value)}return{status:n.value,value:u}})}else{const u=new Map;for(const k of S){const B=k.key,q=k.value;if(B.status==="aborted"||q.status==="aborted")return Ai;(B.status==="dirty"||q.status==="dirty")&&n.dirty(),u.set(B.value,q.value)}return{status:n.value,value:u}}}}Gb.create=(r,e,n)=>new Gb({valueType:e,keyType:r,typeName:At.ZodMap,...ji(n)});class jg extends Ji{_parse(e){const{status:n,ctx:h}=this._processInputParams(e);if(h.parsedType!==Yt.set)return jt(h,{code:Et.invalid_type,expected:Yt.set,received:h.parsedType}),Ai;const _=this._def;_.minSize!==null&&h.data.size<_.minSize.value&&(jt(h,{code:Et.too_small,minimum:_.minSize.value,type:"set",inclusive:!0,exact:!1,message:_.minSize.message}),n.dirty()),_.maxSize!==null&&h.data.size>_.maxSize.value&&(jt(h,{code:Et.too_big,maximum:_.maxSize.value,type:"set",inclusive:!0,exact:!1,message:_.maxSize.message}),n.dirty());const T=this._def.valueType;function S(k){const B=new Set;for(const q of k){if(q.status==="aborted")return Ai;q.status==="dirty"&&n.dirty(),B.add(q.value)}return{status:n.value,value:B}}const u=[...h.data.values()].map((k,B)=>T._parse(new au(h,k,h.path,B)));return h.common.async?Promise.all(u).then(k=>S(k)):S(u)}min(e,n){return new jg({...this._def,minSize:{value:e,message:Wt.toString(n)}})}max(e,n){return new jg({...this._def,maxSize:{value:e,message:Wt.toString(n)}})}size(e,n){return this.min(e,n).max(e,n)}nonempty(e){return this.min(1,e)}}jg.create=(r,e)=>new jg({valueType:r,minSize:null,maxSize:null,typeName:At.ZodSet,...ji(e)});class c0 extends Ji{get schema(){return this._def.getter()}_parse(e){const{ctx:n}=this._processInputParams(e);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}}c0.create=(r,e)=>new c0({getter:r,typeName:At.ZodLazy,...ji(e)});class u0 extends Ji{_parse(e){if(e.data!==this._def.value){const n=this._getOrReturnCtx(e);return jt(n,{received:n.data,code:Et.invalid_literal,expected:this._def.value}),Ai}return{status:"valid",value:e.data}}get value(){return this._def.value}}u0.create=(r,e)=>new u0({value:r,typeName:At.ZodLiteral,...ji(e)});function x1(r,e){return new dm({values:r,typeName:At.ZodEnum,...ji(e)})}class dm extends Ji{_parse(e){if(typeof e.data!="string"){const n=this._getOrReturnCtx(e),h=this._def.values;return jt(n,{expected:hn.joinValues(h),received:n.parsedType,code:Et.invalid_type}),Ai}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const n=this._getOrReturnCtx(e),h=this._def.values;return jt(n,{received:n.data,code:Et.invalid_enum_value,options:h}),Ai}return _l(e.data)}get options(){return this._def.values}get enum(){const e={};for(const n of this._def.values)e[n]=n;return e}get Values(){const e={};for(const n of this._def.values)e[n]=n;return e}get Enum(){const e={};for(const n of this._def.values)e[n]=n;return e}extract(e,n=this._def){return dm.create(e,{...this._def,...n})}exclude(e,n=this._def){return dm.create(this.options.filter(h=>!e.includes(h)),{...this._def,...n})}}dm.create=x1;class qb extends Ji{_parse(e){const n=hn.getValidEnumValues(this._def.values),h=this._getOrReturnCtx(e);if(h.parsedType!==Yt.string&&h.parsedType!==Yt.number){const _=hn.objectValues(n);return jt(h,{expected:hn.joinValues(_),received:h.parsedType,code:Et.invalid_type}),Ai}if(this._cache||(this._cache=new Set(hn.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const _=hn.objectValues(n);return jt(h,{received:h.data,code:Et.invalid_enum_value,options:_}),Ai}return _l(e.data)}get enum(){return this._def.values}}qb.create=(r,e)=>new qb({values:r,typeName:At.ZodNativeEnum,...ji(e)});class wy extends Ji{unwrap(){return this._def.type}_parse(e){const{ctx:n}=this._processInputParams(e);if(n.parsedType!==Yt.promise&&n.common.async===!1)return jt(n,{code:Et.invalid_type,expected:Yt.promise,received:n.parsedType}),Ai;const h=n.parsedType===Yt.promise?n.data:Promise.resolve(n.data);return _l(h.then(_=>this._def.type.parseAsync(_,{path:n.path,errorMap:n.common.contextualErrorMap})))}}wy.create=(r,e)=>new wy({type:r,typeName:At.ZodPromise,...ji(e)});class fm extends Ji{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===At.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:n,ctx:h}=this._processInputParams(e),_=this._def.effect||null,T={addIssue:S=>{jt(h,S),S.fatal?n.abort():n.dirty()},get path(){return h.path}};if(T.addIssue=T.addIssue.bind(T),_.type==="preprocess"){const S=_.transform(h.data,T);if(h.common.async)return Promise.resolve(S).then(async u=>{if(n.value==="aborted")return Ai;const k=await this._def.schema._parseAsync({data:u,path:h.path,parent:h});return k.status==="aborted"?Ai:k.status==="dirty"||n.value==="dirty"?Ig(k.value):k});{if(n.value==="aborted")return Ai;const u=this._def.schema._parseSync({data:S,path:h.path,parent:h});return u.status==="aborted"?Ai:u.status==="dirty"||n.value==="dirty"?Ig(u.value):u}}if(_.type==="refinement"){const S=u=>{const k=_.refinement(u,T);if(h.common.async)return Promise.resolve(k);if(k instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return u};if(h.common.async===!1){const u=this._def.schema._parseSync({data:h.data,path:h.path,parent:h});return u.status==="aborted"?Ai:(u.status==="dirty"&&n.dirty(),S(u.value),{status:n.value,value:u.value})}else return this._def.schema._parseAsync({data:h.data,path:h.path,parent:h}).then(u=>u.status==="aborted"?Ai:(u.status==="dirty"&&n.dirty(),S(u.value).then(()=>({status:n.value,value:u.value}))))}if(_.type==="transform")if(h.common.async===!1){const S=this._def.schema._parseSync({data:h.data,path:h.path,parent:h});if(!um(S))return Ai;const u=_.transform(S.value,T);if(u instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:u}}else return this._def.schema._parseAsync({data:h.data,path:h.path,parent:h}).then(S=>um(S)?Promise.resolve(_.transform(S.value,T)).then(u=>({status:n.value,value:u})):Ai);hn.assertNever(_)}}fm.create=(r,e,n)=>new fm({schema:r,typeName:At.ZodEffects,effect:e,...ji(n)});fm.createWithPreprocess=(r,e,n)=>new fm({schema:e,effect:{type:"preprocess",transform:r},typeName:At.ZodEffects,...ji(n)});class _h extends Ji{_parse(e){return this._getType(e)===Yt.undefined?_l(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}_h.create=(r,e)=>new _h({innerType:r,typeName:At.ZodOptional,...ji(e)});class pm extends Ji{_parse(e){return this._getType(e)===Yt.null?_l(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}pm.create=(r,e)=>new pm({innerType:r,typeName:At.ZodNullable,...ji(e)});class h0 extends Ji{_parse(e){const{ctx:n}=this._processInputParams(e);let h=n.data;return n.parsedType===Yt.undefined&&(h=this._def.defaultValue()),this._def.innerType._parse({data:h,path:n.path,parent:n})}removeDefault(){return this._def.innerType}}h0.create=(r,e)=>new h0({innerType:r,typeName:At.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...ji(e)});class d0 extends Ji{_parse(e){const{ctx:n}=this._processInputParams(e),h={...n,common:{...n.common,issues:[]}},_=this._def.innerType._parse({data:h.data,path:h.path,parent:{...h}});return _y(_)?_.then(T=>({status:"valid",value:T.status==="valid"?T.value:this._def.catchValue({get error(){return new vh(h.common.issues)},input:h.data})})):{status:"valid",value:_.status==="valid"?_.value:this._def.catchValue({get error(){return new vh(h.common.issues)},input:h.data})}}removeCatch(){return this._def.innerType}}d0.create=(r,e)=>new d0({innerType:r,typeName:At.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...ji(e)});class $b extends Ji{_parse(e){if(this._getType(e)!==Yt.nan){const h=this._getOrReturnCtx(e);return jt(h,{code:Et.invalid_type,expected:Yt.nan,received:h.parsedType}),Ai}return{status:"valid",value:e.data}}}$b.create=r=>new $b({typeName:At.ZodNaN,...ji(r)});class vE extends Ji{_parse(e){const{ctx:n}=this._processInputParams(e),h=n.data;return this._def.type._parse({data:h,path:n.path,parent:n})}unwrap(){return this._def.type}}class U0 extends Ji{_parse(e){const{status:n,ctx:h}=this._processInputParams(e);if(h.common.async)return(async()=>{const T=await this._def.in._parseAsync({data:h.data,path:h.path,parent:h});return T.status==="aborted"?Ai:T.status==="dirty"?(n.dirty(),Ig(T.value)):this._def.out._parseAsync({data:T.value,path:h.path,parent:h})})();{const _=this._def.in._parseSync({data:h.data,path:h.path,parent:h});return _.status==="aborted"?Ai:_.status==="dirty"?(n.dirty(),{status:"dirty",value:_.value}):this._def.out._parseSync({data:_.value,path:h.path,parent:h})}}static create(e,n){return new U0({in:e,out:n,typeName:At.ZodPipeline})}}class f0 extends Ji{_parse(e){const n=this._def.innerType._parse(e),h=_=>(um(_)&&(_.value=Object.freeze(_.value)),_);return _y(n)?n.then(_=>h(_)):h(n)}unwrap(){return this._def.innerType}}f0.create=(r,e)=>new f0({innerType:r,typeName:At.ZodReadonly,...ji(e)});function Hb(r,e){const n=typeof r=="function"?r(e):typeof r=="string"?{message:r}:r;return typeof n=="string"?{message:n}:n}function w1(r,e={},n){return r?Ug.create().superRefine((h,_)=>{const T=r(h);if(T instanceof Promise)return T.then(S=>{if(!S){const u=Hb(e,h),k=u.fatal??n??!0;_.addIssue({code:"custom",...u,fatal:k})}});if(!T){const S=Hb(e,h),u=S.fatal??n??!0;_.addIssue({code:"custom",...S,fatal:u})}}):Ug.create()}var At;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(At||(At={}));const Sy=(r,e={message:`Input not instance of ${r.name}`})=>w1(n=>n instanceof r,e),Ii=mh.create,Vg=hm.create,Bf=a0.create,bE=s0.create;Ug.create;const av=o0.create;Cd.create;const kd=ru.create,Yi=ea.create,ns=vy.create;by.create;Nf.create;const p0=xy.create,xE=c0.create,qr=u0.create;dm.create;wy.create;const Ma=_h.create;pm.create;const wE=Symbol("Let zodToJsonSchema decide on which parser to use"),Yb={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},SE=r=>typeof r=="string"?{...Yb,name:r}:{...Yb,...r},TE=r=>{const e=SE(r),n=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:n,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([h,_])=>[_._def,{def:_._def,path:[...e.basePath,e.definitionPath,h],jsonSchema:void 0}]))}};function S1(r,e,n,h){h!=null&&h.errorMessages&&n&&(r.errorMessage={...r.errorMessage,[e]:n})}function Ln(r,e,n,h,_){r[e]=n,S1(r,e,h,_)}function EE(){return{}}function ME(r,e){var h,_,T;const n={type:"array"};return(h=r.type)!=null&&h._def&&((T=(_=r.type)==null?void 0:_._def)==null?void 0:T.typeName)!==At.ZodAny&&(n.items=yn(r.type._def,{...e,currentPath:[...e.currentPath,"items"]})),r.minLength&&Ln(n,"minItems",r.minLength.value,r.minLength.message,e),r.maxLength&&Ln(n,"maxItems",r.maxLength.value,r.maxLength.message,e),r.exactLength&&(Ln(n,"minItems",r.exactLength.value,r.exactLength.message,e),Ln(n,"maxItems",r.exactLength.value,r.exactLength.message,e)),n}function AE(r,e){const n={type:"integer",format:"int64"};if(!r.checks)return n;for(const h of r.checks)switch(h.kind){case"min":e.target==="jsonSchema7"?h.inclusive?Ln(n,"minimum",h.value,h.message,e):Ln(n,"exclusiveMinimum",h.value,h.message,e):(h.inclusive||(n.exclusiveMinimum=!0),Ln(n,"minimum",h.value,h.message,e));break;case"max":e.target==="jsonSchema7"?h.inclusive?Ln(n,"maximum",h.value,h.message,e):Ln(n,"exclusiveMaximum",h.value,h.message,e):(h.inclusive||(n.exclusiveMaximum=!0),Ln(n,"maximum",h.value,h.message,e));break;case"multipleOf":Ln(n,"multipleOf",h.value,h.message,e);break}return n}function IE(){return{type:"boolean"}}function T1(r,e){return yn(r.type._def,e)}const CE=(r,e)=>yn(r.innerType._def,e);function E1(r,e,n){const h=n??e.dateStrategy;if(Array.isArray(h))return{anyOf:h.map((_,T)=>E1(r,e,_))};switch(h){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return DE(r,e)}}const DE=(r,e)=>{const n={type:"integer",format:"unix-time"};if(e.target==="openApi3")return n;for(const h of r.checks)switch(h.kind){case"min":Ln(n,"minimum",h.value,h.message,e);break;case"max":Ln(n,"maximum",h.value,h.message,e);break}return n};function RE(r,e){return{...yn(r.innerType._def,e),default:r.defaultValue()}}function PE(r,e){return e.effectStrategy==="input"?yn(r.schema._def,e):{}}function zE(r){return{type:"string",enum:Array.from(r.values)}}const kE=r=>"type"in r&&r.type==="string"?!1:"allOf"in r;function OE(r,e){const n=[yn(r.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),yn(r.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(T=>!!T);let h=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const _=[];return n.forEach(T=>{if(kE(T))_.push(...T.allOf),T.unevaluatedProperties===void 0&&(h=void 0);else{let S=T;if("additionalProperties"in T&&T.additionalProperties===!1){const{additionalProperties:u,...k}=T;S=k}else h=void 0;_.push(S)}}),_.length?{allOf:_,...h}:void 0}function BE(r,e){const n=typeof r.value;return n!=="bigint"&&n!=="number"&&n!=="boolean"&&n!=="string"?{type:Array.isArray(r.value)?"array":"object"}:e.target==="openApi3"?{type:n==="bigint"?"integer":n,enum:[r.value]}:{type:n==="bigint"?"integer":n,const:r.value}}let Dv;const fc={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Dv===void 0&&(Dv=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Dv),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function M1(r,e){const n={type:"string"};if(r.checks)for(const h of r.checks)switch(h.kind){case"min":Ln(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,h.value):h.value,h.message,e);break;case"max":Ln(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,h.value):h.value,h.message,e);break;case"email":switch(e.emailStrategy){case"format:email":pc(n,"email",h.message,e);break;case"format:idn-email":pc(n,"idn-email",h.message,e);break;case"pattern:zod":ws(n,fc.email,h.message,e);break}break;case"url":pc(n,"uri",h.message,e);break;case"uuid":pc(n,"uuid",h.message,e);break;case"regex":ws(n,h.regex,h.message,e);break;case"cuid":ws(n,fc.cuid,h.message,e);break;case"cuid2":ws(n,fc.cuid2,h.message,e);break;case"startsWith":ws(n,RegExp(`^${Rv(h.value,e)}`),h.message,e);break;case"endsWith":ws(n,RegExp(`${Rv(h.value,e)}$`),h.message,e);break;case"datetime":pc(n,"date-time",h.message,e);break;case"date":pc(n,"date",h.message,e);break;case"time":pc(n,"time",h.message,e);break;case"duration":pc(n,"duration",h.message,e);break;case"length":Ln(n,"minLength",typeof n.minLength=="number"?Math.max(n.minLength,h.value):h.value,h.message,e),Ln(n,"maxLength",typeof n.maxLength=="number"?Math.min(n.maxLength,h.value):h.value,h.message,e);break;case"includes":{ws(n,RegExp(Rv(h.value,e)),h.message,e);break}case"ip":{h.version!=="v6"&&pc(n,"ipv4",h.message,e),h.version!=="v4"&&pc(n,"ipv6",h.message,e);break}case"base64url":ws(n,fc.base64url,h.message,e);break;case"jwt":ws(n,fc.jwt,h.message,e);break;case"cidr":{h.version!=="v6"&&ws(n,fc.ipv4Cidr,h.message,e),h.version!=="v4"&&ws(n,fc.ipv6Cidr,h.message,e);break}case"emoji":ws(n,fc.emoji(),h.message,e);break;case"ulid":{ws(n,fc.ulid,h.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{pc(n,"binary",h.message,e);break}case"contentEncoding:base64":{Ln(n,"contentEncoding","base64",h.message,e);break}case"pattern:zod":{ws(n,fc.base64,h.message,e);break}}break}case"nanoid":ws(n,fc.nanoid,h.message,e)}return n}function Rv(r,e){return e.patternStrategy==="escape"?FE(r):r}const LE=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function FE(r){let e="";for(let n=0;n<r.length;n++)LE.has(r[n])||(e+="\\"),e+=r[n];return e}function pc(r,e,n,h){var _;r.format||(_=r.anyOf)!=null&&_.some(T=>T.format)?(r.anyOf||(r.anyOf=[]),r.format&&(r.anyOf.push({format:r.format,...r.errorMessage&&h.errorMessages&&{errorMessage:{format:r.errorMessage.format}}}),delete r.format,r.errorMessage&&(delete r.errorMessage.format,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.anyOf.push({format:e,...n&&h.errorMessages&&{errorMessage:{format:n}}})):Ln(r,"format",e,n,h)}function ws(r,e,n,h){var _;r.pattern||(_=r.allOf)!=null&&_.some(T=>T.pattern)?(r.allOf||(r.allOf=[]),r.pattern&&(r.allOf.push({pattern:r.pattern,...r.errorMessage&&h.errorMessages&&{errorMessage:{pattern:r.errorMessage.pattern}}}),delete r.pattern,r.errorMessage&&(delete r.errorMessage.pattern,Object.keys(r.errorMessage).length===0&&delete r.errorMessage)),r.allOf.push({pattern:Xb(e,h),...n&&h.errorMessages&&{errorMessage:{pattern:n}}})):Ln(r,"pattern",Xb(e,h),n,h)}function Xb(r,e){var k;if(!e.applyRegexFlags||!r.flags)return r.source;const n={i:r.flags.includes("i"),m:r.flags.includes("m"),s:r.flags.includes("s")},h=n.i?r.source.toLowerCase():r.source;let _="",T=!1,S=!1,u=!1;for(let B=0;B<h.length;B++){if(T){_+=h[B],T=!1;continue}if(n.i){if(S){if(h[B].match(/[a-z]/)){u?(_+=h[B],_+=`${h[B-2]}-${h[B]}`.toUpperCase(),u=!1):h[B+1]==="-"&&((k=h[B+2])!=null&&k.match(/[a-z]/))?(_+=h[B],u=!0):_+=`${h[B]}${h[B].toUpperCase()}`;continue}}else if(h[B].match(/[a-z]/)){_+=`[${h[B]}${h[B].toUpperCase()}]`;continue}}if(n.m){if(h[B]==="^"){_+=`(^|(?<=[\r
]))`;continue}else if(h[B]==="$"){_+=`($|(?=[\r
]))`;continue}}if(n.s&&h[B]==="."){_+=S?`${h[B]}\r
`:`[${h[B]}\r
]`;continue}_+=h[B],h[B]==="\\"?T=!0:S&&h[B]==="]"?S=!1:!S&&h[B]==="["&&(S=!0)}try{new RegExp(_)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),r.source}return _}function A1(r,e){var h,_,T,S,u,k;if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&((h=r.keyType)==null?void 0:h._def.typeName)===At.ZodEnum)return{type:"object",required:r.keyType._def.values,properties:r.keyType._def.values.reduce((B,q)=>({...B,[q]:yn(r.valueType._def,{...e,currentPath:[...e.currentPath,"properties",q]})??{}}),{}),additionalProperties:e.rejectedAdditionalProperties};const n={type:"object",additionalProperties:yn(r.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return n;if(((_=r.keyType)==null?void 0:_._def.typeName)===At.ZodString&&((T=r.keyType._def.checks)!=null&&T.length)){const{type:B,...q}=M1(r.keyType._def,e);return{...n,propertyNames:q}}else{if(((S=r.keyType)==null?void 0:S._def.typeName)===At.ZodEnum)return{...n,propertyNames:{enum:r.keyType._def.values}};if(((u=r.keyType)==null?void 0:u._def.typeName)===At.ZodBranded&&r.keyType._def.type._def.typeName===At.ZodString&&((k=r.keyType._def.type._def.checks)!=null&&k.length)){const{type:B,...q}=T1(r.keyType._def,e);return{...n,propertyNames:q}}}return n}function NE(r,e){if(e.mapStrategy==="record")return A1(r,e);const n=yn(r.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},h=yn(r.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[n,h],minItems:2,maxItems:2}}}function UE(r){const e=r.values,h=Object.keys(r.values).filter(T=>typeof e[e[T]]!="number").map(T=>e[T]),_=Array.from(new Set(h.map(T=>typeof T)));return{type:_.length===1?_[0]==="string"?"string":"number":["string","number"],enum:h}}function jE(){return{not:{}}}function VE(r){return r.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Ty={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function ZE(r,e){if(e.target==="openApi3")return Kb(r,e);const n=r.options instanceof Map?Array.from(r.options.values()):r.options;if(n.every(h=>h._def.typeName in Ty&&(!h._def.checks||!h._def.checks.length))){const h=n.reduce((_,T)=>{const S=Ty[T._def.typeName];return S&&!_.includes(S)?[..._,S]:_},[]);return{type:h.length>1?h:h[0]}}else if(n.every(h=>h._def.typeName==="ZodLiteral"&&!h.description)){const h=n.reduce((_,T)=>{const S=typeof T._def.value;switch(S){case"string":case"number":case"boolean":return[..._,S];case"bigint":return[..._,"integer"];case"object":if(T._def.value===null)return[..._,"null"];case"symbol":case"undefined":case"function":default:return _}},[]);if(h.length===n.length){const _=h.filter((T,S,u)=>u.indexOf(T)===S);return{type:_.length>1?_:_[0],enum:n.reduce((T,S)=>T.includes(S._def.value)?T:[...T,S._def.value],[])}}}else if(n.every(h=>h._def.typeName==="ZodEnum"))return{type:"string",enum:n.reduce((h,_)=>[...h,..._._def.values.filter(T=>!h.includes(T))],[])};return Kb(r,e)}const Kb=(r,e)=>{const n=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((h,_)=>yn(h._def,{...e,currentPath:[...e.currentPath,"anyOf",`${_}`]})).filter(h=>!!h&&(!e.strictUnions||typeof h=="object"&&Object.keys(h).length>0));return n.length?{anyOf:n}:void 0};function GE(r,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(r.innerType._def.typeName)&&(!r.innerType._def.checks||!r.innerType._def.checks.length))return e.target==="openApi3"?{type:Ty[r.innerType._def.typeName],nullable:!0}:{type:[Ty[r.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const h=yn(r.innerType._def,{...e,currentPath:[...e.currentPath]});return h&&"$ref"in h?{allOf:[h],nullable:!0}:h&&{...h,nullable:!0}}const n=yn(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return n&&{anyOf:[n,{type:"null"}]}}function qE(r,e){const n={type:"number"};if(!r.checks)return n;for(const h of r.checks)switch(h.kind){case"int":n.type="integer",S1(n,"type",h.message,e);break;case"min":e.target==="jsonSchema7"?h.inclusive?Ln(n,"minimum",h.value,h.message,e):Ln(n,"exclusiveMinimum",h.value,h.message,e):(h.inclusive||(n.exclusiveMinimum=!0),Ln(n,"minimum",h.value,h.message,e));break;case"max":e.target==="jsonSchema7"?h.inclusive?Ln(n,"maximum",h.value,h.message,e):Ln(n,"exclusiveMaximum",h.value,h.message,e):(h.inclusive||(n.exclusiveMaximum=!0),Ln(n,"maximum",h.value,h.message,e));break;case"multipleOf":Ln(n,"multipleOf",h.value,h.message,e);break}return n}function $E(r,e){const n=e.target==="openAi",h={type:"object",properties:{}},_=[],T=r.shape();for(const u in T){let k=T[u];if(k===void 0||k._def===void 0)continue;let B=YE(k);B&&n&&(k instanceof _h&&(k=k._def.innerType),k.isNullable()||(k=k.nullable()),B=!1);const q=yn(k._def,{...e,currentPath:[...e.currentPath,"properties",u],propertyPath:[...e.currentPath,"properties",u]});q!==void 0&&(h.properties[u]=q,B||_.push(u))}_.length&&(h.required=_);const S=HE(r,e);return S!==void 0&&(h.additionalProperties=S),h}function HE(r,e){if(r.catchall._def.typeName!=="ZodNever")return yn(r.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(r.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function YE(r){try{return r.isOptional()}catch{return!0}}const XE=(r,e)=>{var h;if(e.currentPath.toString()===((h=e.propertyPath)==null?void 0:h.toString()))return yn(r.innerType._def,e);const n=yn(r.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return n?{anyOf:[{not:{}},n]}:{}},KE=(r,e)=>{if(e.pipeStrategy==="input")return yn(r.in._def,e);if(e.pipeStrategy==="output")return yn(r.out._def,e);const n=yn(r.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),h=yn(r.out._def,{...e,currentPath:[...e.currentPath,"allOf",n?"1":"0"]});return{allOf:[n,h].filter(_=>_!==void 0)}};function WE(r,e){return yn(r.type._def,e)}function QE(r,e){const h={type:"array",uniqueItems:!0,items:yn(r.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return r.minSize&&Ln(h,"minItems",r.minSize.value,r.minSize.message,e),r.maxSize&&Ln(h,"maxItems",r.maxSize.value,r.maxSize.message,e),h}function JE(r,e){return r.rest?{type:"array",minItems:r.items.length,items:r.items.map((n,h)=>yn(n._def,{...e,currentPath:[...e.currentPath,"items",`${h}`]})).reduce((n,h)=>h===void 0?n:[...n,h],[]),additionalItems:yn(r.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:r.items.length,maxItems:r.items.length,items:r.items.map((n,h)=>yn(n._def,{...e,currentPath:[...e.currentPath,"items",`${h}`]})).reduce((n,h)=>h===void 0?n:[...n,h],[])}}function eM(){return{not:{}}}function tM(){return{}}const iM=(r,e)=>yn(r.innerType._def,e),nM=(r,e,n)=>{switch(e){case At.ZodString:return M1(r,n);case At.ZodNumber:return qE(r,n);case At.ZodObject:return $E(r,n);case At.ZodBigInt:return AE(r,n);case At.ZodBoolean:return IE();case At.ZodDate:return E1(r,n);case At.ZodUndefined:return eM();case At.ZodNull:return VE(n);case At.ZodArray:return ME(r,n);case At.ZodUnion:case At.ZodDiscriminatedUnion:return ZE(r,n);case At.ZodIntersection:return OE(r,n);case At.ZodTuple:return JE(r,n);case At.ZodRecord:return A1(r,n);case At.ZodLiteral:return BE(r,n);case At.ZodEnum:return zE(r);case At.ZodNativeEnum:return UE(r);case At.ZodNullable:return GE(r,n);case At.ZodOptional:return XE(r,n);case At.ZodMap:return NE(r,n);case At.ZodSet:return QE(r,n);case At.ZodLazy:return()=>r.getter()._def;case At.ZodPromise:return WE(r,n);case At.ZodNaN:case At.ZodNever:return jE();case At.ZodEffects:return PE(r,n);case At.ZodAny:return EE();case At.ZodUnknown:return tM();case At.ZodDefault:return RE(r,n);case At.ZodBranded:return T1(r,n);case At.ZodReadonly:return iM(r,n);case At.ZodCatch:return CE(r,n);case At.ZodPipeline:return KE(r,n);case At.ZodFunction:case At.ZodVoid:case At.ZodSymbol:return;default:return(h=>{})()}};function yn(r,e,n=!1){var u;const h=e.seen.get(r);if(e.override){const k=(u=e.override)==null?void 0:u.call(e,r,e,h,n);if(k!==wE)return k}if(h&&!n){const k=rM(h,e);if(k!==void 0)return k}const _={def:r,path:e.currentPath,jsonSchema:void 0};e.seen.set(r,_);const T=nM(r,r.typeName,e),S=typeof T=="function"?yn(T(),e):T;if(S&&sM(r,e,S),e.postProcess){const k=e.postProcess(S,r,e);return _.jsonSchema=S,k}return _.jsonSchema=S,S}const rM=(r,e)=>{switch(e.$refStrategy){case"root":return{$ref:r.path.join("/")};case"relative":return{$ref:aM(e.currentPath,r.path)};case"none":case"seen":return r.path.length<e.currentPath.length&&r.path.every((n,h)=>e.currentPath[h]===n)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},aM=(r,e)=>{let n=0;for(;n<r.length&&n<e.length&&r[n]===e[n];n++);return[(r.length-n).toString(),...e.slice(n)].join("/")},sM=(r,e,n)=>(r.description&&(n.description=r.description,e.markdownDescription&&(n.markdownDescription=r.description)),n),oM=(r,e)=>{const n=TE(e),h=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((k,[B,q])=>({...k,[B]:yn(q._def,{...n,currentPath:[...n.basePath,n.definitionPath,B]},!0)??{}}),{}):void 0,_=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,T=yn(r._def,_===void 0?n:{...n,currentPath:[...n.basePath,n.definitionPath,_]},!1)??{},S=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;S!==void 0&&(T.title=S);const u=_===void 0?h?{...T,[n.definitionPath]:h}:T:{$ref:[...n.$refStrategy==="relative"?[]:n.basePath,n.definitionPath,_].join("/"),[n.definitionPath]:{...h,[_]:T}};return n.target==="jsonSchema7"?u.$schema="http://json-schema.org/draft-07/schema#":(n.target==="jsonSchema2019-09"||n.target==="openAi")&&(u.$schema="https://json-schema.org/draft/2019-09/schema#"),n.target==="openAi"&&("anyOf"in u||"oneOf"in u||"allOf"in u||"type"in u&&Array.isArray(u.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),u};var Zg={code:"0",name:"text",parse:r=>{if(typeof r!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:r}}},Gg={code:"3",name:"error",parse:r=>{if(typeof r!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:r}}},qg={code:"4",name:"assistant_message",parse:r=>{if(r==null||typeof r!="object"||!("id"in r)||!("role"in r)||!("content"in r)||typeof r.id!="string"||typeof r.role!="string"||r.role!=="assistant"||!Array.isArray(r.content)||!r.content.every(e=>e!=null&&typeof e=="object"&&"type"in e&&e.type==="text"&&"text"in e&&e.text!=null&&typeof e.text=="object"&&"value"in e.text&&typeof e.text.value=="string"))throw new Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:r}}},$g={code:"5",name:"assistant_control_data",parse:r=>{if(r==null||typeof r!="object"||!("threadId"in r)||!("messageId"in r)||typeof r.threadId!="string"||typeof r.messageId!="string")throw new Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:r.threadId,messageId:r.messageId}}}},Hg={code:"6",name:"data_message",parse:r=>{if(r==null||typeof r!="object"||!("role"in r)||!("data"in r)||typeof r.role!="string"||r.role!=="data")throw new Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:r}}},lM=[Zg,Gg,qg,$g,Hg];Zg.code+"",Gg.code+"",qg.code+"",$g.code+"",Hg.code+"";Zg.name+"",Zg.code,Gg.name+"",Gg.code,qg.name+"",qg.code,$g.name+"",$g.code,Hg.name+"",Hg.code;lM.map(r=>r.code);function cM(r){const e=["ROOT"];let n=-1,h=null;function _(k,B,q){switch(k){case'"':{n=B,e.pop(),e.push(q),e.push("INSIDE_STRING");break}case"f":case"t":case"n":{n=B,h=B,e.pop(),e.push(q),e.push("INSIDE_LITERAL");break}case"-":{e.pop(),e.push(q),e.push("INSIDE_NUMBER");break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{n=B,e.pop(),e.push(q),e.push("INSIDE_NUMBER");break}case"{":{n=B,e.pop(),e.push(q),e.push("INSIDE_OBJECT_START");break}case"[":{n=B,e.pop(),e.push(q),e.push("INSIDE_ARRAY_START");break}}}function T(k,B){switch(k){case",":{e.pop(),e.push("INSIDE_OBJECT_AFTER_COMMA");break}case"}":{n=B,e.pop();break}}}function S(k,B){switch(k){case",":{e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{n=B,e.pop();break}}}for(let k=0;k<r.length;k++){const B=r[k];switch(e[e.length-1]){case"ROOT":_(B,k,"FINISH");break;case"INSIDE_OBJECT_START":{switch(B){case'"':{e.pop(),e.push("INSIDE_OBJECT_KEY");break}case"}":{n=k,e.pop();break}}break}case"INSIDE_OBJECT_AFTER_COMMA":{switch(B){case'"':{e.pop(),e.push("INSIDE_OBJECT_KEY");break}}break}case"INSIDE_OBJECT_KEY":{switch(B){case'"':{e.pop(),e.push("INSIDE_OBJECT_AFTER_KEY");break}}break}case"INSIDE_OBJECT_AFTER_KEY":{switch(B){case":":{e.pop(),e.push("INSIDE_OBJECT_BEFORE_VALUE");break}}break}case"INSIDE_OBJECT_BEFORE_VALUE":{_(B,k,"INSIDE_OBJECT_AFTER_VALUE");break}case"INSIDE_OBJECT_AFTER_VALUE":{T(B,k);break}case"INSIDE_STRING":{switch(B){case'"':{e.pop(),n=k;break}case"\\":{e.push("INSIDE_STRING_ESCAPE");break}default:n=k}break}case"INSIDE_ARRAY_START":{switch(B){case"]":{n=k,e.pop();break}default:{n=k,_(B,k,"INSIDE_ARRAY_AFTER_VALUE");break}}break}case"INSIDE_ARRAY_AFTER_VALUE":{switch(B){case",":{e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{n=k,e.pop();break}default:{n=k;break}}break}case"INSIDE_ARRAY_AFTER_COMMA":{_(B,k,"INSIDE_ARRAY_AFTER_VALUE");break}case"INSIDE_STRING_ESCAPE":{e.pop(),n=k;break}case"INSIDE_NUMBER":{switch(B){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{n=k;break}case"e":case"E":case"-":case".":break;case",":{e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&S(B,k),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&T(B,k);break}case"}":{e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&T(B,k);break}case"]":{e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&S(B,k);break}default:{e.pop();break}}break}case"INSIDE_LITERAL":{const oe=r.substring(h,k+1);!"false".startsWith(oe)&&!"true".startsWith(oe)&&!"null".startsWith(oe)?(e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?T(B,k):e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&S(B,k)):n=k;break}}}let u=r.slice(0,n+1);for(let k=e.length-1;k>=0;k--)switch(e[k]){case"INSIDE_STRING":{u+='"';break}case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":{u+="}";break}case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":{u+="]";break}case"INSIDE_LITERAL":{const q=r.substring(h,r.length);"true".startsWith(q)?u+="true".slice(q.length):"false".startsWith(q)?u+="false".slice(q.length):"null".startsWith(q)&&(u+="null".slice(q.length))}}return u}function uM(r){if(r===void 0)return{value:void 0,state:"undefined-input"};let e=n0({text:r});return e.success?{value:e.value,state:"successful-parse"}:(e=n0({text:cM(r)}),e.success?{value:e.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}var hM={code:"0",name:"text",parse:r=>{if(typeof r!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:r}}},dM={code:"2",name:"data",parse:r=>{if(!Array.isArray(r))throw new Error('"data" parts expect an array value.');return{type:"data",value:r}}},fM={code:"3",name:"error",parse:r=>{if(typeof r!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:r}}},pM={code:"8",name:"message_annotations",parse:r=>{if(!Array.isArray(r))throw new Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:r}}},mM={code:"9",name:"tool_call",parse:r=>{if(r==null||typeof r!="object"||!("toolCallId"in r)||typeof r.toolCallId!="string"||!("toolName"in r)||typeof r.toolName!="string"||!("args"in r)||typeof r.args!="object")throw new Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:r}}},gM={code:"a",name:"tool_result",parse:r=>{if(r==null||typeof r!="object"||!("toolCallId"in r)||typeof r.toolCallId!="string"||!("result"in r))throw new Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:r}}},_M={code:"b",name:"tool_call_streaming_start",parse:r=>{if(r==null||typeof r!="object"||!("toolCallId"in r)||typeof r.toolCallId!="string"||!("toolName"in r)||typeof r.toolName!="string")throw new Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:r}}},yM={code:"c",name:"tool_call_delta",parse:r=>{if(r==null||typeof r!="object"||!("toolCallId"in r)||typeof r.toolCallId!="string"||!("argsTextDelta"in r)||typeof r.argsTextDelta!="string")throw new Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:r}}},vM={code:"d",name:"finish_message",parse:r=>{if(r==null||typeof r!="object"||!("finishReason"in r)||typeof r.finishReason!="string")throw new Error('"finish_message" parts expect an object with a "finishReason" property.');const e={finishReason:r.finishReason};return"usage"in r&&r.usage!=null&&typeof r.usage=="object"&&"promptTokens"in r.usage&&"completionTokens"in r.usage&&(e.usage={promptTokens:typeof r.usage.promptTokens=="number"?r.usage.promptTokens:Number.NaN,completionTokens:typeof r.usage.completionTokens=="number"?r.usage.completionTokens:Number.NaN}),{type:"finish_message",value:e}}},bM={code:"e",name:"finish_step",parse:r=>{if(r==null||typeof r!="object"||!("finishReason"in r)||typeof r.finishReason!="string")throw new Error('"finish_step" parts expect an object with a "finishReason" property.');const e={finishReason:r.finishReason,isContinued:!1};return"usage"in r&&r.usage!=null&&typeof r.usage=="object"&&"promptTokens"in r.usage&&"completionTokens"in r.usage&&(e.usage={promptTokens:typeof r.usage.promptTokens=="number"?r.usage.promptTokens:Number.NaN,completionTokens:typeof r.usage.completionTokens=="number"?r.usage.completionTokens:Number.NaN}),"isContinued"in r&&typeof r.isContinued=="boolean"&&(e.isContinued=r.isContinued),{type:"finish_step",value:e}}},xM={code:"f",name:"start_step",parse:r=>{if(r==null||typeof r!="object"||!("messageId"in r)||typeof r.messageId!="string")throw new Error('"start_step" parts expect an object with an "id" property.');return{type:"start_step",value:{messageId:r.messageId}}}},wM={code:"g",name:"reasoning",parse:r=>{if(typeof r!="string")throw new Error('"reasoning" parts expect a string value.');return{type:"reasoning",value:r}}},SM={code:"h",name:"source",parse:r=>{if(r==null||typeof r!="object")throw new Error('"source" parts expect a Source object.');return{type:"source",value:r}}},TM={code:"i",name:"redacted_reasoning",parse:r=>{if(r==null||typeof r!="object"||!("data"in r)||typeof r.data!="string")throw new Error('"redacted_reasoning" parts expect an object with a "data" property.');return{type:"redacted_reasoning",value:{data:r.data}}}},EM={code:"j",name:"reasoning_signature",parse:r=>{if(r==null||typeof r!="object"||!("signature"in r)||typeof r.signature!="string")throw new Error('"reasoning_signature" parts expect an object with a "signature" property.');return{type:"reasoning_signature",value:{signature:r.signature}}}},MM={code:"k",name:"file",parse:r=>{if(r==null||typeof r!="object"||!("data"in r)||typeof r.data!="string"||!("mimeType"in r)||typeof r.mimeType!="string")throw new Error('"file" parts expect an object with a "data" and "mimeType" property.');return{type:"file",value:r}}},sv=[hM,dM,fM,pM,mM,gM,_M,yM,vM,bM,xM,wM,SM,TM,EM,MM];Object.fromEntries(sv.map(r=>[r.code,r]));Object.fromEntries(sv.map(r=>[r.name,r.code]));sv.map(r=>r.code);function I1(r,e){const n=sv.find(h=>h.name===r);if(!n)throw new Error(`Invalid stream part type: ${r}`);return`${n.code}:${JSON.stringify(e)}
`}function AM(r,e){var n;const h=(n=void 0)!=null?n:!1;return IM(oM(r,{$refStrategy:h?"root":"none",target:"jsonSchema7"}),{validate:_=>{const T=r.safeParse(_);return T.success?{success:!0,value:T.data}:{success:!1,error:T.error}}})}var m0=Symbol.for("vercel.ai.schema");function IM(r,{validate:e}={}){return{[m0]:!0,_type:void 0,[gy]:!0,jsonSchema:r,validate:e}}function CM(r){return typeof r=="object"&&r!==null&&m0 in r&&r[m0]===!0&&"jsonSchema"in r&&"validate"in r}function DM(r){return CM(r)?r:AM(r)}var RM=Object.defineProperty,j0=(r,e)=>{for(var n in e)RM(r,n,{get:e[n],enumerable:!0})};function C1(r,{contentType:e,dataStreamVersion:n}){const h=new Headers(r??{});return h.has("Content-Type")||h.set("Content-Type",e),h.set("X-Vercel-AI-Data-Stream",n),h}var D1="AI_NoObjectGeneratedError",R1=`vercel.ai.error.${D1}`,PM=Symbol.for(R1),P1,Wb=class extends Id{constructor({message:r="No object generated.",cause:e,text:n,response:h,usage:_,finishReason:T}){super({name:D1,message:r,cause:e}),this[P1]=!0,this.text=n,this.response=h,this.usage=_,this.finishReason=T}static isInstance(r){return Id.hasMarker(r,R1)}};P1=PM;var z1=ns([Ii(),Sy(Uint8Array),Sy(ArrayBuffer),w1(r=>{var e,n;return(n=(e=globalThis.Buffer)==null?void 0:e.isBuffer(r))!=null?n:!1},{message:"Must be a Buffer"})]),g0=xE(()=>ns([bE(),Ii(),Vg(),Bf(),p0(Ii(),g0),kd(g0)])),zr=p0(Ii(),p0(Ii(),g0)),zM=kd(ns([Yi({type:qr("text"),text:Ii()}),Yi({type:qr("image"),data:Ii(),mimeType:Ii().optional()})])),k1=Yi({type:qr("text"),text:Ii(),providerOptions:zr.optional(),experimental_providerMetadata:zr.optional()}),kM=Yi({type:qr("image"),image:ns([z1,Sy(URL)]),mimeType:Ii().optional(),providerOptions:zr.optional(),experimental_providerMetadata:zr.optional()}),O1=Yi({type:qr("file"),data:ns([z1,Sy(URL)]),filename:Ii().optional(),mimeType:Ii(),providerOptions:zr.optional(),experimental_providerMetadata:zr.optional()}),OM=Yi({type:qr("reasoning"),text:Ii(),providerOptions:zr.optional(),experimental_providerMetadata:zr.optional()}),BM=Yi({type:qr("redacted-reasoning"),data:Ii(),providerOptions:zr.optional(),experimental_providerMetadata:zr.optional()}),LM=Yi({type:qr("tool-call"),toolCallId:Ii(),toolName:Ii(),args:av(),providerOptions:zr.optional(),experimental_providerMetadata:zr.optional()}),FM=Yi({type:qr("tool-result"),toolCallId:Ii(),toolName:Ii(),result:av(),content:zM.optional(),isError:Bf().optional(),providerOptions:zr.optional(),experimental_providerMetadata:zr.optional()}),NM=Yi({role:qr("system"),content:Ii(),providerOptions:zr.optional(),experimental_providerMetadata:zr.optional()}),UM=Yi({role:qr("user"),content:ns([Ii(),kd(ns([k1,kM,O1]))]),providerOptions:zr.optional(),experimental_providerMetadata:zr.optional()}),jM=Yi({role:qr("assistant"),content:ns([Ii(),kd(ns([k1,O1,OM,BM,LM]))]),providerOptions:zr.optional(),experimental_providerMetadata:zr.optional()}),VM=Yi({role:qr("tool"),content:kd(FM),providerOptions:zr.optional(),experimental_providerMetadata:zr.optional()});ns([NM,UM,jM,VM]);var ZM="JSON schema:",GM="You MUST answer with a JSON object that matches the JSON schema above.",qM="You MUST answer with JSON.";function $M({prompt:r,schema:e,schemaPrefix:n=e!=null?ZM:void 0,schemaSuffix:h=e!=null?GM:qM}){return[r!=null&&r.length>0?r:void 0,r!=null&&r.length>0?"":void 0,n,e!=null?JSON.stringify(e):void 0,h].filter(_=>_!=null).join(`
`)}Zf({prefix:"aiobj",size:24});Zf({prefix:"aiobj",size:24});Zf({prefix:"aitxt",size:24});Zf({prefix:"msg",size:24});var HM={};j0(HM,{object:()=>XM,text:()=>YM});var YM=()=>({type:"text",responseFormat:()=>({type:"text"}),injectIntoSystemPrompt({system:r}){return r},parsePartial({text:r}){return{partial:r}},parseOutput({text:r}){return r}}),XM=({schema:r})=>{const e=DM(r);return{type:"object",responseFormat:({model:n})=>({type:"json",schema:n.supportsStructuredOutputs?e.jsonSchema:void 0}),injectIntoSystemPrompt({system:n,model:h}){return h.supportsStructuredOutputs?n:$M({prompt:n,schema:e.jsonSchema})},parsePartial({text:n}){const h=uM(n);switch(h.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:h.value};default:{const _=h.state;throw new Error(`Unsupported parse state: ${_}`)}}},parseOutput({text:n},h){const _=n0({text:n});if(!_.success)throw new Wb({message:"No object generated: could not parse the response.",cause:_.error,text:n,response:h.response,usage:h.usage,finishReason:h.finishReason});const T=y1({value:_.value,schema:e});if(!T.success)throw new Wb({message:"No object generated: response did not match schema.",cause:T.error,text:n,response:h.response,usage:h.usage,finishReason:h.finishReason});return T.value}}};function B1(r,e){const n=r.getReader(),h=e.getReader();let _,T,S=!1,u=!1;async function k(q){try{_==null&&(_=n.read());const oe=await _;_=void 0,oe.done?q.close():q.enqueue(oe.value)}catch(oe){q.error(oe)}}async function B(q){try{T==null&&(T=h.read());const oe=await T;T=void 0,oe.done?q.close():q.enqueue(oe.value)}catch(oe){q.error(oe)}}return new ReadableStream({async pull(q){try{if(S){await B(q);return}if(u){await k(q);return}_==null&&(_=n.read()),T==null&&(T=h.read());const{result:oe,reader:ne}=await Promise.race([_.then(K=>({result:K,reader:n})),T.then(K=>({result:K,reader:h}))]);oe.done||q.enqueue(oe.value),ne===n?(_=void 0,oe.done&&(await B(q),S=!0)):(T=void 0,oe.done&&(u=!0,await k(q)))}catch(oe){q.error(oe)}},cancel(){n.cancel(),h.cancel()}})}Zf({prefix:"aitxt",size:24});Zf({prefix:"msg",size:24});var KM=Yi({name:Ii(),version:Ii()}).passthrough(),V0=Yi({_meta:Ma(Yi({}).passthrough())}).passthrough(),Yg=V0,WM=Yi({method:Ii(),params:Ma(V0)}),QM=Yi({experimental:Ma(Yi({}).passthrough()),logging:Ma(Yi({}).passthrough()),prompts:Ma(Yi({listChanged:Ma(Bf())}).passthrough()),resources:Ma(Yi({subscribe:Ma(Bf()),listChanged:Ma(Bf())}).passthrough()),tools:Ma(Yi({listChanged:Ma(Bf())}).passthrough())}).passthrough();Yg.extend({protocolVersion:Ii(),capabilities:QM,serverInfo:KM,instructions:Ma(Ii())});var JM=Yg.extend({nextCursor:Ma(Ii())}),eA=Yi({name:Ii(),description:Ma(Ii()),inputSchema:Yi({type:qr("object"),properties:Ma(Yi({}).passthrough())}).passthrough()}).passthrough();JM.extend({tools:kd(eA)});var tA=Yi({type:qr("text"),text:Ii()}).passthrough(),iA=Yi({type:qr("image"),data:Ii().base64(),mimeType:Ii()}).passthrough(),L1=Yi({uri:Ii(),mimeType:Ma(Ii())}).passthrough(),nA=L1.extend({text:Ii()}),rA=L1.extend({blob:Ii().base64()}),aA=Yi({type:qr("resource"),resource:ns([nA,rA])}).passthrough();Yg.extend({content:kd(ns([tA,iA,aA])),isError:Bf().default(!1).optional()}).or(Yg.extend({toolResult:av()}));var ov="2.0",sA=Yi({jsonrpc:qr(ov),id:ns([Ii(),Vg().int()])}).merge(WM).strict(),oA=Yi({jsonrpc:qr(ov),id:ns([Ii(),Vg().int()]),result:Yg}).strict(),lA=Yi({jsonrpc:qr(ov),id:ns([Ii(),Vg().int()]),error:Yi({code:Vg().int(),message:Ii(),data:Ma(av())})}).strict(),cA=Yi({jsonrpc:qr(ov)}).merge(Yi({method:Ii(),params:Ma(V0)})).strict();ns([sA,cA,oA,lA]);var uA={};j0(uA,{mergeIntoDataStream:()=>fA,toDataStream:()=>hA,toDataStreamResponse:()=>dA});function F1(r={}){const e=new TextEncoder;let n="";return new TransformStream({async start(){r.onStart&&await r.onStart()},async transform(h,_){_.enqueue(e.encode(h)),n+=h,r.onToken&&await r.onToken(h),r.onText&&typeof h=="string"&&await r.onText(h)},async flush(){r.onCompletion&&await r.onCompletion(n),r.onFinal&&await r.onFinal(n)}})}function Z0(r,e){return r.pipeThrough(new TransformStream({transform:async(n,h)=>{var _;if(typeof n=="string"){h.enqueue(n);return}if("event"in n){n.event==="on_chat_model_stream"&&Qb((_=n.data)==null?void 0:_.chunk,h);return}Qb(n,h)}})).pipeThrough(F1(e)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(n,h)=>{h.enqueue(I1("text",n))}}))}function hA(r,e){return Z0(r,e).pipeThrough(new TextEncoderStream)}function dA(r,e){var n;const h=Z0(r,e==null?void 0:e.callbacks).pipeThrough(new TextEncoderStream),_=e==null?void 0:e.data,T=e==null?void 0:e.init,S=_?B1(_.stream,h):h;return new Response(S,{status:(n=T==null?void 0:T.status)!=null?n:200,statusText:T==null?void 0:T.statusText,headers:C1(T==null?void 0:T.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function fA(r,e){e.dataStream.merge(Z0(r,e.callbacks))}function Qb(r,e){if(typeof r.content=="string")e.enqueue(r.content);else{const n=r.content;for(const h of n)h.type==="text"&&e.enqueue(h.text)}}var pA={};j0(pA,{mergeIntoDataStream:()=>_A,toDataStream:()=>mA,toDataStreamResponse:()=>gA});function G0(r,e){const n=yA();return ZT(r[Symbol.asyncIterator]()).pipeThrough(new TransformStream({async transform(h,_){_.enqueue(n(h.delta))}})).pipeThrough(F1(e)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(h,_)=>{_.enqueue(I1("text",h))}}))}function mA(r,e){return G0(r,e).pipeThrough(new TextEncoderStream)}function gA(r,e={}){var n;const{init:h,data:_,callbacks:T}=e,S=G0(r,T).pipeThrough(new TextEncoderStream),u=_?B1(_.stream,S):S;return new Response(u,{status:(n=h==null?void 0:h.status)!=null?n:200,statusText:h==null?void 0:h.statusText,headers:C1(h==null?void 0:h.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function _A(r,e){e.dataStream.merge(G0(r,e.callbacks))}function yA(){let r=!0;return e=>(r&&(e=e.trimStart(),e&&(r=!1)),e)}Yi({suggestedPrompts:kd(Yi({id:Ii().describe("Unique identifier for the prompt"),text:Ii().describe("The actual prompt text that will be inserted into the input box"),description:Ii().describe("Brief description of what this prompt will do")})).max(5).describe("Array of up to 5 suggested follow-up prompts"),completionMessage:Ii().optional().describe("Optional message to display when work is completed")});function vA(r){const[n,h]=Je.useState([]),[_,T]=Je.useState(""),[S,u]=Je.useState(!1),[k,B]=Je.useState(null),[q,oe]=Je.useState([]),ne=Je.useCallback(tt=>{T(tt.target.value)},[]),K=Je.useCallback(tt=>{T(tt)},[]),le=Je.useCallback(async tt=>{tt.preventDefault(),_.trim()},[_,void 0,S,n,r]);return{messages:n,input:_,handleInputChange:ne,handleSubmit:le,isLoading:S,error:k,isApiKeyConfigured:!1,suggestedPrompts:q,handleSuggestedPromptClick:K}}function bA({db:r}){const e=Je.useRef(null),{messages:n,input:h,handleInputChange:_,handleSubmit:T,isLoading:S,isApiKeyConfigured:u,suggestedPrompts:k,handleSuggestedPromptClick:B}=vA(r),q=()=>{var ne;(ne=e.current)==null||ne.scrollIntoView({behavior:"smooth"})};Je.useEffect(()=>{q()},[n]);const oe=ne=>{ne.key==="Enter"&&!ne.shiftKey&&(ne.preventDefault(),T(ne))};return u?Tt.jsxs(Tt.Fragment,{children:[Tt.jsx("style",{children:`
                @keyframes blink {
                    0%, 50% { opacity: 1; }
                    51%, 100% { opacity: 0; }
                }
            `}),Tt.jsxs("div",{style:{padding:"10px",backgroundColor:"#f5f5f5",color:"#333",textAlign:"left",height:"100vh",display:"flex",flexDirection:"column",overflow:"hidden"},children:[Tt.jsxs("div",{style:{flex:1,overflowY:"auto",backgroundColor:"white",border:"1px solid #ddd",borderRadius:"4px",padding:"10px",marginBottom:"10px"},children:[n.length===0&&Tt.jsx("p",{style:{color:"#666",fontStyle:"italic",margin:"0"},children:"Claude"}),n.map((ne,K)=>{const Ge=K===n.length-1&&ne.role==="assistant"&&S;return Tt.jsxs("div",{style:{marginBottom:"10px",padding:"8px",backgroundColor:ne.role==="user"?"#e3f2fd":"#f1f8e9",borderRadius:"4px",color:"#333"},children:[Tt.jsxs("strong",{style:{color:"#333"},children:[ne.role==="user"?"":"Claude",":"]}),Tt.jsxs("div",{style:{marginTop:"4px",whiteSpace:"pre-wrap",color:"#333"},children:[typeof ne.content=="string"?ne.content:JSON.stringify(ne.content,null,2),Ge&&Tt.jsx("span",{style:{opacity:.7,animation:"blink 1s infinite",marginLeft:"2px"},children:""})]})]},K)}),S&&n.length===0&&Tt.jsx("div",{style:{padding:"8px",backgroundColor:"#f1f8e9",borderRadius:"4px",fontStyle:"italic",color:"#666"},children:"Claude is thinking..."}),Tt.jsx("div",{ref:e})]}),k.length>0&&Tt.jsxs("div",{style:{marginBottom:"10px",padding:"10px",backgroundColor:"white",border:"1px solid #ddd",borderRadius:"4px",flexShrink:0},children:[Tt.jsx("div",{style:{fontSize:"14px",fontWeight:"bold",marginBottom:"8px",color:"#333"},children:":"}),Tt.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:k.map(ne=>Tt.jsx("button",{onClick:()=>B(ne.text),style:{padding:"8px 12px",textAlign:"left",backgroundColor:"#f8f9fa",border:"1px solid #e9ecef",borderRadius:"4px",cursor:"pointer",fontSize:"14px",color:"#495057",transition:"background-color 0.2s"},onMouseEnter:K=>{K.currentTarget.style.backgroundColor="#e9ecef"},onMouseLeave:K=>{K.currentTarget.style.backgroundColor="#f8f9fa"},title:ne.description,children:ne.text},ne.id))})]}),Tt.jsxs("form",{onSubmit:T,style:{display:"flex",gap:"10px",flexShrink:0},children:[Tt.jsx("textarea",{value:h,onChange:_,onKeyPress:oe,placeholder:"Claude...",style:{flex:1,padding:"10px",border:"1px solid #ddd",borderRadius:"4px",resize:"none",height:"60px",backgroundColor:"#fff",color:"#333"},disabled:S}),Tt.jsx("button",{type:"submit",disabled:S||!h.trim(),style:{padding:"10px 20px",backgroundColor:S||!h.trim()?"#ccc":"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:S||!h.trim()?"not-allowed":"pointer",height:"60px"},children:S?"Claude ...":""})]})]})]}):Tt.jsxs("div",{style:{padding:"20px",backgroundColor:"#f5f5f5",borderRadius:"8px",margin:"20px 0",color:"#333",textAlign:"left"},children:[Tt.jsx("h3",{style:{color:"#333",margin:"0 0 16px 0"},children:"AI Chat"}),Tt.jsx("p",{style:{color:"#666",margin:"0"},children:"AI.envVITE_ANTHROPIC_API_KEY"})]})}var iy={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.3.1/LICENSE.txt
 */var xA=iy.exports,Jb;function wA(){return Jb||(Jb=1,function(r,e){(function(n,h){r.exports=h()})(xA,function(){var n={},h={};function _(S,u,k){if(h[S]=k,S==="index"){var B="var sharedModule = {}; ("+h.shared+")(sharedModule); ("+h.worker+")(sharedModule);",q={};return h.shared(q),h.index(n,q),typeof window<"u"&&n.setWorkerUrl(window.URL.createObjectURL(new Blob([B],{type:"text/javascript"}))),n}}_("shared",["exports"],function(S){function u(o,i,l,d){return new(l||(l=Promise))(function(g,x){function w(P){try{C(d.next(P))}catch(O){x(O)}}function M(P){try{C(d.throw(P))}catch(O){x(O)}}function C(P){var O;P.done?g(P.value):(O=P.value,O instanceof l?O:new l(function(L){L(O)})).then(w,M)}C((d=d.apply(o,i||[])).next())})}function k(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var B,q;function oe(){if(q)return B;function o(i,l){this.x=i,this.y=l}return q=1,B=o,o.prototype={clone:function(){return new o(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,l){return this.clone()._rotateAround(i,l)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var l=i.x-this.x,d=i.y-this.y;return l*l+d*d},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,l){return Math.atan2(this.x*l-this.y*i,this.x*i+this.y*l)},_matMult:function(i){var l=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=l,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var l=Math.cos(i),d=Math.sin(i),g=d*this.x+l*this.y;return this.x=l*this.x-d*this.y,this.y=g,this},_rotateAround:function(i,l){var d=Math.cos(i),g=Math.sin(i),x=l.y+g*(this.x-l.x)+d*(this.y-l.y);return this.x=l.x+d*(this.x-l.x)-g*(this.y-l.y),this.y=x,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(i){return i instanceof o?i:Array.isArray(i)?new o(i[0],i[1]):i},B}typeof SuppressedError=="function"&&SuppressedError;var ne,K,le=k(oe()),Ge=function(){if(K)return ne;function o(i,l,d,g){this.cx=3*i,this.bx=3*(d-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(g-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=l,this.p2x=d,this.p2y=g}return K=1,ne=o,o.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,l){if(l===void 0&&(l=1e-6),i<0)return 0;if(i>1)return 1;for(var d=i,g=0;g<8;g++){var x=this.sampleCurveX(d)-i;if(Math.abs(x)<l)return d;var w=this.sampleCurveDerivativeX(d);if(Math.abs(w)<1e-6)break;d-=x/w}var M=0,C=1;for(d=i,g=0;g<20&&(x=this.sampleCurveX(d),!(Math.abs(x-i)<l));g++)i>x?M=d:C=d,d=.5*(C-M)+M;return d},solve:function(i,l){return this.sampleCurveY(this.solveCurveX(i,l))}},ne}(),tt=k(Ge);let Ke,ht;function bt(){return Ke==null&&(Ke=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ke}function It(){if(ht==null&&(ht=!1,bt())){const i=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(i){for(let d=0;d<5*5;d++){const g=4*d;i.fillStyle=`rgb(${g},${g+1},${g+2})`,i.fillRect(d%5,Math.floor(d/5),1,1)}const l=i.getImageData(0,0,5,5).data;for(let d=0;d<5*5*4;d++)if(d%4!=3&&l[d]!==d){ht=!0;break}}}return ht||!1}var wt,zt=1e-6,Pt=typeof Float32Array<"u"?Float32Array:Array;function ut(){var o=new Pt(9);return Pt!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function Mt(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function Ri(){var o=new Pt(3);return Pt!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function bi(o,i,l){var d=new Pt(3);return d[0]=o,d[1]=i,d[2]=l,d}function te(o,i,l){var d=i[0],g=i[1],x=i[2],w=i[3];return o[0]=l[0]*d+l[4]*g+l[8]*x+l[12]*w,o[1]=l[1]*d+l[5]*g+l[9]*x+l[13]*w,o[2]=l[2]*d+l[6]*g+l[10]*x+l[14]*w,o[3]=l[3]*d+l[7]*g+l[11]*x+l[15]*w,o}function be(){var o=new Pt(4);return Pt!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function Fe(){var o=new Pt(2);return Pt!=Float32Array&&(o[0]=0,o[1]=0),o}function xt(o,i){var l=new Pt(2);return l[0]=o,l[1]=i,l}Math.hypot||(Math.hypot=function(){for(var o=0,i=arguments.length;i--;)o+=arguments[i]*arguments[i];return Math.sqrt(o)}),Ri(),wt=new Pt(4),Pt!=Float32Array&&(wt[0]=0,wt[1]=0,wt[2]=0,wt[3]=0),Ri(),bi(1,0,0),bi(0,1,0),be(),be(),ut(),Fe();const Ae=8192;function st(o,i,l){return i*(Ae/(o.tileSize*Math.pow(2,l-o.tileID.overscaledZ)))}function Ct(o,i){return(o%i+i)%i}function yi(o,i,l){return o*(1-l)+i*l}function xe(o){if(o<=0)return 0;if(o>=1)return 1;const i=o*o,l=i*o;return 4*(o<.5?l:3*(o-i)+l-.75)}function lt(o,i,l,d){const g=new tt(o,i,l,d);return x=>g.solve(x)}const Dt=lt(.25,.1,.25,1);function vt(o,i,l){return Math.min(l,Math.max(i,o))}function Zt(o,i,l){const d=l-i,g=((o-i)%d+d)%d+i;return g===i?l:g}function ti(o,...i){for(const l of i)for(const d in l)o[d]=l[d];return o}let Jt=1;function ar(o,i,l){const d={};for(const g in o)d[g]=i.call(this,o[g],g,o);return d}function zi(o,i,l){const d={};for(const g in o)i.call(this,o[g],g,o)&&(d[g]=o[g]);return d}function Fn(o){return Array.isArray(o)?o.map(Fn):typeof o=="object"&&o?ar(o,Fn):o}const Is={};function qn(o){Is[o]||(typeof console<"u"&&console.warn(o),Is[o]=!0)}function sr(o,i,l){return(l.y-o.y)*(i.x-o.x)>(i.y-o.y)*(l.x-o.x)}function as(o){return typeof WorkerGlobalScope<"u"&&o!==void 0&&o instanceof WorkerGlobalScope}let Nn=null;function yl(o){return typeof ImageBitmap<"u"&&o instanceof ImageBitmap}const vl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function dr(o,i,l,d,g){return u(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const x=new VideoFrame(o,{timestamp:0});try{const w=x==null?void 0:x.format;if(!w||!w.startsWith("BGR")&&!w.startsWith("RGB"))throw new Error(`Unrecognized format ${w}`);const M=w.startsWith("BGR"),C=new Uint8ClampedArray(d*g*4);if(yield x.copyTo(C,function(P,O,L,j,Z){const H=4*Math.max(1,0),X=(Math.max(0,L)-L)*j*4+H,re=4*j,ue=Math.max(0,O),ve=Math.max(0,L);return{rect:{x:ue,y:ve,width:Math.min(P.width,O+j)-ue,height:Math.min(P.height,L+Z)-ve},layout:[{offset:X,stride:re}]}}(o,i,l,d,g)),M)for(let P=0;P<C.length;P+=4){const O=C[P];C[P]=C[P+2],C[P+2]=O}return C}finally{x.close()}})}let Po,no;function Fa(o,i,l,d){return o.addEventListener(i,l,d),{unsubscribe:()=>{o.removeEventListener(i,l,d)}}}function fa(o){return o/Math.PI*180}const vc={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},bl={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},uu="AbortError";function xl(){return new Error(uu)}const Na={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Ir(o){return Na.REGISTERED_PROTOCOLS[o.substring(0,o.indexOf("://"))]}const $r="global-dispatcher";class Wn extends Error{constructor(i,l,d,g){super(`AJAXError: ${l} (${i}): ${d}`),this.status=i,this.statusText=l,this.url=d,this.body=g}}const ro=()=>as(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,bc=function(o,i){if(/:\/\//.test(o.url)&&!/^https?:|^file:/.test(o.url)){const d=Ir(o.url);if(d)return d(o,i);if(as(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:o,targetMapId:$r},i)}if(!(/^file:/.test(l=o.url)||/^file:/.test(ro())&&!/^\w+:/.test(l))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(d,g){return u(this,void 0,void 0,function*(){const x=new Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,cache:d.cache,referrer:ro(),signal:g.signal});let w,M;d.type!=="json"||x.headers.has("Accept")||x.headers.set("Accept","application/json");try{w=yield fetch(x)}catch(P){throw new Wn(0,P.message,d.url,new Blob)}if(!w.ok){const P=yield w.blob();throw new Wn(w.status,w.statusText,d.url,P)}M=d.type==="arrayBuffer"||d.type==="image"?w.arrayBuffer():d.type==="json"?w.json():w.text();const C=yield M;if(g.signal.aborted)throw xl();return{data:C,cacheControl:w.headers.get("Cache-Control"),expires:w.headers.get("Expires")}})}(o,i);if(as(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:o,mustQueue:!0,targetMapId:$r},i)}var l;return function(d,g){return new Promise((x,w)=>{var M;const C=new XMLHttpRequest;C.open(d.method||"GET",d.url,!0),d.type!=="arrayBuffer"&&d.type!=="image"||(C.responseType="arraybuffer");for(const P in d.headers)C.setRequestHeader(P,d.headers[P]);d.type==="json"&&(C.responseType="text",!((M=d.headers)===null||M===void 0)&&M.Accept||C.setRequestHeader("Accept","application/json")),C.withCredentials=d.credentials==="include",C.onerror=()=>{w(new Error(C.statusText))},C.onload=()=>{if(!g.signal.aborted)if((C.status>=200&&C.status<300||C.status===0)&&C.response!==null){let P=C.response;if(d.type==="json")try{P=JSON.parse(C.response)}catch(O){return void w(O)}x({data:P,cacheControl:C.getResponseHeader("Cache-Control"),expires:C.getResponseHeader("Expires")})}else{const P=new Blob([C.response],{type:C.getResponseHeader("Content-Type")});w(new Wn(C.status,C.statusText,d.url,P))}},g.signal.addEventListener("abort",()=>{C.abort(),w(xl())}),C.send(d.body)})}(o,i)};function hu(o){if(!o||o.indexOf("://")<=0||o.indexOf("data:image/")===0||o.indexOf("blob:")===0)return!0;const i=new URL(o),l=window.location;return i.protocol===l.protocol&&i.host===l.host}function wl(o,i,l){l[o]&&l[o].indexOf(i)!==-1||(l[o]=l[o]||[],l[o].push(i))}function Ua(o,i,l){if(l&&l[o]){const d=l[o].indexOf(i);d!==-1&&l[o].splice(d,1)}}class De{constructor(i,l={}){ti(this,l),this.type=i}}class W extends De{constructor(i,l={}){super("error",ti({error:i},l))}}class J{on(i,l){return this._listeners=this._listeners||{},wl(i,l,this._listeners),{unsubscribe:()=>{this.off(i,l)}}}off(i,l){return Ua(i,l,this._listeners),Ua(i,l,this._oneTimeListeners),this}once(i,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},wl(i,l,this._oneTimeListeners),this):new Promise(d=>this.once(i,d))}fire(i,l){typeof i=="string"&&(i=new De(i,l||{}));const d=i.type;if(this.listens(d)){i.target=this;const g=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const M of g)M.call(this,i);const x=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const M of x)Ua(d,M,this._oneTimeListeners),M.call(this,i);const w=this._eventedParent;w&&(ti(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(i))}else i instanceof W&&console.error(i.error);return this}listens(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)}setEventedParent(i,l){return this._eventedParent=i,this._eventedParentData=l,this}}var $={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const fe=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ee(o,i){const l={};for(const d in o)d!=="ref"&&(l[d]=o[d]);return fe.forEach(d=>{d in i&&(l[d]=i[d])}),l}function we(o,i){if(Array.isArray(o)){if(!Array.isArray(i)||o.length!==i.length)return!1;for(let l=0;l<o.length;l++)if(!we(o[l],i[l]))return!1;return!0}if(typeof o=="object"&&o!==null&&i!==null){if(typeof i!="object"||Object.keys(o).length!==Object.keys(i).length)return!1;for(const l in o)if(!we(o[l],i[l]))return!1;return!0}return o===i}function ze(o,i){o.push(i)}function Ce(o,i,l){ze(l,{command:"addSource",args:[o,i[o]]})}function Ye(o,i,l){ze(i,{command:"removeSource",args:[o]}),l[o]=!0}function Ze(o,i,l,d){Ye(o,l,d),Ce(o,i,l)}function Pe(o,i,l){let d;for(d in o[l])if(Object.prototype.hasOwnProperty.call(o[l],d)&&d!=="data"&&!we(o[l][d],i[l][d]))return!1;for(d in i[l])if(Object.prototype.hasOwnProperty.call(i[l],d)&&d!=="data"&&!we(o[l][d],i[l][d]))return!1;return!0}function nt(o,i,l,d,g,x){o=o||{},i=i||{};for(const w in o)Object.prototype.hasOwnProperty.call(o,w)&&(we(o[w],i[w])||l.push({command:x,args:[d,w,i[w],g]}));for(const w in i)Object.prototype.hasOwnProperty.call(i,w)&&!Object.prototype.hasOwnProperty.call(o,w)&&(we(o[w],i[w])||l.push({command:x,args:[d,w,i[w],g]}))}function yt(o){return o.id}function St(o,i){return o[i.id]=i,o}class je{constructor(i,l,d,g){this.message=(i?`${i}: `:"")+d,g&&(this.identifier=g),l!=null&&l.__line__&&(this.line=l.__line__)}}function Vt(o,...i){for(const l of i)for(const d in l)o[d]=l[d];return o}class Ot extends Error{constructor(i,l){super(l),this.message=l,this.key=i}}class Kt{constructor(i,l=[]){this.parent=i,this.bindings={};for(const[d,g]of l)this.bindings[d]=g}concat(i){return new Kt(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const ki={kind:"null"},ct={kind:"number"},Bt={kind:"string"},_t={kind:"boolean"},ii={kind:"color"},In={kind:"projectionDefinition"},pa={kind:"object"},Gt={kind:"value"},$n={kind:"collator"},Xi={kind:"formatted"},or={kind:"padding"},Sl={kind:"resolvedImage"},ao={kind:"variableAnchorOffsetCollection"};function fr(o,i){return{kind:"array",itemType:o,N:i}}function rn(o){if(o.kind==="array"){const i=rn(o.itemType);return typeof o.N=="number"?`array<${i}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${i}>`}return o.kind}const Tm=[ki,ct,Bt,_t,ii,In,Xi,pa,fr(Gt),or,Sl,ao];function Tl(o,i){if(i.kind==="error")return null;if(o.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!Tl(o.itemType,i.itemType))&&(typeof o.N!="number"||o.N===i.N))return null}else{if(o.kind===i.kind)return null;if(o.kind==="value"){for(const l of Tm)if(!Tl(l,i))return null}}return`Expected ${rn(o)} but found ${rn(i)} instead.`}function Th(o,i){return i.some(l=>l.kind===o.kind)}function zo(o,i){return i.some(l=>l==="null"?o===null:l==="array"?Array.isArray(o):l==="object"?o&&!Array.isArray(o)&&typeof o=="object":l===typeof o)}function so(o,i){return o.kind==="array"&&i.kind==="array"?o.itemType.kind===i.itemType.kind&&typeof o.N=="number":o.kind===i.kind}const du=.96422,Cs=.82521,Eh=4/29,El=6/29,Ml=3*El*El,Bd=El*El*El,Mh=Math.PI/180,fu=180/Math.PI;function Ld(o){return(o%=360)<0&&(o+=360),o}function Aa([o,i,l,d]){let g,x;const w=Fd((.2225045*(o=ko(o))+.7168786*(i=ko(i))+.0606169*(l=ko(l)))/1);o===i&&i===l?g=x=w:(g=Fd((.4360747*o+.3850649*i+.1430804*l)/du),x=Fd((.0139322*o+.0971045*i+.7141733*l)/Cs));const M=116*w-16;return[M<0?0:M,500*(g-w),200*(w-x),d]}function ko(o){return o<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function Fd(o){return o>Bd?Math.pow(o,1/3):o/Ml+Eh}function pu([o,i,l,d]){let g=(o+16)/116,x=isNaN(i)?g:g+i/500,w=isNaN(l)?g:g-l/200;return g=1*Al(g),x=du*Al(x),w=Cs*Al(w),[Ah(3.1338561*x-1.6168667*g-.4906146*w),Ah(-.9787684*x+1.9161415*g+.033454*w),Ah(.0719453*x-.2289914*g+1.4052427*w),d]}function Ah(o){return(o=o<=.00304?12.92*o:1.055*Math.pow(o,1/2.4)-.055)<0?0:o>1?1:o}function Al(o){return o>El?o*o*o:Ml*(o-Eh)}function mu(o){return parseInt(o.padEnd(2,o),16)/255}function Qn(o,i){return wi(i?o/100:o,0,1)}function wi(o,i,l){return Math.min(Math.max(i,o),l)}function Oo(o){return!o.some(Number.isNaN)}const Ds={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function ma(o,i,l){return o+l*(i-o)}function Il(o,i,l){return o.map((d,g)=>ma(d,i[g],l))}class Bi{constructor(i,l,d,g=1,x=!0){this.r=i,this.g=l,this.b=d,this.a=g,x||(this.r*=g,this.g*=g,this.b*=g,g||this.overwriteGetter("rgb",[i,l,d,g]))}static parse(i){if(i instanceof Bi)return i;if(typeof i!="string")return;const l=function(d){if((d=d.toLowerCase().trim())==="transparent")return[0,0,0,0];const g=Ds[d];if(g){const[w,M,C]=g;return[w/255,M/255,C/255,1]}if(d.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(d)){const w=d.length<6?1:2;let M=1;return[mu(d.slice(M,M+=w)),mu(d.slice(M,M+=w)),mu(d.slice(M,M+=w)),mu(d.slice(M,M+w)||"ff")]}if(d.startsWith("rgb")){const w=d.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[M,C,P,O,L,j,Z,H,X,re,ue,ve]=w,de=[O||" ",Z||" ",re].join("");if(de==="  "||de==="  /"||de===",,"||de===",,,"){const V=[P,j,X].join(""),ie=V==="%%%"?100:V===""?255:0;if(ie){const pe=[wi(+C/ie,0,1),wi(+L/ie,0,1),wi(+H/ie,0,1),ue?Qn(+ue,ve):1];if(Oo(pe))return pe}}return}}const x=d.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[w,M,C,P,O,L,j,Z,H]=x,X=[C||" ",O||" ",j].join("");if(X==="  "||X==="  /"||X===",,"||X===",,,"){const re=[+M,wi(+P,0,100),wi(+L,0,100),Z?Qn(+Z,H):1];if(Oo(re))return function([ue,ve,de,V]){function ie(pe){const Be=(pe+ue/30)%12,ot=ve*Math.min(de,1-de);return de-ot*Math.max(-1,Math.min(Be-3,9-Be,1))}return ue=Ld(ue),ve/=100,de/=100,[ie(0),ie(8),ie(4),V]}(re)}}}(i);return l?new Bi(...l,!1):void 0}get rgb(){const{r:i,g:l,b:d,a:g}=this,x=g||1/0;return this.overwriteGetter("rgb",[i/x,l/x,d/x,g])}get hcl(){return this.overwriteGetter("hcl",function(i){const[l,d,g,x]=Aa(i),w=Math.sqrt(d*d+g*g);return[Math.round(1e4*w)?Ld(Math.atan2(g,d)*fu):NaN,w,l,x]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Aa(this.rgb))}overwriteGetter(i,l){return Object.defineProperty(this,i,{value:l}),l}toString(){const[i,l,d,g]=this.rgb;return`rgba(${[i,l,d].map(x=>Math.round(255*x)).join(",")},${g})`}static interpolate(i,l,d,g="rgb"){switch(g){case"rgb":{const[x,w,M,C]=Il(i.rgb,l.rgb,d);return new Bi(x,w,M,C,!1)}case"hcl":{const[x,w,M,C]=i.hcl,[P,O,L,j]=l.hcl;let Z,H;if(isNaN(x)||isNaN(P))isNaN(x)?isNaN(P)?Z=NaN:(Z=P,M!==1&&M!==0||(H=O)):(Z=x,L!==1&&L!==0||(H=w));else{let de=P-x;P>x&&de>180?de-=360:P<x&&x-P>180&&(de+=360),Z=x+d*de}const[X,re,ue,ve]=function([de,V,ie,pe]){return de=isNaN(de)?0:de*Mh,pu([ie,Math.cos(de)*V,Math.sin(de)*V,pe])}([Z,H??ma(w,O,d),ma(M,L,d),ma(C,j,d)]);return new Bi(X,re,ue,ve,!1)}case"lab":{const[x,w,M,C]=pu(Il(i.lab,l.lab,d));return new Bi(x,w,M,C,!1)}}}}Bi.black=new Bi(0,0,0,1),Bi.white=new Bi(1,1,1,1),Bi.transparent=new Bi(0,0,0,0),Bi.red=new Bi(1,0,0,1);class kr{constructor(i,l,d){this.sensitivity=i?l?"variant":"case":l?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,l){return this.collator.compare(i,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const gu=["bottom","center","top"];class Cl{constructor(i,l,d,g,x,w){this.text=i,this.image=l,this.scale=d,this.fontStack=g,this.textColor=x,this.verticalAlign=w}}class Hr{constructor(i){this.sections=i}static fromString(i){return new Hr([new Cl(i,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||i.image&&i.image.name.length!==0)}static factory(i){return i instanceof Hr?i:Hr.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}}class xr{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof xr)return i;if(typeof i=="number")return new xr([i,i,i,i]);if(Array.isArray(i)&&!(i.length<1||i.length>4)){for(const l of i)if(typeof l!="number")return;switch(i.length){case 1:i=[i[0],i[0],i[0],i[0]];break;case 2:i=[i[0],i[1],i[0],i[1]];break;case 3:i=[i[0],i[1],i[2],i[1]]}return new xr(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,l,d){return new xr(Il(i.values,l.values,d))}}class Cn{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const Ih=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Cr{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof Cr)return i;if(Array.isArray(i)&&!(i.length<1)&&i.length%2==0){for(let l=0;l<i.length;l+=2){const d=i[l],g=i[l+1];if(typeof d!="string"||!Ih.has(d)||!Array.isArray(g)||g.length!==2||typeof g[0]!="number"||typeof g[1]!="number")return}return new Cr(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,l,d){const g=i.values,x=l.values;if(g.length!==x.length)throw new Cn(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${l.toString()}`);const w=[];for(let M=0;M<g.length;M+=2){if(g[M]!==x[M])throw new Cn(`Cannot interpolate values containing mismatched anchors. from[${M}]: ${g[M]}, to[${M}]: ${x[M]}`);w.push(g[M]);const[C,P]=g[M+1],[O,L]=x[M+1];w.push([ma(C,O,d),ma(P,L,d)])}return new Cr(w)}}class Yr{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new Yr({name:i,available:!1}):null}}class lr{constructor(i,l,d){this.from=i,this.to=l,this.transition=d}static interpolate(i,l,d){return new lr(i,l,d)}static parse(i){return i instanceof lr?i:Array.isArray(i)&&i.length===3&&typeof i[0]=="string"&&typeof i[1]=="string"&&typeof i[2]=="number"?new lr(i[0],i[1],i[2]):typeof i=="object"&&typeof i.from=="string"&&typeof i.to=="string"&&typeof i.transition=="number"?new lr(i.from,i.to,i.transition):typeof i=="string"?new lr(i,i,1):void 0}}function Dl(o,i,l,d){return typeof o=="number"&&o>=0&&o<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof l=="number"&&l>=0&&l<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:`Invalid rgba value [${[o,i,l,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof d=="number"?[o,i,l,d]:[o,i,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ia(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof lr||o instanceof Bi||o instanceof kr||o instanceof Hr||o instanceof xr||o instanceof Cr||o instanceof Yr)return!0;if(Array.isArray(o)){for(const i of o)if(!Ia(i))return!1;return!0}if(typeof o=="object"){for(const i in o)if(!Ia(o[i]))return!1;return!0}return!1}function vn(o){if(o===null)return ki;if(typeof o=="string")return Bt;if(typeof o=="boolean")return _t;if(typeof o=="number")return ct;if(o instanceof Bi)return ii;if(o instanceof lr)return In;if(o instanceof kr)return $n;if(o instanceof Hr)return Xi;if(o instanceof xr)return or;if(o instanceof Cr)return ao;if(o instanceof Yr)return Sl;if(Array.isArray(o)){const i=o.length;let l;for(const d of o){const g=vn(d);if(l){if(l===g)continue;l=Gt;break}l=g}return fr(l||Gt,i)}return pa}function Bo(o){const i=typeof o;return o===null?"":i==="string"||i==="number"||i==="boolean"?String(o):o instanceof Bi||o instanceof lr||o instanceof Hr||o instanceof xr||o instanceof Cr||o instanceof Yr?o.toString():JSON.stringify(o)}class oo{constructor(i,l){this.type=i,this.value=l}static parse(i,l){if(i.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Ia(i[1]))return l.error("invalid value");const d=i[1];let g=vn(d);const x=l.expectedType;return g.kind!=="array"||g.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(g=x),new oo(g,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const lo={string:Bt,number:ct,boolean:_t,object:pa};class Jn{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let d,g=1;const x=i[0];if(x==="array"){let M,C;if(i.length>2){const P=i[1];if(typeof P!="string"||!(P in lo)||P==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);M=lo[P],g++}else M=Gt;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return l.error('The length argument to "array" must be a positive integer literal',2);C=i[2],g++}d=fr(M,C)}else{if(!lo[x])throw new Error(`Types doesn't contain name = ${x}`);d=lo[x]}const w=[];for(;g<i.length;g++){const M=l.parse(i[g],g,Gt);if(!M)return null;w.push(M)}return new Jn(d,w)}evaluate(i){for(let l=0;l<this.args.length;l++){const d=this.args[l].evaluate(i);if(!Tl(this.type,vn(d)))return d;if(l===this.args.length-1)throw new Cn(`Expected value to be of type ${rn(this.type)}, but found ${rn(vn(d))} instead.`)}throw new Error}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const sn={"to-boolean":_t,"to-color":ii,"to-number":ct,"to-string":Bt};class ga{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const d=i[0];if(!sn[d])throw new Error(`Can't parse ${d} as it is not part of the known types`);if((d==="to-boolean"||d==="to-string")&&i.length!==2)return l.error("Expected one argument.");const g=sn[d],x=[];for(let w=1;w<i.length;w++){const M=l.parse(i[w],w,Gt);if(!M)return null;x.push(M)}return new ga(g,x)}evaluate(i){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(i);case"color":{let l,d;for(const g of this.args){if(l=g.evaluate(i),d=null,l instanceof Bi)return l;if(typeof l=="string"){const x=i.parseColor(l);if(x)return x}else if(Array.isArray(l)&&(d=l.length<3||l.length>4?`Invalid rgba value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:Dl(l[0],l[1],l[2],l[3]),!d))return new Bi(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new Cn(d||`Could not parse color from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"padding":{let l;for(const d of this.args){l=d.evaluate(i);const g=xr.parse(l);if(g)return g}throw new Cn(`Could not parse padding from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"variableAnchorOffsetCollection":{let l;for(const d of this.args){l=d.evaluate(i);const g=Cr.parse(l);if(g)return g}throw new Cn(`Could not parse variableAnchorOffsetCollection from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"number":{let l=null;for(const d of this.args){if(l=d.evaluate(i),l===null)return 0;const g=Number(l);if(!isNaN(g))return g}throw new Cn(`Could not convert ${JSON.stringify(l)} to number.`)}case"formatted":return Hr.fromString(Bo(this.args[0].evaluate(i)));case"resolvedImage":return Yr.fromString(Bo(this.args[0].evaluate(i)));case"projectionDefinition":return this.args[0].evaluate(i);default:return Bo(this.args[0].evaluate(i))}}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const Ei=["Unknown","Point","LineString","Polygon"];class gi{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ei[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let l=this._parseColorCache[i];return l||(l=this._parseColorCache[i]=Bi.parse(i)),l}}class co{constructor(i,l,d=[],g,x=new Kt,w=[]){this.registry=i,this.path=d,this.key=d.map(M=>`[${M}]`).join(""),this.scope=x,this.errors=w,this.expectedType=g,this._isConstant=l}parse(i,l,d,g,x={}){return l?this.concat(l,d,g)._parse(i,x):this._parse(i,x)}_parse(i,l){function d(g,x,w){return w==="assert"?new Jn(x,[g]):w==="coerce"?new ga(x,[g]):g}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=i[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const x=this.registry[g];if(x){let w=x.parse(i,this);if(!w)return null;if(this.expectedType){const M=this.expectedType,C=w.type;if(M.kind!=="string"&&M.kind!=="number"&&M.kind!=="boolean"&&M.kind!=="object"&&M.kind!=="array"||C.kind!=="value")if(M.kind!=="projectionDefinition"||C.kind!=="string"&&C.kind!=="array")if(M.kind!=="color"&&M.kind!=="formatted"&&M.kind!=="resolvedImage"||C.kind!=="value"&&C.kind!=="string")if(M.kind!=="padding"||C.kind!=="value"&&C.kind!=="number"&&C.kind!=="array")if(M.kind!=="variableAnchorOffsetCollection"||C.kind!=="value"&&C.kind!=="array"){if(this.checkSubtype(M,C))return null}else w=d(w,M,l.typeAnnotation||"coerce");else w=d(w,M,l.typeAnnotation||"coerce");else w=d(w,M,l.typeAnnotation||"coerce");else w=d(w,M,l.typeAnnotation||"coerce");else w=d(w,M,l.typeAnnotation||"assert")}if(!(w instanceof oo)&&w.type.kind!=="resolvedImage"&&this._isConstant(w)){const M=new gi;try{w=new oo(w.type,w.evaluate(M))}catch(C){return this.error(C.message),null}}return w}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,l,d){const g=typeof i=="number"?this.path.concat(i):this.path,x=d?this.scope.concat(d):this.scope;return new co(this.registry,this._isConstant,g,l||null,x,this.errors)}error(i,...l){const d=`${this.key}${l.map(g=>`[${g}]`).join("")}`;this.errors.push(new Ot(d,i))}checkSubtype(i,l){const d=Tl(i,l);return d&&this.error(d),d}}class Oi{constructor(i,l){this.type=l.type,this.bindings=[].concat(i),this.result=l}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const l of this.bindings)i(l[1]);i(this.result)}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const d=[];for(let x=1;x<i.length-1;x+=2){const w=i[x];if(typeof w!="string")return l.error(`Expected string, but found ${typeof w} instead.`,x);if(/[^a-zA-Z0-9_]/.test(w))return l.error("Variable names must contain only alphanumeric characters or '_'.",x);const M=l.parse(i[x+1],x+1);if(!M)return null;d.push([w,M])}const g=l.parse(i[i.length-1],i.length-1,l.expectedType,d);return g?new Oi(d,g):null}outputDefined(){return this.result.outputDefined()}}class uo{constructor(i,l){this.type=l.type,this.name=i,this.boundExpression=l}static parse(i,l){if(i.length!==2||typeof i[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const d=i[1];return l.scope.has(d)?new uo(d,l.scope.get(d)):l.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}}class _a{constructor(i,l,d){this.type=i,this.index=l,this.input=d}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const d=l.parse(i[1],1,ct),g=l.parse(i[2],2,fr(l.expectedType||Gt));return d&&g?new _a(g.type.itemType,d,g):null}evaluate(i){const l=this.index.evaluate(i),d=this.input.evaluate(i);if(l<0)throw new Cn(`Array index out of bounds: ${l} < 0.`);if(l>=d.length)throw new Cn(`Array index out of bounds: ${l} > ${d.length-1}.`);if(l!==Math.floor(l))throw new Cn(`Array index must be an integer, but found ${l} instead.`);return d[l]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}}class xc{constructor(i,l){this.type=_t,this.needle=i,this.haystack=l}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const d=l.parse(i[1],1,Gt),g=l.parse(i[2],2,Gt);return d&&g?Th(d.type,[_t,Bt,ct,ki,Gt])?new xc(d,g):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${rn(d.type)} instead`):null}evaluate(i){const l=this.needle.evaluate(i),d=this.haystack.evaluate(i);if(!d)return!1;if(!zo(l,["boolean","string","number","null"]))throw new Cn(`Expected first argument to be of type boolean, string, number or null, but found ${rn(vn(l))} instead.`);if(!zo(d,["string","array"]))throw new Cn(`Expected second argument to be of type array or string, but found ${rn(vn(d))} instead.`);return d.indexOf(l)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}}class Dr{constructor(i,l,d){this.type=ct,this.needle=i,this.haystack=l,this.fromIndex=d}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const d=l.parse(i[1],1,Gt),g=l.parse(i[2],2,Gt);if(!d||!g)return null;if(!Th(d.type,[_t,Bt,ct,ki,Gt]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${rn(d.type)} instead`);if(i.length===4){const x=l.parse(i[3],3,ct);return x?new Dr(d,g,x):null}return new Dr(d,g)}evaluate(i){const l=this.needle.evaluate(i),d=this.haystack.evaluate(i);if(!zo(l,["boolean","string","number","null"]))throw new Cn(`Expected first argument to be of type boolean, string, number or null, but found ${rn(vn(l))} instead.`);let g;if(this.fromIndex&&(g=this.fromIndex.evaluate(i)),zo(d,["string"])){const x=d.indexOf(l,g);return x===-1?-1:[...d.slice(0,x)].length}if(zo(d,["array"]))return d.indexOf(l,g);throw new Cn(`Expected second argument to be of type array or string, but found ${rn(vn(d))} instead.`)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}}class Rs{constructor(i,l,d,g,x,w){this.inputType=i,this.type=l,this.input=d,this.cases=g,this.outputs=x,this.otherwise=w}static parse(i,l){if(i.length<5)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return l.error("Expected an even number of arguments.");let d,g;l.expectedType&&l.expectedType.kind!=="value"&&(g=l.expectedType);const x={},w=[];for(let P=2;P<i.length-1;P+=2){let O=i[P];const L=i[P+1];Array.isArray(O)||(O=[O]);const j=l.concat(P);if(O.length===0)return j.error("Expected at least one branch label.");for(const H of O){if(typeof H!="number"&&typeof H!="string")return j.error("Branch labels must be numbers or strings.");if(typeof H=="number"&&Math.abs(H)>Number.MAX_SAFE_INTEGER)return j.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof H=="number"&&Math.floor(H)!==H)return j.error("Numeric branch labels must be integer values.");if(d){if(j.checkSubtype(d,vn(H)))return null}else d=vn(H);if(x[String(H)]!==void 0)return j.error("Branch labels must be unique.");x[String(H)]=w.length}const Z=l.parse(L,P,g);if(!Z)return null;g=g||Z.type,w.push(Z)}const M=l.parse(i[1],1,Gt);if(!M)return null;const C=l.parse(i[i.length-1],i.length-1,g);return C?M.type.kind!=="value"&&l.concat(1).checkSubtype(d,M.type)?null:new Rs(d,g,M,x,w,C):null}evaluate(i){const l=this.input.evaluate(i);return(vn(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}}class Lo{constructor(i,l,d){this.type=i,this.branches=l,this.otherwise=d}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return l.error("Expected an odd number of arguments.");let d;l.expectedType&&l.expectedType.kind!=="value"&&(d=l.expectedType);const g=[];for(let w=1;w<i.length-1;w+=2){const M=l.parse(i[w],w,_t);if(!M)return null;const C=l.parse(i[w+1],w+1,d);if(!C)return null;g.push([M,C]),d=d||C.type}const x=l.parse(i[i.length-1],i.length-1,d);if(!x)return null;if(!d)throw new Error("Can't infer output type");return new Lo(d,g,x)}evaluate(i){for(const[l,d]of this.branches)if(l.evaluate(i))return d.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[l,d]of this.branches)i(l),i(d);i(this.otherwise)}outputDefined(){return this.branches.every(([i,l])=>l.outputDefined())&&this.otherwise.outputDefined()}}class ho{constructor(i,l,d,g){this.type=i,this.input=l,this.beginIndex=d,this.endIndex=g}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const d=l.parse(i[1],1,Gt),g=l.parse(i[2],2,ct);if(!d||!g)return null;if(!Th(d.type,[fr(Gt),Bt,Gt]))return l.error(`Expected first argument to be of type array or string, but found ${rn(d.type)} instead`);if(i.length===4){const x=l.parse(i[3],3,ct);return x?new ho(d.type,d,g,x):null}return new ho(d.type,d,g)}evaluate(i){const l=this.input.evaluate(i),d=this.beginIndex.evaluate(i);let g;if(this.endIndex&&(g=this.endIndex.evaluate(i)),zo(l,["string"]))return[...l].slice(d,g).join("");if(zo(l,["array"]))return l.slice(d,g);throw new Cn(`Expected first argument to be of type array or string, but found ${rn(vn(l))} instead.`)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}}function Ch(o,i){const l=o.length-1;let d,g,x=0,w=l,M=0;for(;x<=w;)if(M=Math.floor((x+w)/2),d=o[M],g=o[M+1],d<=i){if(M===l||i<g)return M;x=M+1}else{if(!(d>i))throw new Cn("Input is not a number.");w=M-1}return 0}class Fo{constructor(i,l,d){this.type=i,this.input=l,this.labels=[],this.outputs=[];for(const[g,x]of d)this.labels.push(g),this.outputs.push(x)}static parse(i,l){if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");const d=l.parse(i[1],1,ct);if(!d)return null;const g=[];let x=null;l.expectedType&&l.expectedType.kind!=="value"&&(x=l.expectedType);for(let w=1;w<i.length;w+=2){const M=w===1?-1/0:i[w],C=i[w+1],P=w,O=w+1;if(typeof M!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(g.length&&g[g.length-1][0]>=M)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const L=l.parse(C,O,x);if(!L)return null;x=x||L.type,g.push([M,L])}return new Fo(x,d,g)}evaluate(i){const l=this.labels,d=this.outputs;if(l.length===1)return d[0].evaluate(i);const g=this.input.evaluate(i);if(g<=l[0])return d[0].evaluate(i);const x=l.length;return g>=l[x-1]?d[x-1].evaluate(i):d[Ch(l,g)].evaluate(i)}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function Dh(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var ss,pr,_u=function(){if(pr)return ss;function o(i,l,d,g){this.cx=3*i,this.bx=3*(d-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(g-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=l,this.p2x=d,this.p2y=g}return pr=1,ss=o,o.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,l){if(l===void 0&&(l=1e-6),i<0)return 0;if(i>1)return 1;for(var d=i,g=0;g<8;g++){var x=this.sampleCurveX(d)-i;if(Math.abs(x)<l)return d;var w=this.sampleCurveDerivativeX(d);if(Math.abs(w)<1e-6)break;d-=x/w}var M=0,C=1;for(d=i,g=0;g<20&&(x=this.sampleCurveX(d),!(Math.abs(x-i)<l));g++)i>x?M=d:C=d,d=.5*(C-M)+M;return d},solve:function(i,l){return this.sampleCurveY(this.solveCurveX(i,l))}},ss}(),qf=Dh(_u);class Xr{constructor(i,l,d,g,x){this.type=i,this.operator=l,this.interpolation=d,this.input=g,this.labels=[],this.outputs=[];for(const[w,M]of x)this.labels.push(w),this.outputs.push(M)}static interpolationFactor(i,l,d,g){let x=0;if(i.name==="exponential")x=mr(l,i.base,d,g);else if(i.name==="linear")x=mr(l,1,d,g);else if(i.name==="cubic-bezier"){const w=i.controlPoints;x=new qf(w[0],w[1],w[2],w[3]).solve(mr(l,1,d,g))}return x}static parse(i,l){let[d,g,x,...w]=i;if(!Array.isArray(g)||g.length===0)return l.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const P=g[1];if(typeof P!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:P}}else{if(g[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const P=g.slice(1);if(P.length!==4||P.some(O=>typeof O!="number"||O<0||O>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:P}}}if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(x=l.parse(x,2,ct),!x)return null;const M=[];let C=null;d==="interpolate-hcl"||d==="interpolate-lab"?C=ii:l.expectedType&&l.expectedType.kind!=="value"&&(C=l.expectedType);for(let P=0;P<w.length;P+=2){const O=w[P],L=w[P+1],j=P+3,Z=P+4;if(typeof O!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(M.length&&M[M.length-1][0]>=O)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',j);const H=l.parse(L,Z,C);if(!H)return null;C=C||H.type,M.push([O,H])}return so(C,ct)||so(C,In)||so(C,ii)||so(C,or)||so(C,ao)||so(C,fr(ct))?new Xr(C,d,g,x,M):l.error(`Type ${rn(C)} is not interpolatable.`)}evaluate(i){const l=this.labels,d=this.outputs;if(l.length===1)return d[0].evaluate(i);const g=this.input.evaluate(i);if(g<=l[0])return d[0].evaluate(i);const x=l.length;if(g>=l[x-1])return d[x-1].evaluate(i);const w=Ch(l,g),M=Xr.interpolationFactor(this.interpolation,g,l[w],l[w+1]),C=d[w].evaluate(i),P=d[w+1].evaluate(i);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return ma(C,P,M);case"color":return Bi.interpolate(C,P,M);case"padding":return xr.interpolate(C,P,M);case"variableAnchorOffsetCollection":return Cr.interpolate(C,P,M);case"array":return Il(C,P,M);case"projectionDefinition":return lr.interpolate(C,P,M)}case"interpolate-hcl":return Bi.interpolate(C,P,M,"hcl");case"interpolate-lab":return Bi.interpolate(C,P,M,"lab")}}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function mr(o,i,l,d){const g=d-l,x=o-l;return g===0?0:i===1?x/g:(Math.pow(i,x)-1)/(Math.pow(i,g)-1)}const Ca={color:Bi.interpolate,number:ma,padding:xr.interpolate,variableAnchorOffsetCollection:Cr.interpolate,array:Il};class wc{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let d=null;const g=l.expectedType;g&&g.kind!=="value"&&(d=g);const x=[];for(const M of i.slice(1)){const C=l.parse(M,1+x.length,d,void 0,{typeAnnotation:"omit"});if(!C)return null;d=d||C.type,x.push(C)}if(!d)throw new Error("No output type");const w=g&&x.some(M=>Tl(g,M.type));return new wc(w?Gt:d,x)}evaluate(i){let l,d=null,g=0;for(const x of this.args)if(g++,d=x.evaluate(i),d&&d instanceof Yr&&!d.available&&(l||(l=d.name),d=null,g===this.args.length&&(d=l)),d!==null)break;return d}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}function Nd(o,i){return o==="=="||o==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function $f(o,i,l,d){return d.compare(i,l)===0}function fo(o,i,l){const d=o!=="=="&&o!=="!=";return class N1{constructor(x,w,M){this.type=_t,this.lhs=x,this.rhs=w,this.collator=M,this.hasUntypedArgument=x.type.kind==="value"||w.type.kind==="value"}static parse(x,w){if(x.length!==3&&x.length!==4)return w.error("Expected two or three arguments.");const M=x[0];let C=w.parse(x[1],1,Gt);if(!C)return null;if(!Nd(M,C.type))return w.concat(1).error(`"${M}" comparisons are not supported for type '${rn(C.type)}'.`);let P=w.parse(x[2],2,Gt);if(!P)return null;if(!Nd(M,P.type))return w.concat(2).error(`"${M}" comparisons are not supported for type '${rn(P.type)}'.`);if(C.type.kind!==P.type.kind&&C.type.kind!=="value"&&P.type.kind!=="value")return w.error(`Cannot compare types '${rn(C.type)}' and '${rn(P.type)}'.`);d&&(C.type.kind==="value"&&P.type.kind!=="value"?C=new Jn(P.type,[C]):C.type.kind!=="value"&&P.type.kind==="value"&&(P=new Jn(C.type,[P])));let O=null;if(x.length===4){if(C.type.kind!=="string"&&P.type.kind!=="string"&&C.type.kind!=="value"&&P.type.kind!=="value")return w.error("Cannot use collator to compare non-string types.");if(O=w.parse(x[3],3,$n),!O)return null}return new N1(C,P,O)}evaluate(x){const w=this.lhs.evaluate(x),M=this.rhs.evaluate(x);if(d&&this.hasUntypedArgument){const C=vn(w),P=vn(M);if(C.kind!==P.kind||C.kind!=="string"&&C.kind!=="number")throw new Cn(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${C.kind}, ${P.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const C=vn(w),P=vn(M);if(C.kind!=="string"||P.kind!=="string")return i(x,w,M)}return this.collator?l(x,w,M,this.collator.evaluate(x)):i(x,w,M)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}}}const Ud=fo("==",function(o,i,l){return i===l},$f),Hf=fo("!=",function(o,i,l){return i!==l},function(o,i,l,d){return!$f(0,i,l,d)}),Rh=fo("<",function(o,i,l){return i<l},function(o,i,l,d){return d.compare(i,l)<0}),Ph=fo(">",function(o,i,l){return i>l},function(o,i,l,d){return d.compare(i,l)>0}),os=fo("<=",function(o,i,l){return i<=l},function(o,i,l,d){return d.compare(i,l)<=0}),Yf=fo(">=",function(o,i,l){return i>=l},function(o,i,l,d){return d.compare(i,l)>=0});class po{constructor(i,l,d){this.type=$n,this.locale=d,this.caseSensitive=i,this.diacriticSensitive=l}static parse(i,l){if(i.length!==2)return l.error("Expected one argument.");const d=i[1];if(typeof d!="object"||Array.isArray(d))return l.error("Collator options argument must be an object.");const g=l.parse(d["case-sensitive"]!==void 0&&d["case-sensitive"],1,_t);if(!g)return null;const x=l.parse(d["diacritic-sensitive"]!==void 0&&d["diacritic-sensitive"],1,_t);if(!x)return null;let w=null;return d.locale&&(w=l.parse(d.locale,1,Bt),!w)?null:new po(g,x,w)}evaluate(i){return new kr(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}}class jd{constructor(i,l,d,g,x){this.type=Bt,this.number=i,this.locale=l,this.currency=d,this.minFractionDigits=g,this.maxFractionDigits=x}static parse(i,l){if(i.length!==3)return l.error("Expected two arguments.");const d=l.parse(i[1],1,ct);if(!d)return null;const g=i[2];if(typeof g!="object"||Array.isArray(g))return l.error("NumberFormat options argument must be an object.");let x=null;if(g.locale&&(x=l.parse(g.locale,1,Bt),!x))return null;let w=null;if(g.currency&&(w=l.parse(g.currency,1,Bt),!w))return null;let M=null;if(g["min-fraction-digits"]&&(M=l.parse(g["min-fraction-digits"],1,ct),!M))return null;let C=null;return g["max-fraction-digits"]&&(C=l.parse(g["max-fraction-digits"],1,ct),!C)?null:new jd(d,x,w,M,C)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}}class Sc{constructor(i){this.type=Xi,this.sections=i}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const d=i[1];if(!Array.isArray(d)&&typeof d=="object")return l.error("First argument must be an image or text section.");const g=[];let x=!1;for(let w=1;w<=i.length-1;++w){const M=i[w];if(x&&typeof M=="object"&&!Array.isArray(M)){x=!1;let C=null;if(M["font-scale"]&&(C=l.parse(M["font-scale"],1,ct),!C))return null;let P=null;if(M["text-font"]&&(P=l.parse(M["text-font"],1,fr(Bt)),!P))return null;let O=null;if(M["text-color"]&&(O=l.parse(M["text-color"],1,ii),!O))return null;let L=null;if(M["vertical-align"]){if(typeof M["vertical-align"]=="string"&&!gu.includes(M["vertical-align"]))return l.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${M["vertical-align"]}' instead.`);if(L=l.parse(M["vertical-align"],1,Bt),!L)return null}const j=g[g.length-1];j.scale=C,j.font=P,j.textColor=O,j.verticalAlign=L}else{const C=l.parse(i[w],1,Gt);if(!C)return null;const P=C.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,g.push({content:C,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Sc(g)}evaluate(i){return new Hr(this.sections.map(l=>{const d=l.content.evaluate(i);return vn(d)===Sl?new Cl("",d,null,null,null,l.verticalAlign?l.verticalAlign.evaluate(i):null):new Cl(Bo(d),null,l.scale?l.scale.evaluate(i):null,l.font?l.font.evaluate(i).join(","):null,l.textColor?l.textColor.evaluate(i):null,l.verticalAlign?l.verticalAlign.evaluate(i):null)}))}eachChild(i){for(const l of this.sections)i(l.content),l.scale&&i(l.scale),l.font&&i(l.font),l.textColor&&i(l.textColor),l.verticalAlign&&i(l.verticalAlign)}outputDefined(){return!1}}class Vd{constructor(i){this.type=Sl,this.input=i}static parse(i,l){if(i.length!==2)return l.error("Expected two arguments.");const d=l.parse(i[1],1,Bt);return d?new Vd(d):l.error("No image name provided.")}evaluate(i){const l=this.input.evaluate(i),d=Yr.fromString(l);return d&&i.availableImages&&(d.available=i.availableImages.indexOf(l)>-1),d}eachChild(i){i(this.input)}outputDefined(){return!1}}class zh{constructor(i){this.type=ct,this.input=i}static parse(i,l){if(i.length!==2)return l.error(`Expected 1 argument, but found ${i.length-1} instead.`);const d=l.parse(i[1],1);return d?d.type.kind!=="array"&&d.type.kind!=="string"&&d.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${rn(d.type)} instead.`):new zh(d):null}evaluate(i){const l=this.input.evaluate(i);if(typeof l=="string")return[...l].length;if(Array.isArray(l))return l.length;throw new Cn(`Expected value to be of type string or array, but found ${rn(vn(l))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}}const Ps=8192;function Em(o,i){const l=(180+o[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,g=Math.pow(2,i.z);return[Math.round(l*g*Ps),Math.round(d*g*Ps)]}function Tc(o,i){const l=Math.pow(2,i.z);return[(g=(o[0]/Ps+i.x)/l,360*g-180),(d=(o[1]/Ps+i.y)/l,360/Math.PI*Math.atan(Math.exp((180-360*d)*Math.PI/180))-90)];var d,g}function yu(o,i){o[0]=Math.min(o[0],i[0]),o[1]=Math.min(o[1],i[1]),o[2]=Math.max(o[2],i[0]),o[3]=Math.max(o[3],i[1])}function Ec(o,i){return!(o[0]<=i[0]||o[2]>=i[2]||o[1]<=i[1]||o[3]>=i[3])}function Xf(o,i,l){const d=o[0]-i[0],g=o[1]-i[1],x=o[0]-l[0],w=o[1]-l[1];return d*w-x*g==0&&d*x<=0&&g*w<=0}function kh(o,i,l,d){return(g=[d[0]-l[0],d[1]-l[1]])[0]*(x=[i[0]-o[0],i[1]-o[1]])[1]-g[1]*x[0]!=0&&!(!Gd(o,i,l,d)||!Gd(l,d,o,i));var g,x}function Kf(o,i,l){for(const d of l)for(let g=0;g<d.length-1;++g)if(kh(o,i,d[g],d[g+1]))return!0;return!1}function Mc(o,i,l=!1){let d=!1;for(const M of i)for(let C=0;C<M.length-1;C++){if(Xf(o,M[C],M[C+1]))return l;(x=M[C])[1]>(g=o)[1]!=(w=M[C+1])[1]>g[1]&&g[0]<(w[0]-x[0])*(g[1]-x[1])/(w[1]-x[1])+x[0]&&(d=!d)}var g,x,w;return d}function Zd(o,i){for(const l of i)if(Mc(o,l))return!0;return!1}function Ac(o,i){for(const l of o)if(!Mc(l,i))return!1;for(let l=0;l<o.length-1;++l)if(Kf(o[l],o[l+1],i))return!1;return!0}function Mm(o,i){for(const l of i)if(Ac(o,l))return!0;return!1}function Gd(o,i,l,d){const g=d[0]-l[0],x=d[1]-l[1],w=(o[0]-l[0])*x-g*(o[1]-l[1]),M=(i[0]-l[0])*x-g*(i[1]-l[1]);return w>0&&M<0||w<0&&M>0}function vu(o,i,l){const d=[];for(let g=0;g<o.length;g++){const x=[];for(let w=0;w<o[g].length;w++){const M=Em(o[g][w],l);yu(i,M),x.push(M)}d.push(x)}return d}function Oh(o,i,l){const d=[];for(let g=0;g<o.length;g++){const x=vu(o[g],i,l);d.push(x)}return d}function Bh(o,i,l,d){if(o[0]<l[0]||o[0]>l[2]){const g=.5*d;let x=o[0]-l[0]>g?-d:l[0]-o[0]>g?d:0;x===0&&(x=o[0]-l[2]>g?-d:l[2]-o[0]>g?d:0),o[0]+=x}yu(i,o)}function qd(o,i,l,d){const g=Math.pow(2,d.z)*Ps,x=[d.x*Ps,d.y*Ps],w=[];for(const M of o)for(const C of M){const P=[C.x+x[0],C.y+x[1]];Bh(P,i,l,g),w.push(P)}return w}function Rl(o,i,l,d){const g=Math.pow(2,d.z)*Ps,x=[d.x*Ps,d.y*Ps],w=[];for(const C of o){const P=[];for(const O of C){const L=[O.x+x[0],O.y+x[1]];yu(i,L),P.push(L)}w.push(P)}if(i[2]-i[0]<=g/2){(M=i)[0]=M[1]=1/0,M[2]=M[3]=-1/0;for(const C of w)for(const P of C)Bh(P,i,l,g)}var M;return w}class Pl{constructor(i,l){this.type=_t,this.geojson=i,this.geometries=l}static parse(i,l){if(i.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Ia(i[1])){const d=i[1];if(d.type==="FeatureCollection"){const g=[];for(const x of d.features){const{type:w,coordinates:M}=x.geometry;w==="Polygon"&&g.push(M),w==="MultiPolygon"&&g.push(...M)}if(g.length)return new Pl(d,{type:"MultiPolygon",coordinates:g})}else if(d.type==="Feature"){const g=d.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Pl(d,d.geometry)}else if(d.type==="Polygon"||d.type==="MultiPolygon")return new Pl(d,d)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(l,d){const g=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],w=l.canonicalID();if(d.type==="Polygon"){const M=vu(d.coordinates,x,w),C=qd(l.geometry(),g,x,w);if(!Ec(g,x))return!1;for(const P of C)if(!Mc(P,M))return!1}if(d.type==="MultiPolygon"){const M=Oh(d.coordinates,x,w),C=qd(l.geometry(),g,x,w);if(!Ec(g,x))return!1;for(const P of C)if(!Zd(P,M))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(l,d){const g=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],w=l.canonicalID();if(d.type==="Polygon"){const M=vu(d.coordinates,x,w),C=Rl(l.geometry(),g,x,w);if(!Ec(g,x))return!1;for(const P of C)if(!Ac(P,M))return!1}if(d.type==="MultiPolygon"){const M=Oh(d.coordinates,x,w),C=Rl(l.geometry(),g,x,w);if(!Ec(g,x))return!1;for(const P of C)if(!Mm(P,M))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Lh=class{constructor(o=[],i=(l,d)=>l<d?-1:l>d?1:0){if(this.data=o,this.length=this.data.length,this.compare=i,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(o){this.data.push(o),this._up(this.length++)}pop(){if(this.length===0)return;const o=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:i,compare:l}=this,d=i[o];for(;o>0;){const g=o-1>>1,x=i[g];if(l(d,x)>=0)break;i[o]=x,o=g}i[o]=d}_down(o){const{data:i,compare:l}=this,d=this.length>>1,g=i[o];for(;o<d;){let x=1+(o<<1);const w=x+1;if(w<this.length&&l(i[w],i[x])<0&&(x=w),l(i[x],g)>=0)break;i[o]=i[x],o=x}i[o]=g}};function Wf(o,i,l=0,d=o.length-1,g=Qf){for(;d>l;){if(d-l>600){const C=d-l+1,P=i-l+1,O=Math.log(C),L=.5*Math.exp(2*O/3),j=.5*Math.sqrt(O*L*(C-L)/C)*(P-C/2<0?-1:1);Wf(o,i,Math.max(l,Math.floor(i-P*L/C+j)),Math.min(d,Math.floor(i+(C-P)*L/C+j)),g)}const x=o[i];let w=l,M=d;for(Ic(o,l,i),g(o[d],x)>0&&Ic(o,l,d);w<M;){for(Ic(o,w,M),w++,M--;g(o[w],x)<0;)w++;for(;g(o[M],x)>0;)M--}g(o[l],x)===0?Ic(o,l,M):(M++,Ic(o,M,d)),M<=i&&(l=M+1),i<=M&&(d=M-1)}}function Ic(o,i,l){const d=o[i];o[i]=o[l],o[l]=d}function Qf(o,i){return o<i?-1:o>i?1:0}function mo(o,i){if(o.length<=1)return[o];const l=[];let d,g;for(const x of o){const w=Am(x);w!==0&&(x.area=Math.abs(w),g===void 0&&(g=w<0),g===w<0?(d&&l.push(d),d=[x]):d.push(x))}if(d&&l.push(d),i>1)for(let x=0;x<l.length;x++)l[x].length<=i||(Wf(l[x],i,1,l[x].length-1,Cc),l[x]=l[x].slice(0,i));return l}function Cc(o,i){return i.area-o.area}function Am(o){let i=0;for(let l,d,g=0,x=o.length,w=x-1;g<x;w=g++)l=o[g],d=o[w],i+=(d.x-l.x)*(l.y+d.y);return i}const bu=1/298.257223563,Fh=bu*(2-bu),Nh=Math.PI/180;class xu{constructor(i){const l=6378.137*Nh*1e3,d=Math.cos(i*Nh),g=1/(1-Fh*(1-d*d)),x=Math.sqrt(g);this.kx=l*x*d,this.ky=l*x*g*(1-Fh)}distance(i,l){const d=this.wrap(i[0]-l[0])*this.kx,g=(i[1]-l[1])*this.ky;return Math.sqrt(d*d+g*g)}pointOnLine(i,l){let d,g,x,w,M=1/0;for(let C=0;C<i.length-1;C++){let P=i[C][0],O=i[C][1],L=this.wrap(i[C+1][0]-P)*this.kx,j=(i[C+1][1]-O)*this.ky,Z=0;L===0&&j===0||(Z=(this.wrap(l[0]-P)*this.kx*L+(l[1]-O)*this.ky*j)/(L*L+j*j),Z>1?(P=i[C+1][0],O=i[C+1][1]):Z>0&&(P+=L/this.kx*Z,O+=j/this.ky*Z)),L=this.wrap(l[0]-P)*this.kx,j=(l[1]-O)*this.ky;const H=L*L+j*j;H<M&&(M=H,d=P,g=O,x=C,w=Z)}return{point:[d,g],index:x,t:Math.max(0,Math.min(1,w))}}wrap(i){for(;i<-180;)i+=360;for(;i>180;)i-=360;return i}}function Uh(o,i){return i[0]-o[0]}function wu(o){return o[1]-o[0]+1}function ls(o,i){return o[1]>=o[0]&&o[1]<i}function jh(o,i){if(o[0]>o[1])return[null,null];const l=wu(o);if(i){if(l===2)return[o,null];const g=Math.floor(l/2);return[[o[0],o[0]+g],[o[0]+g,o[1]]]}if(l===1)return[o,null];const d=Math.floor(l/2)-1;return[[o[0],o[0]+d],[o[0]+d+1,o[1]]]}function $d(o,i){if(!ls(i,o.length))return[1/0,1/0,-1/0,-1/0];const l=[1/0,1/0,-1/0,-1/0];for(let d=i[0];d<=i[1];++d)yu(l,o[d]);return l}function Hd(o){const i=[1/0,1/0,-1/0,-1/0];for(const l of o)for(const d of l)yu(i,d);return i}function Jf(o){return o[0]!==-1/0&&o[1]!==-1/0&&o[2]!==1/0&&o[3]!==1/0}function qi(o,i,l){if(!Jf(o)||!Jf(i))return NaN;let d=0,g=0;return o[2]<i[0]&&(d=i[0]-o[2]),o[0]>i[2]&&(d=o[0]-i[2]),o[1]>i[3]&&(g=o[1]-i[3]),o[3]<i[1]&&(g=i[1]-o[3]),l.distance([0,0],[d,g])}function zl(o,i,l){const d=l.pointOnLine(i,o);return l.distance(o,d.point)}function ta(o,i,l,d,g){const x=Math.min(zl(o,[l,d],g),zl(i,[l,d],g)),w=Math.min(zl(l,[o,i],g),zl(d,[o,i],g));return Math.min(x,w)}function Su(o,i,l,d,g){if(!ls(i,o.length)||!ls(d,l.length))return 1/0;let x=1/0;for(let w=i[0];w<i[1];++w){const M=o[w],C=o[w+1];for(let P=d[0];P<d[1];++P){const O=l[P],L=l[P+1];if(kh(M,C,O,L))return 0;x=Math.min(x,ta(M,C,O,L,g))}}return x}function ep(o,i,l,d,g){if(!ls(i,o.length)||!ls(d,l.length))return NaN;let x=1/0;for(let w=i[0];w<=i[1];++w)for(let M=d[0];M<=d[1];++M)if(x=Math.min(x,g.distance(o[w],l[M])),x===0)return x;return x}function tp(o,i,l){if(Mc(o,i,!0))return 0;let d=1/0;for(const g of i){const x=g[0],w=g[g.length-1];if(x!==w&&(d=Math.min(d,zl(o,[w,x],l)),d===0))return d;const M=l.pointOnLine(g,o);if(d=Math.min(d,l.distance(o,M.point)),d===0)return d}return d}function ip(o,i,l,d){if(!ls(i,o.length))return NaN;for(let x=i[0];x<=i[1];++x)if(Mc(o[x],l,!0))return 0;let g=1/0;for(let x=i[0];x<i[1];++x){const w=o[x],M=o[x+1];for(const C of l)for(let P=0,O=C.length,L=O-1;P<O;L=P++){const j=C[L],Z=C[P];if(kh(w,M,j,Z))return 0;g=Math.min(g,ta(w,M,j,Z,d))}}return g}function Yd(o,i){for(const l of o)for(const d of l)if(Mc(d,i,!0))return!0;return!1}function Xd(o,i,l,d=1/0){const g=Hd(o),x=Hd(i);if(d!==1/0&&qi(g,x,l)>=d)return d;if(Ec(g,x)){if(Yd(o,i))return 0}else if(Yd(i,o))return 0;let w=1/0;for(const M of o)for(let C=0,P=M.length,O=P-1;C<P;O=C++){const L=M[O],j=M[C];for(const Z of i)for(let H=0,X=Z.length,re=X-1;H<X;re=H++){const ue=Z[re],ve=Z[H];if(kh(L,j,ue,ve))return 0;w=Math.min(w,ta(L,j,ue,ve,l))}}return w}function np(o,i,l,d,g,x){if(!x)return;const w=qi($d(d,x),g,l);w<i&&o.push([w,x,[0,0]])}function go(o,i,l,d,g,x,w){if(!x||!w)return;const M=qi($d(d,x),$d(g,w),l);M<i&&o.push([M,x,w])}function Dc(o,i,l,d,g=1/0){let x=Math.min(d.distance(o[0],l[0][0]),g);if(x===0)return x;const w=new Lh([[0,[0,o.length-1],[0,0]]],Uh),M=Hd(l);for(;w.length>0;){const C=w.pop();if(C[0]>=x)continue;const P=C[1],O=i?50:100;if(wu(P)<=O){if(!ls(P,o.length))return NaN;if(i){const L=ip(o,P,l,d);if(isNaN(L)||L===0)return L;x=Math.min(x,L)}else for(let L=P[0];L<=P[1];++L){const j=tp(o[L],l,d);if(x=Math.min(x,j),x===0)return 0}}else{const L=jh(P,i);np(w,x,d,o,M,L[0]),np(w,x,d,o,M,L[1])}}return x}function No(o,i,l,d,g,x=1/0){let w=Math.min(x,g.distance(o[0],l[0]));if(w===0)return w;const M=new Lh([[0,[0,o.length-1],[0,l.length-1]]],Uh);for(;M.length>0;){const C=M.pop();if(C[0]>=w)continue;const P=C[1],O=C[2],L=i?50:100,j=d?50:100;if(wu(P)<=L&&wu(O)<=j){if(!ls(P,o.length)&&ls(O,l.length))return NaN;let Z;if(i&&d)Z=Su(o,P,l,O,g),w=Math.min(w,Z);else if(i&&!d){const H=o.slice(P[0],P[1]+1);for(let X=O[0];X<=O[1];++X)if(Z=zl(l[X],H,g),w=Math.min(w,Z),w===0)return w}else if(!i&&d){const H=l.slice(O[0],O[1]+1);for(let X=P[0];X<=P[1];++X)if(Z=zl(o[X],H,g),w=Math.min(w,Z),w===0)return w}else Z=ep(o,P,l,O,g),w=Math.min(w,Z)}else{const Z=jh(P,i),H=jh(O,d);go(M,w,g,o,l,Z[0],H[0]),go(M,w,g,o,l,Z[0],H[1]),go(M,w,g,o,l,Z[1],H[0]),go(M,w,g,o,l,Z[1],H[1])}}return w}function Tu(o){return o.type==="MultiPolygon"?o.coordinates.map(i=>({type:"Polygon",coordinates:i})):o.type==="MultiLineString"?o.coordinates.map(i=>({type:"LineString",coordinates:i})):o.type==="MultiPoint"?o.coordinates.map(i=>({type:"Point",coordinates:i})):[o]}class Uo{constructor(i,l){this.type=ct,this.geojson=i,this.geometries=l}static parse(i,l){if(i.length!==2)return l.error(`'distance' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Ia(i[1])){const d=i[1];if(d.type==="FeatureCollection")return new Uo(d,d.features.map(g=>Tu(g.geometry)).flat());if(d.type==="Feature")return new Uo(d,Tu(d.geometry));if("type"in d&&"coordinates"in d)return new Uo(d,Tu(d))}return l.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(l,d){const g=l.geometry(),x=g.flat().map(C=>Tc([C.x,C.y],l.canonical));if(g.length===0)return NaN;const w=new xu(x[0][1]);let M=1/0;for(const C of d){switch(C.type){case"Point":M=Math.min(M,No(x,!1,[C.coordinates],!1,w,M));break;case"LineString":M=Math.min(M,No(x,!1,C.coordinates,!0,w,M));break;case"Polygon":M=Math.min(M,Dc(x,!1,C.coordinates,w,M))}if(M===0)return M}return M}(i,this.geometries);if(i.geometryType()==="LineString")return function(l,d){const g=l.geometry(),x=g.flat().map(C=>Tc([C.x,C.y],l.canonical));if(g.length===0)return NaN;const w=new xu(x[0][1]);let M=1/0;for(const C of d){switch(C.type){case"Point":M=Math.min(M,No(x,!0,[C.coordinates],!1,w,M));break;case"LineString":M=Math.min(M,No(x,!0,C.coordinates,!0,w,M));break;case"Polygon":M=Math.min(M,Dc(x,!0,C.coordinates,w,M))}if(M===0)return M}return M}(i,this.geometries);if(i.geometryType()==="Polygon")return function(l,d){const g=l.geometry();if(g.length===0||g[0].length===0)return NaN;const x=mo(g,0).map(C=>C.map(P=>P.map(O=>Tc([O.x,O.y],l.canonical)))),w=new xu(x[0][0][0][1]);let M=1/0;for(const C of d)for(const P of x){switch(C.type){case"Point":M=Math.min(M,Dc([C.coordinates],!1,P,w,M));break;case"LineString":M=Math.min(M,Dc(C.coordinates,!0,P,w,M));break;case"Polygon":M=Math.min(M,Xd(P,C.coordinates,w,M))}if(M===0)return M}return M}(i,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const ja={"==":Ud,"!=":Hf,">":Ph,"<":Rh,">=":Yf,"<=":os,array:Jn,at:_a,boolean:Jn,case:Lo,coalesce:wc,collator:po,format:Sc,image:Vd,in:xc,"index-of":Dr,interpolate:Xr,"interpolate-hcl":Xr,"interpolate-lab":Xr,length:zh,let:Oi,literal:oo,match:Rs,number:Jn,"number-format":jd,object:Jn,slice:ho,step:Fo,string:Jn,"to-boolean":ga,"to-color":ga,"to-number":ga,"to-string":ga,var:uo,within:Pl,distance:Uo};class Or{constructor(i,l,d,g){this.name=i,this.type=l,this._evaluate=d,this.args=g}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}static parse(i,l){const d=i[0],g=Or.definitions[d];if(!g)return l.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(g)?g[0]:g.type,w=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,M=w.filter(([P])=>!Array.isArray(P)||P.length===i.length-1);let C=null;for(const[P,O]of M){C=new co(l.registry,Eu,l.path,null,l.scope);const L=[];let j=!1;for(let Z=1;Z<i.length;Z++){const H=i[Z],X=Array.isArray(P)?P[Z-1]:P.type,re=C.parse(H,1+L.length,X);if(!re){j=!0;break}L.push(re)}if(!j)if(Array.isArray(P)&&P.length!==L.length)C.error(`Expected ${P.length} arguments, but found ${L.length} instead.`);else{for(let Z=0;Z<L.length;Z++){const H=Array.isArray(P)?P[Z]:P.type,X=L[Z];C.concat(Z+1).checkSubtype(H,X.type)}if(C.errors.length===0)return new Or(d,x,O,L)}}if(M.length===1)l.errors.push(...C.errors);else{const P=(M.length?M:w).map(([L])=>{return j=L,Array.isArray(j)?`(${j.map(rn).join(", ")})`:`(${rn(j.type)}...)`;var j}).join(" | "),O=[];for(let L=1;L<i.length;L++){const j=l.parse(i[L],1+O.length);if(!j)return null;O.push(rn(j.type))}l.error(`Expected arguments of type ${P}, but found (${O.join(", ")}) instead.`)}return null}static register(i,l){Or.definitions=l;for(const d in l)i[d]=Or}}function Vh(o,[i,l,d,g]){i=i.evaluate(o),l=l.evaluate(o),d=d.evaluate(o);const x=g?g.evaluate(o):1,w=Dl(i,l,d,x);if(w)throw new Cn(w);return new Bi(i/255,l/255,d/255,x,!1)}function Kd(o,i){return o in i}function _o(o,i){const l=i[o];return l===void 0?null:l}function jo(o){return{type:o}}function Eu(o){if(o instanceof uo)return Eu(o.boundExpression);if(o instanceof Or&&o.name==="error"||o instanceof po||o instanceof Pl||o instanceof Uo)return!1;const i=o instanceof ga||o instanceof Jn;let l=!0;return o.eachChild(d=>{l=i?l&&Eu(d):l&&d instanceof oo}),!!l&&Mu(o)&&Zh(o,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Mu(o){if(o instanceof Or&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof Pl||o instanceof Uo)return!1;let i=!0;return o.eachChild(l=>{i&&!Mu(l)&&(i=!1)}),i}function Au(o){if(o instanceof Or&&o.name==="feature-state")return!1;let i=!0;return o.eachChild(l=>{i&&!Au(l)&&(i=!1)}),i}function Zh(o,i){if(o instanceof Or&&i.indexOf(o.name)>=0)return!1;let l=!0;return o.eachChild(d=>{l&&!Zh(d,i)&&(l=!1)}),l}function rp(o){return{result:"success",value:o}}function kl(o){return{result:"error",value:o}}function Ol(o){return o["property-type"]==="data-driven"||o["property-type"]==="cross-faded-data-driven"}function Gh(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function Da(o){return!!o.expression&&o.expression.interpolated}function Ui(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function ia(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function ya(o){return o}function Bl(o,i){const l=i.type==="color",d=o.stops&&typeof o.stops[0][0]=="object",g=d||!(d||o.property!==void 0),x=o.type||(Da(i)?"exponential":"interval");if(l||i.type==="padding"){const O=l?Bi.parse:xr.parse;(o=Vt({},o)).stops&&(o.stops=o.stops.map(L=>[L[0],O(L[1])])),o.default=O(o.default?o.default:i.default)}if(o.colorSpace&&(w=o.colorSpace)!=="rgb"&&w!=="hcl"&&w!=="lab")throw new Error(`Unknown color space: "${o.colorSpace}"`);var w;let M,C,P;if(x==="exponential")M=$h;else if(x==="interval")M=Iu;else if(x==="categorical"){M=qh,C=Object.create(null);for(const O of o.stops)C[O[0]]=O[1];P=typeof o.stops[0][0]}else{if(x!=="identity")throw new Error(`Unknown function type "${x}"`);M=Rc}if(d){const O={},L=[];for(let H=0;H<o.stops.length;H++){const X=o.stops[H],re=X[0].zoom;O[re]===void 0&&(O[re]={zoom:re,type:o.type,property:o.property,default:o.default,stops:[]},L.push(re)),O[re].stops.push([X[0].value,X[1]])}const j=[];for(const H of L)j.push([O[H].zoom,Bl(O[H],i)]);const Z={name:"linear"};return{kind:"composite",interpolationType:Z,interpolationFactor:Xr.interpolationFactor.bind(void 0,Z),zoomStops:j.map(H=>H[0]),evaluate:({zoom:H},X)=>$h({stops:j,base:o.base},i,H).evaluate(H,X)}}if(g){const O=x==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:O,interpolationFactor:Xr.interpolationFactor.bind(void 0,O),zoomStops:o.stops.map(L=>L[0]),evaluate:({zoom:L})=>M(o,i,L,C,P)}}return{kind:"source",evaluate(O,L){const j=L&&L.properties?L.properties[o.property]:void 0;return j===void 0?Ll(o.default,i.default):M(o,i,j,C,P)}}}function Ll(o,i,l){return o!==void 0?o:i!==void 0?i:l!==void 0?l:void 0}function qh(o,i,l,d,g){return Ll(typeof l===g?d[l]:void 0,o.default,i.default)}function Iu(o,i,l){if(Ui(l)!=="number")return Ll(o.default,i.default);const d=o.stops.length;if(d===1||l<=o.stops[0][0])return o.stops[0][1];if(l>=o.stops[d-1][0])return o.stops[d-1][1];const g=Ch(o.stops.map(x=>x[0]),l);return o.stops[g][1]}function $h(o,i,l){const d=o.base!==void 0?o.base:1;if(Ui(l)!=="number")return Ll(o.default,i.default);const g=o.stops.length;if(g===1||l<=o.stops[0][0])return o.stops[0][1];if(l>=o.stops[g-1][0])return o.stops[g-1][1];const x=Ch(o.stops.map(O=>O[0]),l),w=function(O,L,j,Z){const H=Z-j,X=O-j;return H===0?0:L===1?X/H:(Math.pow(L,X)-1)/(Math.pow(L,H)-1)}(l,d,o.stops[x][0],o.stops[x+1][0]),M=o.stops[x][1],C=o.stops[x+1][1],P=Ca[i.type]||ya;return typeof M.evaluate=="function"?{evaluate(...O){const L=M.evaluate.apply(void 0,O),j=C.evaluate.apply(void 0,O);if(L!==void 0&&j!==void 0)return P(L,j,w,o.colorSpace)}}:P(M,C,w,o.colorSpace)}function Rc(o,i,l){switch(i.type){case"color":l=Bi.parse(l);break;case"formatted":l=Hr.fromString(l.toString());break;case"resolvedImage":l=Yr.fromString(l.toString());break;case"padding":l=xr.parse(l);break;default:Ui(l)===i.type||i.type==="enum"&&i.values[l]||(l=void 0)}return Ll(l,o.default,i.default)}Or.register(ja,{error:[{kind:"error"},[Bt],(o,[i])=>{throw new Cn(i.evaluate(o))}],typeof:[Bt,[Gt],(o,[i])=>rn(vn(i.evaluate(o)))],"to-rgba":[fr(ct,4),[ii],(o,[i])=>{const[l,d,g,x]=i.evaluate(o).rgb;return[255*l,255*d,255*g,x]}],rgb:[ii,[ct,ct,ct],Vh],rgba:[ii,[ct,ct,ct,ct],Vh],has:{type:_t,overloads:[[[Bt],(o,[i])=>Kd(i.evaluate(o),o.properties())],[[Bt,pa],(o,[i,l])=>Kd(i.evaluate(o),l.evaluate(o))]]},get:{type:Gt,overloads:[[[Bt],(o,[i])=>_o(i.evaluate(o),o.properties())],[[Bt,pa],(o,[i,l])=>_o(i.evaluate(o),l.evaluate(o))]]},"feature-state":[Gt,[Bt],(o,[i])=>_o(i.evaluate(o),o.featureState||{})],properties:[pa,[],o=>o.properties()],"geometry-type":[Bt,[],o=>o.geometryType()],id:[Gt,[],o=>o.id()],zoom:[ct,[],o=>o.globals.zoom],"heatmap-density":[ct,[],o=>o.globals.heatmapDensity||0],"line-progress":[ct,[],o=>o.globals.lineProgress||0],accumulated:[Gt,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[ct,jo(ct),(o,i)=>{let l=0;for(const d of i)l+=d.evaluate(o);return l}],"*":[ct,jo(ct),(o,i)=>{let l=1;for(const d of i)l*=d.evaluate(o);return l}],"-":{type:ct,overloads:[[[ct,ct],(o,[i,l])=>i.evaluate(o)-l.evaluate(o)],[[ct],(o,[i])=>-i.evaluate(o)]]},"/":[ct,[ct,ct],(o,[i,l])=>i.evaluate(o)/l.evaluate(o)],"%":[ct,[ct,ct],(o,[i,l])=>i.evaluate(o)%l.evaluate(o)],ln2:[ct,[],()=>Math.LN2],pi:[ct,[],()=>Math.PI],e:[ct,[],()=>Math.E],"^":[ct,[ct,ct],(o,[i,l])=>Math.pow(i.evaluate(o),l.evaluate(o))],sqrt:[ct,[ct],(o,[i])=>Math.sqrt(i.evaluate(o))],log10:[ct,[ct],(o,[i])=>Math.log(i.evaluate(o))/Math.LN10],ln:[ct,[ct],(o,[i])=>Math.log(i.evaluate(o))],log2:[ct,[ct],(o,[i])=>Math.log(i.evaluate(o))/Math.LN2],sin:[ct,[ct],(o,[i])=>Math.sin(i.evaluate(o))],cos:[ct,[ct],(o,[i])=>Math.cos(i.evaluate(o))],tan:[ct,[ct],(o,[i])=>Math.tan(i.evaluate(o))],asin:[ct,[ct],(o,[i])=>Math.asin(i.evaluate(o))],acos:[ct,[ct],(o,[i])=>Math.acos(i.evaluate(o))],atan:[ct,[ct],(o,[i])=>Math.atan(i.evaluate(o))],min:[ct,jo(ct),(o,i)=>Math.min(...i.map(l=>l.evaluate(o)))],max:[ct,jo(ct),(o,i)=>Math.max(...i.map(l=>l.evaluate(o)))],abs:[ct,[ct],(o,[i])=>Math.abs(i.evaluate(o))],round:[ct,[ct],(o,[i])=>{const l=i.evaluate(o);return l<0?-Math.round(-l):Math.round(l)}],floor:[ct,[ct],(o,[i])=>Math.floor(i.evaluate(o))],ceil:[ct,[ct],(o,[i])=>Math.ceil(i.evaluate(o))],"filter-==":[_t,[Bt,Gt],(o,[i,l])=>o.properties()[i.value]===l.value],"filter-id-==":[_t,[Gt],(o,[i])=>o.id()===i.value],"filter-type-==":[_t,[Bt],(o,[i])=>o.geometryType()===i.value],"filter-<":[_t,[Bt,Gt],(o,[i,l])=>{const d=o.properties()[i.value],g=l.value;return typeof d==typeof g&&d<g}],"filter-id-<":[_t,[Gt],(o,[i])=>{const l=o.id(),d=i.value;return typeof l==typeof d&&l<d}],"filter->":[_t,[Bt,Gt],(o,[i,l])=>{const d=o.properties()[i.value],g=l.value;return typeof d==typeof g&&d>g}],"filter-id->":[_t,[Gt],(o,[i])=>{const l=o.id(),d=i.value;return typeof l==typeof d&&l>d}],"filter-<=":[_t,[Bt,Gt],(o,[i,l])=>{const d=o.properties()[i.value],g=l.value;return typeof d==typeof g&&d<=g}],"filter-id-<=":[_t,[Gt],(o,[i])=>{const l=o.id(),d=i.value;return typeof l==typeof d&&l<=d}],"filter->=":[_t,[Bt,Gt],(o,[i,l])=>{const d=o.properties()[i.value],g=l.value;return typeof d==typeof g&&d>=g}],"filter-id->=":[_t,[Gt],(o,[i])=>{const l=o.id(),d=i.value;return typeof l==typeof d&&l>=d}],"filter-has":[_t,[Gt],(o,[i])=>i.value in o.properties()],"filter-has-id":[_t,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[_t,[fr(Bt)],(o,[i])=>i.value.indexOf(o.geometryType())>=0],"filter-id-in":[_t,[fr(Gt)],(o,[i])=>i.value.indexOf(o.id())>=0],"filter-in-small":[_t,[Bt,fr(Gt)],(o,[i,l])=>l.value.indexOf(o.properties()[i.value])>=0],"filter-in-large":[_t,[Bt,fr(Gt)],(o,[i,l])=>function(d,g,x,w){for(;x<=w;){const M=x+w>>1;if(g[M]===d)return!0;g[M]>d?w=M-1:x=M+1}return!1}(o.properties()[i.value],l.value,0,l.value.length-1)],all:{type:_t,overloads:[[[_t,_t],(o,[i,l])=>i.evaluate(o)&&l.evaluate(o)],[jo(_t),(o,i)=>{for(const l of i)if(!l.evaluate(o))return!1;return!0}]]},any:{type:_t,overloads:[[[_t,_t],(o,[i,l])=>i.evaluate(o)||l.evaluate(o)],[jo(_t),(o,i)=>{for(const l of i)if(l.evaluate(o))return!0;return!1}]]},"!":[_t,[_t],(o,[i])=>!i.evaluate(o)],"is-supported-script":[_t,[Bt],(o,[i])=>{const l=o.globals&&o.globals.isSupportedScript;return!l||l(i.evaluate(o))}],upcase:[Bt,[Bt],(o,[i])=>i.evaluate(o).toUpperCase()],downcase:[Bt,[Bt],(o,[i])=>i.evaluate(o).toLowerCase()],concat:[Bt,jo(Gt),(o,i)=>i.map(l=>Bo(l.evaluate(o))).join("")],"resolved-locale":[Bt,[$n],(o,[i])=>i.evaluate(o).resolvedLocale()]});class Fl{constructor(i,l){var d;this.expression=i,this._warningHistory={},this._evaluator=new gi,this._defaultValue=l?(d=l).type==="color"&&ia(d.default)?new Bi(0,0,0,0):d.type==="color"?Bi.parse(d.default)||null:d.type==="padding"?xr.parse(d.default)||null:d.type==="variableAnchorOffsetCollection"?Cr.parse(d.default)||null:d.type==="projectionDefinition"?lr.parse(d.default)||null:d.default===void 0?null:d.default:null,this._enumValues=l&&l.type==="enum"?l.values:null}evaluateWithoutErrorHandling(i,l,d,g,x,w){return this._evaluator.globals=i,this._evaluator.feature=l,this._evaluator.featureState=d,this._evaluator.canonical=g,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=w,this.expression.evaluate(this._evaluator)}evaluate(i,l,d,g,x,w){this._evaluator.globals=i,this._evaluator.feature=l||null,this._evaluator.featureState=d||null,this._evaluator.canonical=g,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=w||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new Cn(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(M.message)),this._defaultValue}}}function Vo(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in ja}function yo(o,i){const l=new co(ja,Eu,[],i?function(g){const x={color:ii,string:Bt,number:ct,enum:Bt,boolean:_t,formatted:Xi,padding:or,projectionDefinition:In,resolvedImage:Sl,variableAnchorOffsetCollection:ao};return g.type==="array"?fr(x[g.value]||Gt,g.length):x[g.type]}(i):void 0),d=l.parse(o,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?rp(new Fl(d,i)):kl(l.errors)}class Wd{constructor(i,l){this.kind=i,this._styleExpression=l,this.isStateDependent=i!=="constant"&&!Au(l.expression)}evaluateWithoutErrorHandling(i,l,d,g,x,w){return this._styleExpression.evaluateWithoutErrorHandling(i,l,d,g,x,w)}evaluate(i,l,d,g,x,w){return this._styleExpression.evaluate(i,l,d,g,x,w)}}class na{constructor(i,l,d,g){this.kind=i,this.zoomStops=d,this._styleExpression=l,this.isStateDependent=i!=="camera"&&!Au(l.expression),this.interpolationType=g}evaluateWithoutErrorHandling(i,l,d,g,x,w){return this._styleExpression.evaluateWithoutErrorHandling(i,l,d,g,x,w)}evaluate(i,l,d,g,x,w){return this._styleExpression.evaluate(i,l,d,g,x,w)}interpolationFactor(i,l,d){return this.interpolationType?Xr.interpolationFactor(this.interpolationType,i,l,d):0}}function Hh(o,i){const l=yo(o,i);if(l.result==="error")return l;const d=l.value.expression,g=Mu(d);if(!g&&!Ol(i))return kl([new Ot("","data expressions not supported")]);const x=Zh(d,["zoom"]);if(!x&&!Gh(i))return kl([new Ot("","zoom expressions not supported")]);const w=Pc(d);return w||x?w instanceof Ot?kl([w]):w instanceof Xr&&!Da(i)?kl([new Ot("",'"interpolate" expressions cannot be used with this property')]):rp(w?new na(g?"camera":"composite",l.value,w.labels,w instanceof Xr?w.interpolation:void 0):new Wd(g?"constant":"source",l.value)):kl([new Ot("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Va{constructor(i,l){this._parameters=i,this._specification=l,Vt(this,Bl(this._parameters,this._specification))}static deserialize(i){return new Va(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function Pc(o){let i=null;if(o instanceof Oi)i=Pc(o.result);else if(o instanceof wc){for(const l of o.args)if(i=Pc(l),i)break}else(o instanceof Fo||o instanceof Xr)&&o.input instanceof Or&&o.input.name==="zoom"&&(i=o);return i instanceof Ot||o.eachChild(l=>{const d=Pc(l);d instanceof Ot?i=d:!i&&d?i=new Ot("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&d&&i!==d&&(i=new Ot("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function Nl(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const i of o.slice(1))if(!Nl(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}const Ul={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Cu(o){if(o==null)return{filter:()=>!0,needGeometry:!1};Nl(o)||(o=zs(o));const i=yo(o,Ul);if(i.result==="error")throw new Error(i.value.map(l=>`${l.key}: ${l.message}`).join(", "));return{filter:(l,d,g)=>i.value.evaluate(l,d,{},g),needGeometry:Zo(o)}}function Yh(o,i){return o<i?-1:o>i?1:0}function Zo(o){if(!Array.isArray(o))return!1;if(o[0]==="within"||o[0]==="distance")return!0;for(let i=1;i<o.length;i++)if(Zo(o[i]))return!0;return!1}function zs(o){if(!o)return!0;const i=o[0];return o.length<=1?i!=="any":i==="=="?jl(o[1],o[2],"=="):i==="!="?Br(jl(o[1],o[2],"==")):i==="<"||i===">"||i==="<="||i===">="?jl(o[1],o[2],i):i==="any"?(l=o.slice(1),["any"].concat(l.map(zs))):i==="all"?["all"].concat(o.slice(1).map(zs)):i==="none"?["all"].concat(o.slice(1).map(zs).map(Br)):i==="in"?Vl(o[1],o.slice(2)):i==="!in"?Br(Vl(o[1],o.slice(2))):i==="has"?ra(o[1]):i!=="!has"||Br(ra(o[1]));var l}function jl(o,i,l){switch(o){case"$type":return[`filter-type-${l}`,i];case"$id":return[`filter-id-${l}`,i];default:return[`filter-${l}`,o,i]}}function Vl(o,i){if(i.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(l=>typeof l!=typeof i[0])?["filter-in-large",o,["literal",i.sort(Yh)]]:["filter-in-small",o,["literal",i]]}}function ra(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Br(o){return["!",o]}function Za(o){const i=typeof o;if(i==="number"||i==="boolean"||i==="string"||o==null)return JSON.stringify(o);if(Array.isArray(o)){let g="[";for(const x of o)g+=`${Za(x)},`;return`${g}]`}const l=Object.keys(o).sort();let d="{";for(let g=0;g<l.length;g++)d+=`${JSON.stringify(l[g])}:${Za(o[l[g]])},`;return`${d}}`}function vo(o){let i="";for(const l of fe)i+=`/${Za(o[l])}`;return i}function ks(o){const i=o.value;return i?[new je(o.key,i,"constants have been deprecated as of v8")]:[]}function on(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Go(o){if(Array.isArray(o))return o.map(Go);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const i={};for(const l in o)i[l]=Go(o[l]);return i}return on(o)}function va(o){const i=o.key,l=o.value,d=o.valueSpec||{},g=o.objectElementValidators||{},x=o.style,w=o.styleSpec,M=o.validateSpec;let C=[];const P=Ui(l);if(P!=="object")return[new je(i,l,`object expected, ${P} found`)];for(const O in l){const L=O.split(".")[0],j=d[L]||d["*"];let Z;if(g[L])Z=g[L];else if(d[L])Z=M;else if(g["*"])Z=g["*"];else{if(!d["*"]){C.push(new je(i,l[O],`unknown property "${O}"`));continue}Z=M}C=C.concat(Z({key:(i&&`${i}.`)+O,value:l[O],valueSpec:j,style:x,styleSpec:w,object:l,objectKey:O,validateSpec:M},l))}for(const O in d)g[O]||d[O].required&&d[O].default===void 0&&l[O]===void 0&&C.push(new je(i,l,`missing required property "${O}"`));return C}function Du(o){const i=o.value,l=o.valueSpec,d=o.style,g=o.styleSpec,x=o.key,w=o.arrayElementValidator||o.validateSpec;if(Ui(i)!=="array")return[new je(x,i,`array expected, ${Ui(i)} found`)];if(l.length&&i.length!==l.length)return[new je(x,i,`array length ${l.length} expected, length ${i.length} found`)];if(l["min-length"]&&i.length<l["min-length"])return[new je(x,i,`array length at least ${l["min-length"]} expected, length ${i.length} found`)];let M={type:l.value,values:l.values};g.$version<7&&(M.function=l.function),Ui(l.value)==="object"&&(M=l.value);let C=[];for(let P=0;P<i.length;P++)C=C.concat(w({array:i,arrayIndex:P,value:i[P],valueSpec:M,validateSpec:o.validateSpec,style:d,styleSpec:g,key:`${x}[${P}]`}));return C}function Rr(o){const i=o.key,l=o.value,d=o.valueSpec;let g=Ui(l);return g==="number"&&l!=l&&(g="NaN"),g!=="number"?[new je(i,l,`number expected, ${g} found`)]:"minimum"in d&&l<d.minimum?[new je(i,l,`${l} is less than the minimum value ${d.minimum}`)]:"maximum"in d&&l>d.maximum?[new je(i,l,`${l} is greater than the maximum value ${d.maximum}`)]:[]}function Un(o){const i=o.valueSpec,l=on(o.value.type);let d,g,x,w={};const M=l!=="categorical"&&o.value.property===void 0,C=!M,P=Ui(o.value.stops)==="array"&&Ui(o.value.stops[0])==="array"&&Ui(o.value.stops[0][0])==="object",O=va({key:o.key,value:o.value,valueSpec:o.styleSpec.function,validateSpec:o.validateSpec,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(Z){if(l==="identity")return[new je(Z.key,Z.value,'identity function may not have a "stops" property')];let H=[];const X=Z.value;return H=H.concat(Du({key:Z.key,value:X,valueSpec:Z.valueSpec,validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec,arrayElementValidator:L})),Ui(X)==="array"&&X.length===0&&H.push(new je(Z.key,X,"array must have at least one stop")),H},default:function(Z){return Z.validateSpec({key:Z.key,value:Z.value,valueSpec:i,validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec})}}});return l==="identity"&&M&&O.push(new je(o.key,o.value,'missing required property "property"')),l==="identity"||o.value.stops||O.push(new je(o.key,o.value,'missing required property "stops"')),l==="exponential"&&o.valueSpec.expression&&!Da(o.valueSpec)&&O.push(new je(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(C&&!Ol(o.valueSpec)?O.push(new je(o.key,o.value,"property functions not supported")):M&&!Gh(o.valueSpec)&&O.push(new je(o.key,o.value,"zoom functions not supported"))),l!=="categorical"&&!P||o.value.property!==void 0||O.push(new je(o.key,o.value,'"property" property is required')),O;function L(Z){let H=[];const X=Z.value,re=Z.key;if(Ui(X)!=="array")return[new je(re,X,`array expected, ${Ui(X)} found`)];if(X.length!==2)return[new je(re,X,`array length 2 expected, length ${X.length} found`)];if(P){if(Ui(X[0])!=="object")return[new je(re,X,`object expected, ${Ui(X[0])} found`)];if(X[0].zoom===void 0)return[new je(re,X,"object stop key must have zoom")];if(X[0].value===void 0)return[new je(re,X,"object stop key must have value")];if(x&&x>on(X[0].zoom))return[new je(re,X[0].zoom,"stop zoom values must appear in ascending order")];on(X[0].zoom)!==x&&(x=on(X[0].zoom),g=void 0,w={}),H=H.concat(va({key:`${re}[0]`,value:X[0],valueSpec:{zoom:{}},validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{zoom:Rr,value:j}}))}else H=H.concat(j({key:`${re}[0]`,value:X[0],validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec},X));return Vo(Go(X[1]))?H.concat([new je(`${re}[1]`,X[1],"expressions are not allowed in function stops.")]):H.concat(Z.validateSpec({key:`${re}[1]`,value:X[1],valueSpec:i,validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec}))}function j(Z,H){const X=Ui(Z.value),re=on(Z.value),ue=Z.value!==null?Z.value:H;if(d){if(X!==d)return[new je(Z.key,ue,`${X} stop domain type must match previous stop domain type ${d}`)]}else d=X;if(X!=="number"&&X!=="string"&&X!=="boolean")return[new je(Z.key,ue,"stop domain value must be a number, string, or boolean")];if(X!=="number"&&l!=="categorical"){let ve=`number expected, ${X} found`;return Ol(i)&&l===void 0&&(ve+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new je(Z.key,ue,ve)]}return l!=="categorical"||X!=="number"||isFinite(re)&&Math.floor(re)===re?l!=="categorical"&&X==="number"&&g!==void 0&&re<g?[new je(Z.key,ue,"stop domain values must appear in ascending order")]:(g=re,l==="categorical"&&re in w?[new je(Z.key,ue,"stop domain values must be unique")]:(w[re]=!0,[])):[new je(Z.key,ue,`integer expected, found ${re}`)]}}function Pi(o){const i=(o.expressionContext==="property"?Hh:yo)(Go(o.value),o.valueSpec);if(i.result==="error")return i.value.map(d=>new je(`${o.key}${d.key}`,o.value,d.message));const l=i.value.expression||i.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!l.outputDefined())return[new je(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!Au(l))return[new je(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter"&&!Au(l))return[new je(o.key,o.value,'"feature-state" data expressions are not supported with filters.')];if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!Zh(l,["zoom","feature-state"]))return[new je(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!Mu(l))return[new je(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function cs(o){const i=o.key,l=o.value,d=o.valueSpec,g=[];return Array.isArray(d.values)?d.values.indexOf(on(l))===-1&&g.push(new je(i,l,`expected one of [${d.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(d.values).indexOf(on(l))===-1&&g.push(new je(i,l,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(l)} found`)),g}function Ra(o){return Nl(Go(o.value))?Pi(Vt({},o,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ru(o)}function Ru(o){const i=o.value,l=o.key;if(Ui(i)!=="array")return[new je(l,i,`array expected, ${Ui(i)} found`)];const d=o.styleSpec;let g,x=[];if(i.length<1)return[new je(l,i,"filter array must have at least 1 element")];switch(x=x.concat(cs({key:`${l}[0]`,value:i[0],valueSpec:d.filter_operator,style:o.style,styleSpec:o.styleSpec})),on(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&on(i[1])==="$type"&&x.push(new je(l,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&x.push(new je(l,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(g=Ui(i[1]),g!=="string"&&x.push(new je(`${l}[1]`,i[1],`string expected, ${g} found`)));for(let w=2;w<i.length;w++)g=Ui(i[w]),on(i[1])==="$type"?x=x.concat(cs({key:`${l}[${w}]`,value:i[w],valueSpec:d.geometry_type,style:o.style,styleSpec:o.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&x.push(new je(`${l}[${w}]`,i[w],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let w=1;w<i.length;w++)x=x.concat(Ru({key:`${l}[${w}]`,value:i[w],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":g=Ui(i[1]),i.length!==2?x.push(new je(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):g!=="string"&&x.push(new je(`${l}[1]`,i[1],`string expected, ${g} found`))}return x}function qo(o,i){const l=o.key,d=o.validateSpec,g=o.style,x=o.styleSpec,w=o.value,M=o.objectKey,C=x[`${i}_${o.layerType}`];if(!C)return[];const P=M.match(/^(.*)-transition$/);if(i==="paint"&&P&&C[P[1]]&&C[P[1]].transition)return d({key:l,value:w,valueSpec:x.transition,style:g,styleSpec:x});const O=o.valueSpec||C[M];if(!O)return[new je(l,w,`unknown property "${M}"`)];let L;if(Ui(w)==="string"&&Ol(O)&&!O.tokens&&(L=/^{([^}]+)}$/.exec(w)))return[new je(l,w,`"${M}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(L[1])} }\`.`)];const j=[];return o.layerType==="symbol"&&(M==="text-field"&&g&&!g.glyphs&&j.push(new je(l,w,'use of "text-field" requires a style "glyphs" property')),M==="text-font"&&ia(Go(w))&&on(w.type)==="identity"&&j.push(new je(l,w,'"text-font" does not support identity functions'))),j.concat(d({key:o.key,value:w,valueSpec:O,style:g,styleSpec:x,expressionContext:"property",propertyType:i,propertyKey:M}))}function Xh(o){return qo(o,"paint")}function Kh(o){return qo(o,"layout")}function Os(o){let i=[];const l=o.value,d=o.key,g=o.style,x=o.styleSpec;l.type||l.ref||i.push(new je(d,l,'either "type" or "ref" is required'));let w=on(l.type);const M=on(l.ref);if(l.id){const C=on(l.id);for(let P=0;P<o.arrayIndex;P++){const O=g.layers[P];on(O.id)===C&&i.push(new je(d,l.id,`duplicate layer id "${l.id}", previously used at line ${O.id.__line__}`))}}if("ref"in l){let C;["type","source","source-layer","filter","layout"].forEach(P=>{P in l&&i.push(new je(d,l[P],`"${P}" is prohibited for ref layers`))}),g.layers.forEach(P=>{on(P.id)===M&&(C=P)}),C?C.ref?i.push(new je(d,l.ref,"ref cannot reference another ref layer")):w=on(C.type):i.push(new je(d,l.ref,`ref layer "${M}" not found`))}else if(w!=="background")if(l.source){const C=g.sources&&g.sources[l.source],P=C&&on(C.type);C?P==="vector"&&w==="raster"?i.push(new je(d,l.source,`layer "${l.id}" requires a raster source`)):P!=="raster-dem"&&w==="hillshade"?i.push(new je(d,l.source,`layer "${l.id}" requires a raster-dem source`)):P==="raster"&&w!=="raster"?i.push(new je(d,l.source,`layer "${l.id}" requires a vector source`)):P!=="vector"||l["source-layer"]?P==="raster-dem"&&w!=="hillshade"?i.push(new je(d,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):w!=="line"||!l.paint||!l.paint["line-gradient"]||P==="geojson"&&C.lineMetrics||i.push(new je(d,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new je(d,l,`layer "${l.id}" must specify a "source-layer"`)):i.push(new je(d,l.source,`source "${l.source}" not found`))}else i.push(new je(d,l,'missing required property "source"'));return i=i.concat(va({key:d,value:l,valueSpec:x.layer,style:o.style,styleSpec:o.styleSpec,validateSpec:o.validateSpec,objectElementValidators:{"*":()=>[],type:()=>o.validateSpec({key:`${d}.type`,value:l.type,valueSpec:x.layer.type,style:o.style,styleSpec:o.styleSpec,validateSpec:o.validateSpec,object:l,objectKey:"type"}),filter:Ra,layout:C=>va({layer:l,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":P=>Kh(Vt({layerType:w},P))}}),paint:C=>va({layer:l,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":P=>Xh(Vt({layerType:w},P))}})}})),i}function us(o){const i=o.value,l=o.key,d=Ui(i);return d!=="string"?[new je(l,i,`string expected, ${d} found`)]:[]}const Qd={promoteId:function({key:o,value:i}){if(Ui(i)==="string")return us({key:o,value:i});{const l=[];for(const d in i)l.push(...us({key:`${o}.${d}`,value:i[d]}));return l}}};function zc(o){const i=o.value,l=o.key,d=o.styleSpec,g=o.style,x=o.validateSpec;if(!i.type)return[new je(l,i,'"type" is required')];const w=on(i.type);let M;switch(w){case"vector":case"raster":return M=va({key:l,value:i,valueSpec:d[`source_${w.replace("-","_")}`],style:o.style,styleSpec:d,objectElementValidators:Qd,validateSpec:x}),M;case"raster-dem":return M=function(C){var P;const O=(P=C.sourceName)!==null&&P!==void 0?P:"",L=C.value,j=C.styleSpec,Z=j.source_raster_dem,H=C.style;let X=[];const re=Ui(L);if(L===void 0)return X;if(re!=="object")return X.push(new je("source_raster_dem",L,`object expected, ${re} found`)),X;const ue=on(L.encoding)==="custom",ve=["redFactor","greenFactor","blueFactor","baseShift"],de=C.value.encoding?`"${C.value.encoding}"`:"Default";for(const V in L)!ue&&ve.includes(V)?X.push(new je(V,L[V],`In "${O}": "${V}" is only valid when "encoding" is set to "custom". ${de} encoding found`)):Z[V]?X=X.concat(C.validateSpec({key:V,value:L[V],valueSpec:Z[V],validateSpec:C.validateSpec,style:H,styleSpec:j})):X.push(new je(V,L[V],`unknown property "${V}"`));return X}({sourceName:l,value:i,style:o.style,styleSpec:d,validateSpec:x}),M;case"geojson":if(M=va({key:l,value:i,valueSpec:d.source_geojson,style:g,styleSpec:d,validateSpec:x,objectElementValidators:Qd}),i.cluster)for(const C in i.clusterProperties){const[P,O]=i.clusterProperties[C],L=typeof P=="string"?[P,["accumulated"],["get",C]]:P;M.push(...Pi({key:`${l}.${C}.map`,value:O,expressionContext:"cluster-map"})),M.push(...Pi({key:`${l}.${C}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return M;case"video":return va({key:l,value:i,valueSpec:d.source_video,style:g,validateSpec:x,styleSpec:d});case"image":return va({key:l,value:i,valueSpec:d.source_image,style:g,validateSpec:x,styleSpec:d});case"canvas":return[new je(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return cs({key:`${l}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Wh(o){const i=o.value,l=o.styleSpec,d=l.light,g=o.style;let x=[];const w=Ui(i);if(i===void 0)return x;if(w!=="object")return x=x.concat([new je("light",i,`object expected, ${w} found`)]),x;for(const M in i){const C=M.match(/^(.*)-transition$/);x=x.concat(C&&d[C[1]]&&d[C[1]].transition?o.validateSpec({key:M,value:i[M],valueSpec:l.transition,validateSpec:o.validateSpec,style:g,styleSpec:l}):d[M]?o.validateSpec({key:M,value:i[M],valueSpec:d[M],validateSpec:o.validateSpec,style:g,styleSpec:l}):[new je(M,i[M],`unknown property "${M}"`)])}return x}function $o(o){const i=o.value,l=o.styleSpec,d=l.sky,g=o.style,x=Ui(i);if(i===void 0)return[];if(x!=="object")return[new je("sky",i,`object expected, ${x} found`)];let w=[];for(const M in i)w=w.concat(d[M]?o.validateSpec({key:M,value:i[M],valueSpec:d[M],style:g,styleSpec:l}):[new je(M,i[M],`unknown property "${M}"`)]);return w}function Bs(o){const i=o.value,l=o.styleSpec,d=l.terrain,g=o.style;let x=[];const w=Ui(i);if(i===void 0)return x;if(w!=="object")return x=x.concat([new je("terrain",i,`object expected, ${w} found`)]),x;for(const M in i)x=x.concat(d[M]?o.validateSpec({key:M,value:i[M],valueSpec:d[M],validateSpec:o.validateSpec,style:g,styleSpec:l}):[new je(M,i[M],`unknown property "${M}"`)]);return x}function Pa(o){let i=[];const l=o.value,d=o.key;if(Array.isArray(l)){const g=[],x=[];for(const w in l)l[w].id&&g.includes(l[w].id)&&i.push(new je(d,l,`all the sprites' ids must be unique, but ${l[w].id} is duplicated`)),g.push(l[w].id),l[w].url&&x.includes(l[w].url)&&i.push(new je(d,l,`all the sprites' URLs must be unique, but ${l[w].url} is duplicated`)),x.push(l[w].url),i=i.concat(va({key:`${d}[${w}]`,value:l[w],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:o.validateSpec}));return i}return us({key:d,value:l})}const ba={"*":()=>[],array:Du,boolean:function(o){const i=o.value,l=o.key,d=Ui(i);return d!=="boolean"?[new je(l,i,`boolean expected, ${d} found`)]:[]},number:Rr,color:function(o){const i=o.key,l=o.value,d=Ui(l);return d!=="string"?[new je(i,l,`color expected, ${d} found`)]:Bi.parse(String(l))?[]:[new je(i,l,`color expected, "${l}" found`)]},constants:ks,enum:cs,filter:Ra,function:Un,layer:Os,object:va,source:zc,light:Wh,sky:$o,terrain:Bs,projection:function(o){const i=o.value,l=o.styleSpec,d=l.projection,g=o.style,x=Ui(i);if(i===void 0)return[];if(x!=="object")return[new je("projection",i,`object expected, ${x} found`)];let w=[];for(const M in i)w=w.concat(d[M]?o.validateSpec({key:M,value:i[M],valueSpec:d[M],style:g,styleSpec:l}):[new je(M,i[M],`unknown property "${M}"`)]);return w},projectionDefinition:function(o){const i=o.key;let l=o.value;l=l instanceof String?l.valueOf():l;const d=Ui(l);return d!=="array"||function(g){return Array.isArray(g)&&g.length===3&&typeof g[0]=="string"&&typeof g[1]=="string"&&typeof g[2]=="number"}(l)||function(g){return!!["interpolate","step","literal"].includes(g[0])}(l)?["array","string"].includes(d)?[]:[new je(i,l,`projection expected, invalid type "${d}" found`)]:[new je(i,l,`projection expected, invalid array ${JSON.stringify(l)} found`)]},string:us,formatted:function(o){return us(o).length===0?[]:Pi(o)},resolvedImage:function(o){return us(o).length===0?[]:Pi(o)},padding:function(o){const i=o.key,l=o.value;if(Ui(l)==="array"){if(l.length<1||l.length>4)return[new je(i,l,`padding requires 1 to 4 values; ${l.length} values found`)];const d={type:"number"};let g=[];for(let x=0;x<l.length;x++)g=g.concat(o.validateSpec({key:`${i}[${x}]`,value:l[x],validateSpec:o.validateSpec,valueSpec:d}));return g}return Rr({key:i,value:l,valueSpec:{}})},variableAnchorOffsetCollection:function(o){const i=o.key,l=o.value,d=Ui(l),g=o.styleSpec;if(d!=="array"||l.length<1||l.length%2!=0)return[new je(i,l,"variableAnchorOffsetCollection requires a non-empty array of even length")];let x=[];for(let w=0;w<l.length;w+=2)x=x.concat(cs({key:`${i}[${w}]`,value:l[w],valueSpec:g.layout_symbol["text-anchor"]})),x=x.concat(Du({key:`${i}[${w+1}]`,value:l[w+1],valueSpec:{length:2,value:"number"},validateSpec:o.validateSpec,style:o.style,styleSpec:g}));return x},sprite:Pa};function Pr(o){const i=o.value,l=o.valueSpec,d=o.styleSpec;return o.validateSpec=Pr,l.expression&&ia(on(i))?Un(o):l.expression&&Vo(Go(i))?Pi(o):l.type&&ba[l.type]?ba[l.type](o):va(Vt({},o,{valueSpec:l.type?d[l.type]:l}))}function Ho(o){const i=o.value,l=o.key,d=us(o);return d.length||(i.indexOf("{fontstack}")===-1&&d.push(new je(l,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&d.push(new je(l,i,'"glyphs" url must include a "{range}" token'))),d}function Kr(o,i=$){let l=[];return l=l.concat(Pr({key:"",value:o,valueSpec:i.$root,styleSpec:i,style:o,validateSpec:Pr,objectElementValidators:{glyphs:Ho,"*":()=>[]}})),o.constants&&(l=l.concat(ks({key:"constants",value:o.constants}))),Yo(l)}function za(o){return function(i){return o({...i,validateSpec:Pr})}}function Yo(o){return[].concat(o).sort((i,l)=>i.line-l.line)}function an(o){return function(...i){return Yo(o.apply(this,i))}}Kr.source=an(za(zc)),Kr.sprite=an(za(Pa)),Kr.glyphs=an(za(Ho)),Kr.light=an(za(Wh)),Kr.sky=an(za($o)),Kr.terrain=an(za(Bs)),Kr.layer=an(za(Os)),Kr.filter=an(za(Ra)),Kr.paintProperty=an(za(Xh)),Kr.layoutProperty=an(za(Kh));const Ls=Kr,Qh=Ls.light,Im=Ls.sky,Jd=Ls.paintProperty,Cm=Ls.layoutProperty;function jn(o,i){let l=!1;if(i&&i.length)for(const d of i)o.fire(new W(new Error(d.message))),l=!0;return l}class Zl{constructor(i,l,d){const g=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;const w=new Int32Array(this.arrayBuffer);i=w[0],this.d=(l=w[1])+2*(d=w[2]);for(let C=0;C<this.d*this.d;C++){const P=w[3+C],O=w[3+C+1];g.push(P===O?null:w.subarray(P,O))}const M=w[3+g.length+1];this.keys=w.subarray(w[3+g.length],M),this.bboxes=w.subarray(M),this.insert=this._insertReadonly}else{this.d=l+2*d;for(let w=0;w<this.d*this.d;w++)g.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=i,this.padding=d,this.scale=l/i,this.uid=0;const x=d/l*i;this.min=-x,this.max=i+x}insert(i,l,d,g,x){this._forEachCell(l,d,g,x,this._insertCell,this.uid++,void 0,void 0),this.keys.push(i),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(x)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(i,l,d,g,x,w){this.cells[x].push(w)}query(i,l,d,g,x){const w=this.min,M=this.max;if(i<=w&&l<=w&&M<=d&&M<=g&&!x)return Array.prototype.slice.call(this.keys);{const C=[];return this._forEachCell(i,l,d,g,this._queryCell,C,{},x),C}}_queryCell(i,l,d,g,x,w,M,C){const P=this.cells[x];if(P!==null){const O=this.keys,L=this.bboxes;for(let j=0;j<P.length;j++){const Z=P[j];if(M[Z]===void 0){const H=4*Z;(C?C(L[H+0],L[H+1],L[H+2],L[H+3]):i<=L[H+2]&&l<=L[H+3]&&d>=L[H+0]&&g>=L[H+1])?(M[Z]=!0,w.push(O[Z])):M[Z]=!1}}}}_forEachCell(i,l,d,g,x,w,M,C){const P=this._convertToCellCoord(i),O=this._convertToCellCoord(l),L=this._convertToCellCoord(d),j=this._convertToCellCoord(g);for(let Z=P;Z<=L;Z++)for(let H=O;H<=j;H++){const X=this.d*H+Z;if((!C||C(this._convertFromCellCoord(Z),this._convertFromCellCoord(H),this._convertFromCellCoord(Z+1),this._convertFromCellCoord(H+1)))&&x.call(this,i,l,d,g,X,w,M,C))return}}_convertFromCellCoord(i){return(i-this.padding)/this.scale}_convertToCellCoord(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const i=this.cells,l=3+this.cells.length+1+1;let d=0;for(let w=0;w<this.cells.length;w++)d+=this.cells[w].length;const g=new Int32Array(l+d+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let x=l;for(let w=0;w<i.length;w++){const M=i[w];g[3+w]=x,g.set(M,x),x+=M.length}return g[3+i.length]=x,g.set(this.keys,x),x+=this.keys.length,g[3+i.length+1]=x,g.set(this.bboxes,x),x+=this.bboxes.length,g.buffer}static serialize(i,l){const d=i.toArrayBuffer();return l&&l.push(d),{buffer:d}}static deserialize(i){return new Zl(i.buffer)}}const Lr={};function Rt(o,i,l={}){if(Lr[o])throw new Error(`${o} is already registered.`);Object.defineProperty(i,"_classRegistryKey",{value:o,writeable:!1}),Lr[o]={klass:i,omit:l.omit||[],shallow:l.shallow||[]}}Rt("Object",Object),Rt("TransferableGridIndex",Zl),Rt("Color",Bi),Rt("Error",Error),Rt("AJAXError",Wn),Rt("ResolvedImage",Yr),Rt("StylePropertyFunction",Va),Rt("StyleExpression",Fl,{omit:["_evaluator"]}),Rt("ZoomDependentExpression",na),Rt("ZoomConstantExpression",Wd),Rt("CompoundExpression",Or,{omit:["_evaluate"]});for(const o in ja)ja[o]._classRegistryKey||Rt(`Expression_${o}`,ja[o]);function Jh(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function hs(o){return o.$name||o.constructor._classRegistryKey}function Gl(o){return!function(i){if(i===null||typeof i!="object")return!1;const l=hs(i);return!(!l||l==="Object")}(o)&&(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||o instanceof Blob||o instanceof Error||Jh(o)||yl(o)||ArrayBuffer.isView(o)||o instanceof ImageData)}function ql(o,i){if(Gl(o))return(Jh(o)||yl(o))&&i&&i.push(o),ArrayBuffer.isView(o)&&i&&i.push(o.buffer),o instanceof ImageData&&i&&i.push(o.data.buffer),o;if(Array.isArray(o)){const x=[];for(const w of o)x.push(ql(w,i));return x}if(typeof o!="object")throw new Error("can't serialize object of type "+typeof o);const l=hs(o);if(!l)throw new Error(`can't serialize object of unregistered class ${o.constructor.name}`);if(!Lr[l])throw new Error(`${l} is not registered.`);const{klass:d}=Lr[l],g=d.serialize?d.serialize(o,i):{};if(d.serialize){if(i&&g===i[i.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const x in o){if(!o.hasOwnProperty(x)||Lr[l].omit.indexOf(x)>=0)continue;const w=o[x];g[x]=Lr[l].shallow.indexOf(x)>=0?w:ql(w,i)}o instanceof Error&&(g.message=o.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(g.$name=l),g}function bo(o){if(Gl(o))return o;if(Array.isArray(o))return o.map(bo);if(typeof o!="object")throw new Error("can't deserialize object of type "+typeof o);const i=hs(o)||"Object";if(!Lr[i])throw new Error(`can't deserialize unregistered class ${i}`);const{klass:l}=Lr[i];if(!l)throw new Error(`can't deserialize unregistered class ${i}`);if(l.deserialize)return l.deserialize(o);const d=Object.create(l.prototype);for(const g of Object.keys(o)){if(g==="$name")continue;const x=o[g];d[g]=Lr[i].shallow.indexOf(g)>=0?x:bo(x)}return d}class ef{constructor(){this.first=!0}update(i,l){const d=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=d,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=d,!0):(this.lastFloorZoom>d?(this.lastIntegerZoom=d+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<d&&(this.lastIntegerZoom=d,this.lastIntegerZoomTime=l),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=d,!0))}}const Mi={"Latin-1 Supplement":o=>o>=128&&o<=255,"Hangul Jamo":o=>o>=4352&&o<=4607,Khmer:o=>o>=6016&&o<=6143,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Kanbun:o=>o>=12688&&o<=12703,"CJK Strokes":o=>o>=12736&&o<=12783,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Hangul Syllables":o=>o>=44032&&o<=55215,"Private Use Area":o=>o>=57344&&o<=63743,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519};function Fs(o){for(const i of o)if(kc(i.charCodeAt(0)))return!0;return!1}function ed(o){for(const i of o)if(!Pu(i.charCodeAt(0)))return!1;return!0}function Xo(o){const i=o.map(l=>{try{return new RegExp(`\\p{sc=${l}}`,"u").source}catch{return null}}).filter(l=>l);return new RegExp(i.join("|"),"u")}const tf=Xo(["Arab","Dupl","Mong","Ougr","Syrc"]);function Pu(o){return!tf.test(String.fromCodePoint(o))}const td=Xo(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function kc(o){return!(o!==746&&o!==747&&(o<4352||!(Mi["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||Mi["CJK Compatibility"](o)||Mi["CJK Strokes"](o)||!(!Mi["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||Mi["Enclosed CJK Letters and Months"](o)||Mi["Ideographic Description Characters"](o)||Mi.Kanbun(o)||Mi.Katakana(o)&&o!==12540||!(!Mi["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!Mi["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||Mi["Vertical Forms"](o)||Mi["Yijing Hexagram Symbols"](o)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(o))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(o))||td.test(String.fromCodePoint(o)))))}function zu(o){return!(kc(o)||function(i){return!!(Mi["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||Mi["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||Mi["Letterlike Symbols"](i)||Mi["Number Forms"](i)||Mi["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||Mi["Control Pictures"](i)&&i!==9251||Mi["Optical Character Recognition"](i)||Mi["Enclosed Alphanumerics"](i)||Mi["Geometric Shapes"](i)||Mi["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||Mi["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||Mi["CJK Symbols and Punctuation"](i)||Mi.Katakana(i)||Mi["Private Use Area"](i)||Mi["CJK Compatibility Forms"](i)||Mi["Small Form Variants"](i)||Mi["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(o))}const nf=Xo(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Oc(o){return nf.test(String.fromCodePoint(o))}function ap(o,i){return!(!i&&Oc(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||Mi.Khmer(o))}function ku(o){for(const i of o)if(Oc(i.charCodeAt(0)))return!0;return!1}const Ns=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(o){this.pluginStatus=o.pluginStatus,this.pluginURL=o.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(o){if(Ns.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=o.applyArabicShaping,this.processBidirectionalText=o.processBidirectionalText,this.processStyledBidirectionalText=o.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(o,i){return u(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(o.pluginStatus!=="loading")return this.setState(o),o;const l=o.pluginURL,d=new Promise(x=>{this.loadScriptResolve=x});i(l);const g=new Promise(x=>setTimeout(()=>x(),this.TIMEOUT));if(yield Promise.race([d,g]),this.isParsed()){const x={pluginStatus:"loaded",pluginURL:l};return this.setState(x),x}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${l}`)})}};class fn{constructor(i,l){this.zoom=i,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.zoomHistory=l.zoomHistory,this.transition=l.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ef,this.transition={})}isSupportedScript(i){return function(l,d){for(const g of l)if(!ap(g.charCodeAt(0),d))return!1;return!0}(i,Ns.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,l=i-Math.floor(i),d=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*d}:{fromScale:.5,toScale:1,t:1-(1-d)*l}}}class Ga{constructor(i,l){this.property=i,this.value=l,this.expression=function(d,g){if(ia(d))return new Va(d,g);if(Vo(d)){const x=Hh(d,g);if(x.result==="error")throw new Error(x.value.map(w=>`${w.key}: ${w.message}`).join(", "));return x.value}{let x=d;return g.type==="color"&&typeof d=="string"?x=Bi.parse(d):g.type!=="padding"||typeof d!="number"&&!Array.isArray(d)?g.type==="variableAnchorOffsetCollection"&&Array.isArray(d)?x=Cr.parse(d):g.type==="projectionDefinition"&&typeof d=="string"&&(x=lr.parse(d)):x=xr.parse(d),{kind:"constant",evaluate:()=>x}}}(l===void 0?i.specification.default:l,i.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,l,d){return this.property.possiblyEvaluate(this,i,l,d)}}class Bc{constructor(i){this.property=i,this.value=new Ga(i,void 0)}transitioned(i,l){return new xo(this.property,this.value,l,ti({},i.transition,this.transition),i.now)}untransitioned(){return new xo(this.property,this.value,null,{},0)}}class $l{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return Fn(this._values[i].value.value)}setValue(i,l){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new Bc(this._values[i].property)),this._values[i].value=new Ga(this._values[i].property,l===null?void 0:Fn(l))}getTransition(i){return Fn(this._values[i].transition)}setTransition(i,l){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new Bc(this._values[i].property)),this._values[i].transition=Fn(l)||void 0}serialize(){const i={};for(const l of Object.keys(this._values)){const d=this.getValue(l);d!==void 0&&(i[l]=d);const g=this.getTransition(l);g!==void 0&&(i[`${l}-transition`]=g)}return i}transitioned(i,l){const d=new ds(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].transitioned(i,l._values[g]);return d}untransitioned(){const i=new ds(this._properties);for(const l of Object.keys(this._values))i._values[l]=this._values[l].untransitioned();return i}}class xo{constructor(i,l,d,g,x){this.property=i,this.value=l,this.begin=x+g.delay||0,this.end=this.begin+g.duration||0,i.specification.transition&&(g.delay||g.duration)&&(this.prior=d)}possiblyEvaluate(i,l,d){const g=i.now||0,x=this.value.possiblyEvaluate(i,l,d),w=this.prior;if(w){if(g>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(g<this.begin)return w.possiblyEvaluate(i,l,d);{const M=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(w.possiblyEvaluate(i,l,d),x,xe(M))}}return x}}class ds{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,l,d){const g=new Hl(this._properties);for(const x of Object.keys(this._values))g._values[x]=this._values[x].possiblyEvaluate(i,l,d);return g}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class Ou{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}hasValue(i){return this._values[i].value!==void 0}getValue(i){return Fn(this._values[i].value)}setValue(i,l){this._values[i]=new Ga(this._values[i].property,l===null?void 0:Fn(l))}serialize(){const i={};for(const l of Object.keys(this._values)){const d=this.getValue(l);d!==void 0&&(i[l]=d)}return i}possiblyEvaluate(i,l,d){const g=new Hl(this._properties);for(const x of Object.keys(this._values))g._values[x]=this._values[x].possiblyEvaluate(i,l,d);return g}}class qa{constructor(i,l,d){this.property=i,this.value=l,this.parameters=d}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,l,d,g){return this.property.evaluate(this.value,this.parameters,i,l,d,g)}}class Hl{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class Nt{constructor(i){this.specification=i}possiblyEvaluate(i,l){if(i.isDataDriven())throw new Error("Value should not be data driven");return i.expression.evaluate(l)}interpolate(i,l,d){const g=Ca[this.specification.type];return g?g(i,l,d):i}}class qt{constructor(i,l){this.specification=i,this.overrides=l}possiblyEvaluate(i,l,d,g){return new qa(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(l,null,{},d,g)}:i.expression,l)}interpolate(i,l,d){if(i.value.kind!=="constant"||l.value.kind!=="constant")return i;if(i.value.value===void 0||l.value.value===void 0)return new qa(this,{kind:"constant",value:void 0},i.parameters);const g=Ca[this.specification.type];if(g){const x=g(i.value.value,l.value.value,d);return new qa(this,{kind:"constant",value:x},i.parameters)}return i}evaluate(i,l,d,g,x,w){return i.kind==="constant"?i.value:i.evaluate(l,d,g,x,w)}}class Bu extends qt{possiblyEvaluate(i,l,d,g){if(i.value===void 0)return new qa(this,{kind:"constant",value:void 0},l);if(i.expression.kind==="constant"){const x=i.expression.evaluate(l,null,{},d,g),w=i.property.specification.type==="resolvedImage"&&typeof x!="string"?x.name:x,M=this._calculate(w,w,w,l);return new qa(this,{kind:"constant",value:M},l)}if(i.expression.kind==="camera"){const x=this._calculate(i.expression.evaluate({zoom:l.zoom-1}),i.expression.evaluate({zoom:l.zoom}),i.expression.evaluate({zoom:l.zoom+1}),l);return new qa(this,{kind:"constant",value:x},l)}return new qa(this,i.expression,l)}evaluate(i,l,d,g,x,w){if(i.kind==="source"){const M=i.evaluate(l,d,g,x,w);return this._calculate(M,M,M,l)}return i.kind==="composite"?this._calculate(i.evaluate({zoom:Math.floor(l.zoom)-1},d,g),i.evaluate({zoom:Math.floor(l.zoom)},d,g),i.evaluate({zoom:Math.floor(l.zoom)+1},d,g),l):i.value}_calculate(i,l,d,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:l}:{from:d,to:l}}interpolate(i){return i}}class id{constructor(i){this.specification=i}possiblyEvaluate(i,l,d,g){if(i.value!==void 0){if(i.expression.kind==="constant"){const x=i.expression.evaluate(l,null,{},d,g);return this._calculate(x,x,x,l)}return this._calculate(i.expression.evaluate(new fn(Math.floor(l.zoom-1),l)),i.expression.evaluate(new fn(Math.floor(l.zoom),l)),i.expression.evaluate(new fn(Math.floor(l.zoom+1),l)),l)}}_calculate(i,l,d,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:l}:{from:d,to:l}}interpolate(i){return i}}class Ko{constructor(i){this.specification=i}possiblyEvaluate(i,l,d,g){return!!i.expression.evaluate(l,null,{},d,g)}interpolate(){return!1}}class Fr{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const l in i){const d=i[l];d.specification.overridable&&this.overridableProperties.push(l);const g=this.defaultPropertyValues[l]=new Ga(d,void 0),x=this.defaultTransitionablePropertyValues[l]=new Bc(d);this.defaultTransitioningPropertyValues[l]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=g.possiblyEvaluate({})}}}Rt("DataDrivenProperty",qt),Rt("DataConstantProperty",Nt),Rt("CrossFadedDataDrivenProperty",Bu),Rt("CrossFadedProperty",id),Rt("ColorRampProperty",Ko);const rf="-transition";class Nr extends J{constructor(i,l){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1},i.type!=="custom"&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type!=="background"&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),l.layout&&(this._unevaluatedLayout=new Ou(l.layout)),l.paint)){this._transitionablePaint=new $l(l.paint);for(const d in i.paint)this.setPaintProperty(d,i.paint[d],{validate:!1});for(const d in i.layout)this.setLayoutProperty(d,i.layout[d],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Hl(l.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,l,d={}){l!=null&&this._validate(Cm,`layers.${this.id}.layout.${i}`,i,l,d)||(i!=="visibility"?this._unevaluatedLayout.setValue(i,l):this.visibility=l)}getPaintProperty(i){return i.endsWith(rf)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,l,d={}){if(l!=null&&this._validate(Jd,`layers.${this.id}.paint.${i}`,i,l,d))return!1;if(i.endsWith(rf))return this._transitionablePaint.setTransition(i.slice(0,-11),l||void 0),!1;{const g=this._transitionablePaint._values[i],x=g.property.specification["property-type"]==="cross-faded-data-driven",w=g.value.isDataDriven(),M=g.value;this._transitionablePaint.setValue(i,l),this._handleSpecialPaintPropertyUpdate(i);const C=this._transitionablePaint._values[i].value;return C.isDataDriven()||w||x||this._handleOverridablePaintPropertyUpdate(i,M,C)}}_handleSpecialPaintPropertyUpdate(i){}_handleOverridablePaintPropertyUpdate(i,l,d){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,l){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,l)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),zi(i,(l,d)=>!(l===void 0||d==="layout"&&!Object.keys(l).length||d==="paint"&&!Object.keys(l).length))}_validate(i,l,d,g,x={}){return(!x||x.validate!==!1)&&jn(this,i.call(Ls,{key:l,layerType:this.type,objectKey:d,value:g,styleSpec:$,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const l=this.paint.get(i);if(l instanceof qa&&Ol(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}}const af={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class $a{constructor(i,l){this._structArray=i,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ht{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,l){return i._trim(),l&&(i.isTransferred=!0,l.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const l=Object.create(this.prototype);return l.arrayBuffer=i.arrayBuffer,l.length=i.length,l.capacity=i.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ni(o,i=1){let l=0,d=0;return{members:o.map(g=>{const x=af[g.type].BYTES_PER_ELEMENT,w=l=cr(l,Math.max(i,x)),M=g.components||1;return d=Math.max(d,x),l+=x*M,{name:g.name,type:g.type,components:M,offset:w}}),size:cr(l,Math.max(d,i)),alignment:i}}function cr(o,i){return Math.ceil(o/i)*i}class Wo extends Ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l){const d=this.length;return this.resize(d+1),this.emplace(d,i,l)}emplace(i,l,d){const g=2*i;return this.int16[g+0]=l,this.int16[g+1]=d,i}}Wo.prototype.bytesPerElement=4,Rt("StructArrayLayout2i4",Wo);class aa extends Ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,d)}emplace(i,l,d,g){const x=3*i;return this.int16[x+0]=l,this.int16[x+1]=d,this.int16[x+2]=g,i}}aa.prototype.bytesPerElement=6,Rt("StructArrayLayout3i6",aa);class Us extends Ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,d,g){const x=this.length;return this.resize(x+1),this.emplace(x,i,l,d,g)}emplace(i,l,d,g,x){const w=4*i;return this.int16[w+0]=l,this.int16[w+1]=d,this.int16[w+2]=g,this.int16[w+3]=x,i}}Us.prototype.bytesPerElement=8,Rt("StructArrayLayout4i8",Us);class Qo extends Ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,d,g,x,w){const M=this.length;return this.resize(M+1),this.emplace(M,i,l,d,g,x,w)}emplace(i,l,d,g,x,w,M){const C=6*i;return this.int16[C+0]=l,this.int16[C+1]=d,this.int16[C+2]=g,this.int16[C+3]=x,this.int16[C+4]=w,this.int16[C+5]=M,i}}Qo.prototype.bytesPerElement=12,Rt("StructArrayLayout2i4i12",Qo);class Jo extends Ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,d,g,x,w){const M=this.length;return this.resize(M+1),this.emplace(M,i,l,d,g,x,w)}emplace(i,l,d,g,x,w,M){const C=4*i,P=8*i;return this.int16[C+0]=l,this.int16[C+1]=d,this.uint8[P+4]=g,this.uint8[P+5]=x,this.uint8[P+6]=w,this.uint8[P+7]=M,i}}Jo.prototype.bytesPerElement=8,Rt("StructArrayLayout2i4ub8",Jo);class Ha extends Ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l){const d=this.length;return this.resize(d+1),this.emplace(d,i,l)}emplace(i,l,d){const g=2*i;return this.float32[g+0]=l,this.float32[g+1]=d,i}}Ha.prototype.bytesPerElement=8,Rt("StructArrayLayout2f8",Ha);class sf extends Ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,d,g,x,w,M,C,P,O){const L=this.length;return this.resize(L+1),this.emplace(L,i,l,d,g,x,w,M,C,P,O)}emplace(i,l,d,g,x,w,M,C,P,O,L){const j=10*i;return this.uint16[j+0]=l,this.uint16[j+1]=d,this.uint16[j+2]=g,this.uint16[j+3]=x,this.uint16[j+4]=w,this.uint16[j+5]=M,this.uint16[j+6]=C,this.uint16[j+7]=P,this.uint16[j+8]=O,this.uint16[j+9]=L,i}}sf.prototype.bytesPerElement=20,Rt("StructArrayLayout10ui20",sf);class bn extends Ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,d,g,x,w,M,C,P,O,L,j){const Z=this.length;return this.resize(Z+1),this.emplace(Z,i,l,d,g,x,w,M,C,P,O,L,j)}emplace(i,l,d,g,x,w,M,C,P,O,L,j,Z){const H=12*i;return this.int16[H+0]=l,this.int16[H+1]=d,this.int16[H+2]=g,this.int16[H+3]=x,this.uint16[H+4]=w,this.uint16[H+5]=M,this.uint16[H+6]=C,this.uint16[H+7]=P,this.int16[H+8]=O,this.int16[H+9]=L,this.int16[H+10]=j,this.int16[H+11]=Z,i}}bn.prototype.bytesPerElement=24,Rt("StructArrayLayout4i4ui4i24",bn);class wo extends Ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,d)}emplace(i,l,d,g){const x=3*i;return this.float32[x+0]=l,this.float32[x+1]=d,this.float32[x+2]=g,i}}wo.prototype.bytesPerElement=12,Rt("StructArrayLayout3f12",wo);class Lu extends Ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint32[1*i+0]=l,i}}Lu.prototype.bytesPerElement=4,Rt("StructArrayLayout1ul4",Lu);class Fu extends Ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,d,g,x,w,M,C,P){const O=this.length;return this.resize(O+1),this.emplace(O,i,l,d,g,x,w,M,C,P)}emplace(i,l,d,g,x,w,M,C,P,O){const L=10*i,j=5*i;return this.int16[L+0]=l,this.int16[L+1]=d,this.int16[L+2]=g,this.int16[L+3]=x,this.int16[L+4]=w,this.int16[L+5]=M,this.uint32[j+3]=C,this.uint16[L+8]=P,this.uint16[L+9]=O,i}}Fu.prototype.bytesPerElement=20,Rt("StructArrayLayout6i1ul2ui20",Fu);class el extends Ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,d,g,x,w){const M=this.length;return this.resize(M+1),this.emplace(M,i,l,d,g,x,w)}emplace(i,l,d,g,x,w,M){const C=6*i;return this.int16[C+0]=l,this.int16[C+1]=d,this.int16[C+2]=g,this.int16[C+3]=x,this.int16[C+4]=w,this.int16[C+5]=M,i}}el.prototype.bytesPerElement=12,Rt("StructArrayLayout2i2i2i12",el);class of extends Ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,d,g,x){const w=this.length;return this.resize(w+1),this.emplace(w,i,l,d,g,x)}emplace(i,l,d,g,x,w){const M=4*i,C=8*i;return this.float32[M+0]=l,this.float32[M+1]=d,this.float32[M+2]=g,this.int16[C+6]=x,this.int16[C+7]=w,i}}of.prototype.bytesPerElement=16,Rt("StructArrayLayout2f1f2i16",of);class Nu extends Ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,d,g,x,w){const M=this.length;return this.resize(M+1),this.emplace(M,i,l,d,g,x,w)}emplace(i,l,d,g,x,w,M){const C=16*i,P=4*i,O=8*i;return this.uint8[C+0]=l,this.uint8[C+1]=d,this.float32[P+1]=g,this.float32[P+2]=x,this.int16[O+6]=w,this.int16[O+7]=M,i}}Nu.prototype.bytesPerElement=16,Rt("StructArrayLayout2ub2f2i16",Nu);class Yl extends Ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,d)}emplace(i,l,d,g){const x=3*i;return this.uint16[x+0]=l,this.uint16[x+1]=d,this.uint16[x+2]=g,i}}Yl.prototype.bytesPerElement=6,Rt("StructArrayLayout3ui6",Yl);class Uu extends Ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,d,g,x,w,M,C,P,O,L,j,Z,H,X,re,ue){const ve=this.length;return this.resize(ve+1),this.emplace(ve,i,l,d,g,x,w,M,C,P,O,L,j,Z,H,X,re,ue)}emplace(i,l,d,g,x,w,M,C,P,O,L,j,Z,H,X,re,ue,ve){const de=24*i,V=12*i,ie=48*i;return this.int16[de+0]=l,this.int16[de+1]=d,this.uint16[de+2]=g,this.uint16[de+3]=x,this.uint32[V+2]=w,this.uint32[V+3]=M,this.uint32[V+4]=C,this.uint16[de+10]=P,this.uint16[de+11]=O,this.uint16[de+12]=L,this.float32[V+7]=j,this.float32[V+8]=Z,this.uint8[ie+36]=H,this.uint8[ie+37]=X,this.uint8[ie+38]=re,this.uint32[V+10]=ue,this.int16[de+22]=ve,i}}Uu.prototype.bytesPerElement=48,Rt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Uu);class y extends Ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,d,g,x,w,M,C,P,O,L,j,Z,H,X,re,ue,ve,de,V,ie,pe,Be,ot,Ue,$e,ft,at){const pt=this.length;return this.resize(pt+1),this.emplace(pt,i,l,d,g,x,w,M,C,P,O,L,j,Z,H,X,re,ue,ve,de,V,ie,pe,Be,ot,Ue,$e,ft,at)}emplace(i,l,d,g,x,w,M,C,P,O,L,j,Z,H,X,re,ue,ve,de,V,ie,pe,Be,ot,Ue,$e,ft,at,pt){const Qe=32*i,kt=16*i;return this.int16[Qe+0]=l,this.int16[Qe+1]=d,this.int16[Qe+2]=g,this.int16[Qe+3]=x,this.int16[Qe+4]=w,this.int16[Qe+5]=M,this.int16[Qe+6]=C,this.int16[Qe+7]=P,this.uint16[Qe+8]=O,this.uint16[Qe+9]=L,this.uint16[Qe+10]=j,this.uint16[Qe+11]=Z,this.uint16[Qe+12]=H,this.uint16[Qe+13]=X,this.uint16[Qe+14]=re,this.uint16[Qe+15]=ue,this.uint16[Qe+16]=ve,this.uint16[Qe+17]=de,this.uint16[Qe+18]=V,this.uint16[Qe+19]=ie,this.uint16[Qe+20]=pe,this.uint16[Qe+21]=Be,this.uint16[Qe+22]=ot,this.uint32[kt+12]=Ue,this.float32[kt+13]=$e,this.float32[kt+14]=ft,this.uint16[Qe+30]=at,this.uint16[Qe+31]=pt,i}}y.prototype.bytesPerElement=64,Rt("StructArrayLayout8i15ui1ul2f2ui64",y);class t extends Ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.float32[1*i+0]=l,i}}t.prototype.bytesPerElement=4,Rt("StructArrayLayout1f4",t);class s extends Ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,d)}emplace(i,l,d,g){const x=3*i;return this.uint16[6*i+0]=l,this.float32[x+1]=d,this.float32[x+2]=g,i}}s.prototype.bytesPerElement=12,Rt("StructArrayLayout1ui2f12",s);class f extends Ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,d){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,d)}emplace(i,l,d,g){const x=4*i;return this.uint32[2*i+0]=l,this.uint16[x+2]=d,this.uint16[x+3]=g,i}}f.prototype.bytesPerElement=8,Rt("StructArrayLayout1ul2ui8",f);class m extends Ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l){const d=this.length;return this.resize(d+1),this.emplace(d,i,l)}emplace(i,l,d){const g=2*i;return this.uint16[g+0]=l,this.uint16[g+1]=d,i}}m.prototype.bytesPerElement=4,Rt("StructArrayLayout2ui4",m);class b extends Ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint16[1*i+0]=l,i}}b.prototype.bytesPerElement=2,Rt("StructArrayLayout1ui2",b);class E extends Ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,d,g){const x=this.length;return this.resize(x+1),this.emplace(x,i,l,d,g)}emplace(i,l,d,g,x){const w=4*i;return this.float32[w+0]=l,this.float32[w+1]=d,this.float32[w+2]=g,this.float32[w+3]=x,i}}E.prototype.bytesPerElement=16,Rt("StructArrayLayout4f16",E);class I extends $a{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new le(this.anchorPointX,this.anchorPointY)}}I.prototype.size=20;class D extends Fu{get(i){return new I(this,i)}}Rt("CollisionBoxArray",D);class z extends $a{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(i){this._structArray.uint8[this._pos1+37]=i}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(i){this._structArray.uint8[this._pos1+38]=i}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(i){this._structArray.uint32[this._pos4+10]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}z.prototype.size=48;class F extends Uu{get(i){return new z(this,i)}}Rt("PlacedSymbolArray",F);class U extends $a{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(i){this._structArray.uint32[this._pos4+12]=i}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}U.prototype.size=64;class N extends y{get(i){return new U(this,i)}}Rt("SymbolInstanceArray",N);class Y extends t{getoffsetX(i){return this.float32[1*i+0]}}Rt("GlyphOffsetArray",Y);class Q extends aa{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}Rt("SymbolLineVertexArray",Q);class se extends $a{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}se.prototype.size=12;class ae extends s{get(i){return new se(this,i)}}Rt("TextAnchorOffsetArray",ae);class ce extends $a{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ce.prototype.size=8;class he extends f{get(i){return new ce(this,i)}}Rt("FeatureIndexArray",he);class me extends Wo{}class ge extends Wo{}class ye extends Wo{}class Me extends Qo{}class Se extends Jo{}class Le extends Ha{}class Oe extends sf{}class Xe extends bn{}class We extends wo{}class He extends Lu{}class gt extends el{}class mt extends Nu{}class it extends Yl{}class Lt extends m{}const ai=ni([{name:"a_pos",components:2,type:"Int16"}],4),{members:Li}=ai;class vi{constructor(i=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=i}prepareSegment(i,l,d,g){const x=this.segments[this.segments.length-1];return i>vi.MAX_VERTEX_ARRAY_LENGTH&&qn(`Max vertices per segment is ${vi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${vi.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!x||x.vertexLength+i>vi.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==g?this.createNewSegment(l,d,g):x}createNewSegment(i,l,d){const g={vertexOffset:i.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0,vaos:{}};return d!==void 0&&(g.sortKey=d),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(g),g}getOrCreateLatestSegment(i,l,d){return this.prepareSegment(0,i,l,d)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const i of this.segments)for(const l in i.vaos)i.vaos[l].destroy()}static simpleSegment(i,l,d,g){return new vi([{vertexOffset:i,primitiveOffset:l,vertexLength:d,primitiveLength:g,vaos:{},sortKey:0}])}}function en(o,i){return 256*(o=vt(Math.floor(o),0,255))+vt(Math.floor(i),0,255)}vi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Rt("SegmentVector",vi);const ln=ni([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var pn,Ki,tn,Hn={exports:{}},gr={exports:{}},wr={exports:{}},Wr=function(){if(tn)return Hn.exports;tn=1;var o=(pn||(pn=1,gr.exports=function(l,d){var g,x,w,M,C,P,O,L;for(x=l.length-(g=3&l.length),w=d,C=3432918353,P=461845907,L=0;L<x;)O=255&l.charCodeAt(L)|(255&l.charCodeAt(++L))<<8|(255&l.charCodeAt(++L))<<16|(255&l.charCodeAt(++L))<<24,++L,w=27492+(65535&(M=5*(65535&(w=(w^=O=(65535&(O=(O=(65535&O)*C+(((O>>>16)*C&65535)<<16)&4294967295)<<15|O>>>17))*P+(((O>>>16)*P&65535)<<16)&4294967295)<<13|w>>>19))+((5*(w>>>16)&65535)<<16)&4294967295))+((58964+(M>>>16)&65535)<<16);switch(O=0,g){case 3:O^=(255&l.charCodeAt(L+2))<<16;case 2:O^=(255&l.charCodeAt(L+1))<<8;case 1:w^=O=(65535&(O=(O=(65535&(O^=255&l.charCodeAt(L)))*C+(((O>>>16)*C&65535)<<16)&4294967295)<<15|O>>>17))*P+(((O>>>16)*P&65535)<<16)&4294967295}return w^=l.length,w=2246822507*(65535&(w^=w>>>16))+((2246822507*(w>>>16)&65535)<<16)&4294967295,w=3266489909*(65535&(w^=w>>>13))+((3266489909*(w>>>16)&65535)<<16)&4294967295,(w^=w>>>16)>>>0}),gr.exports),i=(Ki||(Ki=1,wr.exports=function(l,d){for(var g,x=l.length,w=d^x,M=0;x>=4;)g=1540483477*(65535&(g=255&l.charCodeAt(M)|(255&l.charCodeAt(++M))<<8|(255&l.charCodeAt(++M))<<16|(255&l.charCodeAt(++M))<<24))+((1540483477*(g>>>16)&65535)<<16),w=1540483477*(65535&w)+((1540483477*(w>>>16)&65535)<<16)^(g=1540483477*(65535&(g^=g>>>24))+((1540483477*(g>>>16)&65535)<<16)),x-=4,++M;switch(x){case 3:w^=(255&l.charCodeAt(M+2))<<16;case 2:w^=(255&l.charCodeAt(M+1))<<8;case 1:w=1540483477*(65535&(w^=255&l.charCodeAt(M)))+((1540483477*(w>>>16)&65535)<<16)}return w=1540483477*(65535&(w^=w>>>13))+((1540483477*(w>>>16)&65535)<<16),(w^=w>>>15)>>>0}),wr.exports);return Hn.exports=o,Hn.exports.murmur3=o,Hn.exports.murmur2=i,Hn.exports}(),js=k(Wr);class fs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,l,d,g){this.ids.push(tl(i)),this.positions.push(l,d,g)}getPositions(i){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const l=tl(i);let d=0,g=this.ids.length-1;for(;d<g;){const w=d+g>>1;this.ids[w]>=l?g=w:d=w+1}const x=[];for(;this.ids[d]===l;)x.push({index:this.positions[3*d],start:this.positions[3*d+1],end:this.positions[3*d+2]}),d++;return x}static serialize(i,l){const d=new Float64Array(i.ids),g=new Uint32Array(i.positions);return Vs(d,g,0,d.length-1),l&&l.push(d.buffer,g.buffer),{ids:d,positions:g}}static deserialize(i){const l=new fs;return l.ids=i.ids,l.positions=i.positions,l.indexed=!0,l}}function tl(o){const i=+o;return!isNaN(i)&&i<=Number.MAX_SAFE_INTEGER?i:js(String(o))}function Vs(o,i,l,d){for(;l<d;){const g=o[l+d>>1];let x=l-1,w=d+1;for(;;){do x++;while(o[x]<g);do w--;while(o[w]>g);if(x>=w)break;il(o,x,w),il(i,3*x,3*w),il(i,3*x+1,3*w+1),il(i,3*x+2,3*w+2)}w-l<d-w?(Vs(o,i,l,w),l=w+1):(Vs(o,i,w+1,d),d=w)}}function il(o,i,l){const d=o[i];o[i]=o[l],o[l]=d}Rt("FeaturePositionMap",fs);class ps{constructor(i,l){this.gl=i.gl,this.location=l}}class ms extends ps{constructor(i,l){super(i,l),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class xa extends ps{constructor(i,l){super(i,l),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class Zs extends ps{constructor(i,l){super(i,l),this.current=Bi.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const Xl=new Float32Array(16);function Kl(o){return[en(255*o.r,255*o.g),en(255*o.b,255*o.a)]}class Vn{constructor(i,l,d){this.value=i,this.uniformNames=l.map(g=>`u_${g}`),this.type=d}setUniform(i,l,d){i.set(d.constantOr(this.value))}getBinding(i,l,d){return this.type==="color"?new Zs(i,l):new ms(i,l)}}class mn{constructor(i,l){this.uniformNames=l.map(d=>`u_${d}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=l.tlbr,this.patternTo=i.tlbr}setUniform(i,l,d,g){const x=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;x&&i.set(x)}getBinding(i,l,d){return d.substr(0,9)==="u_pattern"?new xa(i,l):new ms(i,l)}}class er{constructor(i,l,d,g){this.expression=i,this.type=d,this.maxValue=0,this.paintVertexAttributes=l.map(x=>({name:`a_${x}`,type:"Float32",components:d==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(i,l,d,g,x){const w=this.paintVertexArray.length,M=this.expression.evaluate(new fn(0),l,{},g,[],x);this.paintVertexArray.resize(i),this._setPaintValue(w,i,M)}updatePaintArray(i,l,d,g){const x=this.expression.evaluate({zoom:0},d,g);this._setPaintValue(i,l,x)}_setPaintValue(i,l,d){if(this.type==="color"){const g=Kl(d);for(let x=i;x<l;x++)this.paintVertexArray.emplace(x,g[0],g[1])}else{for(let g=i;g<l;g++)this.paintVertexArray.emplace(g,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Wi{constructor(i,l,d,g,x,w){this.expression=i,this.uniformNames=l.map(M=>`u_${M}_t`),this.type=d,this.useIntegerZoom=g,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=l.map(M=>({name:`a_${M}`,type:"Float32",components:d==="color"?4:2,offset:0})),this.paintVertexArray=new w}populatePaintArray(i,l,d,g,x){const w=this.expression.evaluate(new fn(this.zoom),l,{},g,[],x),M=this.expression.evaluate(new fn(this.zoom+1),l,{},g,[],x),C=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(C,i,w,M)}updatePaintArray(i,l,d,g){const x=this.expression.evaluate({zoom:this.zoom},d,g),w=this.expression.evaluate({zoom:this.zoom+1},d,g);this._setPaintValue(i,l,x,w)}_setPaintValue(i,l,d,g){if(this.type==="color"){const x=Kl(d),w=Kl(g);for(let M=i;M<l;M++)this.paintVertexArray.emplace(M,x[0],x[1],w[0],w[1])}else{for(let x=i;x<l;x++)this.paintVertexArray.emplace(x,d,g);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(g))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,l){const d=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,g=vt(this.expression.interpolationFactor(d,this.zoom,this.zoom+1),0,1);i.set(g)}getBinding(i,l,d){return new ms(i,l)}}class So{constructor(i,l,d,g,x,w){this.expression=i,this.type=l,this.useIntegerZoom=d,this.zoom=g,this.layerId=w,this.zoomInPaintVertexArray=new x,this.zoomOutPaintVertexArray=new x}populatePaintArray(i,l,d){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(g,i,l.patterns&&l.patterns[this.layerId],d)}updatePaintArray(i,l,d,g,x){this._setPaintValues(i,l,d.patterns&&d.patterns[this.layerId],x)}_setPaintValues(i,l,d,g){if(!g||!d)return;const{min:x,mid:w,max:M}=d,C=g[x],P=g[w],O=g[M];if(C&&P&&O)for(let L=i;L<l;L++)this.zoomInPaintVertexArray.emplace(L,P.tl[0],P.tl[1],P.br[0],P.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],P.pixelRatio,C.pixelRatio),this.zoomOutPaintVertexArray.emplace(L,P.tl[0],P.tl[1],P.br[0],P.br[1],O.tl[0],O.tl[1],O.br[0],O.br[1],P.pixelRatio,O.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,ln.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,ln.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class lf{constructor(i,l,d){this.binders={},this._buffers=[];const g=[];for(const x in i.paint._values){if(!d(x))continue;const w=i.paint.get(x);if(!(w instanceof qa&&Ol(w.property.specification)))continue;const M=sp(x,i.type),C=w.value,P=w.property.specification.type,O=w.property.useIntegerZoom,L=w.property.specification["property-type"],j=L==="cross-faded"||L==="cross-faded-data-driven";if(C.kind==="constant")this.binders[x]=j?new mn(C.value,M):new Vn(C.value,M,P),g.push(`/u_${x}`);else if(C.kind==="source"||j){const Z=cf(x,P,"source");this.binders[x]=j?new So(C,P,O,l,Z,i.id):new er(C,M,P,Z),g.push(`/a_${x}`)}else{const Z=cf(x,P,"composite");this.binders[x]=new Wi(C,M,P,O,l,Z),g.push(`/z_${x}`)}}this.cacheKey=g.sort().join("")}getMaxValue(i){const l=this.binders[i];return l instanceof er||l instanceof Wi?l.maxValue:0}populatePaintArrays(i,l,d,g,x){for(const w in this.binders){const M=this.binders[w];(M instanceof er||M instanceof Wi||M instanceof So)&&M.populatePaintArray(i,l,d,g,x)}}setConstantPatternPositions(i,l){for(const d in this.binders){const g=this.binders[d];g instanceof mn&&g.setConstantPatternPositions(i,l)}}updatePaintArrays(i,l,d,g,x){let w=!1;for(const M in i){const C=l.getPositions(M);for(const P of C){const O=d.feature(P.index);for(const L in this.binders){const j=this.binders[L];if((j instanceof er||j instanceof Wi||j instanceof So)&&j.expression.isStateDependent===!0){const Z=g.paint.get(L);j.expression=Z.value,j.updatePaintArray(P.start,P.end,O,i[M],x),w=!0}}}}return w}defines(){const i=[];for(const l in this.binders){const d=this.binders[l];(d instanceof Vn||d instanceof mn)&&i.push(...d.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return i}getBinderAttributes(){const i=[];for(const l in this.binders){const d=this.binders[l];if(d instanceof er||d instanceof Wi)for(let g=0;g<d.paintVertexAttributes.length;g++)i.push(d.paintVertexAttributes[g].name);else if(d instanceof So)for(let g=0;g<ln.members.length;g++)i.push(ln.members[g].name)}return i}getBinderUniforms(){const i=[];for(const l in this.binders){const d=this.binders[l];if(d instanceof Vn||d instanceof mn||d instanceof Wi)for(const g of d.uniformNames)i.push(g)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,l){const d=[];for(const g in this.binders){const x=this.binders[g];if(x instanceof Vn||x instanceof mn||x instanceof Wi){for(const w of x.uniformNames)if(l[w]){const M=x.getBinding(i,l[w],w);d.push({name:w,property:g,binding:M})}}}return d}setUniforms(i,l,d,g){for(const{name:x,property:w,binding:M}of l)this.binders[w].setUniform(M,g,d.get(w),x)}updatePaintBuffers(i){this._buffers=[];for(const l in this.binders){const d=this.binders[l];if(i&&d instanceof So){const g=i.fromScale===2?d.zoomInPaintVertexBuffer:d.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(d instanceof er||d instanceof Wi)&&d.paintVertexBuffer&&this._buffers.push(d.paintVertexBuffer)}}upload(i){for(const l in this.binders){const d=this.binders[l];(d instanceof er||d instanceof Wi||d instanceof So)&&d.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const l=this.binders[i];(l instanceof er||l instanceof Wi||l instanceof So)&&l.destroy()}}}class Gs{constructor(i,l,d=()=>!0){this.programConfigurations={};for(const g of i)this.programConfigurations[g.id]=new lf(g,l,d);this.needsUpload=!1,this._featureMap=new fs,this._bufferOffset=0}populatePaintArrays(i,l,d,g,x,w){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(i,l,g,x,w);l.id!==void 0&&this._featureMap.add(l.id,d,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,l,d,g){for(const x of d)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(i,this._featureMap,l,x,g)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}function sp(o,i){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[o]||[o.replace(`${i}-`,"").replace(/-/g,"_")]}function cf(o,i,l){const d={color:{source:Ha,composite:E},number:{source:t,composite:Ha}},g=function(x){return{"line-pattern":{source:Oe,composite:Oe},"fill-pattern":{source:Oe,composite:Oe},"fill-extrusion-pattern":{source:Oe,composite:Oe}}[x]}(o);return g&&g[l]||d[i][l]}Rt("ConstantBinder",Vn),Rt("CrossFadedConstantBinder",mn),Rt("SourceExpressionBinder",er),Rt("CrossFadedCompositeBinder",So),Rt("CompositeExpressionBinder",Wi),Rt("ProgramConfiguration",lf,{omit:["_buffers"]}),Rt("ProgramConfigurationSet",Gs);const uf=Math.pow(2,14)-1,ka=-uf-1;function Ya(o){const i=Ae/o.extent,l=o.loadGeometry();for(let d=0;d<l.length;d++){const g=l[d];for(let x=0;x<g.length;x++){const w=g[x],M=Math.round(w.x*i),C=Math.round(w.y*i);w.x=vt(M,ka,uf),w.y=vt(C,ka,uf),(M<w.x||M>w.x+1||C<w.y||C>w.y+1)&&qn("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return l}function gs(o,i){return{type:o.type,id:o.id,properties:o.properties,geometry:i?Ya(o):[]}}const Wl=-32768;function Lc(o,i,l,d,g){o.emplaceBack(Wl+8*i+d,Wl+8*l+g)}class ju{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new ge,this.indexArray=new it,this.segments=new vi,this.programConfigurations=new Gs(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,d){const g=this.layers[0],x=[];let w=null,M=!1,C=g.type==="heatmap";if(g.type==="circle"){const O=g;w=O.layout.get("circle-sort-key"),M=!w.isConstant(),C=C||O.paint.get("circle-pitch-alignment")==="map"}const P=C?l.subdivisionGranularity.circle:1;for(const{feature:O,id:L,index:j,sourceLayerIndex:Z}of i){const H=this.layers[0]._featureFilter.needGeometry,X=gs(O,H);if(!this.layers[0]._featureFilter.filter(new fn(this.zoom),X,d))continue;const re=M?w.evaluate(X,{},d):void 0,ue={id:L,properties:O.properties,type:O.type,sourceLayerIndex:Z,index:j,geometry:H?X.geometry:Ya(O),patterns:{},sortKey:re};x.push(ue)}M&&x.sort((O,L)=>O.sortKey-L.sortKey);for(const O of x){const{geometry:L,index:j,sourceLayerIndex:Z}=O,H=i[j].feature;this.addFeature(O,L,j,d,P),l.featureIndex.insert(H,L,j,Z,this.index)}}update(i,l,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Li),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,l,d,g,x=1){let w;switch(x){case 1:w=[0,7];break;case 3:w=[0,2,5,7];break;case 5:w=[0,1,3,4,6,7];break;case 7:w=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${x}; valid values are 1, 3, 5, 7.`)}const M=w.length;for(const C of l)for(const P of C){const O=P.x,L=P.y;if(O<0||O>=Ae||L<0||L>=Ae)continue;const j=this.segments.prepareSegment(M*M,this.layoutVertexArray,this.indexArray,i.sortKey),Z=j.vertexLength;for(let H=0;H<M;H++)for(let X=0;X<M;X++)Lc(this.layoutVertexArray,O,L,w[X],w[H]);for(let H=0;H<M-1;H++)for(let X=0;X<M-1;X++){const re=Z+H*M+X,ue=Z+(H+1)*M+X;this.indexArray.emplaceBack(re,ue+1,re+1),this.indexArray.emplaceBack(re,ue,ue+1)}j.vertexLength+=M*M,j.primitiveLength+=(M-1)*(M-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,{},g)}}function Vu(o,i){for(let l=0;l<o.length;l++)if(Yn(i,o[l]))return!0;for(let l=0;l<i.length;l++)if(Yn(o,i[l]))return!0;return!!$s(o,i)}function nd(o,i,l){return!!Yn(o,i)||!!op(i,o,l)}function Dm(o,i){if(o.length===1)return nl(i,o[0]);for(let l=0;l<i.length;l++){const d=i[l];for(let g=0;g<d.length;g++)if(Yn(o,d[g]))return!0}for(let l=0;l<o.length;l++)if(nl(i,o[l]))return!0;for(let l=0;l<i.length;l++)if($s(o,i[l]))return!0;return!1}function qs(o,i,l){if(o.length>1){if($s(o,i))return!0;for(let d=0;d<i.length;d++)if(op(i[d],o,l))return!0}for(let d=0;d<o.length;d++)if(op(o[d],i,l))return!0;return!1}function $s(o,i){if(o.length===0||i.length===0)return!1;for(let l=0;l<o.length-1;l++){const d=o[l],g=o[l+1];for(let x=0;x<i.length-1;x++)if(Fc(d,g,i[x],i[x+1]))return!0}return!1}function Fc(o,i,l,d){return sr(o,l,d)!==sr(i,l,d)&&sr(o,i,l)!==sr(o,i,d)}function op(o,i,l){const d=l*l;if(i.length===1)return o.distSqr(i[0])<d;for(let g=1;g<i.length;g++)if(Ql(o,i[g-1],i[g])<d)return!0;return!1}function Ql(o,i,l){const d=i.distSqr(l);if(d===0)return o.distSqr(i);const g=((o.x-i.x)*(l.x-i.x)+(o.y-i.y)*(l.y-i.y))/d;return o.distSqr(g<0?i:g>1?l:l.sub(i)._mult(g)._add(i))}function nl(o,i){for(let l=0;l<o.length;l++)if(Yn(o[l],i))return!0;return!1}function Yn(o,i){let l=!1;for(let d=0,g=o.length-1;d<o.length;g=d++){const x=o[d],w=o[g];x.y>i.y!=w.y>i.y&&i.x<(w.x-x.x)*(i.y-x.y)/(w.y-x.y)+x.x&&(l=!l)}return l}function lp(o,i,l){const d=l[0],g=l[2];if(o.x<d.x&&i.x<d.x||o.x>g.x&&i.x>g.x||o.y<d.y&&i.y<d.y||o.y>g.y&&i.y>g.y)return!1;const x=sr(o,i,l[0]);return x!==sr(o,i,l[1])||x!==sr(o,i,l[2])||x!==sr(o,i,l[3])}function Zu(o,i,l){const d=i.paint.get(o).value;return d.kind==="constant"?d.value:l.programConfigurations.get(i.id).getMaxValue(o)}function rd(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function hf(o,i,l,d,g){if(!i[0]&&!i[1])return o;const x=le.convert(i)._mult(g);l==="viewport"&&x._rotate(-d);const w=[];for(let M=0;M<o.length;M++)w.push(o[M].sub(x));return w}let Rm,Nc;Rt("CircleBucket",ju,{omit:["layers"]});var cp={get paint(){return Nc=Nc||new Fr({"circle-radius":new qt($.paint_circle["circle-radius"]),"circle-color":new qt($.paint_circle["circle-color"]),"circle-blur":new qt($.paint_circle["circle-blur"]),"circle-opacity":new qt($.paint_circle["circle-opacity"]),"circle-translate":new Nt($.paint_circle["circle-translate"]),"circle-translate-anchor":new Nt($.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Nt($.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Nt($.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new qt($.paint_circle["circle-stroke-width"]),"circle-stroke-color":new qt($.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new qt($.paint_circle["circle-stroke-opacity"])})},get layout(){return Rm=Rm||new Fr({"circle-sort-key":new qt($.layout_circle["circle-sort-key"])})}};class c_ extends Nr{constructor(i){super(i,cp)}createBucket(i){return new ju(i)}queryRadius(i){const l=i;return Zu("circle-radius",this,l)+Zu("circle-stroke-width",this,l)+rd(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:i,feature:l,featureState:d,geometry:g,transform:x,pixelsToTileUnits:w,unwrappedTileID:M,getElevation:C}){const P=hf(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-x.bearingInRadians,w),O=this.paint.get("circle-radius").evaluate(l,d)+this.paint.get("circle-stroke-width").evaluate(l,d),L=this.paint.get("circle-pitch-alignment")==="map",j=L?P:function(H,X,re,ue){return H.map(ve=>Pm(ve,X,re,ue))}(P,x,M,C),Z=L?O*w:O;for(const H of g)for(const X of H){const re=L?X:Pm(X,x,M,C);let ue=Z;const ve=x.projectTileCoordinates(X.x,X.y,M,C).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ue*=ve/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ue*=x.cameraToCenterDistance/ve),nd(j,re,ue))return!0}return!1}}function Pm(o,i,l,d){const g=i.projectTileCoordinates(o.x,o.y,l,d).point;return new le((.5*g.x+.5)*i.width,(.5*-g.y+.5)*i.height)}class zm extends ju{}let df;Rt("HeatmapBucket",zm,{omit:["layers"]});var u_={get paint(){return df=df||new Fr({"heatmap-radius":new qt($.paint_heatmap["heatmap-radius"]),"heatmap-weight":new qt($.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Nt($.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ko($.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Nt($.paint_heatmap["heatmap-opacity"])})}};function ff(o,{width:i,height:l},d,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==i*l*d)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${i*l*d}`)}else g=new Uint8Array(i*l*d);return o.width=i,o.height=l,o.data=g,o}function km(o,{width:i,height:l},d){if(i===o.width&&l===o.height)return;const g=ff({},{width:i,height:l},d);up(o,g,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,i),height:Math.min(o.height,l)},d),o.width=i,o.height=l,o.data=g.data}function up(o,i,l,d,g,x){if(g.width===0||g.height===0)return i;if(g.width>o.width||g.height>o.height||l.x>o.width-g.width||l.y>o.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>i.width||g.height>i.height||d.x>i.width-g.width||d.y>i.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const w=o.data,M=i.data;if(w===M)throw new Error("srcData equals dstData, so image is already copied");for(let C=0;C<g.height;C++){const P=((l.y+C)*o.width+l.x)*x,O=((d.y+C)*i.width+d.x)*x;for(let L=0;L<g.width*x;L++)M[O+L]=w[P+L]}return i}class pf{constructor(i,l){ff(this,i,1,l)}resize(i){km(this,i,1)}clone(){return new pf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,d,g,x){up(i,l,d,g,x,1)}}class Xa{constructor(i,l){ff(this,i,4,l)}resize(i){km(this,i,4)}replace(i,l){l?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new Xa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,d,g,x){up(i,l,d,g,x,4)}}function Ur(o){const i={},l=o.resolution||256,d=o.clips?o.clips.length:1,g=o.image||new Xa({width:l,height:d});if(Math.log(l)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${l}`);const x=(w,M,C)=>{i[o.evaluationKey]=C;const P=o.expression.evaluate(i);g.data[w+M+0]=Math.floor(255*P.r/P.a),g.data[w+M+1]=Math.floor(255*P.g/P.a),g.data[w+M+2]=Math.floor(255*P.b/P.a),g.data[w+M+3]=Math.floor(255*P.a)};if(o.clips)for(let w=0,M=0;w<d;++w,M+=4*l)for(let C=0,P=0;C<l;C++,P+=4){const O=C/(l-1),{start:L,end:j}=o.clips[w];x(M,P,L*(1-O)+j*O)}else for(let w=0,M=0;w<l;w++,M+=4)x(0,M,w/(l-1));return g}Rt("AlphaImage",pf),Rt("RGBAImage",Xa);const jr="big-fb";class h_ extends Nr{createBucket(i){return new zm(i)}constructor(i){super(i,u_),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ur({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(jr)&&this.heatmapFbos.delete(jr)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Om;var d_={get paint(){return Om=Om||new Fr({"hillshade-illumination-direction":new Nt($.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Nt($.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Nt($.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Nt($.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Nt($.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Nt($.paint_hillshade["hillshade-accent-color"])})}};class f_ extends Nr{constructor(i){super(i,d_)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const p_=ni([{name:"a_pos",components:2,type:"Int16"}],4),{members:hp}=p_;function mf(o,i,l){const d=l.patternDependencies;let g=!1;for(const x of i){const w=x.paint.get(`${o}-pattern`);w.isConstant()||(g=!0);const M=w.constantOr(null);M&&(g=!0,d[M.to]=!0,d[M.from]=!0)}return g}function dp(o,i,l,d,g){const x=g.patternDependencies;for(const w of i){const M=w.paint.get(`${o}-pattern`).value;if(M.kind!=="constant"){let C=M.evaluate({zoom:d-1},l,{},g.availableImages),P=M.evaluate({zoom:d},l,{},g.availableImages),O=M.evaluate({zoom:d+1},l,{},g.availableImages);C=C&&C.name?C.name:C,P=P&&P.name?P.name:P,O=O&&O.name?O.name:O,x[C]=!0,x[P]=!0,x[O]=!0,l.patterns[w.id]={min:C,mid:P,max:O}}}return l}function Bm(o,i,l,d,g){let x;if(g===function(w,M,C,P){let O=0;for(let L=M,j=C-P;L<C;L+=P)O+=(w[j]-w[L])*(w[L+1]+w[j+1]),j=L;return O}(o,i,l,d)>0)for(let w=i;w<l;w+=d)x=v_(w/d|0,o[w],o[w+1],x);else for(let w=l-d;w>=i;w-=d)x=v_(w/d|0,o[w],o[w+1],x);return x&&Ka(x,x.next)&&(ad(x),x=x.next),x}function Uc(o,i){if(!o)return o;i||(i=o);let l,d=o;do if(l=!1,d.steiner||!Ka(d,d.next)&&tr(d.prev,d,d.next)!==0)d=d.next;else{if(ad(d),d=i=d.prev,d===d.next)break;l=!0}while(l||d!==i);return i}function Gu(o,i,l,d,g,x,w){if(!o)return;!w&&x&&function(C,P,O,L){let j=C;do j.z===0&&(j.z=gf(j.x,j.y,P,O,L)),j.prevZ=j.prev,j.nextZ=j.next,j=j.next;while(j!==C);j.prevZ.nextZ=null,j.prevZ=null,function(Z){let H,X=1;do{let re,ue=Z;Z=null;let ve=null;for(H=0;ue;){H++;let de=ue,V=0;for(let pe=0;pe<X&&(V++,de=de.nextZ,de);pe++);let ie=X;for(;V>0||ie>0&&de;)V!==0&&(ie===0||!de||ue.z<=de.z)?(re=ue,ue=ue.nextZ,V--):(re=de,de=de.nextZ,ie--),ve?ve.nextZ=re:Z=re,re.prevZ=ve,ve=re;ue=de}ve.nextZ=null,X*=2}while(H>1)}(j)}(o,d,g,x);let M=o;for(;o.prev!==o.next;){const C=o.prev,P=o.next;if(x?Fm(o,d,g,x):Lm(o))i.push(C.i,o.i,P.i),ad(o),o=P.next,M=P.next;else if((o=P)===M){w?w===1?Gu(o=m_(Uc(o),i),i,l,d,g,x,2):w===2&&Nm(o,i,l,d,g,x):Gu(Uc(o),i,l,d,g,x,1);break}}}function Lm(o){const i=o.prev,l=o,d=o.next;if(tr(i,l,d)>=0)return!1;const g=i.x,x=l.x,w=d.x,M=i.y,C=l.y,P=d.y,O=Math.min(g,x,w),L=Math.min(M,C,P),j=Math.max(g,x,w),Z=Math.max(M,C,P);let H=d.next;for(;H!==i;){if(H.x>=O&&H.x<=j&&H.y>=L&&H.y<=Z&&qu(g,M,x,C,w,P,H.x,H.y)&&tr(H.prev,H,H.next)>=0)return!1;H=H.next}return!0}function Fm(o,i,l,d){const g=o.prev,x=o,w=o.next;if(tr(g,x,w)>=0)return!1;const M=g.x,C=x.x,P=w.x,O=g.y,L=x.y,j=w.y,Z=Math.min(M,C,P),H=Math.min(O,L,j),X=Math.max(M,C,P),re=Math.max(O,L,j),ue=gf(Z,H,i,l,d),ve=gf(X,re,i,l,d);let de=o.prevZ,V=o.nextZ;for(;de&&de.z>=ue&&V&&V.z<=ve;){if(de.x>=Z&&de.x<=X&&de.y>=H&&de.y<=re&&de!==g&&de!==w&&qu(M,O,C,L,P,j,de.x,de.y)&&tr(de.prev,de,de.next)>=0||(de=de.prevZ,V.x>=Z&&V.x<=X&&V.y>=H&&V.y<=re&&V!==g&&V!==w&&qu(M,O,C,L,P,j,V.x,V.y)&&tr(V.prev,V,V.next)>=0))return!1;V=V.nextZ}for(;de&&de.z>=ue;){if(de.x>=Z&&de.x<=X&&de.y>=H&&de.y<=re&&de!==g&&de!==w&&qu(M,O,C,L,P,j,de.x,de.y)&&tr(de.prev,de,de.next)>=0)return!1;de=de.prevZ}for(;V&&V.z<=ve;){if(V.x>=Z&&V.x<=X&&V.y>=H&&V.y<=re&&V!==g&&V!==w&&qu(M,O,C,L,P,j,V.x,V.y)&&tr(V.prev,V,V.next)>=0)return!1;V=V.nextZ}return!0}function m_(o,i){let l=o;do{const d=l.prev,g=l.next.next;!Ka(d,g)&&jm(d,l,l.next,g)&&Dn(d,g)&&Dn(g,d)&&(i.push(d.i,l.i,g.i),ad(l),ad(l.next),l=o=g),l=l.next}while(l!==o);return Uc(l)}function Nm(o,i,l,d,g,x){let w=o;do{let M=w.next.next;for(;M!==w.prev;){if(w.i!==M.i&&fv(w,M)){let C=y_(w,M);return w=Uc(w,w.next),C=Uc(C,C.next),Gu(w,i,l,d,g,x,0),void Gu(C,i,l,d,g,x,0)}M=M.next}w=w.next}while(w!==o)}function fp(o,i){let l=o.x-i.x;return l===0&&(l=o.y-i.y,l===0)&&(l=(o.next.y-o.y)/(o.next.x-o.x)-(i.next.y-i.y)/(i.next.x-i.x)),l}function Um(o,i){const l=function(g,x){let w=x;const M=g.x,C=g.y;let P,O=-1/0;if(Ka(g,w))return w;do{if(Ka(g,w.next))return w.next;if(C<=w.y&&C>=w.next.y&&w.next.y!==w.y){const X=w.x+(C-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(X<=M&&X>O&&(O=X,P=w.x<w.next.x?w:w.next,X===M))return P}w=w.next}while(w!==x);if(!P)return null;const L=P,j=P.x,Z=P.y;let H=1/0;w=P;do{if(M>=w.x&&w.x>=j&&M!==w.x&&rl(C<Z?M:O,C,j,Z,C<Z?O:M,C,w.x,w.y)){const X=Math.abs(C-w.y)/(M-w.x);Dn(w,g)&&(X<H||X===H&&(w.x>P.x||w.x===P.x&&g_(P,w)))&&(P=w,H=X)}w=w.next}while(w!==L);return P}(o,i);if(!l)return i;const d=y_(l,o);return Uc(d,d.next),Uc(l,l.next)}function g_(o,i){return tr(o.prev,o,i.prev)<0&&tr(i.next,o,o.next)<0}function gf(o,i,l,d,g){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-l)*g|0)|o<<8))|o<<4))|o<<2))|o<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-d)*g|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function __(o){let i=o,l=o;do(i.x<l.x||i.x===l.x&&i.y<l.y)&&(l=i),i=i.next;while(i!==o);return l}function rl(o,i,l,d,g,x,w,M){return(g-w)*(i-M)>=(o-w)*(x-M)&&(o-w)*(d-M)>=(l-w)*(i-M)&&(l-w)*(x-M)>=(g-w)*(d-M)}function qu(o,i,l,d,g,x,w,M){return!(o===w&&i===M)&&rl(o,i,l,d,g,x,w,M)}function fv(o,i){return o.next.i!==i.i&&o.prev.i!==i.i&&!function(l,d){let g=l;do{if(g.i!==l.i&&g.next.i!==l.i&&g.i!==d.i&&g.next.i!==d.i&&jm(g,g.next,l,d))return!0;g=g.next}while(g!==l);return!1}(o,i)&&(Dn(o,i)&&Dn(i,o)&&function(l,d){let g=l,x=!1;const w=(l.x+d.x)/2,M=(l.y+d.y)/2;do g.y>M!=g.next.y>M&&g.next.y!==g.y&&w<(g.next.x-g.x)*(M-g.y)/(g.next.y-g.y)+g.x&&(x=!x),g=g.next;while(g!==l);return x}(o,i)&&(tr(o.prev,o,i.prev)||tr(o,i.prev,i))||Ka(o,i)&&tr(o.prev,o,o.next)>0&&tr(i.prev,i,i.next)>0)}function tr(o,i,l){return(i.y-o.y)*(l.x-i.x)-(i.x-o.x)*(l.y-i.y)}function Ka(o,i){return o.x===i.x&&o.y===i.y}function jm(o,i,l,d){const g=jc(tr(o,i,l)),x=jc(tr(o,i,d)),w=jc(tr(l,d,o)),M=jc(tr(l,d,i));return g!==x&&w!==M||!(g!==0||!$u(o,l,i))||!(x!==0||!$u(o,d,i))||!(w!==0||!$u(l,o,d))||!(M!==0||!$u(l,i,d))}function $u(o,i,l){return i.x<=Math.max(o.x,l.x)&&i.x>=Math.min(o.x,l.x)&&i.y<=Math.max(o.y,l.y)&&i.y>=Math.min(o.y,l.y)}function jc(o){return o>0?1:o<0?-1:0}function Dn(o,i){return tr(o.prev,o,o.next)<0?tr(o,i,o.next)>=0&&tr(o,o.prev,i)>=0:tr(o,i,o.prev)<0||tr(o,o.next,i)<0}function y_(o,i){const l=Hu(o.i,o.x,o.y),d=Hu(i.i,i.x,i.y),g=o.next,x=i.prev;return o.next=i,i.prev=o,l.next=g,g.prev=l,d.next=l,l.prev=d,x.next=d,d.prev=x,d}function v_(o,i,l,d){const g=Hu(o,i,l);return d?(g.next=d.next,g.prev=d,d.next.prev=g,d.next=g):(g.prev=g,g.next=g),g}function ad(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Hu(o,i,l){return{i:o,x:i,y:l,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class _s{constructor(i,l){if(l>i)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=i,this._minGranularity=l}getGranularityForZoomLevel(i){return Math.max(Math.floor(this._baseZoomGranularity/(1<<i)),this._minGranularity,1)}}class _f{constructor(i){this.fill=i.fill,this.line=i.line,this.tile=i.tile,this.stencil=i.stencil,this.circle=i.circle}}_f.noSubdivision=new _f({fill:new _s(0,0),line:new _s(0,0),tile:new _s(0,0),stencil:new _s(0,0),circle:1}),Rt("SubdivisionGranularityExpression",_s),Rt("SubdivisionGranularitySetting",_f);const Yu=-32768,Jl=32767;class al{constructor(i,l){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=i,this._granularityCellSize=Ae/i,this._canonical=l}_getKey(i,l){return(i+=32768)<<16|(l+=32768)<<0}_vertexToIndex(i,l){if(i<-32768||l<-32768||i>32767||l>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const d=0|Math.round(i),g=0|Math.round(l),x=this._getKey(d,g);if(this._vertexDictionary.has(x))return this._vertexDictionary.get(x);const w=this._vertexBuffer.length/2;return this._vertexDictionary.set(x,w),this._vertexBuffer.push(d,g),w}_subdivideTrianglesScanline(i){if(this._granularity<2)return function(g,x){const w=[];for(let M=0;M<x.length;M+=3){const C=x[M],P=x[M+1],O=x[M+2],L=g[2*C],j=g[2*C+1];(g[2*P]-L)*(g[2*O+1]-j)-(g[2*P+1]-j)*(g[2*O]-L)>0?(w.push(C),w.push(O),w.push(P)):(w.push(C),w.push(P),w.push(O))}return w}(this._vertexBuffer,i);const l=[],d=i.length;for(let g=0;g<d;g+=3){const x=[i[g+0],i[g+1],i[g+2]],w=[this._vertexBuffer[2*i[g+0]+0],this._vertexBuffer[2*i[g+0]+1],this._vertexBuffer[2*i[g+1]+0],this._vertexBuffer[2*i[g+1]+1],this._vertexBuffer[2*i[g+2]+0],this._vertexBuffer[2*i[g+2]+1]];let M=1/0,C=1/0,P=-1/0,O=-1/0;for(let X=0;X<3;X++){const re=w[2*X],ue=w[2*X+1];M=Math.min(M,re),P=Math.max(P,re),C=Math.min(C,ue),O=Math.max(O,ue)}if(M===P||C===O)continue;const L=Math.floor(M/this._granularityCellSize),j=Math.ceil(P/this._granularityCellSize),Z=Math.floor(C/this._granularityCellSize),H=Math.ceil(O/this._granularityCellSize);if(L!==j||Z!==H)for(let X=Z;X<H;X++){const re=this._scanlineGenerateVertexRingForCellRow(X,w,x);b_(this._vertexBuffer,re,l)}else l.push(...x)}return l}_scanlineGenerateVertexRingForCellRow(i,l,d){const g=i*this._granularityCellSize,x=g+this._granularityCellSize,w=[];for(let M=0;M<3;M++){const C=l[2*M],P=l[2*M+1],O=l[2*(M+1)%6],L=l[(2*(M+1)+1)%6],j=l[2*(M+2)%6],Z=l[(2*(M+2)+1)%6],H=O-C,X=L-P,re=H===0,ue=X===0,ve=(g-P)/X,de=(x-P)/X,V=Math.min(ve,de),ie=Math.max(ve,de);if(!ue&&(V>=1||ie<=0)||ue&&(P<g||P>x)){L>=g&&L<=x&&w.push(d[(M+1)%3]);continue}!ue&&V>0&&w.push(this._vertexToIndex(C+H*V,P+X*V));const pe=C+H*Math.max(V,0),Be=C+H*Math.min(ie,1);re||this._generateIntraEdgeVertices(w,C,P,O,L,pe,Be),!ue&&ie<1&&w.push(this._vertexToIndex(C+H*ie,P+X*ie)),(ue||L>=g&&L<=x)&&w.push(d[(M+1)%3]),!ue&&(L<=g||L>=x)&&this._generateInterEdgeVertices(w,C,P,O,L,j,Z,Be,g,x)}return w}_generateIntraEdgeVertices(i,l,d,g,x,w,M){const C=g-l,P=x-d,O=P===0,L=O?Math.min(l,g):Math.min(w,M),j=O?Math.max(l,g):Math.max(w,M),Z=Math.floor(L/this._granularityCellSize)+1,H=Math.ceil(j/this._granularityCellSize)-1;if(O?l<g:w<M)for(let X=Z;X<=H;X++){const re=X*this._granularityCellSize;i.push(this._vertexToIndex(re,d+P*(re-l)/C))}else for(let X=H;X>=Z;X--){const re=X*this._granularityCellSize;i.push(this._vertexToIndex(re,d+P*(re-l)/C))}}_generateInterEdgeVertices(i,l,d,g,x,w,M,C,P,O){const L=x-d,j=w-g,Z=M-x,H=(P-x)/Z,X=(O-x)/Z,re=Math.min(H,X),ue=Math.max(H,X),ve=g+j*re;let de=Math.floor(Math.min(ve,C)/this._granularityCellSize)+1,V=Math.ceil(Math.max(ve,C)/this._granularityCellSize)-1,ie=C<ve;const pe=Z===0;if(pe&&(M===P||M===O))return;if(pe||re>=1||ue<=0){const ot=d-M,Ue=w+(l-w)*Math.min((P-M)/ot,(O-M)/ot);de=Math.floor(Math.min(Ue,C)/this._granularityCellSize)+1,V=Math.ceil(Math.max(Ue,C)/this._granularityCellSize)-1,ie=C<Ue}const Be=L>0?O:P;if(ie)for(let ot=de;ot<=V;ot++)i.push(this._vertexToIndex(ot*this._granularityCellSize,Be));else for(let ot=V;ot>=de;ot--)i.push(this._vertexToIndex(ot*this._granularityCellSize,Be))}_generateOutline(i){const l=[];for(const d of i){const g=ec(d,this._granularity,!0),x=this._pointArrayToIndices(g),w=[];for(let M=1;M<x.length;M++)w.push(x[M-1]),w.push(x[M]);l.push(w)}return l}_handlePoles(i){let l=!1,d=!1;this._canonical&&(this._canonical.y===0&&(l=!0),this._canonical.y===(1<<this._canonical.z)-1&&(d=!0)),(l||d)&&this._fillPoles(i,l,d)}_ensureNoPoleVertices(){const i=this._vertexBuffer;for(let l=0;l<i.length;l+=2){const d=i[l+1];d===Yu&&(i[l+1]=-32767),d===Jl&&(i[l+1]=32766)}}_generatePoleQuad(i,l,d,g,x,w){g>x!=(w===Yu)?(i.push(l),i.push(d),i.push(this._vertexToIndex(g,w)),i.push(d),i.push(this._vertexToIndex(x,w)),i.push(this._vertexToIndex(g,w))):(i.push(d),i.push(l),i.push(this._vertexToIndex(g,w)),i.push(this._vertexToIndex(x,w)),i.push(d),i.push(this._vertexToIndex(g,w)))}_fillPoles(i,l,d){const g=this._vertexBuffer,x=Ae,w=i.length;for(let M=2;M<w;M+=3){const C=i[M-2],P=i[M-1],O=i[M],L=g[2*C],j=g[2*C+1],Z=g[2*P],H=g[2*P+1],X=g[2*O],re=g[2*O+1];l&&(j===0&&H===0&&this._generatePoleQuad(i,C,P,L,Z,Yu),H===0&&re===0&&this._generatePoleQuad(i,P,O,Z,X,Yu),re===0&&j===0&&this._generatePoleQuad(i,O,C,X,L,Yu)),d&&(j===x&&H===x&&this._generatePoleQuad(i,C,P,L,Z,Jl),H===x&&re===x&&this._generatePoleQuad(i,P,O,Z,X,Jl),re===x&&j===x&&this._generatePoleQuad(i,O,C,X,L,Jl))}}_initializeVertices(i){for(let l=0;l<i.length;l+=2)this._vertexToIndex(i[l],i[l+1])}subdividePolygonInternal(i,l){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:d,holeIndices:g}=function(M){const C=[],P=[];for(const O of M)if(O.length!==0){O!==M[0]&&C.push(P.length/2);for(let L=0;L<O.length;L++)P.push(O[L].x),P.push(O[L].y)}return{flattened:P,holeIndices:C}}(i);let x;this._initializeVertices(d);try{const M=function(P,O,L=2){const j=O&&O.length,Z=j?O[0]*L:P.length;let H=Bm(P,0,Z,L,!0);const X=[];if(!H||H.next===H.prev)return X;let re,ue,ve;if(j&&(H=function(de,V,ie,pe){const Be=[];for(let ot=0,Ue=V.length;ot<Ue;ot++){const $e=Bm(de,V[ot]*pe,ot<Ue-1?V[ot+1]*pe:de.length,pe,!1);$e===$e.next&&($e.steiner=!0),Be.push(__($e))}Be.sort(fp);for(let ot=0;ot<Be.length;ot++)ie=Um(Be[ot],ie);return ie}(P,O,H,L)),P.length>80*L){re=1/0,ue=1/0;let de=-1/0,V=-1/0;for(let ie=L;ie<Z;ie+=L){const pe=P[ie],Be=P[ie+1];pe<re&&(re=pe),Be<ue&&(ue=Be),pe>de&&(de=pe),Be>V&&(V=Be)}ve=Math.max(de-re,V-ue),ve=ve!==0?32767/ve:0}return Gu(H,X,L,re,ue,ve,0),X}(d,g),C=this._convertIndices(d,M);x=this._subdivideTrianglesScanline(C)}catch(M){console.error(M)}let w=[];return l&&(w=this._generateOutline(i)),this._ensureNoPoleVertices(),this._handlePoles(x),{verticesFlattened:this._vertexBuffer,indicesTriangles:x,indicesLineList:w}}_convertIndices(i,l){const d=[];for(let g=0;g<l.length;g++)d.push(this._vertexToIndex(i[2*l[g]],i[2*l[g]+1]));return d}_pointArrayToIndices(i){const l=[];for(let d=0;d<i.length;d++){const g=i[d];l.push(this._vertexToIndex(g.x,g.y))}return l}}function Vm(o,i,l,d=!0){return new al(l,i).subdividePolygonInternal(o,d)}function ec(o,i,l=!1){if(!o||o.length<1)return[];if(o.length<2)return[];const d=o[0],g=o[o.length-1],x=l&&(d.x!==g.x||d.y!==g.y);if(i<2)return x?[...o,o[0]]:[...o];const w=Math.floor(Ae/i),M=[];M.push(new le(o[0].x,o[0].y));const C=o.length,P=x?C:C-1;for(let O=0;O<P;O++){const L=o[O],j=O<C-1?o[O+1]:o[0],Z=L.x,H=L.y,X=j.x,re=j.y,ue=Z!==X,ve=H!==re;if(!ue&&!ve)continue;const de=X-Z,V=re-H,ie=Math.abs(de),pe=Math.abs(V);let Be=Z,ot=H;for(;;){const $e=de>0?(Math.floor(Be/w)+1)*w:(Math.ceil(Be/w)-1)*w,ft=V>0?(Math.floor(ot/w)+1)*w:(Math.ceil(ot/w)-1)*w,at=Math.abs(Be-$e),pt=Math.abs(ot-ft),Qe=Math.abs(Be-X),kt=Math.abs(ot-re),Xt=ue?at/ie:Number.POSITIVE_INFINITY,$t=ve?pt/pe:Number.POSITIVE_INFINITY;if((Qe<=at||!ue)&&(kt<=pt||!ve))break;if(Xt<$t&&ue||!ve){Be=$e,ot+=V*Xt;const Ut=new le(Be,Math.round(ot));M[M.length-1].x===Ut.x&&M[M.length-1].y===Ut.y||M.push(Ut)}else{Be+=de*$t,ot=ft;const Ut=new le(Math.round(Be),ot);M[M.length-1].x===Ut.x&&M[M.length-1].y===Ut.y||M.push(Ut)}}const Ue=new le(X,re);M[M.length-1].x===Ue.x&&M[M.length-1].y===Ue.y||M.push(Ue)}return M}function b_(o,i,l){if(i.length===0)throw new Error("Subdivision vertex ring is empty.");let d=0,g=o[2*i[0]];for(let C=1;C<i.length;C++){const P=o[2*i[C]];P<g&&(g=P,d=C)}const x=i.length;let w=d,M=(w+1)%x;for(;;){const C=w-1>=0?w-1:x-1,P=(M+1)%x,O=o[2*i[C]],L=o[2*i[P]],j=o[2*i[w]],Z=o[2*i[w]+1],H=o[2*i[M]+1];let X=!1;if(O<L)X=!0;else if(O>L)X=!1;else{const re=H-Z,ue=-(o[2*i[M]]-j),ve=Z<H?1:-1;((O-j)*re+(o[2*i[C]+1]-Z)*ue)*ve>((L-j)*re+(o[2*i[P]+1]-Z)*ue)*ve&&(X=!0)}if(X){const re=i[C],ue=i[w],ve=i[M];re!==ue&&re!==ve&&ue!==ve&&l.push(ve,ue,re),w--,w<0&&(w=x-1)}else{const re=i[P],ue=i[w],ve=i[M];re!==ue&&re!==ve&&ue!==ve&&l.push(ve,ue,re),M++,M>=x&&(M=0)}if(C===P)break}}function pp(o,i,l,d,g,x,w,M,C){const P=g.length/2,O=w&&M&&C;if(P<vi.MAX_VERTEX_ARRAY_LENGTH){const L=i.prepareSegment(P,l,d),j=L.vertexLength;for(let X=0;X<x.length;X+=3)d.emplaceBack(j+x[X],j+x[X+1],j+x[X+2]);let Z,H;L.vertexLength+=P,L.primitiveLength+=x.length/3,O&&(H=w.prepareSegment(P,l,M),Z=H.vertexLength,H.vertexLength+=P);for(let X=0;X<g.length;X+=2)o(g[X],g[X+1]);if(O)for(let X=0;X<C.length;X++){const re=C[X];for(let ue=1;ue<re.length;ue+=2)M.emplaceBack(Z+re[ue-1],Z+re[ue]);H.primitiveLength+=re.length/2}}else(function(L,j,Z,H,X,re){const ue=[];for(let pe=0;pe<H.length/2;pe++)ue.push(-1);const ve={count:0};let de=0,V=L.getOrCreateLatestSegment(j,Z),ie=V.vertexLength;for(let pe=2;pe<X.length;pe+=3){const Be=X[pe-2],ot=X[pe-1],Ue=X[pe];let $e=ue[Be]<de,ft=ue[ot]<de,at=ue[Ue]<de;V.vertexLength+(($e?1:0)+(ft?1:0)+(at?1:0))>vi.MAX_VERTEX_ARRAY_LENGTH&&(V=L.createNewSegment(j,Z),de=ve.count,$e=!0,ft=!0,at=!0,ie=0);const pt=Xu(ue,H,re,ve,Be,$e,V),Qe=Xu(ue,H,re,ve,ot,ft,V),kt=Xu(ue,H,re,ve,Ue,at,V);Z.emplaceBack(ie+pt-de,ie+Qe-de,ie+kt-de),V.primitiveLength++}})(i,l,d,g,x,o),O&&function(L,j,Z,H,X,re){const ue=[];for(let pe=0;pe<H.length/2;pe++)ue.push(-1);const ve={count:0};let de=0,V=L.getOrCreateLatestSegment(j,Z),ie=V.vertexLength;for(let pe=0;pe<X.length;pe++){const Be=X[pe];for(let ot=1;ot<X[pe].length;ot+=2){const Ue=Be[ot-1],$e=Be[ot];let ft=ue[Ue]<de,at=ue[$e]<de;V.vertexLength+((ft?1:0)+(at?1:0))>vi.MAX_VERTEX_ARRAY_LENGTH&&(V=L.createNewSegment(j,Z),de=ve.count,ft=!0,at=!0,ie=0);const pt=Xu(ue,H,re,ve,Ue,ft,V),Qe=Xu(ue,H,re,ve,$e,at,V);Z.emplaceBack(ie+pt-de,ie+Qe-de),V.primitiveLength++}}}(w,l,M,g,C,o),i.forceNewSegmentOnNextPrepare(),w==null||w.forceNewSegmentOnNextPrepare()}function Xu(o,i,l,d,g,x,w){if(x){const M=d.count;return l(i[2*g],i[2*g+1]),o[g]=d.count,d.count++,w.vertexLength++,M}return o[g]}class sd{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ye,this.indexArray=new it,this.indexArray2=new Lt,this.programConfigurations=new Gs(i.layers,i.zoom),this.segments=new vi,this.segments2=new vi,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,d){this.hasPattern=mf("fill",this.layers,l);const g=this.layers[0].layout.get("fill-sort-key"),x=!g.isConstant(),w=[];for(const{feature:M,id:C,index:P,sourceLayerIndex:O}of i){const L=this.layers[0]._featureFilter.needGeometry,j=gs(M,L);if(!this.layers[0]._featureFilter.filter(new fn(this.zoom),j,d))continue;const Z=x?g.evaluate(j,{},d,l.availableImages):void 0,H={id:C,properties:M.properties,type:M.type,sourceLayerIndex:O,index:P,geometry:L?j.geometry:Ya(M),patterns:{},sortKey:Z};w.push(H)}x&&w.sort((M,C)=>M.sortKey-C.sortKey);for(const M of w){const{geometry:C,index:P,sourceLayerIndex:O}=M;if(this.hasPattern){const L=dp("fill",this.layers,M,this.zoom,l);this.patternFeatures.push(L)}else this.addFeature(M,C,P,d,{},l.subdivisionGranularity);l.featureIndex.insert(i[P].feature,C,P,O,this.index)}}update(i,l,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,d)}addFeatures(i,l,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,l,d,i.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,hp),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,l,d,g,x,w){for(const M of mo(l,500)){const C=Vm(M,g,w.fill.getGranularityForZoomLevel(g.z)),P=this.layoutVertexArray;pp((O,L)=>{P.emplaceBack(O,L)},this.segments,this.layoutVertexArray,this.indexArray,C.verticesFlattened,C.indicesTriangles,this.segments2,this.indexArray2,C.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,x,g)}}let Zm,sl;Rt("FillBucket",sd,{omit:["layers","patternFeatures"]});var Sr={get paint(){return sl=sl||new Fr({"fill-antialias":new Nt($.paint_fill["fill-antialias"]),"fill-opacity":new qt($.paint_fill["fill-opacity"]),"fill-color":new qt($.paint_fill["fill-color"]),"fill-outline-color":new qt($.paint_fill["fill-outline-color"]),"fill-translate":new Nt($.paint_fill["fill-translate"]),"fill-translate-anchor":new Nt($.paint_fill["fill-translate-anchor"]),"fill-pattern":new Bu($.paint_fill["fill-pattern"])})},get layout(){return Zm=Zm||new Fr({"fill-sort-key":new qt($.layout_fill["fill-sort-key"])})}};class Gm extends Nr{constructor(i){super(i,Sr)}recalculate(i,l){super.recalculate(i,l);const d=this.paint._values["fill-outline-color"];d.value.kind==="constant"&&d.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new sd(i)}queryRadius(){return rd(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:i,geometry:l,transform:d,pixelsToTileUnits:g}){return Dm(hf(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-d.bearingInRadians,g),l)}isTileClipped(){return!0}}const x_=ni([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Qr=ni([{name:"a_centroid",components:2,type:"Int16"}],4),{members:pv}=x_;var mp,qm,Zn,Oa,To,$m,Hm,gp={};function _p(){if(qm)return mp;qm=1;var o=oe();function i(g,x,w,M,C){this.properties={},this.extent=w,this.type=0,this._pbf=g,this._geometry=-1,this._keys=M,this._values=C,g.readFields(l,this,x)}function l(g,x,w){g==1?x.id=w.readVarint():g==2?function(M,C){for(var P=M.readVarint()+M.pos;M.pos<P;){var O=C._keys[M.readVarint()],L=C._values[M.readVarint()];C.properties[O]=L}}(w,x):g==3?x.type=w.readVarint():g==4&&(x._geometry=w.pos)}function d(g){for(var x,w,M=0,C=0,P=g.length,O=P-1;C<P;O=C++)M+=((w=g[O]).x-(x=g[C]).x)*(x.y+w.y);return M}return mp=i,i.types=["Unknown","Point","LineString","Polygon"],i.prototype.loadGeometry=function(){var g=this._pbf;g.pos=this._geometry;for(var x,w=g.readVarint()+g.pos,M=1,C=0,P=0,O=0,L=[];g.pos<w;){if(C<=0){var j=g.readVarint();M=7&j,C=j>>3}if(C--,M===1||M===2)P+=g.readSVarint(),O+=g.readSVarint(),M===1&&(x&&L.push(x),x=[]),x.push(new o(P,O));else{if(M!==7)throw new Error("unknown command "+M);x&&x.push(x[0].clone())}}return x&&L.push(x),L},i.prototype.bbox=function(){var g=this._pbf;g.pos=this._geometry;for(var x=g.readVarint()+g.pos,w=1,M=0,C=0,P=0,O=1/0,L=-1/0,j=1/0,Z=-1/0;g.pos<x;){if(M<=0){var H=g.readVarint();w=7&H,M=H>>3}if(M--,w===1||w===2)(C+=g.readSVarint())<O&&(O=C),C>L&&(L=C),(P+=g.readSVarint())<j&&(j=P),P>Z&&(Z=P);else if(w!==7)throw new Error("unknown command "+w)}return[O,j,L,Z]},i.prototype.toGeoJSON=function(g,x,w){var M,C,P=this.extent*Math.pow(2,w),O=this.extent*g,L=this.extent*x,j=this.loadGeometry(),Z=i.types[this.type];function H(ue){for(var ve=0;ve<ue.length;ve++){var de=ue[ve];ue[ve]=[360*(de.x+O)/P-180,360/Math.PI*Math.atan(Math.exp((180-360*(de.y+L)/P)*Math.PI/180))-90]}}switch(this.type){case 1:var X=[];for(M=0;M<j.length;M++)X[M]=j[M][0];H(j=X);break;case 2:for(M=0;M<j.length;M++)H(j[M]);break;case 3:for(j=function(ue){var ve=ue.length;if(ve<=1)return[ue];for(var de,V,ie=[],pe=0;pe<ve;pe++){var Be=d(ue[pe]);Be!==0&&(V===void 0&&(V=Be<0),V===Be<0?(de&&ie.push(de),de=[ue[pe]]):de.push(ue[pe]))}return de&&ie.push(de),ie}(j),M=0;M<j.length;M++)for(C=0;C<j[M].length;C++)H(j[M][C])}j.length===1?j=j[0]:Z="Multi"+Z;var re={type:"Feature",geometry:{type:Z,coordinates:j},properties:this.properties};return"id"in this&&(re.id=this.id),re},mp}function Wa(){if(Oa)return Zn;Oa=1;var o=_p();function i(d,g){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=d,this._keys=[],this._values=[],this._features=[],d.readFields(l,this,g),this.length=this._features.length}function l(d,g,x){d===15?g.version=x.readVarint():d===1?g.name=x.readString():d===5?g.extent=x.readVarint():d===2?g._features.push(x.pos):d===3?g._keys.push(x.readString()):d===4&&g._values.push(function(w){for(var M=null,C=w.readVarint()+w.pos;w.pos<C;){var P=w.readVarint()>>3;M=P===1?w.readString():P===2?w.readFloat():P===3?w.readDouble():P===4?w.readVarint64():P===5?w.readVarint():P===6?w.readSVarint():P===7?w.readBoolean():null}return M}(x))}return Zn=i,i.prototype.feature=function(d){if(d<0||d>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[d];var g=this._pbf.readVarint()+this._pbf.pos;return new o(this._pbf,g,this.extent,this._keys,this._values)},Zn}function Hs(){return Hm||(Hm=1,gp.VectorTile=function(){if($m)return To;$m=1;var o=Wa();function i(l,d,g){if(l===3){var x=new o(g,g.readVarint()+g.pos);x.length&&(d[x.name]=x)}}return To=function(l,d){this.layers=l.readFields(i,{},d)},To}(),gp.VectorTileFeature=_p(),gp.VectorTileLayer=Wa()),gp}var od=k(Hs());const ys=od.VectorTileFeature.types,yp=Math.pow(2,13);function Ys(o,i,l,d,g,x,w,M){o.emplaceBack(i,l,2*Math.floor(d*yp)+w,g*yp*2,x*yp*2,Math.round(M))}class tc{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new Me,this.centroidVertexArray=new me,this.indexArray=new it,this.programConfigurations=new Gs(i.layers,i.zoom),this.segments=new vi,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,d){this.features=[],this.hasPattern=mf("fill-extrusion",this.layers,l);for(const{feature:g,id:x,index:w,sourceLayerIndex:M}of i){const C=this.layers[0]._featureFilter.needGeometry,P=gs(g,C);if(!this.layers[0]._featureFilter.filter(new fn(this.zoom),P,d))continue;const O={id:x,sourceLayerIndex:M,index:w,geometry:C?P.geometry:Ya(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(dp("fill-extrusion",this.layers,O,this.zoom,l)):this.addFeature(O,O.geometry,w,d,{},l.subdivisionGranularity),l.featureIndex.insert(g,O.geometry,w,M,this.index,!0)}}addFeatures(i,l,d){for(const g of this.features){const{geometry:x}=g;this.addFeature(g,x,g.index,l,d,i.subdivisionGranularity)}}update(i,l,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,d)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,pv),this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,Qr.members,!0),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(i,l,d,g,x,w){for(const M of mo(l,500)){const C={x:0,y:0,sampleCount:0},P=this.layoutVertexArray.length;this.processPolygon(C,g,i,M,w);const O=this.layoutVertexArray.length-P,L=Math.floor(C.x/C.sampleCount),j=Math.floor(C.y/C.sampleCount);for(let Z=0;Z<O;Z++)this.centroidVertexArray.emplaceBack(L,j)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,x,g)}processPolygon(i,l,d,g,x){if(g.length<1||vp(g[0]))return;for(const L of g)L.length!==0&&Vc(i,L);const w={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},M=x.fill.getGranularityForZoomLevel(l.z),C=ys[d.type]==="Polygon";for(const L of g){if(L.length===0||vp(L))continue;const j=ec(L,M,C);this._generateSideFaces(j,w)}if(!C)return;const P=Vm(g,l,M,!1),O=this.layoutVertexArray;pp((L,j)=>{Ys(O,L,j,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,P.verticesFlattened,P.indicesTriangles)}_generateSideFaces(i,l){let d=0;for(let g=1;g<i.length;g++){const x=i[g],w=i[g-1];if(Ym(x,w))continue;l.segment.vertexLength+4>vi.MAX_VERTEX_ARRAY_LENGTH&&(l.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const M=x.sub(w)._perp()._unit(),C=w.dist(x);d+C>32768&&(d=0),Ys(this.layoutVertexArray,x.x,x.y,M.x,M.y,0,0,d),Ys(this.layoutVertexArray,x.x,x.y,M.x,M.y,0,1,d),d+=C,Ys(this.layoutVertexArray,w.x,w.y,M.x,M.y,0,0,d),Ys(this.layoutVertexArray,w.x,w.y,M.x,M.y,0,1,d);const P=l.segment.vertexLength;this.indexArray.emplaceBack(P,P+2,P+1),this.indexArray.emplaceBack(P+1,P+2,P+3),l.segment.vertexLength+=4,l.segment.primitiveLength+=2}}}function Vc(o,i){for(let l=0;l<i.length;l++){const d=i[l];l===i.length-1&&i[0].x===d.x&&i[0].y===d.y||(o.x+=d.x,o.y+=d.y,o.sampleCount++)}}function Ym(o,i){return o.x===i.x&&(o.x<0||o.x>Ae)||o.y===i.y&&(o.y<0||o.y>Ae)}function vp(o){return o.every(i=>i.x<0)||o.every(i=>i.x>Ae)||o.every(i=>i.y<0)||o.every(i=>i.y>Ae)}let Eo;Rt("FillExtrusionBucket",tc,{omit:["layers","features"]});var w_={get paint(){return Eo=Eo||new Fr({"fill-extrusion-opacity":new Nt($["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new qt($["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Nt($["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Nt($["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Bu($["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new qt($["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new qt($["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Nt($["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class ld extends Nr{constructor(i){super(i,w_)}createBucket(i){return new tc(i)}queryRadius(){return rd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:i,feature:l,featureState:d,geometry:g,transform:x,pixelsToTileUnits:w,pixelPosMatrix:M}){const C=hf(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-x.bearingInRadians,w),P=this.paint.get("fill-extrusion-height").evaluate(l,d),O=this.paint.get("fill-extrusion-base").evaluate(l,d),L=function(Z,H,X){const re=[];for(const ue of Z){const ve=[ue.x,ue.y,0,1];te(ve,ve,H),re.push(new le(ve[0]/ve[3],ve[1]/ve[3]))}return re}(C,M),j=function(Z,H,X,re){const ue=[],ve=[],de=re[8]*H,V=re[9]*H,ie=re[10]*H,pe=re[11]*H,Be=re[8]*X,ot=re[9]*X,Ue=re[10]*X,$e=re[11]*X;for(const ft of Z){const at=[],pt=[];for(const Qe of ft){const kt=Qe.x,Xt=Qe.y,$t=re[0]*kt+re[4]*Xt+re[12],Ut=re[1]*kt+re[5]*Xt+re[13],Di=re[2]*kt+re[6]*Xt+re[14],Gn=re[3]*kt+re[7]*Xt+re[15],ur=Di+ie,Vr=Gn+pe,Ta=$t+Be,Ba=Ut+ot,Zr=Di+Ue,wn=Gn+$e,yr=new le(($t+de)/Vr,(Ut+V)/Vr);yr.z=ur/Vr,at.push(yr);const vr=new le(Ta/wn,Ba/wn);vr.z=Zr/wn,pt.push(vr)}ue.push(at),ve.push(pt)}return[ue,ve]}(g,O,P,M);return function(Z,H,X){let re=1/0;Dm(X,H)&&(re=cd(X,H[0]));for(let ue=0;ue<H.length;ue++){const ve=H[ue],de=Z[ue];for(let V=0;V<ve.length-1;V++){const ie=ve[V],pe=[ie,ve[V+1],de[V+1],de[V],ie];Vu(X,pe)&&(re=Math.min(re,cd(X,pe)))}}return re!==1/0&&re}(j[0],j[1],L)}}function ic(o,i){return o.x*i.x+o.y*i.y}function cd(o,i){if(o.length===1){let l=0;const d=i[l++];let g;for(;!g||d.equals(g);)if(g=i[l++],!g)return 1/0;for(;l<i.length;l++){const x=i[l],w=o[0],M=g.sub(d),C=x.sub(d),P=w.sub(d),O=ic(M,M),L=ic(M,C),j=ic(C,C),Z=ic(P,M),H=ic(P,C),X=O*j-L*L,re=(j*Z-L*H)/X,ue=(O*H-L*Z)/X,ve=d.z*(1-re-ue)+g.z*re+x.z*ue;if(isFinite(ve))return ve}return 1/0}{let l=1/0;for(const d of i)l=Math.min(l,d.z);return l}}const ud=ni([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:S_}=ud,T_=ni([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:yf}=T_,E_=od.VectorTileFeature.types,bp=Math.cos(Math.PI/180*37.5),Xm=Math.pow(2,14)/.5;class Km{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new Se,this.layoutVertexArray2=new Le,this.indexArray=new it,this.programConfigurations=new Gs(i.layers,i.zoom),this.segments=new vi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,d){this.hasPattern=mf("line",this.layers,l);const g=this.layers[0].layout.get("line-sort-key"),x=!g.isConstant(),w=[];for(const{feature:M,id:C,index:P,sourceLayerIndex:O}of i){const L=this.layers[0]._featureFilter.needGeometry,j=gs(M,L);if(!this.layers[0]._featureFilter.filter(new fn(this.zoom),j,d))continue;const Z=x?g.evaluate(j,{},d):void 0,H={id:C,properties:M.properties,type:M.type,sourceLayerIndex:O,index:P,geometry:L?j.geometry:Ya(M),patterns:{},sortKey:Z};w.push(H)}x&&w.sort((M,C)=>M.sortKey-C.sortKey);for(const M of w){const{geometry:C,index:P,sourceLayerIndex:O}=M;if(this.hasPattern){const L=dp("line",this.layers,M,this.zoom,l);this.patternFeatures.push(L)}else this.addFeature(M,C,P,d,{},l.subdivisionGranularity);l.featureIndex.insert(i[P].feature,C,P,O,this.index)}}update(i,l,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,d)}addFeatures(i,l,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,l,d,i.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,yf)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,S_),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,l,d,g,x,w){const M=this.layers[0].layout,C=M.get("line-join").evaluate(i,{}),P=M.get("line-cap"),O=M.get("line-miter-limit"),L=M.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const j of l)this.addLine(j,i,C,P,O,L,g,w);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,x,g)}addLine(i,l,d,g,x,w,M,C){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,i=ec(i,M?C.line.getGranularityForZoomLevel(M.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let de=0;de<i.length-1;de++)this.totalDistance+=i[de].dist(i[de+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const P=E_[l.type]==="Polygon";let O=i.length;for(;O>=2&&i[O-1].equals(i[O-2]);)O--;let L=0;for(;L<O-1&&i[L].equals(i[L+1]);)L++;if(O<(P?3:2))return;d==="bevel"&&(x=1.05);const j=this.overscaling<=16?15*Ae/(512*this.overscaling):0,Z=this.segments.prepareSegment(10*O,this.layoutVertexArray,this.indexArray);let H,X,re,ue,ve;this.e1=this.e2=-1,P&&(H=i[O-2],ve=i[L].sub(H)._unit()._perp());for(let de=L;de<O;de++){if(re=de===O-1?P?i[L+1]:void 0:i[de+1],re&&i[de].equals(re))continue;ve&&(ue=ve),H&&(X=H),H=i[de],ve=re?re.sub(H)._unit()._perp():ue,ue=ue||ve;let V=ue.add(ve);V.x===0&&V.y===0||V._unit();const ie=ue.x*ve.x+ue.y*ve.y,pe=V.x*ve.x+V.y*ve.y,Be=pe!==0?1/pe:1/0,ot=2*Math.sqrt(2-2*pe),Ue=pe<bp&&X&&re,$e=ue.x*ve.y-ue.y*ve.x>0;if(Ue&&de>L){const pt=H.dist(X);if(pt>2*j){const Qe=H.sub(H.sub(X)._mult(j/pt)._round());this.updateDistance(X,Qe),this.addCurrentVertex(Qe,ue,0,0,Z),X=Qe}}const ft=X&&re;let at=ft?d:P?"butt":g;if(ft&&at==="round"&&(Be<w?at="miter":Be<=2&&(at="fakeround")),at==="miter"&&Be>x&&(at="bevel"),at==="bevel"&&(Be>2&&(at="flipbevel"),Be<x&&(at="miter")),X&&this.updateDistance(X,H),at==="miter")V._mult(Be),this.addCurrentVertex(H,V,0,0,Z);else if(at==="flipbevel"){if(Be>100)V=ve.mult(-1);else{const pt=Be*ue.add(ve).mag()/ue.sub(ve).mag();V._perp()._mult(pt*($e?-1:1))}this.addCurrentVertex(H,V,0,0,Z),this.addCurrentVertex(H,V.mult(-1),0,0,Z)}else if(at==="bevel"||at==="fakeround"){const pt=-Math.sqrt(Be*Be-1),Qe=$e?pt:0,kt=$e?0:pt;if(X&&this.addCurrentVertex(H,ue,Qe,kt,Z),at==="fakeround"){const Xt=Math.round(180*ot/Math.PI/20);for(let $t=1;$t<Xt;$t++){let Ut=$t/Xt;if(Ut!==.5){const Gn=Ut-.5;Ut+=Ut*Gn*(Ut-1)*((1.0904+ie*(ie*(3.55645-1.43519*ie)-3.2452))*Gn*Gn+(.848013+ie*(.215638*ie-1.06021)))}const Di=ve.sub(ue)._mult(Ut)._add(ue)._unit()._mult($e?-1:1);this.addHalfVertex(H,Di.x,Di.y,!1,$e,0,Z)}}re&&this.addCurrentVertex(H,ve,-Qe,-kt,Z)}else if(at==="butt")this.addCurrentVertex(H,V,0,0,Z);else if(at==="square"){const pt=X?1:-1;this.addCurrentVertex(H,V,pt,pt,Z)}else at==="round"&&(X&&(this.addCurrentVertex(H,ue,0,0,Z),this.addCurrentVertex(H,ue,1,1,Z,!0)),re&&(this.addCurrentVertex(H,ve,-1,-1,Z,!0),this.addCurrentVertex(H,ve,0,0,Z)));if(Ue&&de<O-1){const pt=H.dist(re);if(pt>2*j){const Qe=H.add(re.sub(H)._mult(j/pt)._round());this.updateDistance(H,Qe),this.addCurrentVertex(Qe,ve,0,0,Z),H=Qe}}}}addCurrentVertex(i,l,d,g,x,w=!1){const M=l.y*g-l.x,C=-l.y-l.x*g;this.addHalfVertex(i,l.x+l.y*d,l.y-l.x*d,w,!1,d,x),this.addHalfVertex(i,M,C,w,!0,-g,x),this.distance>Xm/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(i,l,d,g,x,w))}addHalfVertex({x:i,y:l},d,g,x,w,M,C){const P=.5*(this.lineClips?this.scaledDistance*(Xm-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i<<1)+(x?1:0),(l<<1)+(w?1:0),Math.round(63*d)+128,Math.round(63*g)+128,1+(M===0?0:M<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const O=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,O,this.e2),C.primitiveLength++),w?this.e2=O:this.e1=O}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(i,l){this.distance+=i.dist(l),this.updateScaledDistance()}}let M_,cn;Rt("LineBucket",Km,{omit:["layers","patternFeatures"]});var Rn={get paint(){return cn=cn||new Fr({"line-opacity":new qt($.paint_line["line-opacity"]),"line-color":new qt($.paint_line["line-color"]),"line-translate":new Nt($.paint_line["line-translate"]),"line-translate-anchor":new Nt($.paint_line["line-translate-anchor"]),"line-width":new qt($.paint_line["line-width"]),"line-gap-width":new qt($.paint_line["line-gap-width"]),"line-offset":new qt($.paint_line["line-offset"]),"line-blur":new qt($.paint_line["line-blur"]),"line-dasharray":new id($.paint_line["line-dasharray"]),"line-pattern":new Bu($.paint_line["line-pattern"]),"line-gradient":new Ko($.paint_line["line-gradient"])})},get layout(){return M_=M_||new Fr({"line-cap":new Nt($.layout_line["line-cap"]),"line-join":new qt($.layout_line["line-join"]),"line-miter-limit":new Nt($.layout_line["line-miter-limit"]),"line-round-limit":new Nt($.layout_line["line-round-limit"]),"line-sort-key":new qt($.layout_line["line-sort-key"])})}};class Vi extends qt{possiblyEvaluate(i,l){return l=new fn(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,zoomHistory:l.zoomHistory,transition:l.transition}),super.possiblyEvaluate(i,l)}evaluate(i,l,d,g){return l=ti({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(i,l,d,g)}}let Zi;class gn extends Nr{constructor(i){super(i,Rn),this.gradientVersion=0,Zi||(Zi=new Vi(Rn.paint.properties["line-width"].specification),Zi.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const l=this.gradientExpression();this.stepInterpolant=!!function(d){return d._styleExpression!==void 0}(l)&&l._styleExpression.expression instanceof Fo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,l){super.recalculate(i,l),this.paint._values["line-floorwidth"]=Zi.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Km(i)}queryRadius(i){const l=i,d=Qa(Zu("line-width",this,l),Zu("line-gap-width",this,l)),g=Zu("line-offset",this,l);return d/2+Math.abs(g)+rd(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:i,feature:l,featureState:d,geometry:g,transform:x,pixelsToTileUnits:w}){const M=hf(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-x.bearingInRadians,w),C=w/2*Qa(this.paint.get("line-width").evaluate(l,d),this.paint.get("line-gap-width").evaluate(l,d)),P=this.paint.get("line-offset").evaluate(l,d);return P&&(g=function(O,L){const j=[];for(let Z=0;Z<O.length;Z++){const H=O[Z],X=[];for(let re=0;re<H.length;re++){const ue=H[re-1],ve=H[re],de=H[re+1],V=re===0?new le(0,0):ve.sub(ue)._unit()._perp(),ie=re===H.length-1?new le(0,0):de.sub(ve)._unit()._perp(),pe=V._add(ie)._unit(),Be=pe.x*ie.x+pe.y*ie.y;Be!==0&&pe._mult(1/Be),X.push(pe._mult(L)._add(ve))}j.push(X)}return j}(g,P*w)),function(O,L,j){for(let Z=0;Z<L.length;Z++){const H=L[Z];if(O.length>=3){for(let X=0;X<H.length;X++)if(Yn(O,H[X]))return!0}if(qs(O,H,j))return!0}return!1}(M,g,C)}isTileClipped(){return!0}}function Qa(o,i){return i>0?i+2*o:o}const Zc=ni([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),hd=ni([{name:"a_projected_pos",components:3,type:"Float32"}],4);ni([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Wm=ni([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);ni([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ol=ni([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),_r=ni([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Gc(o,i,l){return o.sections.forEach(d=>{d.text=function(g,x,w){const M=x.layout.get("text-transform").evaluate(w,{});return M==="uppercase"?g=g.toLocaleUpperCase():M==="lowercase"&&(g=g.toLocaleLowerCase()),Ns.applyArabicShaping&&(g=Ns.applyArabicShaping(g)),g}(d.text,i,l)}),o}ni([{name:"triangle",components:3,type:"Uint16"}]),ni([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ni([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),ni([{type:"Float32",name:"offsetX"}]),ni([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),ni([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Mo={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var xp,Ja,Ku,Xn=24,wa={};function Qm(){return xp||(xp=1,wa.read=function(o,i,l,d,g){var x,w,M=8*g-d-1,C=(1<<M)-1,P=C>>1,O=-7,L=l?g-1:0,j=l?-1:1,Z=o[i+L];for(L+=j,x=Z&(1<<-O)-1,Z>>=-O,O+=M;O>0;x=256*x+o[i+L],L+=j,O-=8);for(w=x&(1<<-O)-1,x>>=-O,O+=d;O>0;w=256*w+o[i+L],L+=j,O-=8);if(x===0)x=1-P;else{if(x===C)return w?NaN:1/0*(Z?-1:1);w+=Math.pow(2,d),x-=P}return(Z?-1:1)*w*Math.pow(2,x-d)},wa.write=function(o,i,l,d,g,x){var w,M,C,P=8*x-g-1,O=(1<<P)-1,L=O>>1,j=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,Z=d?0:x-1,H=d?1:-1,X=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(M=isNaN(i)?1:0,w=O):(w=Math.floor(Math.log(i)/Math.LN2),i*(C=Math.pow(2,-w))<1&&(w--,C*=2),(i+=w+L>=1?j/C:j*Math.pow(2,1-L))*C>=2&&(w++,C/=2),w+L>=O?(M=0,w=O):w+L>=1?(M=(i*C-1)*Math.pow(2,g),w+=L):(M=i*Math.pow(2,L-1)*Math.pow(2,g),w=0));g>=8;o[l+Z]=255&M,Z+=H,M/=256,g-=8);for(w=w<<g|M,P+=g;P>0;o[l+Z]=255&w,Z+=H,w/=256,P-=8);o[l+Z-H]|=128*X}),wa}function wp(){if(Ku)return Ja;Ku=1,Ja=i;var o=Qm();function i(V){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(V)?V:new Uint8Array(V||0),this.pos=0,this.type=0,this.length=this.buf.length}i.Varint=0,i.Fixed64=1,i.Bytes=2,i.Fixed32=5;var l=4294967296,d=1/l,g=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function x(V){return V.type===i.Bytes?V.readVarint()+V.pos:V.pos+1}function w(V,ie,pe){return pe?4294967296*ie+(V>>>0):4294967296*(ie>>>0)+(V>>>0)}function M(V,ie,pe){var Be=ie<=16383?1:ie<=2097151?2:ie<=268435455?3:Math.floor(Math.log(ie)/(7*Math.LN2));pe.realloc(Be);for(var ot=pe.pos-1;ot>=V;ot--)pe.buf[ot+Be]=pe.buf[ot]}function C(V,ie){for(var pe=0;pe<V.length;pe++)ie.writeVarint(V[pe])}function P(V,ie){for(var pe=0;pe<V.length;pe++)ie.writeSVarint(V[pe])}function O(V,ie){for(var pe=0;pe<V.length;pe++)ie.writeFloat(V[pe])}function L(V,ie){for(var pe=0;pe<V.length;pe++)ie.writeDouble(V[pe])}function j(V,ie){for(var pe=0;pe<V.length;pe++)ie.writeBoolean(V[pe])}function Z(V,ie){for(var pe=0;pe<V.length;pe++)ie.writeFixed32(V[pe])}function H(V,ie){for(var pe=0;pe<V.length;pe++)ie.writeSFixed32(V[pe])}function X(V,ie){for(var pe=0;pe<V.length;pe++)ie.writeFixed64(V[pe])}function re(V,ie){for(var pe=0;pe<V.length;pe++)ie.writeSFixed64(V[pe])}function ue(V,ie){return(V[ie]|V[ie+1]<<8|V[ie+2]<<16)+16777216*V[ie+3]}function ve(V,ie,pe){V[pe]=ie,V[pe+1]=ie>>>8,V[pe+2]=ie>>>16,V[pe+3]=ie>>>24}function de(V,ie){return(V[ie]|V[ie+1]<<8|V[ie+2]<<16)+(V[ie+3]<<24)}return i.prototype={destroy:function(){this.buf=null},readFields:function(V,ie,pe){for(pe=pe||this.length;this.pos<pe;){var Be=this.readVarint(),ot=Be>>3,Ue=this.pos;this.type=7&Be,V(ot,ie,this),this.pos===Ue&&this.skip(Be)}return ie},readMessage:function(V,ie){return this.readFields(V,ie,this.readVarint()+this.pos)},readFixed32:function(){var V=ue(this.buf,this.pos);return this.pos+=4,V},readSFixed32:function(){var V=de(this.buf,this.pos);return this.pos+=4,V},readFixed64:function(){var V=ue(this.buf,this.pos)+ue(this.buf,this.pos+4)*l;return this.pos+=8,V},readSFixed64:function(){var V=ue(this.buf,this.pos)+de(this.buf,this.pos+4)*l;return this.pos+=8,V},readFloat:function(){var V=o.read(this.buf,this.pos,!0,23,4);return this.pos+=4,V},readDouble:function(){var V=o.read(this.buf,this.pos,!0,52,8);return this.pos+=8,V},readVarint:function(V){var ie,pe,Be=this.buf;return ie=127&(pe=Be[this.pos++]),pe<128?ie:(ie|=(127&(pe=Be[this.pos++]))<<7,pe<128?ie:(ie|=(127&(pe=Be[this.pos++]))<<14,pe<128?ie:(ie|=(127&(pe=Be[this.pos++]))<<21,pe<128?ie:function(ot,Ue,$e){var ft,at,pt=$e.buf;if(ft=(112&(at=pt[$e.pos++]))>>4,at<128||(ft|=(127&(at=pt[$e.pos++]))<<3,at<128)||(ft|=(127&(at=pt[$e.pos++]))<<10,at<128)||(ft|=(127&(at=pt[$e.pos++]))<<17,at<128)||(ft|=(127&(at=pt[$e.pos++]))<<24,at<128)||(ft|=(1&(at=pt[$e.pos++]))<<31,at<128))return w(ot,ft,Ue);throw new Error("Expected varint not more than 10 bytes")}(ie|=(15&(pe=Be[this.pos]))<<28,V,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var V=this.readVarint();return V%2==1?(V+1)/-2:V/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var V=this.readVarint()+this.pos,ie=this.pos;return this.pos=V,V-ie>=12&&g?function(pe,Be,ot){return g.decode(pe.subarray(Be,ot))}(this.buf,ie,V):function(pe,Be,ot){for(var Ue="",$e=Be;$e<ot;){var ft,at,pt,Qe=pe[$e],kt=null,Xt=Qe>239?4:Qe>223?3:Qe>191?2:1;if($e+Xt>ot)break;Xt===1?Qe<128&&(kt=Qe):Xt===2?(192&(ft=pe[$e+1]))==128&&(kt=(31&Qe)<<6|63&ft)<=127&&(kt=null):Xt===3?(at=pe[$e+2],(192&(ft=pe[$e+1]))==128&&(192&at)==128&&((kt=(15&Qe)<<12|(63&ft)<<6|63&at)<=2047||kt>=55296&&kt<=57343)&&(kt=null)):Xt===4&&(at=pe[$e+2],pt=pe[$e+3],(192&(ft=pe[$e+1]))==128&&(192&at)==128&&(192&pt)==128&&((kt=(15&Qe)<<18|(63&ft)<<12|(63&at)<<6|63&pt)<=65535||kt>=1114112)&&(kt=null)),kt===null?(kt=65533,Xt=1):kt>65535&&(kt-=65536,Ue+=String.fromCharCode(kt>>>10&1023|55296),kt=56320|1023&kt),Ue+=String.fromCharCode(kt),$e+=Xt}return Ue}(this.buf,ie,V)},readBytes:function(){var V=this.readVarint()+this.pos,ie=this.buf.subarray(this.pos,V);return this.pos=V,ie},readPackedVarint:function(V,ie){if(this.type!==i.Bytes)return V.push(this.readVarint(ie));var pe=x(this);for(V=V||[];this.pos<pe;)V.push(this.readVarint(ie));return V},readPackedSVarint:function(V){if(this.type!==i.Bytes)return V.push(this.readSVarint());var ie=x(this);for(V=V||[];this.pos<ie;)V.push(this.readSVarint());return V},readPackedBoolean:function(V){if(this.type!==i.Bytes)return V.push(this.readBoolean());var ie=x(this);for(V=V||[];this.pos<ie;)V.push(this.readBoolean());return V},readPackedFloat:function(V){if(this.type!==i.Bytes)return V.push(this.readFloat());var ie=x(this);for(V=V||[];this.pos<ie;)V.push(this.readFloat());return V},readPackedDouble:function(V){if(this.type!==i.Bytes)return V.push(this.readDouble());var ie=x(this);for(V=V||[];this.pos<ie;)V.push(this.readDouble());return V},readPackedFixed32:function(V){if(this.type!==i.Bytes)return V.push(this.readFixed32());var ie=x(this);for(V=V||[];this.pos<ie;)V.push(this.readFixed32());return V},readPackedSFixed32:function(V){if(this.type!==i.Bytes)return V.push(this.readSFixed32());var ie=x(this);for(V=V||[];this.pos<ie;)V.push(this.readSFixed32());return V},readPackedFixed64:function(V){if(this.type!==i.Bytes)return V.push(this.readFixed64());var ie=x(this);for(V=V||[];this.pos<ie;)V.push(this.readFixed64());return V},readPackedSFixed64:function(V){if(this.type!==i.Bytes)return V.push(this.readSFixed64());var ie=x(this);for(V=V||[];this.pos<ie;)V.push(this.readSFixed64());return V},skip:function(V){var ie=7&V;if(ie===i.Varint)for(;this.buf[this.pos++]>127;);else if(ie===i.Bytes)this.pos=this.readVarint()+this.pos;else if(ie===i.Fixed32)this.pos+=4;else{if(ie!==i.Fixed64)throw new Error("Unimplemented type: "+ie);this.pos+=8}},writeTag:function(V,ie){this.writeVarint(V<<3|ie)},realloc:function(V){for(var ie=this.length||16;ie<this.pos+V;)ie*=2;if(ie!==this.length){var pe=new Uint8Array(ie);pe.set(this.buf),this.buf=pe,this.length=ie}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(V){this.realloc(4),ve(this.buf,V,this.pos),this.pos+=4},writeSFixed32:function(V){this.realloc(4),ve(this.buf,V,this.pos),this.pos+=4},writeFixed64:function(V){this.realloc(8),ve(this.buf,-1&V,this.pos),ve(this.buf,Math.floor(V*d),this.pos+4),this.pos+=8},writeSFixed64:function(V){this.realloc(8),ve(this.buf,-1&V,this.pos),ve(this.buf,Math.floor(V*d),this.pos+4),this.pos+=8},writeVarint:function(V){(V=+V||0)>268435455||V<0?function(ie,pe){var Be,ot;if(ie>=0?(Be=ie%4294967296|0,ot=ie/4294967296|0):(ot=~(-ie/4294967296),4294967295^(Be=~(-ie%4294967296))?Be=Be+1|0:(Be=0,ot=ot+1|0)),ie>=18446744073709552e3||ie<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");pe.realloc(10),function(Ue,$e,ft){ft.buf[ft.pos++]=127&Ue|128,Ue>>>=7,ft.buf[ft.pos++]=127&Ue|128,Ue>>>=7,ft.buf[ft.pos++]=127&Ue|128,Ue>>>=7,ft.buf[ft.pos++]=127&Ue|128,ft.buf[ft.pos]=127&(Ue>>>=7)}(Be,0,pe),function(Ue,$e){var ft=(7&Ue)<<4;$e.buf[$e.pos++]|=ft|((Ue>>>=3)?128:0),Ue&&($e.buf[$e.pos++]=127&Ue|((Ue>>>=7)?128:0),Ue&&($e.buf[$e.pos++]=127&Ue|((Ue>>>=7)?128:0),Ue&&($e.buf[$e.pos++]=127&Ue|((Ue>>>=7)?128:0),Ue&&($e.buf[$e.pos++]=127&Ue|((Ue>>>=7)?128:0),Ue&&($e.buf[$e.pos++]=127&Ue)))))}(ot,pe)}(V,this):(this.realloc(4),this.buf[this.pos++]=127&V|(V>127?128:0),V<=127||(this.buf[this.pos++]=127&(V>>>=7)|(V>127?128:0),V<=127||(this.buf[this.pos++]=127&(V>>>=7)|(V>127?128:0),V<=127||(this.buf[this.pos++]=V>>>7&127))))},writeSVarint:function(V){this.writeVarint(V<0?2*-V-1:2*V)},writeBoolean:function(V){this.writeVarint(!!V)},writeString:function(V){V=String(V),this.realloc(4*V.length),this.pos++;var ie=this.pos;this.pos=function(Be,ot,Ue){for(var $e,ft,at=0;at<ot.length;at++){if(($e=ot.charCodeAt(at))>55295&&$e<57344){if(!ft){$e>56319||at+1===ot.length?(Be[Ue++]=239,Be[Ue++]=191,Be[Ue++]=189):ft=$e;continue}if($e<56320){Be[Ue++]=239,Be[Ue++]=191,Be[Ue++]=189,ft=$e;continue}$e=ft-55296<<10|$e-56320|65536,ft=null}else ft&&(Be[Ue++]=239,Be[Ue++]=191,Be[Ue++]=189,ft=null);$e<128?Be[Ue++]=$e:($e<2048?Be[Ue++]=$e>>6|192:($e<65536?Be[Ue++]=$e>>12|224:(Be[Ue++]=$e>>18|240,Be[Ue++]=$e>>12&63|128),Be[Ue++]=$e>>6&63|128),Be[Ue++]=63&$e|128)}return Ue}(this.buf,V,this.pos);var pe=this.pos-ie;pe>=128&&M(ie,pe,this),this.pos=ie-1,this.writeVarint(pe),this.pos+=pe},writeFloat:function(V){this.realloc(4),o.write(this.buf,V,this.pos,!0,23,4),this.pos+=4},writeDouble:function(V){this.realloc(8),o.write(this.buf,V,this.pos,!0,52,8),this.pos+=8},writeBytes:function(V){var ie=V.length;this.writeVarint(ie),this.realloc(ie);for(var pe=0;pe<ie;pe++)this.buf[this.pos++]=V[pe]},writeRawMessage:function(V,ie){this.pos++;var pe=this.pos;V(ie,this);var Be=this.pos-pe;Be>=128&&M(pe,Be,this),this.pos=pe-1,this.writeVarint(Be),this.pos+=Be},writeMessage:function(V,ie,pe){this.writeTag(V,i.Bytes),this.writeRawMessage(ie,pe)},writePackedVarint:function(V,ie){ie.length&&this.writeMessage(V,C,ie)},writePackedSVarint:function(V,ie){ie.length&&this.writeMessage(V,P,ie)},writePackedBoolean:function(V,ie){ie.length&&this.writeMessage(V,j,ie)},writePackedFloat:function(V,ie){ie.length&&this.writeMessage(V,O,ie)},writePackedDouble:function(V,ie){ie.length&&this.writeMessage(V,L,ie)},writePackedFixed32:function(V,ie){ie.length&&this.writeMessage(V,Z,ie)},writePackedSFixed32:function(V,ie){ie.length&&this.writeMessage(V,H,ie)},writePackedFixed64:function(V,ie){ie.length&&this.writeMessage(V,X,ie)},writePackedSFixed64:function(V,ie){ie.length&&this.writeMessage(V,re,ie)},writeBytesField:function(V,ie){this.writeTag(V,i.Bytes),this.writeBytes(ie)},writeFixed32Field:function(V,ie){this.writeTag(V,i.Fixed32),this.writeFixed32(ie)},writeSFixed32Field:function(V,ie){this.writeTag(V,i.Fixed32),this.writeSFixed32(ie)},writeFixed64Field:function(V,ie){this.writeTag(V,i.Fixed64),this.writeFixed64(ie)},writeSFixed64Field:function(V,ie){this.writeTag(V,i.Fixed64),this.writeSFixed64(ie)},writeVarintField:function(V,ie){this.writeTag(V,i.Varint),this.writeVarint(ie)},writeSVarintField:function(V,ie){this.writeTag(V,i.Varint),this.writeSVarint(ie)},writeStringField:function(V,ie){this.writeTag(V,i.Bytes),this.writeString(ie)},writeFloatField:function(V,ie){this.writeTag(V,i.Fixed32),this.writeFloat(ie)},writeDoubleField:function(V,ie){this.writeTag(V,i.Fixed64),this.writeDouble(ie)},writeBooleanField:function(V,ie){this.writeVarintField(V,!!ie)}},Ja}var dd=k(wp());const fd=3;function qc(o,i,l){o===1&&l.readMessage(sa,i)}function sa(o,i,l){if(o===3){const{id:d,bitmap:g,width:x,height:w,left:M,top:C,advance:P}=l.readMessage($c,{});i.push({id:d,bitmap:new pf({width:x+2*fd,height:w+2*fd},g),metrics:{width:x,height:w,left:M,top:C,advance:P}})}}function $c(o,i,l){o===1?i.id=l.readVarint():o===2?i.bitmap=l.readBytes():o===3?i.width=l.readVarint():o===4?i.height=l.readVarint():o===5?i.left=l.readSVarint():o===6?i.top=l.readSVarint():o===7&&(i.advance=l.readVarint())}const pd=fd;function Wu(o){let i=0,l=0;for(const w of o)i+=w.w*w.h,l=Math.max(l,w.w);o.sort((w,M)=>M.h-w.h);const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),l),h:1/0}];let g=0,x=0;for(const w of o)for(let M=d.length-1;M>=0;M--){const C=d[M];if(!(w.w>C.w||w.h>C.h)){if(w.x=C.x,w.y=C.y,x=Math.max(x,w.y+w.h),g=Math.max(g,w.x+w.w),w.w===C.w&&w.h===C.h){const P=d.pop();M<d.length&&(d[M]=P)}else w.h===C.h?(C.x+=w.w,C.w-=w.w):w.w===C.w?(C.y+=w.h,C.h-=w.h):(d.push({x:C.x+w.w,y:C.y,w:C.w-w.w,h:w.h}),C.y+=w.h,C.h-=w.h);break}}return{w:g,h:x,fill:i/(g*x)||0}}const oa=1;class vf{constructor(i,{pixelRatio:l,version:d,stretchX:g,stretchY:x,content:w,textFitWidth:M,textFitHeight:C}){this.paddedRect=i,this.pixelRatio=l,this.stretchX=g,this.stretchY=x,this.content=w,this.version=d,this.textFitWidth=M,this.textFitHeight=C}get tl(){return[this.paddedRect.x+oa,this.paddedRect.y+oa]}get br(){return[this.paddedRect.x+this.paddedRect.w-oa,this.paddedRect.y+this.paddedRect.h-oa]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*oa)/this.pixelRatio,(this.paddedRect.h-2*oa)/this.pixelRatio]}}class Jm{constructor(i,l){const d={},g={};this.haveRenderCallbacks=[];const x=[];this.addImages(i,d,x),this.addImages(l,g,x);const{w,h:M}=Wu(x),C=new Xa({width:w||1,height:M||1});for(const P in i){const O=i[P],L=d[P].paddedRect;Xa.copy(O.data,C,{x:0,y:0},{x:L.x+oa,y:L.y+oa},O.data)}for(const P in l){const O=l[P],L=g[P].paddedRect,j=L.x+oa,Z=L.y+oa,H=O.data.width,X=O.data.height;Xa.copy(O.data,C,{x:0,y:0},{x:j,y:Z},O.data),Xa.copy(O.data,C,{x:0,y:X-1},{x:j,y:Z-1},{width:H,height:1}),Xa.copy(O.data,C,{x:0,y:0},{x:j,y:Z+X},{width:H,height:1}),Xa.copy(O.data,C,{x:H-1,y:0},{x:j-1,y:Z},{width:1,height:X}),Xa.copy(O.data,C,{x:0,y:0},{x:j+H,y:Z},{width:1,height:X})}this.image=C,this.iconPositions=d,this.patternPositions=g}addImages(i,l,d){for(const g in i){const x=i[g],w={x:0,y:0,w:x.data.width+2*oa,h:x.data.height+2*oa};d.push(w),l[g]=new vf(w,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(i,l){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const d in i.updatedImages)this.patchUpdatedImage(this.iconPositions[d],i.getImage(d),l),this.patchUpdatedImage(this.patternPositions[d],i.getImage(d),l)}patchUpdatedImage(i,l,d){if(!i||!l||i.version===l.version)return;i.version=l.version;const[g,x]=i.tl;d.update(l.data,void 0,{x:g,y:x})}}var Xs;Rt("ImagePosition",vf),Rt("ImageAtlas",Jm),S.ah=void 0,(Xs=S.ah||(S.ah={}))[Xs.none=0]="none",Xs[Xs.horizontal=1]="horizontal",Xs[Xs.vertical=2]="vertical",Xs[Xs.horizontalOnly=3]="horizontalOnly";const md=-17;class la{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(i,l,d){const g=new la;return g.scale=i||1,g.fontStack=l,g.verticalAlign=d||"bottom",g}static forImage(i,l){const d=new la;return d.imageName=i,d.verticalAlign=l||"bottom",d}}class Qu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,l){const d=new Qu;for(let g=0;g<i.sections.length;g++){const x=i.sections[g];x.image?d.addImageSection(x):d.addTextSection(x,l)}return d}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(){this.text=function(i){let l="";for(let d=0;d<i.length;d++){const g=i.charCodeAt(d+1)||null,x=i.charCodeAt(d-1)||null;l+=g&&zu(g)&&!Mo[i[d+1]]||x&&zu(x)&&!Mo[i[d-1]]||!Mo[i[d]]?i[d]:Mo[i[d]]}return l}(this.text)}trim(){let i=0;for(let d=0;d<this.text.length&&bf[this.text.charCodeAt(d)];d++)i++;let l=this.text.length;for(let d=this.text.length-1;d>=0&&d>=i&&bf[this.text.charCodeAt(d)];d--)l--;this.text=this.text.substring(i,l),this.sectionIndex=this.sectionIndex.slice(i,l)}substring(i,l){const d=new Qu;return d.text=this.text.substring(i,l),d.sectionIndex=this.sectionIndex.slice(i,l),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,l)=>Math.max(i,this.sections[l].scale),0)}getMaxImageSize(i){let l=0,d=0;for(let g=0;g<this.length();g++){const x=this.getSection(g);if(x.imageName){const w=i[x.imageName];if(!w)continue;const M=w.displaySize;l=Math.max(l,M[0]),d=Math.max(d,M[1])}}return{maxImageWidth:l,maxImageHeight:d}}addTextSection(i,l){this.text+=i.text,this.sections.push(la.forText(i.scale,i.fontStack||l,i.verticalAlign));const d=this.sections.length-1;for(let g=0;g<i.text.length;++g)this.sectionIndex.push(d)}addImageSection(i){const l=i.image?i.image.name:"";if(l.length===0)return void qn("Can't add FormattedSection with an empty image.");const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCharCode(d),this.sections.push(la.forImage(l,i.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):qn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Sa(o,i,l,d,g,x,w,M,C,P,O,L,j,Z,H){const X=Qu.fromFeature(o,g);let re;L===S.ah.vertical&&X.verticalizePunctuation();const{processBidirectionalText:ue,processStyledBidirectionalText:ve}=Ns;if(ue&&X.sections.length===1){re=[];const ie=ue(X.toString(),Sp(X,P,x,i,d,Z));for(const pe of ie){const Be=new Qu;Be.text=pe,Be.sections=X.sections;for(let ot=0;ot<pe.length;ot++)Be.sectionIndex.push(0);re.push(Be)}}else if(ve){re=[];const ie=ve(X.text,X.sectionIndex,Sp(X,P,x,i,d,Z));for(const pe of ie){const Be=new Qu;Be.text=pe[0],Be.sectionIndex=pe[1],Be.sections=X.sections,re.push(Be)}}else re=function(ie,pe){const Be=[],ot=ie.text;let Ue=0;for(const $e of pe)Be.push(ie.substring(Ue,$e)),Ue=$e;return Ue<ot.length&&Be.push(ie.substring(Ue,ot.length)),Be}(X,Sp(X,P,x,i,d,Z));const de=[],V={positionedLines:de,text:X.toString(),top:O[1],bottom:O[1],left:O[0],right:O[0],writingMode:L,iconsInText:!1,verticalizable:!1};return function(ie,pe,Be,ot,Ue,$e,ft,at,pt,Qe,kt,Xt){let $t=0,Ut=0,Di=0,Gn=0;const ur=at==="right"?1:at==="left"?0:.5,Vr=Xn/Xt;let Ta=0;for(const wn of Ue){wn.trim();const yr=wn.getMaxScale(),vr={positionedGlyphs:[],lineOffset:0};ie.positionedLines[Ta]=vr;const Er=vr.positionedGlyphs;let ca=0;if(!wn.length()){Ut+=$e,++Ta;continue}const La=ig(ot,wn,Vr);for(let br=0;br<wn.length();br++){const Sn=wn.getSection(br),ir=wn.getSectionIndex(br),nr=wn.getCharCode(br),_n=gv(pt,kt,nr);let Tn;if(Sn.imageName){if(ie.iconsInText=!0,Sn.scale=Sn.scale*Vr,Tn=yv(Sn,_n,yr,La,ot),!Tn)continue;ca=Math.max(ca,Tn.imageOffset)}else if(Tn=_v(Sn,nr,_n,La,pe,Be),!Tn)continue;const{rect:Ks,metrics:cl,baselineOffset:Io}=Tn;Er.push({glyph:nr,imageName:Sn.imageName,x:$t,y:Ut+Io+md,vertical:_n,scale:Sn.scale,fontStack:Sn.fontStack,sectionIndex:ir,metrics:cl,rect:Ks}),_n?(ie.verticalizable=!0,$t+=(Sn.imageName?cl.advance:Xn)*Sn.scale+Qe):$t+=cl.advance*Sn.scale+Qe}Er.length!==0&&(Di=Math.max($t-Qe,Di),I_(Er,0,Er.length-1,ur)),$t=0,vr.lineOffset=Math.max(ca,(yr-1)*Xn);const zn=$e*yr+ca;Ut+=zn,Gn=Math.max(zn,Gn),++Ta}const{horizontalAlign:Ba,verticalAlign:Zr}=Tp(ft);(function(wn,yr,vr,Er,ca,La,zn,br,Sn){const ir=(yr-vr)*ca;let nr=0;nr=La!==zn?-br*Er-md:-Er*Sn*zn+.5*zn;for(const _n of wn)for(const Tn of _n.positionedGlyphs)Tn.x+=ir,Tn.y+=nr})(ie.positionedLines,ur,Ba,Zr,Di,Gn,$e,Ut,Ue.length),ie.top+=-Zr*Ut,ie.bottom=ie.top+Ut,ie.left+=-Ba*Di,ie.right=ie.left+Di}(V,i,l,d,re,w,M,C,L,P,j,H),!function(ie){for(const pe of ie)if(pe.positionedGlyphs.length!==0)return!1;return!0}(de)&&V}const bf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},A_={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},mv={40:!0};function nc(o,i,l,d,g,x){if(i.imageName){const w=d[i.imageName];return w?w.displaySize[0]*i.scale*Xn/x+g:0}{const w=l[i.fontStack],M=w&&w[o];return M?M.metrics.advance*i.scale+g:0}}function xf(o,i,l,d){const g=Math.pow(o-i,2);return d?o<i?g/2:2*g:g+Math.abs(l)*l}function eg(o,i,l){let d=0;return o===10&&(d-=1e4),l&&(d+=150),o!==40&&o!==65288||(d+=50),i!==41&&i!==65289||(d+=50),d}function Ju(o,i,l,d,g,x){let w=null,M=xf(i,l,g,x);for(const C of d){const P=xf(i-C.x,l,g,x)+C.badness;P<=M&&(w=C,M=P)}return{index:o,x:i,priorBreak:w,badness:M}}function tg(o){return o?tg(o.priorBreak).concat(o.index):[]}function Sp(o,i,l,d,g,x){if(!o)return[];const w=[],M=function(L,j,Z,H,X,re){let ue=0;for(let ve=0;ve<L.length();ve++){const de=L.getSection(ve);ue+=nc(L.getCharCode(ve),de,H,X,j,re)}return ue/Math.max(1,Math.ceil(ue/Z))}(o,i,l,d,g,x),C=o.text.indexOf("")>=0;let P=0;for(let L=0;L<o.length();L++){const j=o.getSection(L),Z=o.getCharCode(L);if(bf[Z]||(P+=nc(Z,j,d,g,i,x)),L<o.length()-1){const H=!((O=Z)<11904)&&(!!Mi["CJK Compatibility Forms"](O)||!!Mi["CJK Compatibility"](O)||!!Mi["CJK Strokes"](O)||!!Mi["CJK Symbols and Punctuation"](O)||!!Mi["Enclosed CJK Letters and Months"](O)||!!Mi["Halfwidth and Fullwidth Forms"](O)||!!Mi["Ideographic Description Characters"](O)||!!Mi["Vertical Forms"](O)||td.test(String.fromCodePoint(O)));(A_[Z]||H||j.imageName||L!==o.length()-2&&mv[o.getCharCode(L+1)])&&w.push(Ju(L+1,P,M,w,eg(Z,o.getCharCode(L+1),H&&C),!1))}}var O;return tg(Ju(o.length(),P,M,w,0,!0))}function Tp(o){let i=.5,l=.5;switch(o){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:i,verticalAlign:l}}function ig(o,i,l){const d=i.getMaxScale()*Xn,{maxImageWidth:g,maxImageHeight:x}=i.getMaxImageSize(o),w=Math.max(d,x*l);return{verticalLineContentWidth:Math.max(d,g*l),horizontalLineContentHeight:w}}function Ep(o){switch(o){case"top":return 0;case"center":return .5;default:return 1}}function gv(o,i,l){return!(o===S.ah.horizontal||!i&&!kc(l)||i&&(bf[l]||(d=l,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(d)))));var d}function _v(o,i,l,d,g,x){const w=x[o.fontStack],M=function(P,O,L,j){if(P&&P.rect)return P;const Z=O[L.fontStack],H=Z&&Z[j];return H?{rect:null,metrics:H.metrics}:null}(w&&w[i],g,o,i);if(M===null)return null;let C;if(l)C=d.verticalLineContentWidth-o.scale*Xn;else{const P=Ep(o.verticalAlign);C=(d.horizontalLineContentHeight-o.scale*Xn)*P}return{rect:M.rect,metrics:M.metrics,baselineOffset:C}}function yv(o,i,l,d,g){const x=g[o.imageName];if(!x)return null;const w=x.paddedRect,M=x.displaySize,C={width:M[0],height:M[1],left:oa,top:-3,advance:i?M[1]:M[0]};let P;if(i)P=d.verticalLineContentWidth-M[1]*o.scale;else{const O=Ep(o.verticalAlign);P=(d.horizontalLineContentHeight-M[1]*o.scale)*O}return{rect:w,metrics:C,baselineOffset:P,imageOffset:(i?M[0]:M[1])*o.scale-Xn*l}}function I_(o,i,l,d){if(d===0)return;const g=o[l],x=(o[l].x+g.metrics.advance*g.scale)*d;for(let w=i;w<=l;w++)o[w].x-=x}function C_(o,i,l){const{horizontalAlign:d,verticalAlign:g}=Tp(l),x=i[0]-o.displaySize[0]*d,w=i[1]-o.displaySize[1]*g;return{image:o,top:w,bottom:w+o.displaySize[1],left:x,right:x+o.displaySize[0]}}function eh(o){var i,l;let d=o.left,g=o.top,x=o.right-d,w=o.bottom-g;const M=(i=o.image.textFitWidth)!==null&&i!==void 0?i:"stretchOrShrink",C=(l=o.image.textFitHeight)!==null&&l!==void 0?l:"stretchOrShrink",P=(o.image.content[2]-o.image.content[0])/(o.image.content[3]-o.image.content[1]);if(C==="proportional"){if(M==="stretchOnly"&&x/w<P||M==="proportional"){const O=Math.ceil(w*P);d*=O/x,x=O}}else if(M==="proportional"&&C==="stretchOnly"&&P!==0&&x/w>P){const O=Math.ceil(x/P);g*=O/w,w=O}return{x1:d,y1:g,x2:d+x,y2:g+w}}function wf(o,i,l,d,g,x){const w=o.image;let M;if(w.content){const re=w.content,ue=w.pixelRatio||1;M=[re[0]/ue,re[1]/ue,w.displaySize[0]-re[2]/ue,w.displaySize[1]-re[3]/ue]}const C=i.left*x,P=i.right*x;let O,L,j,Z;l==="width"||l==="both"?(Z=g[0]+C-d[3],L=g[0]+P+d[1]):(Z=g[0]+(C+P-w.displaySize[0])/2,L=Z+w.displaySize[0]);const H=i.top*x,X=i.bottom*x;return l==="height"||l==="both"?(O=g[1]+H-d[0],j=g[1]+X+d[2]):(O=g[1]+(H+X-w.displaySize[1])/2,j=O+w.displaySize[1]),{image:w,top:O,right:L,bottom:j,left:Z,collisionPadding:M}}const gd=255,Ao=128,rc=gd*Ao;function ng(o,i){const{expression:l}=i;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new fn(o+1))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:d,interpolationType:g}=l;let x=0;for(;x<d.length&&d[x]<=o;)x++;x=Math.max(0,x-1);let w=x;for(;w<d.length&&d[w]<o+1;)w++;w=Math.min(d.length-1,w);const M=d[x],C=d[w];return l.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:C,interpolationType:g}:{kind:"camera",minZoom:M,maxZoom:C,minSize:l.evaluate(new fn(M)),maxSize:l.evaluate(new fn(C)),interpolationType:g}}}function Mp(o,i,l){let d="never";const g=o.get(i);return g?d=g:o.get(l)&&(d="always"),d}const D_=od.VectorTileFeature.types,Ap=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Sf(o,i,l,d,g,x,w,M,C,P,O,L,j){const Z=M?Math.min(rc,Math.round(M[0])):0,H=M?Math.min(rc,Math.round(M[1])):0;o.emplaceBack(i,l,Math.round(32*d),Math.round(32*g),x,w,(Z<<1)+(C?1:0),H,16*P,16*O,256*L,256*j)}function Ip(o,i,l){o.emplaceBack(i.x,i.y,l),o.emplaceBack(i.x,i.y,l),o.emplaceBack(i.x,i.y,l),o.emplaceBack(i.x,i.y,l)}function Pn(o){for(const i of o.sections)if(ku(i.text))return!0;return!1}class Tf{constructor(i){this.layoutVertexArray=new Xe,this.indexArray=new it,this.programConfigurations=i,this.segments=new vi,this.dynamicLayoutVertexArray=new We,this.opacityVertexArray=new He,this.hasVisibleVertices=!1,this.placedSymbolArray=new F}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(i,l,d,g){this.isEmpty()||(d&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Zc.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,hd.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,Ap,!0),this.opacityVertexBuffer.itemSize=1),(d||g)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Rt("SymbolBuffers",Tf);class rg{constructor(i,l,d){this.layoutVertexArray=new i,this.layoutAttributes=l,this.indexArray=new d,this.segments=new vi,this.collisionVertexArray=new mt}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,Wm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Rt("CollisionBuffers",rg);class th{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(w=>w.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ng(this.zoom,l["text-size"]),this.iconSizeData=ng(this.zoom,l["icon-size"]);const d=this.layers[0].layout,g=d.get("symbol-sort-key"),x=d.get("symbol-z-order");this.canOverlap=Mp(d,"text-overlap","text-allow-overlap")!=="never"||Mp(d,"icon-overlap","icon-allow-overlap")!=="never"||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,d.get("symbol-placement")==="point"&&(this.writingModes=d.get("text-writing-mode").map(w=>S.ah[w])),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.sourceID=i.sourceID}createArrays(){this.text=new Tf(new Gs(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new Tf(new Gs(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new Y,this.lineVertexArray=new Q,this.symbolInstances=new N,this.textAnchorOffsets=new ae}calculateGlyphDependencies(i,l,d,g,x){for(let w=0;w<i.length;w++)if(l[i.charCodeAt(w)]=!0,(d||g)&&x){const M=Mo[i.charAt(w)];M&&(l[M.charCodeAt(0)]=!0)}}populate(i,l,d){const g=this.layers[0],x=g.layout,w=x.get("text-font"),M=x.get("text-field"),C=x.get("icon-image"),P=(M.value.kind!=="constant"||M.value.value instanceof Hr&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),O=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,L=x.get("symbol-sort-key");if(this.features=[],!P&&!O)return;const j=l.iconDependencies,Z=l.glyphDependencies,H=l.availableImages,X=new fn(this.zoom);for(const{feature:re,id:ue,index:ve,sourceLayerIndex:de}of i){const V=g._featureFilter.needGeometry,ie=gs(re,V);if(!g._featureFilter.filter(X,ie,d))continue;let pe,Be;if(V||(ie.geometry=Ya(re)),P){const Ue=g.getValueAndResolveTokens("text-field",ie,d,H),$e=Hr.factory(Ue),ft=this.hasRTLText=this.hasRTLText||Pn($e);(!ft||Ns.getRTLTextPluginStatus()==="unavailable"||ft&&Ns.isParsed())&&(pe=Gc($e,g,ie))}if(O){const Ue=g.getValueAndResolveTokens("icon-image",ie,d,H);Be=Ue instanceof Yr?Ue:Yr.fromString(Ue)}if(!pe&&!Be)continue;const ot=this.sortFeaturesByKey?L.evaluate(ie,{},d):void 0;if(this.features.push({id:ue,text:pe,icon:Be,index:ve,sourceLayerIndex:de,geometry:ie.geometry,properties:re.properties,type:D_[re.type],sortKey:ot}),Be&&(j[Be.name]=!0),pe){const Ue=w.evaluate(ie,{},d).join(","),$e=x.get("text-rotation-alignment")!=="viewport"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(S.ah.vertical)>=0;for(const ft of pe.sections)if(ft.image)j[ft.image.name]=!0;else{const at=Fs(pe.toString()),pt=ft.fontStack||Ue,Qe=Z[pt]=Z[pt]||{};this.calculateGlyphDependencies(ft.text,Qe,$e,this.allowVerticalPlacement,at)}}}x.get("symbol-placement")==="line"&&(this.features=function(re){const ue={},ve={},de=[];let V=0;function ie(Ue){de.push(re[Ue]),V++}function pe(Ue,$e,ft){const at=ve[Ue];return delete ve[Ue],ve[$e]=at,de[at].geometry[0].pop(),de[at].geometry[0]=de[at].geometry[0].concat(ft[0]),at}function Be(Ue,$e,ft){const at=ue[$e];return delete ue[$e],ue[Ue]=at,de[at].geometry[0].shift(),de[at].geometry[0]=ft[0].concat(de[at].geometry[0]),at}function ot(Ue,$e,ft){const at=ft?$e[0][$e[0].length-1]:$e[0][0];return`${Ue}:${at.x}:${at.y}`}for(let Ue=0;Ue<re.length;Ue++){const $e=re[Ue],ft=$e.geometry,at=$e.text?$e.text.toString():null;if(!at){ie(Ue);continue}const pt=ot(at,ft),Qe=ot(at,ft,!0);if(pt in ve&&Qe in ue&&ve[pt]!==ue[Qe]){const kt=Be(pt,Qe,ft),Xt=pe(pt,Qe,de[kt].geometry);delete ue[pt],delete ve[Qe],ve[ot(at,de[Xt].geometry,!0)]=Xt,de[kt].geometry=null}else pt in ve?pe(pt,Qe,ft):Qe in ue?Be(pt,Qe,ft):(ie(Ue),ue[pt]=V-1,ve[Qe]=V-1)}return de.filter(Ue=>Ue.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((re,ue)=>re.sortKey-ue.sortKey)}update(i,l,d){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,l,this.layers,d),this.icon.programConfigurations.updatePaintArrays(i,l,this.layers,d))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,l){const d=this.lineVertexArray.length;if(i.segment!==void 0){let g=i.dist(l[i.segment+1]),x=i.dist(l[i.segment]);const w={};for(let M=i.segment+1;M<l.length;M++)w[M]={x:l[M].x,y:l[M].y,tileUnitDistanceFromAnchor:g},M<l.length-1&&(g+=l[M+1].dist(l[M]));for(let M=i.segment||0;M>=0;M--)w[M]={x:l[M].x,y:l[M].y,tileUnitDistanceFromAnchor:x},M>0&&(x+=l[M-1].dist(l[M]));for(let M=0;M<l.length;M++){const C=w[M];this.lineVertexArray.emplaceBack(C.x,C.y,C.tileUnitDistanceFromAnchor)}}return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(i,l,d,g,x,w,M,C,P,O,L,j){const Z=i.indexArray,H=i.layoutVertexArray,X=i.segments.prepareSegment(4*l.length,H,Z,this.canOverlap?w.sortKey:void 0),re=this.glyphOffsetArray.length,ue=X.vertexLength,ve=this.allowVerticalPlacement&&M===S.ah.vertical?Math.PI/2:0,de=w.text&&w.text.sections;for(let V=0;V<l.length;V++){const{tl:ie,tr:pe,bl:Be,br:ot,tex:Ue,pixelOffsetTL:$e,pixelOffsetBR:ft,minFontScaleX:at,minFontScaleY:pt,glyphOffset:Qe,isSDF:kt,sectionIndex:Xt}=l[V],$t=X.vertexLength,Ut=Qe[1];Sf(H,C.x,C.y,ie.x,Ut+ie.y,Ue.x,Ue.y,d,kt,$e.x,$e.y,at,pt),Sf(H,C.x,C.y,pe.x,Ut+pe.y,Ue.x+Ue.w,Ue.y,d,kt,ft.x,$e.y,at,pt),Sf(H,C.x,C.y,Be.x,Ut+Be.y,Ue.x,Ue.y+Ue.h,d,kt,$e.x,ft.y,at,pt),Sf(H,C.x,C.y,ot.x,Ut+ot.y,Ue.x+Ue.w,Ue.y+Ue.h,d,kt,ft.x,ft.y,at,pt),Ip(i.dynamicLayoutVertexArray,C,ve),Z.emplaceBack($t,$t+2,$t+1),Z.emplaceBack($t+1,$t+2,$t+3),X.vertexLength+=4,X.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Qe[0]),V!==l.length-1&&Xt===l[V+1].sectionIndex||i.programConfigurations.populatePaintArrays(H.length,w,w.index,{},j,de&&de[Xt])}i.placedSymbolArray.emplaceBack(C.x,C.y,re,this.glyphOffsetArray.length-re,ue,P,O,C.segment,d?d[0]:0,d?d[1]:0,g[0],g[1],M,0,!1,0,L)}_addCollisionDebugVertex(i,l,d,g,x,w){return l.emplaceBack(0,0),i.emplaceBack(d.x,d.y,g,x,Math.round(w.x),Math.round(w.y))}addCollisionDebugVertices(i,l,d,g,x,w,M){const C=x.segments.prepareSegment(4,x.layoutVertexArray,x.indexArray),P=C.vertexLength,O=x.layoutVertexArray,L=x.collisionVertexArray,j=M.anchorX,Z=M.anchorY;this._addCollisionDebugVertex(O,L,w,j,Z,new le(i,l)),this._addCollisionDebugVertex(O,L,w,j,Z,new le(d,l)),this._addCollisionDebugVertex(O,L,w,j,Z,new le(d,g)),this._addCollisionDebugVertex(O,L,w,j,Z,new le(i,g)),C.vertexLength+=4;const H=x.indexArray;H.emplaceBack(P,P+1),H.emplaceBack(P+1,P+2),H.emplaceBack(P+2,P+3),H.emplaceBack(P+3,P),C.primitiveLength+=4}addDebugCollisionBoxes(i,l,d,g){for(let x=i;x<l;x++){const w=this.collisionBoxArray.get(x);this.addCollisionDebugVertices(w.x1,w.y1,w.x2,w.y2,g?this.textCollisionBox:this.iconCollisionBox,w.anchorPoint,d)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new rg(gt,ol.members,Lt),this.iconCollisionBox=new rg(gt,ol.members,Lt);for(let i=0;i<this.symbolInstances.length;i++){const l=this.symbolInstances.get(i);this.addDebugCollisionBoxes(l.textBoxStartIndex,l.textBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.iconBoxStartIndex,l.iconBoxEndIndex,l,!1),this.addDebugCollisionBoxes(l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l,!1)}}_deserializeCollisionBoxesForSymbol(i,l,d,g,x,w,M,C,P){const O={};for(let L=l;L<d;L++){const j=i.get(L);O.textBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},O.textFeatureIndex=j.featureIndex;break}for(let L=g;L<x;L++){const j=i.get(L);O.verticalTextBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},O.verticalTextFeatureIndex=j.featureIndex;break}for(let L=w;L<M;L++){const j=i.get(L);O.iconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},O.iconFeatureIndex=j.featureIndex;break}for(let L=C;L<P;L++){const j=i.get(L);O.verticalIconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},O.verticalIconFeatureIndex=j.featureIndex;break}return O}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const d=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,l){const d=i.placedSymbolArray.get(l),g=d.vertexStartIndex+4*d.numGlyphs;for(let x=d.vertexStartIndex;x<g;x+=4)i.indexArray.emplaceBack(x,x+2,x+1),i.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(i),d=Math.cos(i),g=[],x=[],w=[];for(let M=0;M<this.symbolInstances.length;++M){w.push(M);const C=this.symbolInstances.get(M);g.push(0|Math.round(l*C.anchorX+d*C.anchorY)),x.push(C.featureIndex)}return w.sort((M,C)=>g[M]-g[C]||x[C]-x[M]),w}addToSortKeyRanges(i,l){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===l?d.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const d=this.symbolInstances.get(l);this.featureSortOrder.push(d.featureIndex),[d.rightJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.leftJustifiedTextSymbolIndex].forEach((g,x,w)=>{g>=0&&w.indexOf(g)===x&&this.addIndicesForPlacedSymbol(this.text,g)}),d.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,d.verticalPlacedTextSymbolIndex),d.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.placedIconSymbolIndex),d.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let R_,P_;Rt("SymbolBucket",th,{omit:["layers","collisionBoxArray","features","compareText"]}),th.MAX_GLYPHS=65535,th.addDynamicAttributes=Ip;var ag={get paint(){return P_=P_||new Fr({"icon-opacity":new qt($.paint_symbol["icon-opacity"]),"icon-color":new qt($.paint_symbol["icon-color"]),"icon-halo-color":new qt($.paint_symbol["icon-halo-color"]),"icon-halo-width":new qt($.paint_symbol["icon-halo-width"]),"icon-halo-blur":new qt($.paint_symbol["icon-halo-blur"]),"icon-translate":new Nt($.paint_symbol["icon-translate"]),"icon-translate-anchor":new Nt($.paint_symbol["icon-translate-anchor"]),"text-opacity":new qt($.paint_symbol["text-opacity"]),"text-color":new qt($.paint_symbol["text-color"],{runtimeType:ii,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new qt($.paint_symbol["text-halo-color"]),"text-halo-width":new qt($.paint_symbol["text-halo-width"]),"text-halo-blur":new qt($.paint_symbol["text-halo-blur"]),"text-translate":new Nt($.paint_symbol["text-translate"]),"text-translate-anchor":new Nt($.paint_symbol["text-translate-anchor"])})},get layout(){return R_=R_||new Fr({"symbol-placement":new Nt($.layout_symbol["symbol-placement"]),"symbol-spacing":new Nt($.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Nt($.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new qt($.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Nt($.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Nt($.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Nt($.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Nt($.layout_symbol["icon-ignore-placement"]),"icon-optional":new Nt($.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Nt($.layout_symbol["icon-rotation-alignment"]),"icon-size":new qt($.layout_symbol["icon-size"]),"icon-text-fit":new Nt($.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Nt($.layout_symbol["icon-text-fit-padding"]),"icon-image":new qt($.layout_symbol["icon-image"]),"icon-rotate":new qt($.layout_symbol["icon-rotate"]),"icon-padding":new qt($.layout_symbol["icon-padding"]),"icon-keep-upright":new Nt($.layout_symbol["icon-keep-upright"]),"icon-offset":new qt($.layout_symbol["icon-offset"]),"icon-anchor":new qt($.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Nt($.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Nt($.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Nt($.layout_symbol["text-rotation-alignment"]),"text-field":new qt($.layout_symbol["text-field"]),"text-font":new qt($.layout_symbol["text-font"]),"text-size":new qt($.layout_symbol["text-size"]),"text-max-width":new qt($.layout_symbol["text-max-width"]),"text-line-height":new Nt($.layout_symbol["text-line-height"]),"text-letter-spacing":new qt($.layout_symbol["text-letter-spacing"]),"text-justify":new qt($.layout_symbol["text-justify"]),"text-radial-offset":new qt($.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Nt($.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new qt($.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new qt($.layout_symbol["text-anchor"]),"text-max-angle":new Nt($.layout_symbol["text-max-angle"]),"text-writing-mode":new Nt($.layout_symbol["text-writing-mode"]),"text-rotate":new qt($.layout_symbol["text-rotate"]),"text-padding":new Nt($.layout_symbol["text-padding"]),"text-keep-upright":new Nt($.layout_symbol["text-keep-upright"]),"text-transform":new qt($.layout_symbol["text-transform"]),"text-offset":new qt($.layout_symbol["text-offset"]),"text-allow-overlap":new Nt($.layout_symbol["text-allow-overlap"]),"text-overlap":new Nt($.layout_symbol["text-overlap"]),"text-ignore-placement":new Nt($.layout_symbol["text-ignore-placement"]),"text-optional":new Nt($.layout_symbol["text-optional"])})}};class Ef{constructor(i){if(i.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=i.property.overrides?i.property.overrides.runtimeType:ki,this.defaultValue=i}evaluate(i){if(i.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(i.formattedSection))return l.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Rt("FormatSectionOverride",Ef,{omit:["defaultValue"]});class ac extends Nr{constructor(i){super(i,ag)}recalculate(i,l){if(super.recalculate(i,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const d=this.layout.get("text-writing-mode");if(d){const g=[];for(const x of d)g.indexOf(x)<0&&g.push(x);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(i,l,d,g){const x=this.layout.get(i).evaluate(l,{},d,g),w=this._unevaluatedLayout._values[i];return w.isDataDriven()||Vo(w.value)||!x?x:function(M,C){return C.replace(/{([^{}]+)}/g,(P,O)=>M&&O in M?String(M[O]):"")}(l.properties,x)}createBucket(i){return new th(i)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const i of ag.paint.overridableProperties){if(!ac.hasPaintOverride(this.layout,i))continue;const l=this.paint.get(i),d=new Ef(l),g=new Fl(d,l.property.specification);let x=null;x=l.value.kind==="constant"||l.value.kind==="source"?new Wd("source",g):new na("composite",g,l.value.zoomStops),this.paint._values[i]=new qa(l.property,x,l.parameters)}}_handleOverridablePaintPropertyUpdate(i,l,d){return!(!this.layout||l.isDataDriven()||d.isDataDriven())&&ac.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,l){const d=i.get("text-field"),g=ag.paint.properties[l];let x=!1;const w=M=>{for(const C of M)if(g.overrides&&g.overrides.hasOverride(C))return void(x=!0)};if(d.value.kind==="constant"&&d.value.value instanceof Hr)w(d.value.value.sections);else if(d.value.kind==="source"){const M=P=>{x||(P instanceof oo&&vn(P.value)===Xi?w(P.value.sections):P instanceof Sc?w(P.sections):P.eachChild(M))},C=d.value;C._styleExpression&&M(C._styleExpression.expression)}return x}}let Cp;var Dp={get paint(){return Cp=Cp||new Fr({"background-color":new Nt($.paint_background["background-color"]),"background-pattern":new id($.paint_background["background-pattern"]),"background-opacity":new Nt($.paint_background["background-opacity"])})}};class sg extends Nr{constructor(i){super(i,Dp)}}let Hc;var ll={get paint(){return Hc=Hc||new Fr({"raster-opacity":new Nt($.paint_raster["raster-opacity"]),"raster-hue-rotate":new Nt($.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Nt($.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Nt($.paint_raster["raster-brightness-max"]),"raster-saturation":new Nt($.paint_raster["raster-saturation"]),"raster-contrast":new Nt($.paint_raster["raster-contrast"]),"raster-resampling":new Nt($.paint_raster["raster-resampling"]),"raster-fade-duration":new Nt($.paint_raster["raster-fade-duration"])})}};class Mf extends Nr{constructor(i){super(i,ll)}}class vv extends Nr{constructor(i){super(i,{}),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=i}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class z_{constructor(i){this._methodToThrottle=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const k_={once:!0},Rp=63710088e-1;class sc{constructor(i,l){if(isNaN(i)||isNaN(l))throw new Error(`Invalid LngLat object: (${i}, ${l})`);if(this.lng=+i,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new sc(Zt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const l=Math.PI/180,d=this.lat*l,g=i.lat*l,x=Math.sin(d)*Math.sin(g)+Math.cos(d)*Math.cos(g)*Math.cos((i.lng-this.lng)*l);return Rp*Math.acos(Math.min(x,1))}static convert(i){if(i instanceof sc)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new sc(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new sc(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const O_=2*Math.PI*Rp;function Pp(o){return O_*Math.cos(o*Math.PI/180)}function og(o){return(180+o)/360}function lg(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function B_(o,i){return o/Pp(i)}function Af(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function zp(o,i){return o*Pp(Af(i))}class If{constructor(i,l,d=0){this.x=+i,this.y=+l,this.z=+d}static fromLngLat(i,l=0){const d=sc.convert(i);return new If(og(d.lng),lg(d.lat),B_(l,d.lat))}toLngLat(){return new sc(360*this.x-180,Af(this.y))}toAltitude(){return zp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/O_*(i=Af(this.y),1/Math.cos(i*Math.PI/180));var i}}function L_(o,i,l){var d=2*Math.PI*6378137/256/Math.pow(2,l);return[o*d-2*Math.PI*6378137/2,i*d-2*Math.PI*6378137/2]}class ih{constructor(i,l,d){if(!function(g,x,w){return!(g<0||g>25||w<0||w>=Math.pow(2,g)||x<0||x>=Math.pow(2,g))}(i,l,d))throw new Error(`x=${l}, y=${d}, z=${i} outside of bounds. 0<=x<${Math.pow(2,i)}, 0<=y<${Math.pow(2,i)} 0<=z<=25 `);this.z=i,this.x=l,this.y=d,this.key=Ci(0,i,i,l,d)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,l,d){const g=(w=this.y,M=this.z,C=L_(256*(x=this.x),256*(w=Math.pow(2,M)-w-1),M),P=L_(256*(x+1),256*(w+1),M),C[0]+","+C[1]+","+P[0]+","+P[1]);var x,w,M,C,P;const O=function(L,j,Z){let H,X="";for(let re=L;re>0;re--)H=1<<re-1,X+=(j&H?1:0)+(Z&H?2:0);return X}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(d==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,l>1?"@2x":"").replace(/{quadkey}/g,O).replace(/{bbox-epsg-3857}/g,g)}isChildOf(i){const l=this.z-i.z;return l>0&&i.x===this.x>>l&&i.y===this.y>>l}getTilePoint(i){const l=Math.pow(2,this.z);return new le((i.x*l-this.x)*Ae,(i.y*l-this.y)*Ae)}toString(){return`${this.z}/${this.x}/${this.y}`}}class F_{constructor(i,l){this.wrap=i,this.canonical=l,this.key=Ci(i,l.z,l.z,l.x,l.y)}}class es{constructor(i,l,d,g,x){if(this.terrainRttPosMatrix32f=null,i<d)throw new Error(`overscaledZ should be >= z; overscaledZ = ${i}; z = ${d}`);this.overscaledZ=i,this.wrap=l,this.canonical=new ih(d,+g,+x),this.key=Ci(l,i,d,g,x)}clone(){return new es(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-i;return i>this.canonical.z?new es(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new es(i,this.wrap,i,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(i,l){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const d=this.canonical.z-i;return i>this.canonical.z?Ci(this.wrap*+l,i,this.canonical.z,this.canonical.x,this.canonical.y):Ci(this.wrap*+l,i,i,this.canonical.x>>d,this.canonical.y>>d)}isChildOf(i){if(i.wrap!==this.wrap)return!1;const l=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>l&&i.canonical.y===this.canonical.y>>l}children(i){if(this.overscaledZ>=i)return[new es(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,d=2*this.canonical.x,g=2*this.canonical.y;return[new es(l,this.wrap,l,d,g),new es(l,this.wrap,l,d+1,g),new es(l,this.wrap,l,d,g+1),new es(l,this.wrap,l,d+1,g+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new es(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new es(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new F_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new If(i.x-this.wrap,i.y))}}function Ci(o,i,l,d,g){(o*=2)<0&&(o=-1*o-1);const x=1<<l;return(x*x*o+x*g+d).toString(36)+l.toString(36)+i.toString(36)}Rt("CanonicalTileID",ih),Rt("OverscaledTileID",es,{omit:["terrainRttPosMatrix32f"]});class kp{constructor(i,l,d,g=1,x=1,w=1,M=0){if(this.uid=i,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(d&&!["mapbox","terrarium","custom"].includes(d))return void qn(`"${d}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=l.height;const C=this.dim=l.height-2;switch(this.data=new Uint32Array(l.data.buffer),d){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=g,this.greenFactor=x,this.blueFactor=w,this.baseShift=M;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let P=0;P<C;P++)this.data[this._idx(-1,P)]=this.data[this._idx(0,P)],this.data[this._idx(C,P)]=this.data[this._idx(C-1,P)],this.data[this._idx(P,-1)]=this.data[this._idx(P,0)],this.data[this._idx(P,C)]=this.data[this._idx(P,C-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(C,-1)]=this.data[this._idx(C-1,0)],this.data[this._idx(-1,C)]=this.data[this._idx(0,C-1)],this.data[this._idx(C,C)]=this.data[this._idx(C-1,C-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let P=0;P<C;P++)for(let O=0;O<C;O++){const L=this.get(P,O);L>this.max&&(this.max=L),L<this.min&&(this.min=L)}}get(i,l){const d=new Uint8Array(this.data.buffer),g=4*this._idx(i,l);return this.unpack(d[g],d[g+1],d[g+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(i,l){if(i<-1||i>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(i+1)}unpack(i,l,d){return i*this.redFactor+l*this.greenFactor+d*this.blueFactor-this.baseShift}getPixels(){return new Xa({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,l,d){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let g=l*this.dim,x=l*this.dim+this.dim,w=d*this.dim,M=d*this.dim+this.dim;switch(l){case-1:g=x-1;break;case 1:x=g+1}switch(d){case-1:w=M-1;break;case 1:M=w+1}const C=-l*this.dim,P=-d*this.dim;for(let O=w;O<M;O++)for(let L=g;L<x;L++)this.data[this._idx(L,O)]=i.data[this._idx(L+C,O+P)]}}Rt("DEMData",kp);class Cf{constructor(i){this._stringToNumber={},this._numberToString=[];for(let l=0;l<i.length;l++){const d=i[l];this._stringToNumber[d]=l,this._numberToString[l]=d}}encode(i){return this._stringToNumber[i]}decode(i){if(i>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${i} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[i]}}class Op{constructor(i,l,d,g,x){this.type="Feature",this._vectorTileFeature=i,i._z=l,i._x=d,i._y=g,this.properties=i.properties,this.id=x}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={geometry:this.geometry};for(const l in this)l!=="_geometry"&&l!=="_vectorTileFeature"&&(i[l]=this[l]);return i}}class cg{constructor(i,l){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Zl(Ae,16,0),this.grid3D=new Zl(Ae,16,0),this.featureIndexArray=new he,this.promoteId=l}insert(i,l,d,g,x,w){const M=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,g,x);const C=w?this.grid3D:this.grid;for(let P=0;P<l.length;P++){const O=l[P],L=[1/0,1/0,-1/0,-1/0];for(let j=0;j<O.length;j++){const Z=O[j];L[0]=Math.min(L[0],Z.x),L[1]=Math.min(L[1],Z.y),L[2]=Math.max(L[2],Z.x),L[3]=Math.max(L[3],Z.y)}L[0]<Ae&&L[1]<Ae&&L[2]>=0&&L[3]>=0&&C.insert(M,L[0],L[1],L[2],L[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new od.VectorTile(new dd(this.rawTileData)).layers,this.sourceLayerCoder=new Cf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(i,l,d,g){this.loadVTLayers();const x=i.params,w=Ae/i.tileSize/i.scale,M=Cu(x.filter),C=i.queryGeometry,P=i.queryPadding*w,O=_d(C),L=this.grid.query(O.minX-P,O.minY-P,O.maxX+P,O.maxY+P),j=_d(i.cameraQueryGeometry),Z=this.grid3D.query(j.minX-P,j.minY-P,j.maxX+P,j.maxY+P,(re,ue,ve,de)=>function(V,ie,pe,Be,ot){for(const $e of V)if(ie<=$e.x&&pe<=$e.y&&Be>=$e.x&&ot>=$e.y)return!0;const Ue=[new le(ie,pe),new le(ie,ot),new le(Be,ot),new le(Be,pe)];if(V.length>2){for(const $e of Ue)if(Yn(V,$e))return!0}for(let $e=0;$e<V.length-1;$e++)if(lp(V[$e],V[$e+1],Ue))return!0;return!1}(i.cameraQueryGeometry,re-P,ue-P,ve+P,de+P));for(const re of Z)L.push(re);L.sort(Lp);const H={};let X;for(let re=0;re<L.length;re++){const ue=L[re];if(ue===X)continue;X=ue;const ve=this.featureIndexArray.get(ue);let de=null;this.loadMatchingFeature(H,ve.bucketIndex,ve.sourceLayerIndex,ve.featureIndex,M,x.layers,x.availableImages,l,d,g,(V,ie,pe)=>(de||(de=Ya(V)),ie.queryIntersectsFeature({queryGeometry:C,feature:V,featureState:pe,geometry:de,zoom:this.z,transform:i.transform,pixelsToTileUnits:w,pixelPosMatrix:i.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:i.getElevation})))}return H}loadMatchingFeature(i,l,d,g,x,w,M,C,P,O,L){const j=this.bucketLayerIDs[l];if(w&&!j.some(re=>w.has(re)))return;const Z=this.sourceLayerCoder.decode(d),H=this.vtLayers[Z].feature(g);if(x.needGeometry){const re=gs(H,!0);if(!x.filter(new fn(this.tileID.overscaledZ),re,this.tileID.canonical))return}else if(!x.filter(new fn(this.tileID.overscaledZ),H))return;const X=this.getId(H,Z);for(let re=0;re<j.length;re++){const ue=j[re];if(w&&!w.has(ue))continue;const ve=C[ue];if(!ve)continue;let de={};X&&O&&(de=O.getState(ve.sourceLayer||"_geojsonTileLayer",X));const V=ti({},P[ue]);V.paint=Bp(V.paint,ve.paint,H,de,M),V.layout=Bp(V.layout,ve.layout,H,de,M);const ie=!L||L(H,ve,de);if(!ie)continue;const pe=new Op(H,this.z,this.x,this.y,X);pe.layer=V;let Be=i[ue];Be===void 0&&(Be=i[ue]=[]),Be.push({featureIndex:g,feature:pe,intersectionZ:ie})}}lookupSymbolFeatures(i,l,d,g,x,w,M,C){const P={};this.loadVTLayers();const O=Cu(x);for(const L of i)this.loadMatchingFeature(P,d,g,L,O,w,M,C,l);return P}hasLayer(i){for(const l of this.bucketLayerIDs)for(const d of l)if(i===d)return!0;return!1}getId(i,l){var d;let g=i.id;return this.promoteId&&(g=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[l]],typeof g=="boolean"&&(g=Number(g)),g===void 0&&(!((d=i.properties)===null||d===void 0)&&d.cluster)&&this.promoteId&&(g=Number(i.properties.cluster_id))),g}}function Bp(o,i,l,d,g){return ar(o,(x,w)=>{const M=i instanceof Hl?i.get(w):null;return M&&M.evaluate?M.evaluate(l,d,g):M})}function _d(o){let i=1/0,l=1/0,d=-1/0,g=-1/0;for(const x of o)i=Math.min(i,x.x),l=Math.min(l,x.y),d=Math.max(d,x.x),g=Math.max(g,x.y);return{minX:i,minY:l,maxX:d,maxY:g}}function Lp(o,i){return i-o}function nh(o,i,l,d,g){const x=[];for(let w=0;w<o.length;w++){const M=o[w];let C;for(let P=0;P<M.length-1;P++){let O=M[P],L=M[P+1];O.x<i&&L.x<i||(O.x<i?O=new le(i,O.y+(i-O.x)/(L.x-O.x)*(L.y-O.y))._round():L.x<i&&(L=new le(i,O.y+(i-O.x)/(L.x-O.x)*(L.y-O.y))._round()),O.y<l&&L.y<l||(O.y<l?O=new le(O.x+(l-O.y)/(L.y-O.y)*(L.x-O.x),l)._round():L.y<l&&(L=new le(O.x+(l-O.y)/(L.y-O.y)*(L.x-O.x),l)._round()),O.x>=d&&L.x>=d||(O.x>=d?O=new le(d,O.y+(d-O.x)/(L.x-O.x)*(L.y-O.y))._round():L.x>=d&&(L=new le(d,O.y+(d-O.x)/(L.x-O.x)*(L.y-O.y))._round()),O.y>=g&&L.y>=g||(O.y>=g?O=new le(O.x+(g-O.y)/(L.y-O.y)*(L.x-O.x),g)._round():L.y>=g&&(L=new le(O.x+(g-O.y)/(L.y-O.y)*(L.x-O.x),g)._round()),C&&O.equals(C[C.length-1])||(C=[O],x.push(C)),C.push(L)))))}}return x}Rt("FeatureIndex",cg,{omit:["rawTileData","sourceLayerCoder"]});class oc extends le{constructor(i,l,d,g){super(i,l),this.angle=d,g!==void 0&&(this.segment=g)}clone(){return new oc(this.x,this.y,this.angle,this.segment)}}function N_(o,i,l,d,g){if(i.segment===void 0||l===0)return!0;let x=i,w=i.segment+1,M=0;for(;M>-l/2;){if(w--,w<0)return!1;M-=o[w].dist(x),x=o[w]}M+=o[w].dist(o[w+1]),w++;const C=[];let P=0;for(;M<l/2;){const O=o[w],L=o[w+1];if(!L)return!1;let j=o[w-1].angleTo(O)-O.angleTo(L);for(j=Math.abs((j+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:M,angleDelta:j}),P+=j;M-C[0].distance>d;)P-=C.shift().angleDelta;if(P>g)return!1;w++,M+=O.dist(L)}return!0}function U_(o){let i=0;for(let l=0;l<o.length-1;l++)i+=o[l].dist(o[l+1]);return i}function ug(o,i,l){return o?.6*i*l:0}function hg(o,i){return Math.max(o?o.right-o.left:0,i?i.right-i.left:0)}function Fp(o,i,l,d,g,x){const w=ug(l,g,x),M=hg(l,d)*x;let C=0;const P=U_(o)/2;for(let O=0;O<o.length-1;O++){const L=o[O],j=o[O+1],Z=L.dist(j);if(C+Z>P){const H=(P-C)/Z,X=Ca.number(L.x,j.x,H),re=Ca.number(L.y,j.y,H),ue=new oc(X,re,j.angleTo(L),O);return ue._round(),!w||N_(o,ue,M,w,i)?ue:void 0}C+=Z}}function xn(o,i,l,d,g,x,w,M,C){const P=ug(d,x,w),O=hg(d,g),L=O*w,j=o[0].x===0||o[0].x===C||o[0].y===0||o[0].y===C;return i-L<i/4&&(i=L+i/4),Np(o,j?i/2*M%i:(O/2+2*x)*w*M%i,i,P,l,L,j,!1,C)}function Np(o,i,l,d,g,x,w,M,C){const P=x/2,O=U_(o);let L=0,j=i-l,Z=[];for(let H=0;H<o.length-1;H++){const X=o[H],re=o[H+1],ue=X.dist(re),ve=re.angleTo(X);for(;j+l<L+ue;){j+=l;const de=(j-L)/ue,V=Ca.number(X.x,re.x,de),ie=Ca.number(X.y,re.y,de);if(V>=0&&V<C&&ie>=0&&ie<C&&j-P>=0&&j+P<=O){const pe=new oc(V,ie,ve,H);pe._round(),d&&!N_(o,pe,x,d,g)||Z.push(pe)}}L+=ue}return M||Z.length||w||(Z=Np(o,L/2,l,d,g,x,w,!0,C)),Z}Rt("Anchor",oc);const Tr=oa;function j_(o,i,l,d){const g=[],x=o.image,w=x.pixelRatio,M=x.paddedRect.w-2*Tr,C=x.paddedRect.h-2*Tr;let P={x1:o.left,y1:o.top,x2:o.right,y2:o.bottom};const O=x.stretchX||[[0,M]],L=x.stretchY||[[0,C]],j=(Qe,kt)=>Qe+kt[1]-kt[0],Z=O.reduce(j,0),H=L.reduce(j,0),X=M-Z,re=C-H;let ue=0,ve=Z,de=0,V=H,ie=0,pe=X,Be=0,ot=re;if(x.content&&d){const Qe=x.content,kt=Qe[2]-Qe[0],Xt=Qe[3]-Qe[1];(x.textFitWidth||x.textFitHeight)&&(P=eh(o)),ue=yd(O,0,Qe[0]),de=yd(L,0,Qe[1]),ve=yd(O,Qe[0],Qe[2]),V=yd(L,Qe[1],Qe[3]),ie=Qe[0]-ue,Be=Qe[1]-de,pe=kt-ve,ot=Xt-V}const Ue=P.x1,$e=P.y1,ft=P.x2-Ue,at=P.y2-$e,pt=(Qe,kt,Xt,$t)=>{const Ut=rh(Qe.stretch-ue,ve,ft,Ue),Di=Df(Qe.fixed-ie,pe,Qe.stretch,Z),Gn=rh(kt.stretch-de,V,at,$e),ur=Df(kt.fixed-Be,ot,kt.stretch,H),Vr=rh(Xt.stretch-ue,ve,ft,Ue),Ta=Df(Xt.fixed-ie,pe,Xt.stretch,Z),Ba=rh($t.stretch-de,V,at,$e),Zr=Df($t.fixed-Be,ot,$t.stretch,H),wn=new le(Ut,Gn),yr=new le(Vr,Gn),vr=new le(Vr,Ba),Er=new le(Ut,Ba),ca=new le(Di/w,ur/w),La=new le(Ta/w,Zr/w),zn=i*Math.PI/180;if(zn){const ir=Math.sin(zn),nr=Math.cos(zn),_n=[nr,-ir,ir,nr];wn._matMult(_n),yr._matMult(_n),Er._matMult(_n),vr._matMult(_n)}const br=Qe.stretch+Qe.fixed,Sn=kt.stretch+kt.fixed;return{tl:wn,tr:yr,bl:Er,br:vr,tex:{x:x.paddedRect.x+Tr+br,y:x.paddedRect.y+Tr+Sn,w:Xt.stretch+Xt.fixed-br,h:$t.stretch+$t.fixed-Sn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ca,pixelOffsetBR:La,minFontScaleX:pe/w/ft,minFontScaleY:ot/w/at,isSDF:l}};if(d&&(x.stretchX||x.stretchY)){const Qe=Up(O,X,Z),kt=Up(L,re,H);for(let Xt=0;Xt<Qe.length-1;Xt++){const $t=Qe[Xt],Ut=Qe[Xt+1];for(let Di=0;Di<kt.length-1;Di++)g.push(pt($t,kt[Di],Ut,kt[Di+1]))}}else g.push(pt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:C+1}));return g}function yd(o,i,l){let d=0;for(const g of o)d+=Math.max(i,Math.min(l,g[1]))-Math.max(i,Math.min(l,g[0]));return d}function Up(o,i,l){const d=[{fixed:-1,stretch:0}];for(const[g,x]of o){const w=d[d.length-1];d.push({fixed:g-w.stretch,stretch:w.stretch}),d.push({fixed:g-w.stretch,stretch:w.stretch+(x-g)})}return d.push({fixed:i+Tr,stretch:l}),d}function rh(o,i,l,d){return o/i*l+d}function Df(o,i,l,d){return o-i*l/d}class Rf{constructor(i,l,d,g,x,w,M,C,P,O){var L;if(this.boxStartIndex=i.length,P){let j=w.top,Z=w.bottom;const H=w.collisionPadding;H&&(j-=H[1],Z+=H[3]);let X=Z-j;X>0&&(X=Math.max(10,X),this.circleDiameter=X)}else{const j=!((L=w.image)===null||L===void 0)&&L.content&&(w.image.textFitWidth||w.image.textFitHeight)?eh(w):{x1:w.left,y1:w.top,x2:w.right,y2:w.bottom};j.y1=j.y1*M-C[0],j.y2=j.y2*M+C[2],j.x1=j.x1*M-C[3],j.x2=j.x2*M+C[1];const Z=w.collisionPadding;if(Z&&(j.x1-=Z[0]*M,j.y1-=Z[1]*M,j.x2+=Z[2]*M,j.y2+=Z[3]*M),O){const H=new le(j.x1,j.y1),X=new le(j.x2,j.y1),re=new le(j.x1,j.y2),ue=new le(j.x2,j.y2),ve=O*Math.PI/180;H._rotate(ve),X._rotate(ve),re._rotate(ve),ue._rotate(ve),j.x1=Math.min(H.x,X.x,re.x,ue.x),j.x2=Math.max(H.x,X.x,re.x,ue.x),j.y1=Math.min(H.y,X.y,re.y,ue.y),j.y2=Math.max(H.y,X.y,re.y,ue.y)}i.emplaceBack(l.x,l.y,j.x1,j.y1,j.x2,j.y2,d,g,x)}this.boxEndIndex=i.length}}class dg{constructor(i=[],l=(d,g)=>d<g?-1:d>g?1:0){if(this.data=i,this.length=this.data.length,this.compare=l,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:l,compare:d}=this,g=l[i];for(;i>0;){const x=i-1>>1,w=l[x];if(d(g,w)>=0)break;l[i]=w,i=x}l[i]=g}_down(i){const{data:l,compare:d}=this,g=this.length>>1,x=l[i];for(;i<g;){let w=1+(i<<1);const M=w+1;if(M<this.length&&d(l[M],l[w])<0&&(w=M),d(l[w],x)>=0)break;l[i]=l[w],i=w}l[i]=x}}function fg(o,i=1,l=!1){let d=1/0,g=1/0,x=-1/0,w=-1/0;const M=o[0];for(let Z=0;Z<M.length;Z++){const H=M[Z];(!Z||H.x<d)&&(d=H.x),(!Z||H.y<g)&&(g=H.y),(!Z||H.x>x)&&(x=H.x),(!Z||H.y>w)&&(w=H.y)}const C=Math.min(x-d,w-g);let P=C/2;const O=new dg([],bv);if(C===0)return new le(d,g);for(let Z=d;Z<x;Z+=C)for(let H=g;H<w;H+=C)O.push(new ah(Z+P,H+P,P,o));let L=function(Z){let H=0,X=0,re=0;const ue=Z[0];for(let ve=0,de=ue.length,V=de-1;ve<de;V=ve++){const ie=ue[ve],pe=ue[V],Be=ie.x*pe.y-pe.x*ie.y;X+=(ie.x+pe.x)*Be,re+=(ie.y+pe.y)*Be,H+=3*Be}return new ah(X/H,re/H,0,Z)}(o),j=O.length;for(;O.length;){const Z=O.pop();(Z.d>L.d||!L.d)&&(L=Z,l&&console.log("found best %d after %d probes",Math.round(1e4*Z.d)/1e4,j)),Z.max-L.d<=i||(P=Z.h/2,O.push(new ah(Z.p.x-P,Z.p.y-P,P,o)),O.push(new ah(Z.p.x+P,Z.p.y-P,P,o)),O.push(new ah(Z.p.x-P,Z.p.y+P,P,o)),O.push(new ah(Z.p.x+P,Z.p.y+P,P,o)),j+=4)}return l&&(console.log(`num probes: ${j}`),console.log(`best distance: ${L.d}`)),L.p}function bv(o,i){return i.max-o.max}function ah(o,i,l,d){this.p=new le(o,i),this.h=l,this.d=function(g,x){let w=!1,M=1/0;for(let C=0;C<x.length;C++){const P=x[C];for(let O=0,L=P.length,j=L-1;O<L;j=O++){const Z=P[O],H=P[j];Z.y>g.y!=H.y>g.y&&g.x<(H.x-Z.x)*(g.y-Z.y)/(H.y-Z.y)+Z.x&&(w=!w),M=Math.min(M,Ql(g,Z,H))}}return(w?1:-1)*Math.sqrt(M)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}var Jr;S.ay=void 0,(Jr=S.ay||(S.ay={}))[Jr.center=1]="center",Jr[Jr.left=2]="left",Jr[Jr.right=3]="right",Jr[Jr.top=4]="top",Jr[Jr.bottom=5]="bottom",Jr[Jr["top-left"]=6]="top-left",Jr[Jr["top-right"]=7]="top-right",Jr[Jr["bottom-left"]=8]="bottom-left",Jr[Jr["bottom-right"]=9]="bottom-right";const lc=7,pg=Number.POSITIVE_INFINITY;function V_(o,i){return i[1]!==pg?function(l,d,g){let x=0,w=0;switch(d=Math.abs(d),g=Math.abs(g),l){case"top-right":case"top-left":case"top":w=g-lc;break;case"bottom-right":case"bottom-left":case"bottom":w=-g+lc}switch(l){case"top-right":case"bottom-right":case"right":x=-d;break;case"top-left":case"bottom-left":case"left":x=d}return[x,w]}(o,i[0],i[1]):function(l,d){let g=0,x=0;d<0&&(d=0);const w=d/Math.SQRT2;switch(l){case"top-right":case"top-left":x=w-lc;break;case"bottom-right":case"bottom-left":x=-w+lc;break;case"bottom":x=-d+lc;break;case"top":x=d-lc}switch(l){case"top-right":case"bottom-right":g=-w;break;case"top-left":case"bottom-left":g=w;break;case"left":g=d;break;case"right":g=-d}return[g,x]}(o,i[0])}function cc(o,i,l){var d;const g=o.layout,x=(d=g.get("text-variable-anchor-offset"))===null||d===void 0?void 0:d.evaluate(i,{},l);if(x){const M=x.values,C=[];for(let P=0;P<M.length;P+=2){const O=C[P]=M[P],L=M[P+1].map(j=>j*Xn);O.startsWith("top")?L[1]-=lc:O.startsWith("bottom")&&(L[1]+=lc),C[P+1]=L}return new Cr(C)}const w=g.get("text-variable-anchor");if(w){let M;M=o._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[g.get("text-radial-offset").evaluate(i,{},l)*Xn,pg]:g.get("text-offset").evaluate(i,{},l).map(P=>P*Xn);const C=[];for(const P of w)C.push(P,V_(P,M));return new Cr(C)}return null}function jp(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function mg(o,i,l,d,g,x,w,M,C,P,O,L){let j=x.textMaxSize.evaluate(i,{});j===void 0&&(j=w);const Z=o.layers[0].layout,H=Z.get("icon-offset").evaluate(i,{},O),X=G_(l.horizontal),re=w/24,ue=o.tilePixelRatio*re,ve=o.tilePixelRatio*j/24,de=o.tilePixelRatio*M,V=o.tilePixelRatio*Z.get("symbol-spacing"),ie=Z.get("text-padding")*o.tilePixelRatio,pe=function(Xt,$t,Ut,Di=1){const Gn=Xt.get("icon-padding").evaluate($t,{},Ut),ur=Gn&&Gn.values;return[ur[0]*Di,ur[1]*Di,ur[2]*Di,ur[3]*Di]}(Z,i,O,o.tilePixelRatio),Be=Z.get("text-max-angle")/180*Math.PI,ot=Z.get("text-rotation-alignment")!=="viewport"&&Z.get("symbol-placement")!=="point",Ue=Z.get("icon-rotation-alignment")==="map"&&Z.get("symbol-placement")!=="point",$e=Z.get("symbol-placement"),ft=V/2,at=Z.get("icon-text-fit");let pt;d&&at!=="none"&&(o.allowVerticalPlacement&&l.vertical&&(pt=wf(d,l.vertical,at,Z.get("icon-text-fit-padding"),H,re)),X&&(d=wf(d,X,at,Z.get("icon-text-fit-padding"),H,re)));const Qe=O?L.line.getGranularityForZoomLevel(O.z):1,kt=(Xt,$t)=>{$t.x<0||$t.x>=Ae||$t.y<0||$t.y>=Ae||function(Ut,Di,Gn,ur,Vr,Ta,Ba,Zr,wn,yr,vr,Er,ca,La,zn,br,Sn,ir,nr,_n,Tn,Ks,cl,Io,H_){const uc=Ut.addToLineVertexArray(Di,Gn);let Xc,bd,hc,dc,bg=0,xd=0,Zp=0,zf=0,Gp=-1,xg=-1;const Ws={};let a=js("");if(Ut.allowVerticalPlacement&&ur.vertical){const Si=Zr.layout.get("text-rotate").evaluate(Tn,{},Io)+90;hc=new Rf(wn,Di,yr,vr,Er,ur.vertical,ca,La,zn,Si),Ba&&(dc=new Rf(wn,Di,yr,vr,Er,Ba,Sn,ir,zn,Si))}if(Vr){const Si=Zr.layout.get("icon-rotate").evaluate(Tn,{}),Re=Zr.layout.get("icon-text-fit")!=="none",Ie=j_(Vr,Si,cl,Re),ke=Ba?j_(Ba,Si,cl,Re):void 0;bd=new Rf(wn,Di,yr,vr,Er,Vr,Sn,ir,!1,Si),bg=4*Ie.length;const rt=Ut.iconSizeData;let Ft=null;rt.kind==="source"?(Ft=[Ao*Zr.layout.get("icon-size").evaluate(Tn,{})],Ft[0]>rc&&qn(`${Ut.layerIds[0]}: Value for "icon-size" is >= ${gd}. Reduce your "icon-size".`)):rt.kind==="composite"&&(Ft=[Ao*Ks.compositeIconSizes[0].evaluate(Tn,{},Io),Ao*Ks.compositeIconSizes[1].evaluate(Tn,{},Io)],(Ft[0]>rc||Ft[1]>rc)&&qn(`${Ut.layerIds[0]}: Value for "icon-size" is >= ${gd}. Reduce your "icon-size".`)),Ut.addSymbols(Ut.icon,Ie,Ft,_n,nr,Tn,S.ah.none,Di,uc.lineStartIndex,uc.lineLength,-1,Io),Gp=Ut.icon.placedSymbolArray.length-1,ke&&(xd=4*ke.length,Ut.addSymbols(Ut.icon,ke,Ft,_n,nr,Tn,S.ah.vertical,Di,uc.lineStartIndex,uc.lineLength,-1,Io),xg=Ut.icon.placedSymbolArray.length-1)}const c=Object.keys(ur.horizontal);for(const Si of c){const Re=ur.horizontal[Si];if(!Xc){a=js(Re.text);const ke=Zr.layout.get("text-rotate").evaluate(Tn,{},Io);Xc=new Rf(wn,Di,yr,vr,Er,Re,ca,La,zn,ke)}const Ie=Re.positionedLines.length===1;if(Zp+=Z_(Ut,Di,Re,Ta,Zr,zn,Tn,br,uc,ur.vertical?S.ah.horizontal:S.ah.horizontalOnly,Ie?c:[Si],Ws,Gp,Ks,Io),Ie)break}ur.vertical&&(zf+=Z_(Ut,Di,ur.vertical,Ta,Zr,zn,Tn,br,uc,S.ah.vertical,["vertical"],Ws,xg,Ks,Io));const p=Xc?Xc.boxStartIndex:Ut.collisionBoxArray.length,v=Xc?Xc.boxEndIndex:Ut.collisionBoxArray.length,A=hc?hc.boxStartIndex:Ut.collisionBoxArray.length,R=hc?hc.boxEndIndex:Ut.collisionBoxArray.length,G=bd?bd.boxStartIndex:Ut.collisionBoxArray.length,ee=bd?bd.boxEndIndex:Ut.collisionBoxArray.length,_e=dc?dc.boxStartIndex:Ut.collisionBoxArray.length,Ne=dc?dc.boxEndIndex:Ut.collisionBoxArray.length;let et=-1;const dt=(Si,Re)=>Si&&Si.circleDiameter?Math.max(Si.circleDiameter,Re):Re;et=dt(Xc,et),et=dt(hc,et),et=dt(bd,et),et=dt(dc,et);const Ve=et>-1?1:0;Ve&&(et*=H_/Xn),Ut.glyphOffsetArray.length>=th.MAX_GLYPHS&&qn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Tn.sortKey!==void 0&&Ut.addToSortKeyRanges(Ut.symbolInstances.length,Tn.sortKey);const qe=cc(Zr,Tn,Io),[ui,ri]=function(Si,Re){const Ie=Si.length,ke=Re==null?void 0:Re.values;if((ke==null?void 0:ke.length)>0)for(let rt=0;rt<ke.length;rt+=2){const Ft=ke[rt+1];Si.emplaceBack(S.ay[ke[rt]],Ft[0],Ft[1])}return[Ie,Si.length]}(Ut.textAnchorOffsets,qe);Ut.symbolInstances.emplaceBack(Di.x,Di.y,Ws.right>=0?Ws.right:-1,Ws.center>=0?Ws.center:-1,Ws.left>=0?Ws.left:-1,Ws.vertical||-1,Gp,xg,a,p,v,A,R,G,ee,_e,Ne,yr,Zp,zf,bg,xd,Ve,0,ca,et,ui,ri)}(o,$t,Xt,l,d,g,pt,o.layers[0],o.collisionBoxArray,i.index,i.sourceLayerIndex,o.index,ue,[ie,ie,ie,ie],ot,C,de,pe,Ue,H,i,x,P,O,w)};if($e==="line")for(const Xt of nh(i.geometry,0,0,Ae,Ae)){const $t=ec(Xt,Qe),Ut=xn($t,V,Be,l.vertical||X,d,24,ve,o.overscaling,Ae);for(const Di of Ut)X&&gg(o,X.text,ft,Di)||kt($t,Di)}else if($e==="line-center"){for(const Xt of i.geometry)if(Xt.length>1){const $t=ec(Xt,Qe),Ut=Fp($t,Be,l.vertical||X,d,24,ve);Ut&&kt($t,Ut)}}else if(i.type==="Polygon")for(const Xt of mo(i.geometry,0)){const $t=fg(Xt,16);kt(ec(Xt[0],Qe,!0),new oc($t.x,$t.y,0))}else if(i.type==="LineString")for(const Xt of i.geometry){const $t=ec(Xt,Qe);kt($t,new oc($t[0].x,$t[0].y,0))}else if(i.type==="Point")for(const Xt of i.geometry)for(const $t of Xt)kt([$t],new oc($t.x,$t.y,0))}function Z_(o,i,l,d,g,x,w,M,C,P,O,L,j,Z,H){const X=function(ve,de,V,ie,pe,Be,ot,Ue){const $e=ie.layout.get("text-rotate").evaluate(Be,{})*Math.PI/180,ft=[];for(const at of de.positionedLines)for(const pt of at.positionedGlyphs){if(!pt.rect)continue;const Qe=pt.rect||{};let kt=pd+1,Xt=!0,$t=1,Ut=0;const Di=(pe||Ue)&&pt.vertical,Gn=pt.metrics.advance*pt.scale/2;if(Ue&&de.verticalizable&&(Ut=at.lineOffset/2-(pt.imageName?-(Xn-pt.metrics.width*pt.scale)/2:(pt.scale-1)*Xn)),pt.imageName){const ir=ot[pt.imageName];Xt=ir.sdf,$t=ir.pixelRatio,kt=oa/$t}const ur=pe?[pt.x+Gn,pt.y]:[0,0];let Vr=pe?[0,0]:[pt.x+Gn+V[0],pt.y+V[1]-Ut],Ta=[0,0];Di&&(Ta=Vr,Vr=[0,0]);const Ba=pt.metrics.isDoubleResolution?2:1,Zr=(pt.metrics.left-kt)*pt.scale-Gn+Vr[0],wn=(-pt.metrics.top-kt)*pt.scale+Vr[1],yr=Zr+Qe.w/Ba*pt.scale/$t,vr=wn+Qe.h/Ba*pt.scale/$t,Er=new le(Zr,wn),ca=new le(yr,wn),La=new le(Zr,vr),zn=new le(yr,vr);if(Di){const ir=new le(-Gn,Gn-md),nr=-Math.PI/2,_n=Xn/2-Gn,Tn=new le(5-md-_n,-(pt.imageName?_n:0)),Ks=new le(...Ta);Er._rotateAround(nr,ir)._add(Tn)._add(Ks),ca._rotateAround(nr,ir)._add(Tn)._add(Ks),La._rotateAround(nr,ir)._add(Tn)._add(Ks),zn._rotateAround(nr,ir)._add(Tn)._add(Ks)}if($e){const ir=Math.sin($e),nr=Math.cos($e),_n=[nr,-ir,ir,nr];Er._matMult(_n),ca._matMult(_n),La._matMult(_n),zn._matMult(_n)}const br=new le(0,0),Sn=new le(0,0);ft.push({tl:Er,tr:ca,bl:La,br:zn,tex:Qe,writingMode:de.writingMode,glyphOffset:ur,sectionIndex:pt.sectionIndex,isSDF:Xt,pixelOffsetTL:br,pixelOffsetBR:Sn,minFontScaleX:0,minFontScaleY:0})}return ft}(0,l,M,g,x,w,d,o.allowVerticalPlacement),re=o.textSizeData;let ue=null;re.kind==="source"?(ue=[Ao*g.layout.get("text-size").evaluate(w,{})],ue[0]>rc&&qn(`${o.layerIds[0]}: Value for "text-size" is >= ${gd}. Reduce your "text-size".`)):re.kind==="composite"&&(ue=[Ao*Z.compositeTextSizes[0].evaluate(w,{},H),Ao*Z.compositeTextSizes[1].evaluate(w,{},H)],(ue[0]>rc||ue[1]>rc)&&qn(`${o.layerIds[0]}: Value for "text-size" is >= ${gd}. Reduce your "text-size".`)),o.addSymbols(o.text,X,ue,M,x,w,P,i,C.lineStartIndex,C.lineLength,j,H);for(const ve of O)L[ve]=o.text.placedSymbolArray.length-1;return 4*X.length}function G_(o){for(const i in o)return o[i];return null}function gg(o,i,l,d){const g=o.compareText;if(i in g){const x=g[i];for(let w=x.length-1;w>=0;w--)if(d.dist(x[w])<l)return!0}else g[i]=[];return g[i].push(d),!1}const q_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class vs{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,d]=new Uint8Array(i,0,2);if(l!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=d>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const x=q_[15&d];if(!x)throw new Error("Unrecognized array type.");const[w]=new Uint16Array(i,2,1),[M]=new Uint32Array(i,4,1);return new vs(M,w,x,i)}constructor(i,l=64,d=Float64Array,g){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=d,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const x=q_.indexOf(this.ArrayType),w=2*i*this.ArrayType.BYTES_PER_ELEMENT,M=i*this.IndexArrayType.BYTES_PER_ELEMENT,C=(8-M%8)%8;if(x<0)throw new Error(`Unexpected typed array class: ${d}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+M+C,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+w+M+C),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+M+C,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+x]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=i)}add(i,l){const d=this._pos>>1;return this.ids[d]=d,this.coords[this._pos++]=i,this.coords[this._pos++]=l,d}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return Pf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,l,d,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:x,coords:w,nodeSize:M}=this,C=[0,x.length-1,0],P=[];for(;C.length;){const O=C.pop()||0,L=C.pop()||0,j=C.pop()||0;if(L-j<=M){for(let re=j;re<=L;re++){const ue=w[2*re],ve=w[2*re+1];ue>=i&&ue<=d&&ve>=l&&ve<=g&&P.push(x[re])}continue}const Z=j+L>>1,H=w[2*Z],X=w[2*Z+1];H>=i&&H<=d&&X>=l&&X<=g&&P.push(x[Z]),(O===0?i<=H:l<=X)&&(C.push(j),C.push(Z-1),C.push(1-O)),(O===0?d>=H:g>=X)&&(C.push(Z+1),C.push(L),C.push(1-O))}return P}within(i,l,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:x,nodeSize:w}=this,M=[0,g.length-1,0],C=[],P=d*d;for(;M.length;){const O=M.pop()||0,L=M.pop()||0,j=M.pop()||0;if(L-j<=w){for(let re=j;re<=L;re++)bs(x[2*re],x[2*re+1],i,l)<=P&&C.push(g[re]);continue}const Z=j+L>>1,H=x[2*Z],X=x[2*Z+1];bs(H,X,i,l)<=P&&C.push(g[Z]),(O===0?i-d<=H:l-d<=X)&&(M.push(j),M.push(Z-1),M.push(1-O)),(O===0?i+d>=H:l+d>=X)&&(M.push(Z+1),M.push(L),M.push(1-O))}return C}}function Pf(o,i,l,d,g,x){if(g-d<=l)return;const w=d+g>>1;_g(o,i,w,d,g,x),Pf(o,i,l,d,w-1,1-x),Pf(o,i,l,w+1,g,1-x)}function _g(o,i,l,d,g,x){for(;g>d;){if(g-d>600){const P=g-d+1,O=l-d+1,L=Math.log(P),j=.5*Math.exp(2*L/3),Z=.5*Math.sqrt(L*j*(P-j)/P)*(O-P/2<0?-1:1);_g(o,i,l,Math.max(d,Math.floor(l-O*j/P+Z)),Math.min(g,Math.floor(l+(P-O)*j/P+Z)),x)}const w=i[2*l+x];let M=d,C=g;for(vd(o,i,d,l),i[2*g+x]>w&&vd(o,i,d,g);M<C;){for(vd(o,i,M,C),M++,C--;i[2*M+x]<w;)M++;for(;i[2*C+x]>w;)C--}i[2*d+x]===w?vd(o,i,d,C):(C++,vd(o,i,C,g)),C<=l&&(d=C+1),l<=C&&(g=C-1)}}function vd(o,i,l,d){sh(o,l,d),sh(i,2*l,2*d),sh(i,2*l+1,2*d+1)}function sh(o,i,l){const d=o[i];o[i]=o[l],o[l]=d}function bs(o,i,l,d){const g=o-l,x=i-d;return g*g+x*x}var Vp;S.ck=void 0,(Vp=S.ck||(S.ck={})).create="create",Vp.load="load",Vp.fullLoad="fullLoad";let oh=null,xs=[];const yg=1e3/60,vg="loadTime",Yc="fullLoadTime",$_={mark(o){performance.mark(o)},frame(o){const i=o;oh!=null&&xs.push(i-oh),oh=i},clearMetrics(){oh=null,xs=[],performance.clearMeasures(vg),performance.clearMeasures(Yc);for(const o in S.ck)performance.clearMarks(S.ck[o])},getPerformanceMetrics(){performance.measure(vg,S.ck.create,S.ck.load),performance.measure(Yc,S.ck.create,S.ck.fullLoad);const o=performance.getEntriesByName(vg)[0].duration,i=performance.getEntriesByName(Yc)[0].duration,l=xs.length,d=1/(xs.reduce((x,w)=>x+w,0)/l/1e3),g=xs.filter(x=>x>yg).reduce((x,w)=>x+(w-yg)/yg,0);return{loadTime:o,fullLoadTime:i,fps:d,percentDroppedFrames:g/(l+g)*100,totalFrames:l}}};S.$=If,S.A=Pt,S.B=Ca,S.C=fn,S.D=Nt,S.E=J,S.F=Im,S.G=function(o){if(Nn==null){const i=o.navigator?o.navigator.userAgent:null;Nn=!!o.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return Nn},S.H=class{constructor(o,i){this.target=o,this.mapId=i,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new z_(()=>this.process()),this.subscription=Fa(this.target,"message",l=>this.receive(l),!1),this.globalScope=as(self)?o:window}registerMessageHandler(o,i){this.messageHandlers[o]=i}sendAsync(o,i){return new Promise((l,d)=>{const g=Math.round(1e18*Math.random()).toString(36).substring(0,10),x=i?Fa(i.signal,"abort",()=>{x==null||x.unsubscribe(),delete this.resolveRejects[g];const C={id:g,type:"<cancel>",origin:location.origin,targetMapId:o.targetMapId,sourceMapId:this.mapId};this.target.postMessage(C)},k_):null;this.resolveRejects[g]={resolve:C=>{x==null||x.unsubscribe(),l(C)},reject:C=>{x==null||x.unsubscribe(),d(C)}};const w=[],M=Object.assign(Object.assign({},o),{id:g,sourceMapId:this.mapId,origin:location.origin,data:ql(o.data,w)});this.target.postMessage(M,{transfer:w})})}receive(o){const i=o.data,l=i.id;if(!(i.origin!=="file://"&&location.origin!=="file://"&&i.origin!=="resource://android"&&location.origin!=="resource://android"&&i.origin!==location.origin||i.targetMapId&&this.mapId!==i.targetMapId)){if(i.type==="<cancel>"){delete this.tasks[l];const d=this.abortControllers[l];return delete this.abortControllers[l],void(d&&d.abort())}if(as(self)||i.mustQueue)return this.tasks[l]=i,this.taskQueue.push(l),void this.invoker.trigger();this.processTask(l,i)}}process(){if(this.taskQueue.length===0)return;const o=this.taskQueue.shift(),i=this.tasks[o];delete this.tasks[o],this.taskQueue.length>0&&this.invoker.trigger(),i&&this.processTask(o,i)}processTask(o,i){return u(this,void 0,void 0,function*(){if(i.type==="<response>"){const g=this.resolveRejects[o];return delete this.resolveRejects[o],g?void(i.error?g.reject(bo(i.error)):g.resolve(bo(i.data))):void 0}if(!this.messageHandlers[i.type])return void this.completeTask(o,new Error(`Could not find a registered handler for ${i.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const l=bo(i.data),d=new AbortController;this.abortControllers[o]=d;try{const g=yield this.messageHandlers[i.type](i.sourceMapId,l,d);this.completeTask(o,null,g)}catch(g){this.completeTask(o,g)}})}completeTask(o,i,l){const d=[];delete this.abortControllers[o];const g={id:o,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:i?ql(i):null,data:ql(l,d)};this.target.postMessage(g,{transfer:d})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},S.I=vf,S.J=$r,S.K=function(){var o=new Pt(16);return Pt!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},S.L=function(o,i,l){var d,g,x,w,M,C,P,O,L,j,Z,H,X=l[0],re=l[1],ue=l[2];return i===o?(o[12]=i[0]*X+i[4]*re+i[8]*ue+i[12],o[13]=i[1]*X+i[5]*re+i[9]*ue+i[13],o[14]=i[2]*X+i[6]*re+i[10]*ue+i[14],o[15]=i[3]*X+i[7]*re+i[11]*ue+i[15]):(g=i[1],x=i[2],w=i[3],M=i[4],C=i[5],P=i[6],O=i[7],L=i[8],j=i[9],Z=i[10],H=i[11],o[0]=d=i[0],o[1]=g,o[2]=x,o[3]=w,o[4]=M,o[5]=C,o[6]=P,o[7]=O,o[8]=L,o[9]=j,o[10]=Z,o[11]=H,o[12]=d*X+M*re+L*ue+i[12],o[13]=g*X+C*re+j*ue+i[13],o[14]=x*X+P*re+Z*ue+i[14],o[15]=w*X+O*re+H*ue+i[15]),o},S.M=function(o,i,l){var d=l[0],g=l[1],x=l[2];return o[0]=i[0]*d,o[1]=i[1]*d,o[2]=i[2]*d,o[3]=i[3]*d,o[4]=i[4]*g,o[5]=i[5]*g,o[6]=i[6]*g,o[7]=i[7]*g,o[8]=i[8]*x,o[9]=i[9]*x,o[10]=i[10]*x,o[11]=i[11]*x,o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15],o},S.N=function(o,i,l){var d=i[0],g=i[1],x=i[2],w=i[3],M=i[4],C=i[5],P=i[6],O=i[7],L=i[8],j=i[9],Z=i[10],H=i[11],X=i[12],re=i[13],ue=i[14],ve=i[15],de=l[0],V=l[1],ie=l[2],pe=l[3];return o[0]=de*d+V*M+ie*L+pe*X,o[1]=de*g+V*C+ie*j+pe*re,o[2]=de*x+V*P+ie*Z+pe*ue,o[3]=de*w+V*O+ie*H+pe*ve,o[4]=(de=l[4])*d+(V=l[5])*M+(ie=l[6])*L+(pe=l[7])*X,o[5]=de*g+V*C+ie*j+pe*re,o[6]=de*x+V*P+ie*Z+pe*ue,o[7]=de*w+V*O+ie*H+pe*ve,o[8]=(de=l[8])*d+(V=l[9])*M+(ie=l[10])*L+(pe=l[11])*X,o[9]=de*g+V*C+ie*j+pe*re,o[10]=de*x+V*P+ie*Z+pe*ue,o[11]=de*w+V*O+ie*H+pe*ve,o[12]=(de=l[12])*d+(V=l[13])*M+(ie=l[14])*L+(pe=l[15])*X,o[13]=de*g+V*C+ie*j+pe*re,o[14]=de*x+V*P+ie*Z+pe*ue,o[15]=de*w+V*O+ie*H+pe*ve,o},S.O=function(o,i){const l={};for(let d=0;d<i.length;d++){const g=i[d];g in o&&(l[g]=o[g])}return l},S.P=le,S.Q=sc,S.R=Xa,S.S=lg,S.T=$l,S.U=og,S.V=bt,S.W=It,S.X=dr,S.Y=es,S.Z=Ae,S._=u,S.a=Na,S.a$=function(o,i,l){var d=Math.sin(l),g=Math.cos(l),x=i[4],w=i[5],M=i[6],C=i[7],P=i[8],O=i[9],L=i[10],j=i[11];return i!==o&&(o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[4]=x*g+P*d,o[5]=w*g+O*d,o[6]=M*g+L*d,o[7]=C*g+j*d,o[8]=P*g-x*d,o[9]=O*g-w*d,o[10]=L*g-M*d,o[11]=j*g-C*d,o},S.a0=25,S.a1=ih,S.a2=o=>{const i=window.document.createElement("video");return i.muted=!0,new Promise(l=>{i.onloadstart=()=>{l(i)};for(const d of o){const g=window.document.createElement("source");hu(d)||(i.crossOrigin="Anonymous"),g.src=d,i.appendChild(g)}})},S.a3=je,S.a4=function(){return Jt++},S.a5=D,S.a6=th,S.a7=Cu,S.a8=gs,S.a9=Op,S.aA=jp,S.aB=Tp,S.aC=vs,S.aD=ni,S.aE=_f,S.aF=me,S.aG=vi,S.aH=it,S.aI=function(o){return Math.pow(2,o)},S.aJ=85.051129,S.aK=B_,S.aL=Zt,S.aM=fa,S.aN=zp,S.aO=function(o,i,l){return o[0]=i[0]*l,o[1]=i[1]*l,o[2]=i[2]*l,o},S.aP=function(o,i,l){return o[0]=i[0]+l[0],o[1]=i[1]+l[1],o[2]=i[2]+l[2],o},S.aQ=function(o){var i=new Pt(3);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i},S.aR=function(o,i,l){return o[0]=i[0]*l[0],o[1]=i[1]*l[1],o[2]=i[2]*l[2],o[3]=i[3]*l[3],o},S.aS=function(o,i,l){return o[0]=i[0]-l[0],o[1]=i[1]-l[1],o[2]=i[2]-l[2],o},S.aT=function(o,i){var l=i[0],d=i[1],g=i[2],x=l*l+d*d+g*g;return x>0&&(x=1/Math.sqrt(x)),o[0]=i[0]*x,o[1]=i[1]*x,o[2]=i[2]*x,o},S.aU=function(o,i,l){var d=i[0],g=i[1],x=i[2],w=l[0],M=l[1],C=l[2];return o[0]=g*C-x*M,o[1]=x*w-d*C,o[2]=d*M-g*w,o},S.aV=function(o,i){return o[0]*i[0]+o[1]*i[1]+o[2]*i[2]},S.aW=F_,S.aX=Ci,S.aY=function(o,i,l,d,g){var x,w=1/Math.tan(i/2);return o[0]=w/l,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=w,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,g!=null&&g!==1/0?(o[10]=(g+d)*(x=1/(d-g)),o[14]=2*g*d*x):(o[10]=-1,o[14]=-2*d),o},S.aZ=function(o){var i=new Pt(16);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i[4]=o[4],i[5]=o[5],i[6]=o[6],i[7]=o[7],i[8]=o[8],i[9]=o[9],i[10]=o[10],i[11]=o[11],i[12]=o[12],i[13]=o[13],i[14]=o[14],i[15]=o[15],i},S.a_=function(o,i,l){var d=Math.sin(l),g=Math.cos(l),x=i[0],w=i[1],M=i[2],C=i[3],P=i[4],O=i[5],L=i[6],j=i[7];return i!==o&&(o[8]=i[8],o[9]=i[9],o[10]=i[10],o[11]=i[11],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[0]=x*g+P*d,o[1]=w*g+O*d,o[2]=M*g+L*d,o[3]=C*g+j*d,o[4]=P*g-x*d,o[5]=O*g-w*d,o[6]=L*g-M*d,o[7]=j*g-C*d,o},S.aa=function(o){const i={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,d,g,x)=>{const w=g||x;return i[d]=!w||w.toLowerCase(),""}),i["max-age"]){const l=parseInt(i["max-age"],10);isNaN(l)?delete i["max-age"]:i["max-age"]=l}return i},S.ab=function(o){return Math.log(o)/Math.LN2},S.ac=function(o){var i=o[0],l=o[1];return i*i+l*l},S.ad=function(o){return o*Math.PI/180},S.ae=vt,S.af=function(o,i){const l=[];for(const d in o)d in i||l.push(d);return l},S.ag=function(o,i){let l=0,d=0;if(o.kind==="constant")d=o.layoutSize;else if(o.kind!=="source"){const{interpolationType:g,minZoom:x,maxZoom:w}=o,M=g?vt(Xr.interpolationFactor(g,i,x,w),0,1):0;o.kind==="camera"?d=Ca.number(o.minSize,o.maxSize,M):l=M}return{uSizeT:l,uSize:d}},S.ai=function(o,{uSize:i,uSizeT:l},{lowerSize:d,upperSize:g}){return o.kind==="source"?d/Ao:o.kind==="composite"?Ca.number(d/Ao,g/Ao,l):i},S.aj=function(o,i){var l=i[0],d=i[1],g=i[2],x=i[3],w=i[4],M=i[5],C=i[6],P=i[7],O=i[8],L=i[9],j=i[10],Z=i[11],H=i[12],X=i[13],re=i[14],ue=i[15],ve=l*M-d*w,de=l*C-g*w,V=l*P-x*w,ie=d*C-g*M,pe=d*P-x*M,Be=g*P-x*C,ot=O*X-L*H,Ue=O*re-j*H,$e=O*ue-Z*H,ft=L*re-j*X,at=L*ue-Z*X,pt=j*ue-Z*re,Qe=ve*pt-de*at+V*ft+ie*$e-pe*Ue+Be*ot;return Qe?(o[0]=(M*pt-C*at+P*ft)*(Qe=1/Qe),o[1]=(g*at-d*pt-x*ft)*Qe,o[2]=(X*Be-re*pe+ue*ie)*Qe,o[3]=(j*pe-L*Be-Z*ie)*Qe,o[4]=(C*$e-w*pt-P*Ue)*Qe,o[5]=(l*pt-g*$e+x*Ue)*Qe,o[6]=(re*V-H*Be-ue*de)*Qe,o[7]=(O*Be-j*V+Z*de)*Qe,o[8]=(w*at-M*$e+P*ot)*Qe,o[9]=(d*$e-l*at-x*ot)*Qe,o[10]=(H*pe-X*V+ue*ve)*Qe,o[11]=(L*V-O*pe-Z*ve)*Qe,o[12]=(M*Ue-w*ft-C*ot)*Qe,o[13]=(l*ft-d*Ue+g*ot)*Qe,o[14]=(X*de-H*ie-re*ve)*Qe,o[15]=(O*ie-L*de+j*ve)*Qe,o):null},S.ak=Fe,S.al=function(o){return Math.hypot(o[0],o[1])},S.am=function(o){return o[0]=0,o[1]=0,o},S.an=function(o,i,l){return o[0]=i[0]*l,o[1]=i[1]*l,o},S.ao=Ip,S.ap=te,S.aq=function(o,i,l,d){const g=i.y-o.y,x=i.x-o.x,w=d.y-l.y,M=d.x-l.x,C=w*x-M*g;if(C===0)return null;const P=(M*(o.y-l.y)-w*(o.x-l.x))/C;return new le(o.x+P*x,o.y+P*g)},S.ar=nh,S.as=Vu,S.at=Mt,S.au=function(o){let i=1/0,l=1/0,d=-1/0,g=-1/0;for(const x of o)i=Math.min(i,x.x),l=Math.min(l,x.y),d=Math.max(d,x.x),g=Math.max(g,x.y);return[i,l,d,g]},S.av=Xn,S.aw=st,S.ax=function(o,i,l,d,g=!1){if(!l[0]&&!l[1])return[0,0];const x=g?d==="map"?-o.bearingInRadians:0:d==="viewport"?o.bearingInRadians:0;if(x){const w=Math.sin(x),M=Math.cos(x);l=[l[0]*M-l[1]*w,l[0]*w+l[1]*M]}return[g?l[0]:st(i,l[0],o.zoom),g?l[1]:st(i,l[1],o.zoom)]},S.az=Mp,S.b=yl,S.b$=o=>o.type==="symbol",S.b0=function(){const o=new Float32Array(16);return Mt(o),o},S.b1=function(){const o=new Float64Array(16);return Mt(o),o},S.b2=function(){return new Float64Array(16)},S.b3=function(o,i,l){const d=new Float64Array(4);return function(g,x,w,M){var C=.5*Math.PI/180;x*=C,w*=C,M*=C;var P=Math.sin(x),O=Math.cos(x),L=Math.sin(w),j=Math.cos(w),Z=Math.sin(M),H=Math.cos(M);g[0]=P*j*H-O*L*Z,g[1]=O*L*H+P*j*Z,g[2]=O*j*Z-P*L*H,g[3]=O*j*H+P*L*Z}(d,o,i-90,l),d},S.b4=function(o,i,l,d){var g,x,w,M,C,P=i[0],O=i[1],L=i[2],j=i[3],Z=l[0],H=l[1],X=l[2],re=l[3];return(x=P*Z+O*H+L*X+j*re)<0&&(x=-x,Z=-Z,H=-H,X=-X,re=-re),1-x>zt?(g=Math.acos(x),w=Math.sin(g),M=Math.sin((1-d)*g)/w,C=Math.sin(d*g)/w):(M=1-d,C=d),o[0]=M*P+C*Z,o[1]=M*O+C*H,o[2]=M*L+C*X,o[3]=M*j+C*re,o},S.b5=function(o){const i=new Float64Array(9);var l,d,g,x,w,M,C,P,O,L,j,Z,H,X,re,ue,ve,de;L=(g=(d=o)[0])*(C=g+g),j=(x=d[1])*C,H=(w=d[2])*C,X=w*(P=x+x),ue=(M=d[3])*C,ve=M*P,de=M*(O=w+w),(l=i)[0]=1-(Z=x*P)-(re=w*O),l[3]=j-de,l[6]=H+ve,l[1]=j+de,l[4]=1-L-re,l[7]=X-ue,l[2]=H-ve,l[5]=X+ue,l[8]=1-L-Z;const V=fa(-Math.asin(vt(i[2],-1,1)));let ie,pe;return Math.hypot(i[5],i[8])<.001?(ie=0,pe=-fa(Math.atan2(i[3],i[4]))):(ie=fa(i[5]===0&&i[8]===0?0:Math.atan2(i[5],i[8])),pe=fa(i[1]===0&&i[0]===0?0:Math.atan2(i[1],i[0]))),{roll:ie,pitch:V+90,bearing:pe}},S.b6=function(o,i){return o.roll==i.roll&&o.pitch==i.pitch&&o.bearing==i.bearing},S.b7=Bi,S.b8=ms,S.b9=Yu,S.bA=function(o,i){if(!o)return[{command:"setStyle",args:[i]}];let l=[];try{if(!we(o.version,i.version))return[{command:"setStyle",args:[i]}];we(o.center,i.center)||l.push({command:"setCenter",args:[i.center]}),we(o.centerAltitude,i.centerAltitude)||l.push({command:"setCenterAltitude",args:[i.centerAltitude]}),we(o.zoom,i.zoom)||l.push({command:"setZoom",args:[i.zoom]}),we(o.bearing,i.bearing)||l.push({command:"setBearing",args:[i.bearing]}),we(o.pitch,i.pitch)||l.push({command:"setPitch",args:[i.pitch]}),we(o.roll,i.roll)||l.push({command:"setRoll",args:[i.roll]}),we(o.sprite,i.sprite)||l.push({command:"setSprite",args:[i.sprite]}),we(o.glyphs,i.glyphs)||l.push({command:"setGlyphs",args:[i.glyphs]}),we(o.transition,i.transition)||l.push({command:"setTransition",args:[i.transition]}),we(o.light,i.light)||l.push({command:"setLight",args:[i.light]}),we(o.terrain,i.terrain)||l.push({command:"setTerrain",args:[i.terrain]}),we(o.sky,i.sky)||l.push({command:"setSky",args:[i.sky]}),we(o.projection,i.projection)||l.push({command:"setProjection",args:[i.projection]});const d={},g=[];(function(w,M,C,P){let O;for(O in M=M||{},w=w||{})Object.prototype.hasOwnProperty.call(w,O)&&(Object.prototype.hasOwnProperty.call(M,O)||Ye(O,C,P));for(O in M)Object.prototype.hasOwnProperty.call(M,O)&&(Object.prototype.hasOwnProperty.call(w,O)?we(w[O],M[O])||(w[O].type==="geojson"&&M[O].type==="geojson"&&Pe(w,M,O)?ze(C,{command:"setGeoJSONSourceData",args:[O,M[O].data]}):Ze(O,M,C,P)):Ce(O,M,C))})(o.sources,i.sources,g,d);const x=[];o.layers&&o.layers.forEach(w=>{"source"in w&&d[w.source]?l.push({command:"removeLayer",args:[w.id]}):x.push(w)}),l=l.concat(g),function(w,M,C){M=M||[];const P=(w=w||[]).map(yt),O=M.map(yt),L=w.reduce(St,{}),j=M.reduce(St,{}),Z=P.slice(),H=Object.create(null);let X,re,ue,ve,de;for(let V=0,ie=0;V<P.length;V++)X=P[V],Object.prototype.hasOwnProperty.call(j,X)?ie++:(ze(C,{command:"removeLayer",args:[X]}),Z.splice(Z.indexOf(X,ie),1));for(let V=0,ie=0;V<O.length;V++)X=O[O.length-1-V],Z[Z.length-1-V]!==X&&(Object.prototype.hasOwnProperty.call(L,X)?(ze(C,{command:"removeLayer",args:[X]}),Z.splice(Z.lastIndexOf(X,Z.length-ie),1)):ie++,ve=Z[Z.length-V],ze(C,{command:"addLayer",args:[j[X],ve]}),Z.splice(Z.length-V,0,X),H[X]=!0);for(let V=0;V<O.length;V++)if(X=O[V],re=L[X],ue=j[X],!H[X]&&!we(re,ue))if(we(re.source,ue.source)&&we(re["source-layer"],ue["source-layer"])&&we(re.type,ue.type)){for(de in nt(re.layout,ue.layout,C,X,null,"setLayoutProperty"),nt(re.paint,ue.paint,C,X,null,"setPaintProperty"),we(re.filter,ue.filter)||ze(C,{command:"setFilter",args:[X,ue.filter]}),we(re.minzoom,ue.minzoom)&&we(re.maxzoom,ue.maxzoom)||ze(C,{command:"setLayerZoomRange",args:[X,ue.minzoom,ue.maxzoom]}),re)Object.prototype.hasOwnProperty.call(re,de)&&de!=="layout"&&de!=="paint"&&de!=="filter"&&de!=="metadata"&&de!=="minzoom"&&de!=="maxzoom"&&(de.indexOf("paint.")===0?nt(re[de],ue[de],C,X,de.slice(6),"setPaintProperty"):we(re[de],ue[de])||ze(C,{command:"setLayerProperty",args:[X,de,ue[de]]}));for(de in ue)Object.prototype.hasOwnProperty.call(ue,de)&&!Object.prototype.hasOwnProperty.call(re,de)&&de!=="layout"&&de!=="paint"&&de!=="filter"&&de!=="metadata"&&de!=="minzoom"&&de!=="maxzoom"&&(de.indexOf("paint.")===0?nt(re[de],ue[de],C,X,de.slice(6),"setPaintProperty"):we(re[de],ue[de])||ze(C,{command:"setLayerProperty",args:[X,de,ue[de]]}))}else ze(C,{command:"removeLayer",args:[X]}),ve=Z[Z.lastIndexOf(X)+1],ze(C,{command:"addLayer",args:[ue,ve]})}(x,i.layers,l)}catch(d){console.warn("Unable to compute style diff:",d),l=[{command:"setStyle",args:[i]}]}return l},S.bB=function(o){const i=[],l=o.id;return l===void 0&&i.push({message:`layers.${l}: missing required property "id"`}),o.render===void 0&&i.push({message:`layers.${l}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&i.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),i},S.bC=function o(i,l){if(Array.isArray(i)){if(!Array.isArray(l)||i.length!==l.length)return!1;for(let d=0;d<i.length;d++)if(!o(i[d],l[d]))return!1;return!0}if(typeof i=="object"&&i!==null&&l!==null){if(typeof l!="object"||Object.keys(i).length!==Object.keys(l).length)return!1;for(const d in i)if(!o(i[d],l[d]))return!1;return!0}return i===l},S.bD=ar,S.bE=zi,S.bF=class extends ps{constructor(o,i){super(o,i),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},S.bG=Zs,S.bH=class extends ps{constructor(o,i){super(o,i),this.current=Xl}set(o){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let i=1;i<16;i++)if(o[i]!==this.current[i]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}},S.bI=xa,S.bJ=class extends ps{constructor(o,i){super(o,i),this.current=[0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2]))}},S.bK=class extends ps{constructor(o,i){super(o,i),this.current=[0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1]))}},S.bL=ut,S.bM=function(o,i){var l=Math.sin(i),d=Math.cos(i);return o[0]=d,o[1]=l,o[2]=0,o[3]=-l,o[4]=d,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},S.bN=function(o,i,l){var d=i[0],g=i[1],x=i[2];return o[0]=d*l[0]+g*l[3]+x*l[6],o[1]=d*l[1]+g*l[4]+x*l[7],o[2]=d*l[2]+g*l[5]+x*l[8],o},S.bO=function(o,i,l,d,g,x,w){var M=1/(i-l),C=1/(d-g),P=1/(x-w);return o[0]=-2*M,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*C,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*P,o[11]=0,o[12]=(i+l)*M,o[13]=(g+d)*C,o[14]=(w+x)*P,o[15]=1,o},S.bP=class extends of{},S.bQ=_r,S.bR=class extends Yl{},S.bS=jr,S.bT=function(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))},S.bU=Ur,S.bV=function(o,i,l){var d=i[0],g=i[1],x=i[2],w=l[3]*d+l[7]*g+l[11]*x+l[15];return o[0]=(l[0]*d+l[4]*g+l[8]*x+l[12])/(w=w||1),o[1]=(l[1]*d+l[5]*g+l[9]*x+l[13])/w,o[2]=(l[2]*d+l[6]*g+l[10]*x+l[14])/w,o},S.bW=class extends Us{},S.bX=class extends b{},S.bY=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]&&o[3]===i[3]&&o[4]===i[4]&&o[5]===i[5]&&o[6]===i[6]&&o[7]===i[7]&&o[8]===i[8]&&o[9]===i[9]&&o[10]===i[10]&&o[11]===i[11]&&o[12]===i[12]&&o[13]===i[13]&&o[14]===i[14]&&o[15]===i[15]},S.bZ=function(o,i){var l=o[0],d=o[1],g=o[2],x=o[3],w=o[4],M=o[5],C=o[6],P=o[7],O=o[8],L=o[9],j=o[10],Z=o[11],H=o[12],X=o[13],re=o[14],ue=o[15],ve=i[0],de=i[1],V=i[2],ie=i[3],pe=i[4],Be=i[5],ot=i[6],Ue=i[7],$e=i[8],ft=i[9],at=i[10],pt=i[11],Qe=i[12],kt=i[13],Xt=i[14],$t=i[15];return Math.abs(l-ve)<=zt*Math.max(1,Math.abs(l),Math.abs(ve))&&Math.abs(d-de)<=zt*Math.max(1,Math.abs(d),Math.abs(de))&&Math.abs(g-V)<=zt*Math.max(1,Math.abs(g),Math.abs(V))&&Math.abs(x-ie)<=zt*Math.max(1,Math.abs(x),Math.abs(ie))&&Math.abs(w-pe)<=zt*Math.max(1,Math.abs(w),Math.abs(pe))&&Math.abs(M-Be)<=zt*Math.max(1,Math.abs(M),Math.abs(Be))&&Math.abs(C-ot)<=zt*Math.max(1,Math.abs(C),Math.abs(ot))&&Math.abs(P-Ue)<=zt*Math.max(1,Math.abs(P),Math.abs(Ue))&&Math.abs(O-$e)<=zt*Math.max(1,Math.abs(O),Math.abs($e))&&Math.abs(L-ft)<=zt*Math.max(1,Math.abs(L),Math.abs(ft))&&Math.abs(j-at)<=zt*Math.max(1,Math.abs(j),Math.abs(at))&&Math.abs(Z-pt)<=zt*Math.max(1,Math.abs(Z),Math.abs(pt))&&Math.abs(H-Qe)<=zt*Math.max(1,Math.abs(H),Math.abs(Qe))&&Math.abs(X-kt)<=zt*Math.max(1,Math.abs(X),Math.abs(kt))&&Math.abs(re-Xt)<=zt*Math.max(1,Math.abs(re),Math.abs(Xt))&&Math.abs(ue-$t)<=zt*Math.max(1,Math.abs(ue),Math.abs($t))},S.b_=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[4]=i[4],o[5]=i[5],o[6]=i[6],o[7]=i[7],o[8]=i[8],o[9]=i[9],o[10]=i[10],o[11]=i[11],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15],o},S.ba=Jl,S.bb=_s,S.bc=yi,S.bd=xe,S.be=lr,S.bf=function(o,i,l,d,g){return yi(d,g,vt((o-i)/(l-i),0,1))},S.bg=Ct,S.bh=function(){return new Float64Array(4)},S.bi=function(){return new Float64Array(3)},S.bj=function(o,i,l,d){var g=[],x=[];return g[0]=i[0]-l[0],g[1]=i[1]-l[1],g[2]=i[2]-l[2],x[0]=g[0]*Math.cos(d)-g[1]*Math.sin(d),x[1]=g[0]*Math.sin(d)+g[1]*Math.cos(d),x[2]=g[2],o[0]=x[0]+l[0],o[1]=x[1]+l[1],o[2]=x[2]+l[2],o},S.bk=function(o,i,l,d){var g=[],x=[];return g[0]=i[0]-l[0],g[1]=i[1]-l[1],g[2]=i[2]-l[2],x[0]=g[0],x[1]=g[1]*Math.cos(d)-g[2]*Math.sin(d),x[2]=g[1]*Math.sin(d)+g[2]*Math.cos(d),o[0]=x[0]+l[0],o[1]=x[1]+l[1],o[2]=x[2]+l[2],o},S.bl=function(o,i,l,d){var g=[],x=[];return g[0]=i[0]-l[0],g[1]=i[1]-l[1],g[2]=i[2]-l[2],x[0]=g[2]*Math.sin(d)+g[0]*Math.cos(d),x[1]=g[1],x[2]=g[2]*Math.cos(d)-g[0]*Math.sin(d),o[0]=x[0]+l[0],o[1]=x[1]+l[1],o[2]=x[2]+l[2],o},S.bm=function(o,i,l){var d=Math.sin(l),g=Math.cos(l),x=i[0],w=i[1],M=i[2],C=i[3],P=i[8],O=i[9],L=i[10],j=i[11];return i!==o&&(o[4]=i[4],o[5]=i[5],o[6]=i[6],o[7]=i[7],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[0]=x*g-P*d,o[1]=w*g-O*d,o[2]=M*g-L*d,o[3]=C*g-j*d,o[8]=x*d+P*g,o[9]=w*d+O*g,o[10]=M*d+L*g,o[11]=C*d+j*g,o},S.bn=function(o,i){const l=Ct(o,360),d=Ct(i,360),g=d-l,x=d>l?g-360:g+360;return Math.abs(g)<Math.abs(x)?g:x},S.bo=function(o){return o[0]=0,o[1]=0,o[2]=0,o},S.bp=function(o,i,l,d){const g=Math.sqrt(o*o+i*i),x=Math.sqrt(l*l+d*d);o/=g,i/=g,l/=x,d/=x;const w=Math.acos(o*l+i*d);return-i*l+o*d>0?w:-w},S.bq=function(o,i){return o[0]*i[0]+o[1]*i[1]+o[2]*i[2]+o[3]},S.br=Rp,S.bs=function(o,i){const l=Ct(o,2*Math.PI),d=Ct(i,2*Math.PI);return Math.min(Math.abs(l-d),Math.abs(l-d+2*Math.PI),Math.abs(l-d-2*Math.PI))},S.bt=function(o){return Math.hypot(o[0],o[1],o[2])},S.bu=function(){const o={},i=$.$version;for(const l in $.$root){const d=$.$root[l];if(d.required){let g=null;g=l==="version"?i:d.type==="array"?[]:{},g!=null&&(o[l]=g)}}return o},S.bv=ef,S.bw=ro,S.bx=function(o){o=o.slice();const i=Object.create(null);for(let l=0;l<o.length;l++)i[o[l].id]=o[l];for(let l=0;l<o.length;l++)"ref"in o[l]&&(o[l]=Ee(o[l],i[o[l].ref]));return o},S.by=function(o){if(o.type==="custom")return new vv(o);switch(o.type){case"background":return new sg(o);case"circle":return new c_(o);case"fill":return new Gm(o);case"fill-extrusion":return new ld(o);case"heatmap":return new h_(o);case"hillshade":return new f_(o);case"line":return new gn(o);case"raster":return new Mf(o);case"symbol":return new ac(o)}},S.bz=Fn,S.c=xl,S.c0=o=>o.type==="circle",S.c1=o=>o.type==="heatmap",S.c2=o=>o.type==="line",S.c3=o=>o.type==="fill",S.c4=o=>o.type==="fill-extrusion",S.c5=o=>o.type==="hillshade",S.c6=o=>o.type==="raster",S.c7=o=>o.type==="background",S.c8=o=>o.type==="custom",S.c9=lt,S.cA=class{constructor(o){this._marks={start:[o.url,"start"].join("#"),end:[o.url,"end"].join("#"),measure:o.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let o=performance.getEntriesByName(this._marks.measure);return o.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),o=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),o}},S.cB=function(o,i,l,d,g){return u(this,void 0,void 0,function*(){if(It())try{return yield dr(o,i,l,d,g)}catch{}return function(x,w,M,C,P){const O=x.width,L=x.height;Po&&no||(Po=new OffscreenCanvas(O,L),no=Po.getContext("2d",{willReadFrequently:!0})),Po.width=O,Po.height=L,no.drawImage(x,0,0,O,L);const j=no.getImageData(w,M,C,P);return no.clearRect(0,0,O,L),j.data}(o,i,l,d,g)})},S.cC=kp,S.cD=k,S.cE=oe,S.cF=Hs,S.cG=wp,S.cH=yo,S.cI=Ns,S.ca=function(o,i,l){const d=xt(i.x-l.x,i.y-l.y),g=xt(o.x-l.x,o.y-l.y);var x,w;return fa(Math.atan2(d[0]*g[1]-d[1]*g[0],(x=d)[0]*(w=g)[0]+x[1]*w[1]))},S.cb=Dt,S.cc=function(o,i){return bl[i]&&(o instanceof MouseEvent||o instanceof WheelEvent)},S.cd=function(o,i){return vc[i]&&"touches"in o},S.ce=function(o){return vc[o]||bl[o]},S.cf=function(o,i,l){var d=i[0],g=i[1];return o[0]=l[0]*d+l[4]*g+l[12],o[1]=l[1]*d+l[5]*g+l[13],o},S.cg=function(o,i){const{x:l,y:d}=If.fromLngLat(i);return!(o<0||o>25||d<0||d>=1||l<0||l>=1)},S.ch=function(o,i){return o[0]=i[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=i[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=i[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},S.ci=class extends aa{},S.cj=$_,S.cl=function(o){return o.message===uu},S.cm=Wn,S.cn=function(o,i){Na.REGISTERED_PROTOCOLS[o]=i},S.co=function(o){delete Na.REGISTERED_PROTOCOLS[o]},S.cp=function(o,i){const l={};for(let g=0;g<o.length;g++){const x=i&&i[o[g].id]||vo(o[g]);i&&(i[o[g].id]=x);let w=l[x];w||(w=l[x]=[]),w.push(o[g])}const d=[];for(const g in l)d.push(l[g]);return d},S.cq=Rt,S.cr=Cf,S.cs=cg,S.ct=Jm,S.cu=function(o){o.bucket.createArrays(),o.bucket.tilePixelRatio=Ae/(512*o.bucket.overscaling),o.bucket.compareText={},o.bucket.iconsNeedLinear=!1;const i=o.bucket.layers[0],l=i.layout,d=i._unevaluatedLayout._values,g={layoutIconSize:d["icon-size"].possiblyEvaluate(new fn(o.bucket.zoom+1),o.canonical),layoutTextSize:d["text-size"].possiblyEvaluate(new fn(o.bucket.zoom+1),o.canonical),textMaxSize:d["text-size"].possiblyEvaluate(new fn(18))};if(o.bucket.textSizeData.kind==="composite"){const{minZoom:P,maxZoom:O}=o.bucket.textSizeData;g.compositeTextSizes=[d["text-size"].possiblyEvaluate(new fn(P),o.canonical),d["text-size"].possiblyEvaluate(new fn(O),o.canonical)]}if(o.bucket.iconSizeData.kind==="composite"){const{minZoom:P,maxZoom:O}=o.bucket.iconSizeData;g.compositeIconSizes=[d["icon-size"].possiblyEvaluate(new fn(P),o.canonical),d["icon-size"].possiblyEvaluate(new fn(O),o.canonical)]}const x=l.get("text-line-height")*Xn,w=l.get("text-rotation-alignment")!=="viewport"&&l.get("symbol-placement")!=="point",M=l.get("text-keep-upright"),C=l.get("text-size");for(const P of o.bucket.features){const O=l.get("text-font").evaluate(P,{},o.canonical).join(","),L=C.evaluate(P,{},o.canonical),j=g.layoutTextSize.evaluate(P,{},o.canonical),Z=g.layoutIconSize.evaluate(P,{},o.canonical),H={horizontal:{},vertical:void 0},X=P.text;let re,ue=[0,0];if(X){const V=X.toString(),ie=l.get("text-letter-spacing").evaluate(P,{},o.canonical)*Xn,pe=ed(V)?ie:0,Be=l.get("text-anchor").evaluate(P,{},o.canonical),ot=cc(i,P,o.canonical);if(!ot){const at=l.get("text-radial-offset").evaluate(P,{},o.canonical);ue=at?V_(Be,[at*Xn,pg]):l.get("text-offset").evaluate(P,{},o.canonical).map(pt=>pt*Xn)}let Ue=w?"center":l.get("text-justify").evaluate(P,{},o.canonical);const $e=l.get("symbol-placement")==="point"?l.get("text-max-width").evaluate(P,{},o.canonical)*Xn:1/0,ft=()=>{o.bucket.allowVerticalPlacement&&Fs(V)&&(H.vertical=Sa(X,o.glyphMap,o.glyphPositions,o.imagePositions,O,$e,x,Be,"left",pe,ue,S.ah.vertical,!0,j,L))};if(!w&&ot){const at=new Set;if(Ue==="auto")for(let Qe=0;Qe<ot.values.length;Qe+=2)at.add(jp(ot.values[Qe]));else at.add(Ue);let pt=!1;for(const Qe of at)if(!H.horizontal[Qe])if(pt)H.horizontal[Qe]=H.horizontal[0];else{const kt=Sa(X,o.glyphMap,o.glyphPositions,o.imagePositions,O,$e,x,"center",Qe,pe,ue,S.ah.horizontal,!1,j,L);kt&&(H.horizontal[Qe]=kt,pt=kt.positionedLines.length===1)}ft()}else{Ue==="auto"&&(Ue=jp(Be));const at=Sa(X,o.glyphMap,o.glyphPositions,o.imagePositions,O,$e,x,Be,Ue,pe,ue,S.ah.horizontal,!1,j,L);at&&(H.horizontal[Ue]=at),ft(),Fs(V)&&w&&M&&(H.vertical=Sa(X,o.glyphMap,o.glyphPositions,o.imagePositions,O,$e,x,Be,Ue,pe,ue,S.ah.vertical,!1,j,L))}}let ve=!1;if(P.icon&&P.icon.name){const V=o.imageMap[P.icon.name];V&&(re=C_(o.imagePositions[P.icon.name],l.get("icon-offset").evaluate(P,{},o.canonical),l.get("icon-anchor").evaluate(P,{},o.canonical)),ve=!!V.sdf,o.bucket.sdfIcons===void 0?o.bucket.sdfIcons=ve:o.bucket.sdfIcons!==ve&&qn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(V.pixelRatio!==o.bucket.pixelRatio||l.get("icon-rotate").constantOr(1)!==0)&&(o.bucket.iconsNeedLinear=!0))}const de=G_(H.horizontal)||H.vertical;o.bucket.iconsInText=!!de&&de.iconsInText,(de||re)&&mg(o.bucket,P,H,re,o.imageMap,g,j,Z,ue,ve,o.canonical,o.subdivisionGranularity)}o.showCollisionBoxes&&o.bucket.generateCollisionDebugBuffers()},S.cv=Km,S.cw=sd,S.cx=tc,S.cy=od,S.cz=dd,S.d=hu,S.e=ti,S.f=o=>u(void 0,void 0,void 0,function*(){if(o.byteLength===0)return createImageBitmap(new ImageData(1,1));const i=new Blob([new Uint8Array(o)],{type:"image/png"});try{return createImageBitmap(i)}catch(l){throw new Error(`Could not load image because of ${l.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),S.g=Ir,S.h=o=>new Promise((i,l)=>{const d=new Image;d.onload=()=>{i(d),URL.revokeObjectURL(d.src),d.onload=null,window.requestAnimationFrame(()=>{d.src=vl})},d.onerror=()=>l(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const g=new Blob([new Uint8Array(o)],{type:"image/png"});d.src=o.byteLength?URL.createObjectURL(g):vl}),S.i=as,S.j=(o,i)=>bc(ti(o,{type:"json"}),i),S.k=W,S.l=De,S.m=bc,S.n=(o,i)=>bc(ti(o,{type:"arrayBuffer"}),i),S.o=function(o){return new dd(o).readFields(qc,[])},S.p=Wu,S.q=pf,S.r=Fr,S.s=Fa,S.t=Qh,S.u=Mi,S.v=$,S.w=qn,S.x=jn,S.y=Ls,S.z=function([o,i,l]){return i+=90,i*=Math.PI/180,l*=Math.PI/180,{x:o*Math.cos(i)*Math.sin(l),y:o*Math.sin(i)*Math.sin(l),z:o*Math.cos(l)}}}),_("worker",["./shared"],function(S){class u{constructor(W){this.keyCache={},W&&this.replace(W)}replace(W){this._layerConfigs={},this._layers={},this.update(W,[])}update(W,J){for(const fe of W){this._layerConfigs[fe.id]=fe;const Ee=this._layers[fe.id]=S.by(fe);Ee._featureFilter=S.a7(Ee.filter),this.keyCache[fe.id]&&delete this.keyCache[fe.id]}for(const fe of J)delete this.keyCache[fe],delete this._layerConfigs[fe],delete this._layers[fe];this.familiesBySource={};const $=S.cp(Object.values(this._layerConfigs),this.keyCache);for(const fe of $){const Ee=fe.map(Pe=>this._layers[Pe.id]),we=Ee[0];if(we.visibility==="none")continue;const ze=we.source||"";let Ce=this.familiesBySource[ze];Ce||(Ce=this.familiesBySource[ze]={});const Ye=we.sourceLayer||"_geojsonTileLayer";let Ze=Ce[Ye];Ze||(Ze=Ce[Ye]=[]),Ze.push(Ee)}}}class k{constructor(W){const J={},$=[];for(const ze in W){const Ce=W[ze],Ye=J[ze]={};for(const Ze in Ce){const Pe=Ce[+Ze];if(!Pe||Pe.bitmap.width===0||Pe.bitmap.height===0)continue;const nt={x:0,y:0,w:Pe.bitmap.width+2,h:Pe.bitmap.height+2};$.push(nt),Ye[Ze]={rect:nt,metrics:Pe.metrics}}}const{w:fe,h:Ee}=S.p($),we=new S.q({width:fe||1,height:Ee||1});for(const ze in W){const Ce=W[ze];for(const Ye in Ce){const Ze=Ce[+Ye];if(!Ze||Ze.bitmap.width===0||Ze.bitmap.height===0)continue;const Pe=J[ze][Ye].rect;S.q.copy(Ze.bitmap,we,{x:0,y:0},{x:Pe.x+1,y:Pe.y+1},Ze.bitmap)}}this.image=we,this.positions=J}}S.cq("GlyphAtlas",k);class B{constructor(W){this.tileID=new S.Y(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.uid=W.uid,this.zoom=W.zoom,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=W.showCollisionBoxes,this.collectResourceTiming=!!W.collectResourceTiming,this.returnDependencies=!!W.returnDependencies,this.promoteId=W.promoteId,this.inFlightDependencies=[]}parse(W,J,$,fe,Ee){return S._(this,void 0,void 0,function*(){this.status="parsing",this.data=W,this.collisionBoxArray=new S.a5;const we=new S.cr(Object.keys(W.layers).sort()),ze=new S.cs(this.tileID,this.promoteId);ze.bucketLayerIDs=[];const Ce={},Ye={featureIndex:ze,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:$,subdivisionGranularity:Ee},Ze=J.familiesBySource[this.source];for(const _t in Ze){const ii=W.layers[_t];if(!ii)continue;ii.version===1&&S.w(`Vector tile source "${this.source}" layer "${_t}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const In=we.encode(_t),pa=[];for(let Gt=0;Gt<ii.length;Gt++){const $n=ii.feature(Gt),Xi=ze.getId($n,_t);pa.push({feature:$n,id:Xi,index:Gt,sourceLayerIndex:In})}for(const Gt of Ze[_t]){const $n=Gt[0];$n.source!==this.source&&S.w(`layer.source = ${$n.source} does not equal this.source = ${this.source}`),$n.minzoom&&this.zoom<Math.floor($n.minzoom)||$n.maxzoom&&this.zoom>=$n.maxzoom||$n.visibility!=="none"&&(q(Gt,this.zoom,$),(Ce[$n.id]=$n.createBucket({index:ze.bucketLayerIDs.length,layers:Gt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:In,sourceID:this.source})).populate(pa,Ye,this.tileID.canonical),ze.bucketLayerIDs.push(Gt.map(Xi=>Xi.id)))}}const Pe=S.bD(Ye.glyphDependencies,_t=>Object.keys(_t).map(Number));this.inFlightDependencies.forEach(_t=>_t==null?void 0:_t.abort()),this.inFlightDependencies=[];let nt=Promise.resolve({});if(Object.keys(Pe).length){const _t=new AbortController;this.inFlightDependencies.push(_t),nt=fe.sendAsync({type:"GG",data:{stacks:Pe,source:this.source,tileID:this.tileID,type:"glyphs"}},_t)}const yt=Object.keys(Ye.iconDependencies);let St=Promise.resolve({});if(yt.length){const _t=new AbortController;this.inFlightDependencies.push(_t),St=fe.sendAsync({type:"GI",data:{icons:yt,source:this.source,tileID:this.tileID,type:"icons"}},_t)}const je=Object.keys(Ye.patternDependencies);let Vt=Promise.resolve({});if(je.length){const _t=new AbortController;this.inFlightDependencies.push(_t),Vt=fe.sendAsync({type:"GI",data:{icons:je,source:this.source,tileID:this.tileID,type:"patterns"}},_t)}const[Ot,Kt,ki]=yield Promise.all([nt,St,Vt]),ct=new k(Ot),Bt=new S.ct(Kt,ki);for(const _t in Ce){const ii=Ce[_t];ii instanceof S.a6?(q(ii.layers,this.zoom,$),S.cu({bucket:ii,glyphMap:Ot,glyphPositions:ct.positions,imageMap:Kt,imagePositions:Bt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Ye.subdivisionGranularity})):ii.hasPattern&&(ii instanceof S.cv||ii instanceof S.cw||ii instanceof S.cx)&&(q(ii.layers,this.zoom,$),ii.addFeatures(Ye,this.tileID.canonical,Bt.patternPositions))}return this.status="done",{buckets:Object.values(Ce).filter(_t=>!_t.isEmpty()),featureIndex:ze,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ct.image,imageAtlas:Bt,glyphMap:this.returnDependencies?Ot:null,iconMap:this.returnDependencies?Kt:null,glyphPositions:this.returnDependencies?ct.positions:null}})}}function q(De,W,J){const $=new S.C(W);for(const fe of De)fe.recalculate($,J)}class oe{constructor(W,J,$){this.actor=W,this.layerIndex=J,this.availableImages=$,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(W,J){return S._(this,void 0,void 0,function*(){const $=yield S.n(W.request,J);try{return{vectorTile:new S.cy.VectorTile(new S.cz($.data)),rawData:$.data,cacheControl:$.cacheControl,expires:$.expires}}catch(fe){const Ee=new Uint8Array($.data);let we=`Unable to parse the tile at ${W.request.url}, `;throw we+=Ee[0]===31&&Ee[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${fe.message}`,new Error(we)}})}loadTile(W){return S._(this,void 0,void 0,function*(){const J=W.uid,$=!!(W&&W.request&&W.request.collectResourceTiming)&&new S.cA(W.request),fe=new B(W);this.loading[J]=fe;const Ee=new AbortController;fe.abort=Ee;try{const we=yield this.loadVectorTile(W,Ee);if(delete this.loading[J],!we)return null;const ze=we.rawData,Ce={};we.expires&&(Ce.expires=we.expires),we.cacheControl&&(Ce.cacheControl=we.cacheControl);const Ye={};if($){const Pe=$.finish();Pe&&(Ye.resourceTiming=JSON.parse(JSON.stringify(Pe)))}fe.vectorTile=we.vectorTile;const Ze=fe.parse(we.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity);this.loaded[J]=fe,this.fetching[J]={rawTileData:ze,cacheControl:Ce,resourceTiming:Ye};try{const Pe=yield Ze;return S.e({rawTileData:ze.slice(0)},Pe,Ce,Ye)}finally{delete this.fetching[J]}}catch(we){throw delete this.loading[J],fe.status="done",this.loaded[J]=fe,we}})}reloadTile(W){return S._(this,void 0,void 0,function*(){const J=W.uid;if(!this.loaded||!this.loaded[J])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const $=this.loaded[J];if($.showCollisionBoxes=W.showCollisionBoxes,$.status==="parsing"){const fe=yield $.parse($.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity);let Ee;if(this.fetching[J]){const{rawTileData:we,cacheControl:ze,resourceTiming:Ce}=this.fetching[J];delete this.fetching[J],Ee=S.e({rawTileData:we.slice(0)},fe,ze,Ce)}else Ee=fe;return Ee}if($.status==="done"&&$.vectorTile)return $.parse($.vectorTile,this.layerIndex,this.availableImages,this.actor,W.subdivisionGranularity)})}abortTile(W){return S._(this,void 0,void 0,function*(){const J=this.loading,$=W.uid;J&&J[$]&&J[$].abort&&(J[$].abort.abort(),delete J[$])})}removeTile(W){return S._(this,void 0,void 0,function*(){this.loaded&&this.loaded[W.uid]&&delete this.loaded[W.uid]})}}class ne{constructor(){this.loaded={}}loadTile(W){return S._(this,void 0,void 0,function*(){const{uid:J,encoding:$,rawImageData:fe,redFactor:Ee,greenFactor:we,blueFactor:ze,baseShift:Ce}=W,Ye=fe.width+2,Ze=fe.height+2,Pe=S.b(fe)?new S.R({width:Ye,height:Ze},yield S.cB(fe,-1,-1,Ye,Ze)):fe,nt=new S.cC(J,Pe,$,Ee,we,ze,Ce);return this.loaded=this.loaded||{},this.loaded[J]=nt,nt})}removeTile(W){const J=this.loaded,$=W.uid;J&&J[$]&&delete J[$]}}var K,le,Ge=function(){if(le)return K;function De(J,$){if(J.length!==0){W(J[0],$);for(var fe=1;fe<J.length;fe++)W(J[fe],!$)}}function W(J,$){for(var fe=0,Ee=0,we=0,ze=J.length,Ce=ze-1;we<ze;Ce=we++){var Ye=(J[we][0]-J[Ce][0])*(J[Ce][1]+J[we][1]),Ze=fe+Ye;Ee+=Math.abs(fe)>=Math.abs(Ye)?fe-Ze+Ye:Ye-Ze+fe,fe=Ze}fe+Ee>=0!=!!$&&J.reverse()}return le=1,K=function J($,fe){var Ee,we=$&&$.type;if(we==="FeatureCollection")for(Ee=0;Ee<$.features.length;Ee++)J($.features[Ee],fe);else if(we==="GeometryCollection")for(Ee=0;Ee<$.geometries.length;Ee++)J($.geometries[Ee],fe);else if(we==="Feature")J($.geometry,fe);else if(we==="Polygon")De($.coordinates,fe);else if(we==="MultiPolygon")for(Ee=0;Ee<$.coordinates.length;Ee++)De($.coordinates[Ee],fe);return $}}(),tt=S.cD(Ge);const Ke=S.cy.VectorTileFeature.prototype.toGeoJSON;class ht{constructor(W){this._feature=W,this.extent=S.Z,this.type=W.type,this.properties=W.tags,"id"in W&&!isNaN(W.id)&&(this.id=parseInt(W.id,10))}loadGeometry(){if(this._feature.type===1){const W=[];for(const J of this._feature.geometry)W.push([new S.P(J[0],J[1])]);return W}{const W=[];for(const J of this._feature.geometry){const $=[];for(const fe of J)$.push(new S.P(fe[0],fe[1]));W.push($)}return W}}toGeoJSON(W,J,$){return Ke.call(this,W,J,$)}}class bt{constructor(W){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=S.Z,this.length=W.length,this._features=W}feature(W){return new ht(this._features[W])}}var It,wt,zt,Pt={exports:{}},ut=function(){if(zt)return Pt.exports;zt=1;var De=S.cG(),W=function(){if(wt)return It;wt=1;var Ze=S.cE(),Pe=S.cF().VectorTileFeature;function nt(St,je){this.options=je||{},this.features=St,this.length=St.length}function yt(St,je){this.id=typeof St.id=="number"?St.id:void 0,this.type=St.type,this.rawGeometry=St.type===1?[St.geometry]:St.geometry,this.properties=St.tags,this.extent=je||4096}return It=nt,nt.prototype.feature=function(St){return new yt(this.features[St],this.options.extent)},yt.prototype.loadGeometry=function(){var St=this.rawGeometry;this.geometry=[];for(var je=0;je<St.length;je++){for(var Vt=St[je],Ot=[],Kt=0;Kt<Vt.length;Kt++)Ot.push(new Ze(Vt[Kt][0],Vt[Kt][1]));this.geometry.push(Ot)}return this.geometry},yt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var St=this.geometry,je=1/0,Vt=-1/0,Ot=1/0,Kt=-1/0,ki=0;ki<St.length;ki++)for(var ct=St[ki],Bt=0;Bt<ct.length;Bt++){var _t=ct[Bt];je=Math.min(je,_t.x),Vt=Math.max(Vt,_t.x),Ot=Math.min(Ot,_t.y),Kt=Math.max(Kt,_t.y)}return[je,Ot,Vt,Kt]},yt.prototype.toGeoJSON=Pe.prototype.toGeoJSON,It}();function J(Ze){var Pe=new De;return function(nt,yt){for(var St in nt.layers)yt.writeMessage(3,$,nt.layers[St])}(Ze,Pe),Pe.finish()}function $(Ze,Pe){var nt;Pe.writeVarintField(15,Ze.version||1),Pe.writeStringField(1,Ze.name||""),Pe.writeVarintField(5,Ze.extent||4096);var yt={keys:[],values:[],keycache:{},valuecache:{}};for(nt=0;nt<Ze.length;nt++)yt.feature=Ze.feature(nt),Pe.writeMessage(2,fe,yt);var St=yt.keys;for(nt=0;nt<St.length;nt++)Pe.writeStringField(3,St[nt]);var je=yt.values;for(nt=0;nt<je.length;nt++)Pe.writeMessage(4,Ye,je[nt])}function fe(Ze,Pe){var nt=Ze.feature;nt.id!==void 0&&Pe.writeVarintField(1,nt.id),Pe.writeMessage(2,Ee,Ze),Pe.writeVarintField(3,nt.type),Pe.writeMessage(4,Ce,nt)}function Ee(Ze,Pe){var nt=Ze.feature,yt=Ze.keys,St=Ze.values,je=Ze.keycache,Vt=Ze.valuecache;for(var Ot in nt.properties){var Kt=nt.properties[Ot],ki=je[Ot];if(Kt!==null){ki===void 0&&(yt.push(Ot),je[Ot]=ki=yt.length-1),Pe.writeVarint(ki);var ct=typeof Kt;ct!=="string"&&ct!=="boolean"&&ct!=="number"&&(Kt=JSON.stringify(Kt));var Bt=ct+":"+Kt,_t=Vt[Bt];_t===void 0&&(St.push(Kt),Vt[Bt]=_t=St.length-1),Pe.writeVarint(_t)}}}function we(Ze,Pe){return(Pe<<3)+(7&Ze)}function ze(Ze){return Ze<<1^Ze>>31}function Ce(Ze,Pe){for(var nt=Ze.loadGeometry(),yt=Ze.type,St=0,je=0,Vt=nt.length,Ot=0;Ot<Vt;Ot++){var Kt=nt[Ot],ki=1;yt===1&&(ki=Kt.length),Pe.writeVarint(we(1,ki));for(var ct=yt===3?Kt.length-1:Kt.length,Bt=0;Bt<ct;Bt++){Bt===1&&yt!==1&&Pe.writeVarint(we(2,ct-1));var _t=Kt[Bt].x-St,ii=Kt[Bt].y-je;Pe.writeVarint(ze(_t)),Pe.writeVarint(ze(ii)),St+=_t,je+=ii}yt===3&&Pe.writeVarint(we(7,1))}}function Ye(Ze,Pe){var nt=typeof Ze;nt==="string"?Pe.writeStringField(1,Ze):nt==="boolean"?Pe.writeBooleanField(7,Ze):nt==="number"&&(Ze%1!=0?Pe.writeDoubleField(3,Ze):Ze<0?Pe.writeSVarintField(6,Ze):Pe.writeVarintField(5,Ze))}return Pt.exports=J,Pt.exports.fromVectorTileJs=J,Pt.exports.fromGeojsonVt=function(Ze,Pe){Pe=Pe||{};var nt={};for(var yt in Ze)nt[yt]=new W(Ze[yt].features,Pe),nt[yt].name=yt,nt[yt].version=Pe.version,nt[yt].extent=Pe.extent;return J({layers:nt})},Pt.exports.GeoJSONWrapper=W,Pt.exports}(),Mt=S.cD(ut);const Ri={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:De=>De},bi=Math.fround||(te=new Float32Array(1),De=>(te[0]=+De,te[0]));var te;const be=3,Fe=5,xt=6;class Ae{constructor(W){this.options=Object.assign(Object.create(Ri),W),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(W){const{log:J,minZoom:$,maxZoom:fe}=this.options;J&&console.time("total time");const Ee=`prepare ${W.length} points`;J&&console.time(Ee),this.points=W;const we=[];for(let Ce=0;Ce<W.length;Ce++){const Ye=W[Ce];if(!Ye.geometry)continue;const[Ze,Pe]=Ye.geometry.coordinates,nt=bi(yi(Ze)),yt=bi(xe(Pe));we.push(nt,yt,1/0,Ce,-1,1),this.options.reduce&&we.push(0)}let ze=this.trees[fe+1]=this._createTree(we);J&&console.timeEnd(Ee);for(let Ce=fe;Ce>=$;Ce--){const Ye=+Date.now();ze=this.trees[Ce]=this._createTree(this._cluster(ze,Ce)),J&&console.log("z%d: %d clusters in %dms",Ce,ze.numItems,+Date.now()-Ye)}return J&&console.timeEnd("total time"),this}getClusters(W,J){let $=((W[0]+180)%360+360)%360-180;const fe=Math.max(-90,Math.min(90,W[1]));let Ee=W[2]===180?180:((W[2]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)$=-180,Ee=180;else if($>Ee){const Pe=this.getClusters([$,fe,180,we],J),nt=this.getClusters([-180,fe,Ee,we],J);return Pe.concat(nt)}const ze=this.trees[this._limitZoom(J)],Ce=ze.range(yi($),xe(we),yi(Ee),xe(fe)),Ye=ze.data,Ze=[];for(const Pe of Ce){const nt=this.stride*Pe;Ze.push(Ye[nt+Fe]>1?st(Ye,nt,this.clusterProps):this.points[Ye[nt+be]])}return Ze}getChildren(W){const J=this._getOriginId(W),$=this._getOriginZoom(W),fe="No cluster with the specified id.",Ee=this.trees[$];if(!Ee)throw new Error(fe);const we=Ee.data;if(J*this.stride>=we.length)throw new Error(fe);const ze=this.options.radius/(this.options.extent*Math.pow(2,$-1)),Ce=Ee.within(we[J*this.stride],we[J*this.stride+1],ze),Ye=[];for(const Ze of Ce){const Pe=Ze*this.stride;we[Pe+4]===W&&Ye.push(we[Pe+Fe]>1?st(we,Pe,this.clusterProps):this.points[we[Pe+be]])}if(Ye.length===0)throw new Error(fe);return Ye}getLeaves(W,J,$){const fe=[];return this._appendLeaves(fe,W,J=J||10,$=$||0,0),fe}getTile(W,J,$){const fe=this.trees[this._limitZoom(W)],Ee=Math.pow(2,W),{extent:we,radius:ze}=this.options,Ce=ze/we,Ye=($-Ce)/Ee,Ze=($+1+Ce)/Ee,Pe={features:[]};return this._addTileFeatures(fe.range((J-Ce)/Ee,Ye,(J+1+Ce)/Ee,Ze),fe.data,J,$,Ee,Pe),J===0&&this._addTileFeatures(fe.range(1-Ce/Ee,Ye,1,Ze),fe.data,Ee,$,Ee,Pe),J===Ee-1&&this._addTileFeatures(fe.range(0,Ye,Ce/Ee,Ze),fe.data,-1,$,Ee,Pe),Pe.features.length?Pe:null}getClusterExpansionZoom(W){let J=this._getOriginZoom(W)-1;for(;J<=this.options.maxZoom;){const $=this.getChildren(W);if(J++,$.length!==1)break;W=$[0].properties.cluster_id}return J}_appendLeaves(W,J,$,fe,Ee){const we=this.getChildren(J);for(const ze of we){const Ce=ze.properties;if(Ce&&Ce.cluster?Ee+Ce.point_count<=fe?Ee+=Ce.point_count:Ee=this._appendLeaves(W,Ce.cluster_id,$,fe,Ee):Ee<fe?Ee++:W.push(ze),W.length===$)break}return Ee}_createTree(W){const J=new S.aC(W.length/this.stride|0,this.options.nodeSize,Float32Array);for(let $=0;$<W.length;$+=this.stride)J.add(W[$],W[$+1]);return J.finish(),J.data=W,J}_addTileFeatures(W,J,$,fe,Ee,we){for(const ze of W){const Ce=ze*this.stride,Ye=J[Ce+Fe]>1;let Ze,Pe,nt;if(Ye)Ze=Ct(J,Ce,this.clusterProps),Pe=J[Ce],nt=J[Ce+1];else{const je=this.points[J[Ce+be]];Ze=je.properties;const[Vt,Ot]=je.geometry.coordinates;Pe=yi(Vt),nt=xe(Ot)}const yt={type:1,geometry:[[Math.round(this.options.extent*(Pe*Ee-$)),Math.round(this.options.extent*(nt*Ee-fe))]],tags:Ze};let St;St=Ye||this.options.generateId?J[Ce+be]:this.points[J[Ce+be]].id,St!==void 0&&(yt.id=St),we.features.push(yt)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(Math.floor(+W),this.options.maxZoom+1))}_cluster(W,J){const{radius:$,extent:fe,reduce:Ee,minPoints:we}=this.options,ze=$/(fe*Math.pow(2,J)),Ce=W.data,Ye=[],Ze=this.stride;for(let Pe=0;Pe<Ce.length;Pe+=Ze){if(Ce[Pe+2]<=J)continue;Ce[Pe+2]=J;const nt=Ce[Pe],yt=Ce[Pe+1],St=W.within(Ce[Pe],Ce[Pe+1],ze),je=Ce[Pe+Fe];let Vt=je;for(const Ot of St){const Kt=Ot*Ze;Ce[Kt+2]>J&&(Vt+=Ce[Kt+Fe])}if(Vt>je&&Vt>=we){let Ot,Kt=nt*je,ki=yt*je,ct=-1;const Bt=((Pe/Ze|0)<<5)+(J+1)+this.points.length;for(const _t of St){const ii=_t*Ze;if(Ce[ii+2]<=J)continue;Ce[ii+2]=J;const In=Ce[ii+Fe];Kt+=Ce[ii]*In,ki+=Ce[ii+1]*In,Ce[ii+4]=Bt,Ee&&(Ot||(Ot=this._map(Ce,Pe,!0),ct=this.clusterProps.length,this.clusterProps.push(Ot)),Ee(Ot,this._map(Ce,ii)))}Ce[Pe+4]=Bt,Ye.push(Kt/Vt,ki/Vt,1/0,Bt,-1,Vt),Ee&&Ye.push(ct)}else{for(let Ot=0;Ot<Ze;Ot++)Ye.push(Ce[Pe+Ot]);if(Vt>1)for(const Ot of St){const Kt=Ot*Ze;if(!(Ce[Kt+2]<=J)){Ce[Kt+2]=J;for(let ki=0;ki<Ze;ki++)Ye.push(Ce[Kt+ki])}}}}return Ye}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,J,$){if(W[J+Fe]>1){const we=this.clusterProps[W[J+xt]];return $?Object.assign({},we):we}const fe=this.points[W[J+be]].properties,Ee=this.options.map(fe);return $&&Ee===fe?Object.assign({},Ee):Ee}}function st(De,W,J){return{type:"Feature",id:De[W+be],properties:Ct(De,W,J),geometry:{type:"Point",coordinates:[($=De[W],360*($-.5)),lt(De[W+1])]}};var $}function Ct(De,W,J){const $=De[W+Fe],fe=$>=1e4?`${Math.round($/1e3)}k`:$>=1e3?Math.round($/100)/10+"k":$,Ee=De[W+xt],we=Ee===-1?{}:Object.assign({},J[Ee]);return Object.assign(we,{cluster:!0,cluster_id:De[W+be],point_count:$,point_count_abbreviated:fe})}function yi(De){return De/360+.5}function xe(De){const W=Math.sin(De*Math.PI/180),J=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return J<0?0:J>1?1:J}function lt(De){const W=(180-360*De)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}function Dt(De,W,J,$){let fe=$;const Ee=W+(J-W>>1);let we,ze=J-W;const Ce=De[W],Ye=De[W+1],Ze=De[J],Pe=De[J+1];for(let nt=W+3;nt<J;nt+=3){const yt=vt(De[nt],De[nt+1],Ce,Ye,Ze,Pe);if(yt>fe)we=nt,fe=yt;else if(yt===fe){const St=Math.abs(nt-Ee);St<ze&&(we=nt,ze=St)}}fe>$&&(we-W>3&&Dt(De,W,we,$),De[we+2]=fe,J-we>3&&Dt(De,we,J,$))}function vt(De,W,J,$,fe,Ee){let we=fe-J,ze=Ee-$;if(we!==0||ze!==0){const Ce=((De-J)*we+(W-$)*ze)/(we*we+ze*ze);Ce>1?(J=fe,$=Ee):Ce>0&&(J+=we*Ce,$+=ze*Ce)}return we=De-J,ze=W-$,we*we+ze*ze}function Zt(De,W,J,$){const fe={id:De??null,type:W,geometry:J,tags:$,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(W==="Point"||W==="MultiPoint"||W==="LineString")ti(fe,J);else if(W==="Polygon")ti(fe,J[0]);else if(W==="MultiLineString")for(const Ee of J)ti(fe,Ee);else if(W==="MultiPolygon")for(const Ee of J)ti(fe,Ee[0]);return fe}function ti(De,W){for(let J=0;J<W.length;J+=3)De.minX=Math.min(De.minX,W[J]),De.minY=Math.min(De.minY,W[J+1]),De.maxX=Math.max(De.maxX,W[J]),De.maxY=Math.max(De.maxY,W[J+1])}function Jt(De,W,J,$){if(!W.geometry)return;const fe=W.geometry.coordinates;if(fe&&fe.length===0)return;const Ee=W.geometry.type,we=Math.pow(J.tolerance/((1<<J.maxZoom)*J.extent),2);let ze=[],Ce=W.id;if(J.promoteId?Ce=W.properties[J.promoteId]:J.generateId&&(Ce=$||0),Ee==="Point")ar(fe,ze);else if(Ee==="MultiPoint")for(const Ye of fe)ar(Ye,ze);else if(Ee==="LineString")zi(fe,ze,we,!1);else if(Ee==="MultiLineString"){if(J.lineMetrics){for(const Ye of fe)ze=[],zi(Ye,ze,we,!1),De.push(Zt(Ce,"LineString",ze,W.properties));return}Fn(fe,ze,we,!1)}else if(Ee==="Polygon")Fn(fe,ze,we,!0);else{if(Ee!=="MultiPolygon"){if(Ee==="GeometryCollection"){for(const Ye of W.geometry.geometries)Jt(De,{id:Ce,geometry:Ye,properties:W.properties},J,$);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ye of fe){const Ze=[];Fn(Ye,Ze,we,!0),ze.push(Ze)}}De.push(Zt(Ce,Ee,ze,W.properties))}function ar(De,W){W.push(Is(De[0]),qn(De[1]),0)}function zi(De,W,J,$){let fe,Ee,we=0;for(let Ce=0;Ce<De.length;Ce++){const Ye=Is(De[Ce][0]),Ze=qn(De[Ce][1]);W.push(Ye,Ze,0),Ce>0&&(we+=$?(fe*Ze-Ye*Ee)/2:Math.sqrt(Math.pow(Ye-fe,2)+Math.pow(Ze-Ee,2))),fe=Ye,Ee=Ze}const ze=W.length-3;W[2]=1,Dt(W,0,ze,J),W[ze+2]=1,W.size=Math.abs(we),W.start=0,W.end=W.size}function Fn(De,W,J,$){for(let fe=0;fe<De.length;fe++){const Ee=[];zi(De[fe],Ee,J,$),W.push(Ee)}}function Is(De){return De/360+.5}function qn(De){const W=Math.sin(De*Math.PI/180),J=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return J<0?0:J>1?1:J}function sr(De,W,J,$,fe,Ee,we,ze){if($/=W,Ee>=(J/=W)&&we<$)return De;if(we<J||Ee>=$)return null;const Ce=[];for(const Ye of De){const Ze=Ye.geometry;let Pe=Ye.type;const nt=fe===0?Ye.minX:Ye.minY,yt=fe===0?Ye.maxX:Ye.maxY;if(nt>=J&&yt<$){Ce.push(Ye);continue}if(yt<J||nt>=$)continue;let St=[];if(Pe==="Point"||Pe==="MultiPoint")as(Ze,St,J,$,fe);else if(Pe==="LineString")Nn(Ze,St,J,$,fe,!1,ze.lineMetrics);else if(Pe==="MultiLineString")vl(Ze,St,J,$,fe,!1);else if(Pe==="Polygon")vl(Ze,St,J,$,fe,!0);else if(Pe==="MultiPolygon")for(const je of Ze){const Vt=[];vl(je,Vt,J,$,fe,!0),Vt.length&&St.push(Vt)}if(St.length){if(ze.lineMetrics&&Pe==="LineString"){for(const je of St)Ce.push(Zt(Ye.id,Pe,je,Ye.tags));continue}Pe!=="LineString"&&Pe!=="MultiLineString"||(St.length===1?(Pe="LineString",St=St[0]):Pe="MultiLineString"),Pe!=="Point"&&Pe!=="MultiPoint"||(Pe=St.length===3?"Point":"MultiPoint"),Ce.push(Zt(Ye.id,Pe,St,Ye.tags))}}return Ce.length?Ce:null}function as(De,W,J,$,fe){for(let Ee=0;Ee<De.length;Ee+=3){const we=De[Ee+fe];we>=J&&we<=$&&dr(W,De[Ee],De[Ee+1],De[Ee+2])}}function Nn(De,W,J,$,fe,Ee,we){let ze=yl(De);const Ce=fe===0?Po:no;let Ye,Ze,Pe=De.start;for(let Vt=0;Vt<De.length-3;Vt+=3){const Ot=De[Vt],Kt=De[Vt+1],ki=De[Vt+2],ct=De[Vt+3],Bt=De[Vt+4],_t=fe===0?Ot:Kt,ii=fe===0?ct:Bt;let In=!1;we&&(Ye=Math.sqrt(Math.pow(Ot-ct,2)+Math.pow(Kt-Bt,2))),_t<J?ii>J&&(Ze=Ce(ze,Ot,Kt,ct,Bt,J),we&&(ze.start=Pe+Ye*Ze)):_t>$?ii<$&&(Ze=Ce(ze,Ot,Kt,ct,Bt,$),we&&(ze.start=Pe+Ye*Ze)):dr(ze,Ot,Kt,ki),ii<J&&_t>=J&&(Ze=Ce(ze,Ot,Kt,ct,Bt,J),In=!0),ii>$&&_t<=$&&(Ze=Ce(ze,Ot,Kt,ct,Bt,$),In=!0),!Ee&&In&&(we&&(ze.end=Pe+Ye*Ze),W.push(ze),ze=yl(De)),we&&(Pe+=Ye)}let nt=De.length-3;const yt=De[nt],St=De[nt+1],je=fe===0?yt:St;je>=J&&je<=$&&dr(ze,yt,St,De[nt+2]),nt=ze.length-3,Ee&&nt>=3&&(ze[nt]!==ze[0]||ze[nt+1]!==ze[1])&&dr(ze,ze[0],ze[1],ze[2]),ze.length&&W.push(ze)}function yl(De){const W=[];return W.size=De.size,W.start=De.start,W.end=De.end,W}function vl(De,W,J,$,fe,Ee){for(const we of De)Nn(we,W,J,$,fe,Ee,!1)}function dr(De,W,J,$){De.push(W,J,$)}function Po(De,W,J,$,fe,Ee){const we=(Ee-W)/($-W);return dr(De,Ee,J+(fe-J)*we,1),we}function no(De,W,J,$,fe,Ee){const we=(Ee-J)/(fe-J);return dr(De,W+($-W)*we,Ee,1),we}function Fa(De,W){const J=[];for(let $=0;$<De.length;$++){const fe=De[$],Ee=fe.type;let we;if(Ee==="Point"||Ee==="MultiPoint"||Ee==="LineString")we=fa(fe.geometry,W);else if(Ee==="MultiLineString"||Ee==="Polygon"){we=[];for(const ze of fe.geometry)we.push(fa(ze,W))}else if(Ee==="MultiPolygon"){we=[];for(const ze of fe.geometry){const Ce=[];for(const Ye of ze)Ce.push(fa(Ye,W));we.push(Ce)}}J.push(Zt(fe.id,Ee,we,fe.tags))}return J}function fa(De,W){const J=[];J.size=De.size,De.start!==void 0&&(J.start=De.start,J.end=De.end);for(let $=0;$<De.length;$+=3)J.push(De[$]+W,De[$+1],De[$+2]);return J}function vc(De,W){if(De.transformed)return De;const J=1<<De.z,$=De.x,fe=De.y;for(const Ee of De.features){const we=Ee.geometry,ze=Ee.type;if(Ee.geometry=[],ze===1)for(let Ce=0;Ce<we.length;Ce+=2)Ee.geometry.push(bl(we[Ce],we[Ce+1],W,J,$,fe));else for(let Ce=0;Ce<we.length;Ce++){const Ye=[];for(let Ze=0;Ze<we[Ce].length;Ze+=2)Ye.push(bl(we[Ce][Ze],we[Ce][Ze+1],W,J,$,fe));Ee.geometry.push(Ye)}}return De.transformed=!0,De}function bl(De,W,J,$,fe,Ee){return[Math.round(J*(De*$-fe)),Math.round(J*(W*$-Ee))]}function uu(De,W,J,$,fe){const Ee=W===fe.maxZoom?0:fe.tolerance/((1<<W)*fe.extent),we={features:[],numPoints:0,numSimplified:0,numFeatures:De.length,source:null,x:J,y:$,z:W,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ze of De)xl(we,ze,Ee,fe);return we}function xl(De,W,J,$){const fe=W.geometry,Ee=W.type,we=[];if(De.minX=Math.min(De.minX,W.minX),De.minY=Math.min(De.minY,W.minY),De.maxX=Math.max(De.maxX,W.maxX),De.maxY=Math.max(De.maxY,W.maxY),Ee==="Point"||Ee==="MultiPoint")for(let ze=0;ze<fe.length;ze+=3)we.push(fe[ze],fe[ze+1]),De.numPoints++,De.numSimplified++;else if(Ee==="LineString")Na(we,fe,De,J,!1,!1);else if(Ee==="MultiLineString"||Ee==="Polygon")for(let ze=0;ze<fe.length;ze++)Na(we,fe[ze],De,J,Ee==="Polygon",ze===0);else if(Ee==="MultiPolygon")for(let ze=0;ze<fe.length;ze++){const Ce=fe[ze];for(let Ye=0;Ye<Ce.length;Ye++)Na(we,Ce[Ye],De,J,!0,Ye===0)}if(we.length){let ze=W.tags||null;if(Ee==="LineString"&&$.lineMetrics){ze={};for(const Ye in W.tags)ze[Ye]=W.tags[Ye];ze.mapbox_clip_start=fe.start/fe.size,ze.mapbox_clip_end=fe.end/fe.size}const Ce={geometry:we,type:Ee==="Polygon"||Ee==="MultiPolygon"?3:Ee==="LineString"||Ee==="MultiLineString"?2:1,tags:ze};W.id!==null&&(Ce.id=W.id),De.features.push(Ce)}}function Na(De,W,J,$,fe,Ee){const we=$*$;if($>0&&W.size<(fe?we:$))return void(J.numPoints+=W.length/3);const ze=[];for(let Ce=0;Ce<W.length;Ce+=3)($===0||W[Ce+2]>we)&&(J.numSimplified++,ze.push(W[Ce],W[Ce+1])),J.numPoints++;fe&&function(Ce,Ye){let Ze=0;for(let Pe=0,nt=Ce.length,yt=nt-2;Pe<nt;yt=Pe,Pe+=2)Ze+=(Ce[Pe]-Ce[yt])*(Ce[Pe+1]+Ce[yt+1]);if(Ze>0===Ye)for(let Pe=0,nt=Ce.length;Pe<nt/2;Pe+=2){const yt=Ce[Pe],St=Ce[Pe+1];Ce[Pe]=Ce[nt-2-Pe],Ce[Pe+1]=Ce[nt-1-Pe],Ce[nt-2-Pe]=yt,Ce[nt-1-Pe]=St}}(ze,Ee),De.push(ze)}const Ir={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class $r{constructor(W,J){const $=(J=this.options=function(Ee,we){for(const ze in we)Ee[ze]=we[ze];return Ee}(Object.create(Ir),J)).debug;if($&&console.time("preprocess data"),J.maxZoom<0||J.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(J.promoteId&&J.generateId)throw new Error("promoteId and generateId cannot be used together.");let fe=function(Ee,we){const ze=[];if(Ee.type==="FeatureCollection")for(let Ce=0;Ce<Ee.features.length;Ce++)Jt(ze,Ee.features[Ce],we,Ce);else Jt(ze,Ee.type==="Feature"?Ee:{geometry:Ee},we);return ze}(W,J);this.tiles={},this.tileCoords=[],$&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",J.indexMaxZoom,J.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),fe=function(Ee,we){const ze=we.buffer/we.extent;let Ce=Ee;const Ye=sr(Ee,1,-1-ze,ze,0,-1,2,we),Ze=sr(Ee,1,1-ze,2+ze,0,-1,2,we);return(Ye||Ze)&&(Ce=sr(Ee,1,-ze,1+ze,0,-1,2,we)||[],Ye&&(Ce=Fa(Ye,1).concat(Ce)),Ze&&(Ce=Ce.concat(Fa(Ze,-1)))),Ce}(fe,J),fe.length&&this.splitTile(fe,0,0,0),$&&(fe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(W,J,$,fe,Ee,we,ze){const Ce=[W,J,$,fe],Ye=this.options,Ze=Ye.debug;for(;Ce.length;){fe=Ce.pop(),$=Ce.pop(),J=Ce.pop(),W=Ce.pop();const Pe=1<<J,nt=Wn(J,$,fe);let yt=this.tiles[nt];if(!yt&&(Ze>1&&console.time("creation"),yt=this.tiles[nt]=uu(W,J,$,fe,Ye),this.tileCoords.push({z:J,x:$,y:fe}),Ze)){Ze>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",J,$,fe,yt.numFeatures,yt.numPoints,yt.numSimplified),console.timeEnd("creation"));const In=`z${J}`;this.stats[In]=(this.stats[In]||0)+1,this.total++}if(yt.source=W,Ee==null){if(J===Ye.indexMaxZoom||yt.numPoints<=Ye.indexMaxPoints)continue}else{if(J===Ye.maxZoom||J===Ee)continue;if(Ee!=null){const In=Ee-J;if($!==we>>In||fe!==ze>>In)continue}}if(yt.source=null,W.length===0)continue;Ze>1&&console.time("clipping");const St=.5*Ye.buffer/Ye.extent,je=.5-St,Vt=.5+St,Ot=1+St;let Kt=null,ki=null,ct=null,Bt=null,_t=sr(W,Pe,$-St,$+Vt,0,yt.minX,yt.maxX,Ye),ii=sr(W,Pe,$+je,$+Ot,0,yt.minX,yt.maxX,Ye);W=null,_t&&(Kt=sr(_t,Pe,fe-St,fe+Vt,1,yt.minY,yt.maxY,Ye),ki=sr(_t,Pe,fe+je,fe+Ot,1,yt.minY,yt.maxY,Ye),_t=null),ii&&(ct=sr(ii,Pe,fe-St,fe+Vt,1,yt.minY,yt.maxY,Ye),Bt=sr(ii,Pe,fe+je,fe+Ot,1,yt.minY,yt.maxY,Ye),ii=null),Ze>1&&console.timeEnd("clipping"),Ce.push(Kt||[],J+1,2*$,2*fe),Ce.push(ki||[],J+1,2*$,2*fe+1),Ce.push(ct||[],J+1,2*$+1,2*fe),Ce.push(Bt||[],J+1,2*$+1,2*fe+1)}}getTile(W,J,$){W=+W,J=+J,$=+$;const fe=this.options,{extent:Ee,debug:we}=fe;if(W<0||W>24)return null;const ze=1<<W,Ce=Wn(W,J=J+ze&ze-1,$);if(this.tiles[Ce])return vc(this.tiles[Ce],Ee);we>1&&console.log("drilling down to z%d-%d-%d",W,J,$);let Ye,Ze=W,Pe=J,nt=$;for(;!Ye&&Ze>0;)Ze--,Pe>>=1,nt>>=1,Ye=this.tiles[Wn(Ze,Pe,nt)];return Ye&&Ye.source?(we>1&&(console.log("found parent tile z%d-%d-%d",Ze,Pe,nt),console.time("drilling down")),this.splitTile(Ye.source,Ze,Pe,nt,W,J,$),we>1&&console.timeEnd("drilling down"),this.tiles[Ce]?vc(this.tiles[Ce],Ee):null):null}}function Wn(De,W,J){return 32*((1<<De)*J+W)+De}function ro(De,W){return W?De.properties[W]:De.id}function bc(De,W){if(De==null)return!0;if(De.type==="Feature")return ro(De,W)!=null;if(De.type==="FeatureCollection"){const J=new Set;for(const $ of De.features){const fe=ro($,W);if(fe==null||J.has(fe))return!1;J.add(fe)}return!0}return!1}function hu(De,W){const J=new Map;if(De!=null)if(De.type==="Feature")J.set(ro(De,W),De);else for(const $ of De.features)J.set(ro($,W),$);return J}class wl extends oe{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(W,J){return S._(this,void 0,void 0,function*(){const $=W.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const fe=this._geoJSONIndex.getTile($.z,$.x,$.y);if(!fe)return null;const Ee=new bt(fe.features);let we=Mt(Ee);return we.byteOffset===0&&we.byteLength===we.buffer.byteLength||(we=new Uint8Array(we)),{vectorTile:Ee,rawData:we.buffer}})}loadData(W){return S._(this,void 0,void 0,function*(){var J;(J=this._pendingRequest)===null||J===void 0||J.abort();const $=!!(W&&W.request&&W.request.collectResourceTiming)&&new S.cA(W.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(W,this._pendingRequest),this._geoJSONIndex=W.cluster?new Ae(function({superclusterOptions:we,clusterProperties:ze}){if(!ze||!we)return we;const Ce={},Ye={},Ze={accumulated:null,zoom:0},Pe={properties:null},nt=Object.keys(ze);for(const yt of nt){const[St,je]=ze[yt],Vt=S.cH(je),Ot=S.cH(typeof St=="string"?[St,["accumulated"],["get",yt]]:St);Ce[yt]=Vt.value,Ye[yt]=Ot.value}return we.map=yt=>{Pe.properties=yt;const St={};for(const je of nt)St[je]=Ce[je].evaluate(Ze,Pe);return St},we.reduce=(yt,St)=>{Pe.properties=St;for(const je of nt)Ze.accumulated=yt[je],yt[je]=Ye[je].evaluate(Ze,Pe)},we}(W)).load((yield this._pendingData).features):(fe=yield this._pendingData,new $r(fe,W.geojsonVtOptions)),this.loaded={};const Ee={};if($){const we=$.finish();we&&(Ee.resourceTiming={},Ee.resourceTiming[W.source]=JSON.parse(JSON.stringify(we)))}return Ee}catch(Ee){if(delete this._pendingRequest,S.cl(Ee))return{abandoned:!0};throw Ee}var fe})}getData(){return S._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(W){const J=this.loaded;return J&&J[W.uid]?super.reloadTile(W):this.loadTile(W)}loadAndProcessGeoJSON(W,J){return S._(this,void 0,void 0,function*(){let $=yield this.loadGeoJSON(W,J);if(delete this._pendingRequest,typeof $!="object")throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);if(tt($,!0),W.filter){const fe=S.cH(W.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(fe.result==="error")throw new Error(fe.value.map(we=>`${we.key}: ${we.message}`).join(", "));$={type:"FeatureCollection",features:$.features.filter(we=>fe.value.evaluate({zoom:0},we))}}return $})}loadGeoJSON(W,J){return S._(this,void 0,void 0,function*(){const{promoteId:$}=W;if(W.request){const fe=yield S.j(W.request,J);return this._dataUpdateable=bc(fe.data,$)?hu(fe.data,$):void 0,fe.data}if(typeof W.data=="string")try{const fe=JSON.parse(W.data);return this._dataUpdateable=bc(fe,$)?hu(fe,$):void 0,fe}catch{throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`)}if(!W.dataDiff)throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${W.source}`);return function(fe,Ee,we){var ze,Ce,Ye,Ze;if(Ee.removeAll&&fe.clear(),Ee.remove)for(const Pe of Ee.remove)fe.delete(Pe);if(Ee.add)for(const Pe of Ee.add){const nt=ro(Pe,we);nt!=null&&fe.set(nt,Pe)}if(Ee.update)for(const Pe of Ee.update){let nt=fe.get(Pe.id);if(nt==null)continue;const yt=!Pe.removeAllProperties&&(((ze=Pe.removeProperties)===null||ze===void 0?void 0:ze.length)>0||((Ce=Pe.addOrUpdateProperties)===null||Ce===void 0?void 0:Ce.length)>0);if((Pe.newGeometry||Pe.removeAllProperties||yt)&&(nt=Object.assign({},nt),fe.set(Pe.id,nt),yt&&(nt.properties=Object.assign({},nt.properties))),Pe.newGeometry&&(nt.geometry=Pe.newGeometry),Pe.removeAllProperties)nt.properties={};else if(((Ye=Pe.removeProperties)===null||Ye===void 0?void 0:Ye.length)>0)for(const St of Pe.removeProperties)Object.prototype.hasOwnProperty.call(nt.properties,St)&&delete nt.properties[St];if(((Ze=Pe.addOrUpdateProperties)===null||Ze===void 0?void 0:Ze.length)>0)for(const{key:St,value:je}of Pe.addOrUpdateProperties)nt.properties[St]=je}}(this._dataUpdateable,W.dataDiff,$),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(W){return S._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(W){return this._geoJSONIndex.getClusterExpansionZoom(W.clusterId)}getClusterChildren(W){return this._geoJSONIndex.getChildren(W.clusterId)}getClusterLeaves(W){return this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset)}}class Ua{constructor(W){this.self=W,this.actor=new S.H(W),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(J,$)=>{if(this.externalWorkerSourceTypes[J])throw new Error(`Worker source with name "${J}" already registered.`);this.externalWorkerSourceTypes[J]=$},this.self.addProtocol=S.cn,this.self.removeProtocol=S.co,this.self.registerRTLTextPlugin=J=>{S.cI.setMethods(J)},this.actor.registerMessageHandler("LDT",(J,$)=>this._getDEMWorkerSource(J,$.source).loadTile($)),this.actor.registerMessageHandler("RDT",(J,$)=>S._(this,void 0,void 0,function*(){this._getDEMWorkerSource(J,$.source).removeTile($)})),this.actor.registerMessageHandler("GCEZ",(J,$)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(J,$.type,$.source).getClusterExpansionZoom($)})),this.actor.registerMessageHandler("GCC",(J,$)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(J,$.type,$.source).getClusterChildren($)})),this.actor.registerMessageHandler("GCL",(J,$)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(J,$.type,$.source).getClusterLeaves($)})),this.actor.registerMessageHandler("LD",(J,$)=>this._getWorkerSource(J,$.type,$.source).loadData($)),this.actor.registerMessageHandler("GD",(J,$)=>this._getWorkerSource(J,$.type,$.source).getData()),this.actor.registerMessageHandler("LT",(J,$)=>this._getWorkerSource(J,$.type,$.source).loadTile($)),this.actor.registerMessageHandler("RT",(J,$)=>this._getWorkerSource(J,$.type,$.source).reloadTile($)),this.actor.registerMessageHandler("AT",(J,$)=>this._getWorkerSource(J,$.type,$.source).abortTile($)),this.actor.registerMessageHandler("RMT",(J,$)=>this._getWorkerSource(J,$.type,$.source).removeTile($)),this.actor.registerMessageHandler("RS",(J,$)=>S._(this,void 0,void 0,function*(){if(!this.workerSources[J]||!this.workerSources[J][$.type]||!this.workerSources[J][$.type][$.source])return;const fe=this.workerSources[J][$.type][$.source];delete this.workerSources[J][$.type][$.source],fe.removeSource!==void 0&&fe.removeSource($)})),this.actor.registerMessageHandler("RM",J=>S._(this,void 0,void 0,function*(){delete this.layerIndexes[J],delete this.availableImages[J],delete this.workerSources[J],delete this.demWorkerSources[J]})),this.actor.registerMessageHandler("SR",(J,$)=>S._(this,void 0,void 0,function*(){this.referrer=$})),this.actor.registerMessageHandler("SRPS",(J,$)=>this._syncRTLPluginState(J,$)),this.actor.registerMessageHandler("IS",(J,$)=>S._(this,void 0,void 0,function*(){this.self.importScripts($)})),this.actor.registerMessageHandler("SI",(J,$)=>this._setImages(J,$)),this.actor.registerMessageHandler("UL",(J,$)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(J).update($.layers,$.removedIds)})),this.actor.registerMessageHandler("SL",(J,$)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(J).replace($)}))}_setImages(W,J){return S._(this,void 0,void 0,function*(){this.availableImages[W]=J;for(const $ in this.workerSources[W]){const fe=this.workerSources[W][$];for(const Ee in fe)fe[Ee].availableImages=J}})}_syncRTLPluginState(W,J){return S._(this,void 0,void 0,function*(){return yield S.cI.syncState(J,this.self.importScripts)})}_getAvailableImages(W){let J=this.availableImages[W];return J||(J=[]),J}_getLayerIndex(W){let J=this.layerIndexes[W];return J||(J=this.layerIndexes[W]=new u),J}_getWorkerSource(W,J,$){if(this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][J]||(this.workerSources[W][J]={}),!this.workerSources[W][J][$]){const fe={sendAsync:(Ee,we)=>(Ee.targetMapId=W,this.actor.sendAsync(Ee,we))};switch(J){case"vector":this.workerSources[W][J][$]=new oe(fe,this._getLayerIndex(W),this._getAvailableImages(W));break;case"geojson":this.workerSources[W][J][$]=new wl(fe,this._getLayerIndex(W),this._getAvailableImages(W));break;default:this.workerSources[W][J][$]=new this.externalWorkerSourceTypes[J](fe,this._getLayerIndex(W),this._getAvailableImages(W))}}return this.workerSources[W][J][$]}_getDEMWorkerSource(W,J){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][J]||(this.demWorkerSources[W][J]=new ne),this.demWorkerSources[W][J]}}return S.i(self)&&(self.worker=new Ua(self)),Ua}),_("index",["exports","./shared"],function(S,u){var k="5.3.1";function B(){var y=new u.A(4);return u.A!=Float32Array&&(y[1]=0,y[2]=0),y[0]=1,y[3]=1,y}let q,oe;const ne={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(y,t,s){const f=requestAnimationFrame(b=>{m(),t(b)}),{unsubscribe:m}=u.s(y.signal,"abort",()=>{m(),cancelAnimationFrame(f),s(u.c())},!1)},frameAsync(y){return new Promise((t,s)=>{this.frame(y,t,s)})},getImageData(y,t=0){return this.getImageCanvasContext(y).getImageData(-t,-t,y.width+2*t,y.height+2*t)},getImageCanvasContext(y){const t=window.document.createElement("canvas"),s=t.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return t.width=y.width,t.height=y.height,s.drawImage(y,0,0,y.width,y.height),s},resolveURL:y=>(q||(q=document.createElement("a")),q.href=y,q.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(oe==null&&(oe=matchMedia("(prefers-reduced-motion: reduce)")),oe.matches)}};class K{static testProp(t){if(!K.docStyle)return t[0];for(let s=0;s<t.length;s++)if(t[s]in K.docStyle)return t[s];return t[0]}static create(t,s,f){const m=window.document.createElement(t);return s!==void 0&&(m.className=s),f&&f.appendChild(m),m}static createNS(t,s){return window.document.createElementNS(t,s)}static disableDrag(){K.docStyle&&K.selectProp&&(K.userSelect=K.docStyle[K.selectProp],K.docStyle[K.selectProp]="none")}static enableDrag(){K.docStyle&&K.selectProp&&(K.docStyle[K.selectProp]=K.userSelect)}static setTransform(t,s){t.style[K.transformProp]=s}static addEventListener(t,s,f,m={}){t.addEventListener(s,f,"passive"in m?m:m.capture)}static removeEventListener(t,s,f,m={}){t.removeEventListener(s,f,"passive"in m?m:m.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",K.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",K.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",K.suppressClickInternal,!0)},0)}static getScale(t){const s=t.getBoundingClientRect();return{x:s.width/t.offsetWidth||1,y:s.height/t.offsetHeight||1,boundingClientRect:s}}static getPoint(t,s,f){const m=s.boundingClientRect;return new u.P((f.clientX-m.left)/s.x-t.clientLeft,(f.clientY-m.top)/s.y-t.clientTop)}static mousePos(t,s){const f=K.getScale(t);return K.getPoint(t,f,s)}static touchPos(t,s){const f=[],m=K.getScale(t);for(let b=0;b<s.length;b++)f.push(K.getPoint(t,m,s[b]));return f}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const s=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),f=s.querySelectorAll("script");for(const m of f)m.remove();return K.clean(s),s.innerHTML}static isPossiblyDangerous(t,s){const f=s.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!f.includes("javascript:")&&!f.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const s=t.children;for(const f of s)K.removeAttributes(f),K.clean(f)}static removeAttributes(t){for(const{name:s,value:f}of t.attributes)K.isPossiblyDangerous(s,f)&&t.removeAttribute(s)}}K.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,K.selectProp=K.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),K.transformProp=K.testProp(["transform","WebkitTransform"]);const le={supported:!1,testSupport:function(y){!Ke&&tt&&(ht?bt(y):Ge=y)}};let Ge,tt,Ke=!1,ht=!1;function bt(y){const t=y.createTexture();y.bindTexture(y.TEXTURE_2D,t);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,tt),y.isContextLost())return;le.supported=!0}catch{}y.deleteTexture(t),Ke=!0}var It;typeof document<"u"&&(tt=document.createElement("img"),tt.onload=()=>{Ge&&bt(Ge),Ge=null,ht=!0},tt.onerror=()=>{Ke=!0,Ge=null},tt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(y){let t,s,f,m;y.resetRequestQueue=()=>{t=[],s=0,f=0,m={}},y.addThrottleControl=D=>{const z=f++;return m[z]=D,z},y.removeThrottleControl=D=>{delete m[D],E()},y.getImage=(D,z,F=!0)=>new Promise((U,N)=>{le.supported&&(D.headers||(D.headers={}),D.headers.accept="image/webp,*/*"),u.e(D,{type:"image"}),t.push({abortController:z,requestParameters:D,supportImageRefresh:F,state:"queued",onError:Y=>{N(Y)},onSuccess:Y=>{U(Y)}}),E()});const b=D=>u._(this,void 0,void 0,function*(){D.state="running";const{requestParameters:z,supportImageRefresh:F,onError:U,onSuccess:N,abortController:Y}=D,Q=F===!1&&!u.i(self)&&!u.g(z.url)&&(!z.headers||Object.keys(z.headers).reduce((ce,he)=>ce&&he==="accept",!0));s++;const se=Q?I(z,Y):u.m(z,Y);try{const ce=yield se;delete D.abortController,D.state="completed",ce.data instanceof HTMLImageElement||u.b(ce.data)?N(ce):ce.data&&N({data:yield(ae=ce.data,typeof createImageBitmap=="function"?u.f(ae):u.h(ae)),cacheControl:ce.cacheControl,expires:ce.expires})}catch(ce){delete D.abortController,U(ce)}finally{s--,E()}var ae}),E=()=>{const D=(()=>{for(const z of Object.keys(m))if(m[z]())return!0;return!1})()?u.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:u.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let z=s;z<D&&t.length>0;z++){const F=t.shift();F.abortController.signal.aborted?z--:b(F)}},I=(D,z)=>new Promise((F,U)=>{const N=new Image,Y=D.url,Q=D.credentials;Q&&Q==="include"?N.crossOrigin="use-credentials":(Q&&Q==="same-origin"||!u.d(Y))&&(N.crossOrigin="anonymous"),z.signal.addEventListener("abort",()=>{N.src="",U(u.c())}),N.fetchPriority="high",N.onload=()=>{N.onerror=N.onload=null,F({data:N})},N.onerror=()=>{N.onerror=N.onload=null,z.signal.aborted||U(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},N.src=Y})}(It||(It={})),It.resetRequestQueue();class wt{constructor(t){this._transformRequestFn=t}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function zt(y){const t=[];if(typeof y=="string")t.push({id:"default",url:y});else if(y&&y.length>0){const s=[];for(const{id:f,url:m}of y){const b=`${f}${m}`;s.indexOf(b)===-1&&(s.push(b),t.push({id:f,url:m}))}}return t}function Pt(y,t,s){try{const f=new URL(y);return f.pathname+=`${t}${s}`,f.toString()}catch{throw new Error(`Invalid sprite URL "${y}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class ut{constructor(t,s,f,m){this.context=t,this.format=f,this.texture=t.gl.createTexture(),this.update(s,m)}update(t,s,f){const{width:m,height:b}=t,E=!(this.size&&this.size[0]===m&&this.size[1]===b||f),{context:I}=this,{gl:D}=I;if(this.useMipmap=!!(s&&s.useMipmap),D.bindTexture(D.TEXTURE_2D,this.texture),I.pixelStoreUnpackFlipY.set(!1),I.pixelStoreUnpack.set(1),I.pixelStoreUnpackPremultiplyAlpha.set(this.format===D.RGBA&&(!s||s.premultiply!==!1)),E)this.size=[m,b],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||u.b(t)?D.texImage2D(D.TEXTURE_2D,0,this.format,this.format,D.UNSIGNED_BYTE,t):D.texImage2D(D.TEXTURE_2D,0,this.format,m,b,0,this.format,D.UNSIGNED_BYTE,t.data);else{const{x:z,y:F}=f||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||u.b(t)?D.texSubImage2D(D.TEXTURE_2D,0,z,F,D.RGBA,D.UNSIGNED_BYTE,t):D.texSubImage2D(D.TEXTURE_2D,0,z,F,m,b,D.RGBA,D.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&D.generateMipmap(D.TEXTURE_2D),I.pixelStoreUnpackFlipY.setDefault(),I.pixelStoreUnpack.setDefault(),I.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,s,f){const{context:m}=this,{gl:b}=m;b.bindTexture(b.TEXTURE_2D,this.texture),f!==b.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(f=b.LINEAR),t!==this.filter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,t),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,f||t),this.filter=t),s!==this.wrap&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,s),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function Mt(y){const{userImage:t}=y;return!!(t&&t.render&&t.render())&&(y.data.replace(new Uint8Array(t.data.buffer)),!0)}class Ri extends u.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:s,promiseResolve:f}of this.requestors)f(this._getImagesForIds(s));this.requestors=[]}}getImage(t){const s=this.images[t];if(s&&!s.data&&s.spriteData){const f=s.spriteData;s.data=new u.R({width:f.width,height:f.height},f.context.getImageData(f.x,f.y,f.width,f.height).data),s.spriteData=null}return s}addImage(t,s){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,s)&&(this.images[t]=s)}_validate(t,s){let f=!0;const m=s.data||s.spriteData;return this._validateStretch(s.stretchX,m&&m.width)||(this.fire(new u.k(new Error(`Image "${t}" has invalid "stretchX" value`))),f=!1),this._validateStretch(s.stretchY,m&&m.height)||(this.fire(new u.k(new Error(`Image "${t}" has invalid "stretchY" value`))),f=!1),this._validateContent(s.content,s)||(this.fire(new u.k(new Error(`Image "${t}" has invalid "content" value`))),f=!1),f}_validateStretch(t,s){if(!t)return!0;let f=0;for(const m of t){if(m[0]<f||m[1]<m[0]||s<m[1])return!1;f=m[1]}return!0}_validateContent(t,s){if(!t)return!0;if(t.length!==4)return!1;const f=s.spriteData,m=f&&f.width||s.data.width,b=f&&f.height||s.data.height;return!(t[0]<0||m<t[0]||t[1]<0||b<t[1]||t[2]<0||m<t[2]||t[3]<0||b<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,s,f=!0){const m=this.getImage(t);if(f&&(m.data.width!==s.data.width||m.data.height!==s.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=m.version+1,this.images[t]=s,this.updatedImages[t]=!0}removeImage(t){const s=this.images[t];delete this.images[t],delete this.patterns[t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise((s,f)=>{let m=!0;if(!this.isLoaded())for(const b of t)this.images[b]||(m=!1);this.isLoaded()||m?s(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:s})})}_getImagesForIds(t){const s={};for(const f of t){let m=this.getImage(f);m||(this.fire(new u.l("styleimagemissing",{id:f})),m=this.getImage(f)),m?s[f]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,textFitWidth:m.textFitWidth,textFitHeight:m.textFitHeight,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:u.w(`Image "${f}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return s}getPixelSize(){const{width:t,height:s}=this.atlasImage;return{width:t,height:s}}getPattern(t){const s=this.patterns[t],f=this.getImage(t);if(!f)return null;if(s&&s.position.version===f.version)return s.position;if(s)s.position.version=f.version;else{const m={w:f.data.width+2,h:f.data.height+2,x:0,y:0},b=new u.I(m,f);this.patterns[t]={bin:m,position:b}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const s=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ut(t,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const b in this.patterns)t.push(this.patterns[b].bin);const{w:s,h:f}=u.p(t),m=this.atlasImage;m.resize({width:s||1,height:f||1});for(const b in this.patterns){const{bin:E}=this.patterns[b],I=E.x+1,D=E.y+1,z=this.getImage(b).data,F=z.width,U=z.height;u.R.copy(z,m,{x:0,y:0},{x:I,y:D},{width:F,height:U}),u.R.copy(z,m,{x:0,y:U-1},{x:I,y:D-1},{width:F,height:1}),u.R.copy(z,m,{x:0,y:0},{x:I,y:D+U},{width:F,height:1}),u.R.copy(z,m,{x:F-1,y:0},{x:I-1,y:D},{width:1,height:U}),u.R.copy(z,m,{x:0,y:0},{x:I+F,y:D},{width:1,height:U})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const s of t){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const f=this.getImage(s);f||u.w(`Image with ID: "${s}" was not found`),Mt(f)&&this.updateImage(s,f)}}}const bi=1e20;function te(y,t,s,f,m,b,E,I,D){for(let z=t;z<t+f;z++)be(y,s*b+z,b,m,E,I,D);for(let z=s;z<s+m;z++)be(y,z*b+t,1,f,E,I,D)}function be(y,t,s,f,m,b,E){b[0]=0,E[0]=-1e20,E[1]=bi,m[0]=y[t];for(let I=1,D=0,z=0;I<f;I++){m[I]=y[t+I*s];const F=I*I;do{const U=b[D];z=(m[I]-m[U]+F-U*U)/(I-U)/2}while(z<=E[D]&&--D>-1);D++,b[D]=I,E[D]=z,E[D+1]=bi}for(let I=0,D=0;I<f;I++){for(;E[D+1]<I;)D++;const z=b[D],F=I-z;y[t+I*s]=m[z]+F*F}}class Fe{constructor(t,s){this.requestManager=t,this.localIdeographFontFamily=s,this.entries={}}setURL(t){this.url=t}getGlyphs(t){return u._(this,void 0,void 0,function*(){const s=[];for(const b in t)for(const E of t[b])s.push(this._getAndCacheGlyphsPromise(b,E));const f=yield Promise.all(s),m={};for(const{stack:b,id:E,glyph:I}of f)m[b]||(m[b]={}),m[b][E]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics};return m})}_getAndCacheGlyphsPromise(t,s){return u._(this,void 0,void 0,function*(){let f=this.entries[t];f||(f=this.entries[t]={glyphs:{},requests:{},ranges:{}});let m=f.glyphs[s];if(m!==void 0)return{stack:t,id:s,glyph:m};if(m=this._tinySDF(f,t,s),m)return f.glyphs[s]=m,{stack:t,id:s,glyph:m};const b=Math.floor(s/256);if(256*b>65535)throw new Error("glyphs > 65535 not supported");if(f.ranges[b])return{stack:t,id:s,glyph:m};if(!this.url)throw new Error("glyphsUrl is not set");if(!f.requests[b]){const I=Fe.loadGlyphRange(t,b,this.url,this.requestManager);f.requests[b]=I}const E=yield f.requests[b];for(const I in E)this._doesCharSupportLocalGlyph(+I)||(f.glyphs[+I]=E[+I]);return f.ranges[b]=!0,{stack:t,id:s,glyph:E[s]||null}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(t))||u.u["CJK Unified Ideographs"](t)||u.u["Hangul Syllables"](t)||u.u.Hiragana(t)||u.u.Katakana(t)||u.u["CJK Symbols and Punctuation"](t)||u.u["Halfwidth and Fullwidth Forms"](t))}_tinySDF(t,s,f){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(f))return;let b=t.tinySDF;if(!b){let I="400";/bold/i.test(s)?I="900":/medium/i.test(s)?I="500":/light/i.test(s)&&(I="200"),b=t.tinySDF=new Fe.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:I})}const E=b.draw(String.fromCharCode(f));return{id:f,bitmap:new u.q({width:E.width||60,height:E.height||60},E.data),metrics:{width:E.glyphWidth/2||24,height:E.glyphHeight/2||24,left:E.glyphLeft/2+.5||0,top:E.glyphTop/2-27.5||-8,advance:E.glyphAdvance/2||24,isDoubleResolution:!0}}}}Fe.loadGlyphRange=function(y,t,s,f){return u._(this,void 0,void 0,function*(){const m=256*t,b=m+255,E=f.transformRequest(s.replace("{fontstack}",y).replace("{range}",`${m}-${b}`),"Glyphs"),I=yield u.n(E,new AbortController);if(!I||!I.data)throw new Error(`Could not load glyph range. range: ${t}, ${m}-${b}`);const D={};for(const z of u.o(I.data))D[z.id]=z;return D})},Fe.TinySDF=class{constructor({fontSize:y=24,buffer:t=3,radius:s=8,cutoff:f=.25,fontFamily:m="sans-serif",fontWeight:b="normal",fontStyle:E="normal"}={}){this.buffer=t,this.cutoff=f,this.radius=s;const I=this.size=y+4*t,D=this._createCanvas(I),z=this.ctx=D.getContext("2d",{willReadFrequently:!0});z.font=`${E} ${b} ${y}px ${m}`,z.textBaseline="alphabetic",z.textAlign="left",z.fillStyle="black",this.gridOuter=new Float64Array(I*I),this.gridInner=new Float64Array(I*I),this.f=new Float64Array(I),this.z=new Float64Array(I+1),this.v=new Uint16Array(I)}_createCanvas(y){const t=document.createElement("canvas");return t.width=t.height=y,t}draw(y){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:f,actualBoundingBoxLeft:m,actualBoundingBoxRight:b}=this.ctx.measureText(y),E=Math.ceil(s),I=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-m))),D=Math.min(this.size-this.buffer,E+Math.ceil(f)),z=I+2*this.buffer,F=D+2*this.buffer,U=Math.max(z*F,0),N=new Uint8ClampedArray(U),Y={data:N,width:z,height:F,glyphWidth:I,glyphHeight:D,glyphTop:E,glyphLeft:0,glyphAdvance:t};if(I===0||D===0)return Y;const{ctx:Q,buffer:se,gridInner:ae,gridOuter:ce}=this;Q.clearRect(se,se,I,D),Q.fillText(y,se,se+E);const he=Q.getImageData(se,se,I,D);ce.fill(bi,0,U),ae.fill(0,0,U);for(let me=0;me<D;me++)for(let ge=0;ge<I;ge++){const ye=he.data[4*(me*I+ge)+3]/255;if(ye===0)continue;const Me=(me+se)*z+ge+se;if(ye===1)ce[Me]=0,ae[Me]=bi;else{const Se=.5-ye;ce[Me]=Se>0?Se*Se:0,ae[Me]=Se<0?Se*Se:0}}te(ce,0,0,z,F,z,this.f,this.v,this.z),te(ae,se,se,I,D,z,this.f,this.v,this.z);for(let me=0;me<U;me++){const ge=Math.sqrt(ce[me])-Math.sqrt(ae[me]);N[me]=Math.round(255-255*(ge/this.radius+this.cutoff))}return Y}};class xt{constructor(){this.specification=u.v.light.position}possiblyEvaluate(t,s){return u.z(t.expression.evaluate(s))}interpolate(t,s,f){return{x:u.B.number(t.x,s.x,f),y:u.B.number(t.y,s.y,f),z:u.B.number(t.z,s.z,f)}}}let Ae;class st extends u.E{constructor(t){super(),Ae=Ae||new u.r({anchor:new u.D(u.v.light.anchor),position:new xt,color:new u.D(u.v.light.color),intensity:new u.D(u.v.light.intensity)}),this._transitionable=new u.T(Ae),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s={}){if(!this._validate(u.t,t,s))for(const f in t){const m=t[f];f.endsWith("-transition")?this._transitionable.setTransition(f.slice(0,-11),m):this._transitionable.setValue(f,m)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,f){return(!f||f.validate!==!1)&&u.x(this,t.call(u.y,{value:s,style:{glyphs:!0,sprite:!0},styleSpec:u.v}))}}const Ct=new u.r({"sky-color":new u.D(u.v.sky["sky-color"]),"horizon-color":new u.D(u.v.sky["horizon-color"]),"fog-color":new u.D(u.v.sky["fog-color"]),"fog-ground-blend":new u.D(u.v.sky["fog-ground-blend"]),"horizon-fog-blend":new u.D(u.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new u.D(u.v.sky["sky-horizon-blend"]),"atmosphere-blend":new u.D(u.v.sky["atmosphere-blend"])});class yi extends u.E{constructor(t){super(),this._transitionable=new u.T(Ct),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new u.C(0))}setSky(t,s={}){if(!this._validate(u.F,t,s)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const f in t){const m=t[f];f.endsWith("-transition")?this._transitionable.setTransition(f.slice(0,-11),m):this._transitionable.setValue(f,m)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,f={}){return(f==null?void 0:f.validate)!==!1&&u.x(this,t.call(u.y,u.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:u.v})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class xe{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,s){const f=t.join(",")+String(s);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(t,s)),this.dashEntry[f]}getDashRanges(t,s,f){const m=[];let b=t.length%2==1?-t[t.length-1]*f:0,E=t[0]*f,I=!0;m.push({left:b,right:E,isDash:I,zeroLength:t[0]===0});let D=t[0];for(let z=1;z<t.length;z++){I=!I;const F=t[z];b=D*f,D+=F,E=D*f,m.push({left:b,right:E,isDash:I,zeroLength:F===0})}return m}addRoundDash(t,s,f){const m=s/2;for(let b=-f;b<=f;b++){const E=this.width*(this.nextRow+f+b);let I=0,D=t[I];for(let z=0;z<this.width;z++){z/D.right>1&&(D=t[++I]);const F=Math.abs(z-D.left),U=Math.abs(z-D.right),N=Math.min(F,U);let Y;const Q=b/f*(m+1);if(D.isDash){const se=m-Math.abs(Q);Y=Math.sqrt(N*N+se*se)}else Y=m-Math.sqrt(N*N+Q*Q);this.data[E+z]=Math.max(0,Math.min(255,Y+128))}}}addRegularDash(t){for(let I=t.length-1;I>=0;--I){const D=t[I],z=t[I+1];D.zeroLength?t.splice(I,1):z&&z.isDash===D.isDash&&(z.left=D.left,t.splice(I,1))}const s=t[0],f=t[t.length-1];s.isDash===f.isDash&&(s.left=f.left-this.width,f.right=s.right+this.width);const m=this.width*this.nextRow;let b=0,E=t[b];for(let I=0;I<this.width;I++){I/E.right>1&&(E=t[++b]);const D=Math.abs(I-E.left),z=Math.abs(I-E.right),F=Math.min(D,z);this.data[m+I]=Math.max(0,Math.min(255,(E.isDash?F:-F)+128))}}addDash(t,s){const f=s?7:0,m=2*f+1;if(this.nextRow+m>this.height)return u.w("LineAtlas out of space"),null;let b=0;for(let I=0;I<t.length;I++)b+=t[I];if(b!==0){const I=this.width/b,D=this.getDashRanges(t,this.width,I);s?this.addRoundDash(D,I,f):this.addRegularDash(D)}const E={y:(this.nextRow+f+.5)/this.height,height:2*f/this.height,width:b};return this.nextRow+=m,this.dirty=!0,E}bind(t){const s=t.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}const lt="maplibre_preloaded_worker_pool";class Dt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Dt.workerCount;)this.workers.push(new Worker(u.a.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[lt]}numActive(){return Object.keys(this.active).length}}const vt=Math.floor(ne.hardwareConcurrency/2);let Zt,ti;function Jt(){return Zt||(Zt=new Dt),Zt}Dt.workerCount=u.G(globalThis)?Math.max(Math.min(vt,3),1):1;class ar{constructor(t,s){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=s;const f=this.workerPool.acquire(s);for(let m=0;m<f.length;m++){const b=new u.H(f[m],s);b.name=`Worker ${m}`,this.actors.push(b)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,s){const f=[];for(const m of this.actors)f.push(m.sendAsync({type:t,data:s}));return Promise.all(f)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(s=>{s.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,s){for(const f of this.actors)f.registerMessageHandler(t,s)}}function zi(){return ti||(ti=new ar(Jt(),u.J),ti.registerMessageHandler("GR",(y,t,s)=>u.m(t,s))),ti}function Fn(y,t){const s=u.K();return u.L(s,s,[1,1,0]),u.M(s,s,[.5*y.width,.5*y.height,1]),y.calculatePosMatrix?u.N(s,s,y.calculatePosMatrix(t.toUnwrapped())):s}function Is(y,t,s,f,m,b,E){var I;const D=function(N,Y,Q){if(N)for(const se of N){const ae=Y[se];if(ae&&ae.source===Q&&ae.type==="fill-extrusion")return!0}else for(const se in Y){const ae=Y[se];if(ae.source===Q&&ae.type==="fill-extrusion")return!0}return!1}((I=m==null?void 0:m.layers)!==null&&I!==void 0?I:null,t,y.id),z=b.maxPitchScaleFactor(),F=y.tilesIn(f,z,D);F.sort(qn);const U=[];for(const N of F)U.push({wrappedTileID:N.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(t,s,y._state,N.queryGeometry,N.cameraQueryGeometry,N.scale,m,b,z,Fn(y.transform,N.tileID),E?(Y,Q)=>E(N.tileID,Y,Q):void 0)});return function(N,Y){for(const Q in N)for(const se of N[Q])sr(se,Y);return N}(function(N){const Y={},Q={};for(const se of N){const ae=se.queryResults,ce=se.wrappedTileID,he=Q[ce]=Q[ce]||{};for(const me in ae){const ge=ae[me],ye=he[me]=he[me]||{},Me=Y[me]=Y[me]||[];for(const Se of ge)ye[Se.featureIndex]||(ye[Se.featureIndex]=!0,Me.push(Se))}}return Y}(U),y)}function qn(y,t){const s=y.tileID,f=t.tileID;return s.overscaledZ-f.overscaledZ||s.canonical.y-f.canonical.y||s.wrap-f.wrap||s.canonical.x-f.canonical.x}function sr(y,t){const s=y.feature,f=t.getFeatureState(s.layer["source-layer"],s.id);s.source=s.layer.source,s.layer["source-layer"]&&(s.sourceLayer=s.layer["source-layer"]),s.state=f}function as(y,t,s){return u._(this,void 0,void 0,function*(){let f=y;if(y.url?f=(yield u.j(t.transformRequest(y.url,"Source"),s)).data:yield ne.frameAsync(s),!f)return null;const m=u.O(u.e(f,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in f&&f.vector_layers&&(m.vectorLayerIds=f.vector_layers.map(b=>b.id)),m})}class Nn{constructor(t,s){t&&(s?this.setSouthWest(t).setNorthEast(s):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof u.Q?new u.Q(t.lng,t.lat):u.Q.convert(t),this}setSouthWest(t){return this._sw=t instanceof u.Q?new u.Q(t.lng,t.lat):u.Q.convert(t),this}extend(t){const s=this._sw,f=this._ne;let m,b;if(t instanceof u.Q)m=t,b=t;else{if(!(t instanceof Nn))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Nn.convert(t)):this.extend(u.Q.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(u.Q.convert(t)):this;if(m=t._sw,b=t._ne,!m||!b)return this}return s||f?(s.lng=Math.min(m.lng,s.lng),s.lat=Math.min(m.lat,s.lat),f.lng=Math.max(b.lng,f.lng),f.lat=Math.max(b.lat,f.lat)):(this._sw=new u.Q(m.lng,m.lat),this._ne=new u.Q(b.lng,b.lat)),this}getCenter(){return new u.Q((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new u.Q(this.getWest(),this.getNorth())}getSouthEast(){return new u.Q(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:s,lat:f}=u.Q.convert(t);let m=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&m}static convert(t){return t instanceof Nn?t:t&&new Nn(t)}static fromLngLat(t,s=0){const f=360*s/40075017,m=f/Math.cos(Math.PI/180*t.lat);return new Nn(new u.Q(t.lng-m,t.lat-f),new u.Q(t.lng+m,t.lat+f))}adjustAntiMeridian(){const t=new u.Q(this._sw.lng,this._sw.lat),s=new u.Q(this._ne.lng,this._ne.lat);return new Nn(t,t.lng>s.lng?new u.Q(s.lng+360,s.lat):s)}}class yl{constructor(t,s,f){this.bounds=Nn.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=f||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),f=Math.floor(u.U(this.bounds.getWest())*s),m=Math.floor(u.S(this.bounds.getNorth())*s),b=Math.ceil(u.U(this.bounds.getEast())*s),E=Math.ceil(u.S(this.bounds.getSouth())*s);return t.x>=f&&t.x<b&&t.y>=m&&t.y<E}}class vl extends u.E{constructor(t,s,f,m){if(super(),this.id=t,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.e(this,u.O(s,["url","scheme","tileSize","promoteId"])),this._options=u.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield as(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t&&(u.e(this,t),t.bounds&&(this.tileBounds=new yl(t.bounds,this.minzoom,this.maxzoom)),this.fire(new u.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this.fire(new u.k(t))}})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return u.e({},this._options)}loadTile(t){return u._(this,void 0,void 0,function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f={request:this.map._requestManager.transformRequest(s,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};f.request.collectResourceTiming=this._collectResourceTiming;let m="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise((b,E)=>{t.reloadPromise={resolve:b,reject:E}})}else t.actor=this.dispatcher.getActor(),m="LT";t.abortController=new AbortController;try{const b=yield t.actor.sendAsync({type:m,data:f},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,b)}catch(b){if(delete t.abortController,t.aborted)return;if(b&&b.status!==404)throw b;this._afterTileLoadWorkerResponse(t,null)}})}_afterTileLoadWorkerResponse(t,s){if(s&&s.resourceTiming&&(t.resourceTiming=s.resourceTiming),s&&this.map._refreshExpiredTiles&&t.setExpiryData(s),t.loadVectorData(s,this.map.painter),t.reloadPromise){const f=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(f.resolve).catch(f.reject)}}abortTile(t){return u._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))})}unloadTile(t){return u._(this,void 0,void 0,function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class dr extends u.E{constructor(t,s,f,m){super(),this.id=t,this.dispatcher=f,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.e({type:"raster"},s),u.e(this,u.O(s,["url","scheme","tileSize"]))}load(){return u._(this,arguments,void 0,function*(t=!1){this._loaded=!1,this.fire(new u.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield as(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,s&&(u.e(this,s),s.bounds&&(this.tileBounds=new yl(s.bounds,this.minzoom,this.maxzoom)),this.fire(new u.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(s){this._tileJSONRequest=null,this.fire(new u.k(s))}})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}serialize(){return u.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return u._(this,void 0,void 0,function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const f=yield It.getImage(this.map._requestManager.transformRequest(s,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(f&&f.data){this.map._refreshExpiredTiles&&f.cacheControl&&f.expires&&t.setExpiryData({cacheControl:f.cacheControl,expires:f.expires});const m=this.map.painter.context,b=m.gl,E=f.data;t.texture=this.map.painter.getTileTexture(E.width),t.texture?t.texture.update(E,{useMipmap:!0}):(t.texture=new ut(m,E,b.RGBA,{useMipmap:!0}),t.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(f){if(delete t.abortController,t.aborted)t.state="unloaded";else if(f)throw t.state="errored",f}})}abortTile(t){return u._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)})}unloadTile(t){return u._(this,void 0,void 0,function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)})}hasTransition(){return!1}}class Po extends dr{constructor(t,s,f,m){super(t,s,f,m),this.type="raster-dem",this.maxzoom=22,this._options=u.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(t){return u._(this,void 0,void 0,function*(){const s=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),f=this.map._requestManager.transformRequest(s,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const m=yield It.getImage(f,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(m&&m.data){const b=m.data;this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&t.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const E=u.b(b)&&u.V()?b:yield this.readImageNow(b),I={type:this.type,uid:t.uid,source:this.id,rawImageData:E,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const D=yield t.actor.sendAsync({type:"LDT",data:I});t.dem=D,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(m){if(delete t.abortController,t.aborted)t.state="unloaded";else if(m)throw t.state="errored",m}})}readImageNow(t){return u._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&u.W()){const s=t.width+2,f=t.height+2;try{return new u.R({width:s,height:f},yield u.X(t,-1,-1,s,f))}catch{}}return ne.getImageData(t,1)})}_getNeighboringTiles(t){const s=t.canonical,f=Math.pow(2,s.z),m=(s.x-1+f)%f,b=s.x===0?t.wrap-1:t.wrap,E=(s.x+1+f)%f,I=s.x+1===f?t.wrap+1:t.wrap,D={};return D[new u.Y(t.overscaledZ,b,s.z,m,s.y).key]={backfilled:!1},D[new u.Y(t.overscaledZ,I,s.z,E,s.y).key]={backfilled:!1},s.y>0&&(D[new u.Y(t.overscaledZ,b,s.z,m,s.y-1).key]={backfilled:!1},D[new u.Y(t.overscaledZ,t.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},D[new u.Y(t.overscaledZ,I,s.z,E,s.y-1).key]={backfilled:!1}),s.y+1<f&&(D[new u.Y(t.overscaledZ,b,s.z,m,s.y+1).key]={backfilled:!1},D[new u.Y(t.overscaledZ,t.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},D[new u.Y(t.overscaledZ,I,s.z,E,s.y+1).key]={backfilled:!1}),D}unloadTile(t){return u._(this,void 0,void 0,function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))})}}class no extends u.E{constructor(t,s,f,m){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=f.getActor(),this.setEventedParent(m),this._data=s.data,this._options=u.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId,s.clusterMaxZoom!==void 0&&this.maxzoom<=s.clusterMaxZoom&&u.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${s.clusterMaxZoom}".`),this.workerOptions=u.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(s.buffer!==void 0?s.buffer:128),tolerance:this._pixelsToTileUnits(s.tolerance!==void 0?s.tolerance:.375),extent:u.Z,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:u.Z,radius:this._pixelsToTileUnits(s.clusterRadius||50),log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(t){return t*(u.Z/this.tileSize)}load(){return u._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}getData(){return u._(this,void 0,void 0,function*(){const t=u.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})})}getCoordinatesFromGeometry(t){return t.type==="GeometryCollection"?t.geometries.map(s=>s.coordinates).flat(1/0):t.coordinates.flat(1/0)}getBounds(){return u._(this,void 0,void 0,function*(){const t=new Nn,s=yield this.getData();let f;switch(s.type){case"FeatureCollection":f=s.features.map(m=>this.getCoordinatesFromGeometry(m.geometry)).flat(1/0);break;case"Feature":f=this.getCoordinatesFromGeometry(s.geometry);break;default:f=this.getCoordinatesFromGeometry(s)}if(f.length==0)return t;for(let m=0;m<f.length-1;m+=2)t.extend([f[m],f[m+1]]);return t})}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,s,f){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:s,offset:f}})}_updateWorkerData(t){return u._(this,void 0,void 0,function*(){const s=u.e({type:this.type},this.workerOptions);t?s.dataDiff=t:typeof this._data=="string"?(s.request=this.map._requestManager.transformRequest(ne.resolveURL(this._data),"Source"),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new u.l("dataloading",{dataType:"source"}));try{const f=yield this.actor.sendAsync({type:"LD",data:s});if(this._pendingLoads--,this._removed||f.abandoned)return void this.fire(new u.l("dataabort",{dataType:"source"}));let m=null;f.resourceTiming&&f.resourceTiming[this.id]&&(m=f.resourceTiming[this.id].slice(0));const b={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&u.e(b,{resourceTiming:m}),this.fire(new u.l("data",Object.assign(Object.assign({},b),{sourceDataType:"metadata"}))),this.fire(new u.l("data",Object.assign(Object.assign({},b),{sourceDataType:"content"})))}catch(f){if(this._pendingLoads--,this._removed)return void this.fire(new u.l("dataabort",{dataType:"source"}));this.fire(new u.k(f))}})}loaded(){return this._pendingLoads===0}loadTile(t){return u._(this,void 0,void 0,function*(){const s=t.actor?"RT":"LT";t.actor=this.actor;const f={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const m=yield this.actor.sendAsync({type:s,data:f},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(m,this.map.painter,s==="RT")})}abortTile(t){return u._(this,void 0,void 0,function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0})}unloadTile(t){return u._(this,void 0,void 0,function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return u.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Fa extends u.E{constructor(t,s,f,m){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=f,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=s}load(t){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const s=yield It.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,s&&s.data&&(this.image=s.data,t&&(this.coordinates=t),this._finishLoading())}catch(s){this._request=null,this._loaded=!0,this.fire(new u.k(s))}})}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const s=t.map(u.$.fromLngLat);var f;return this.tileID=function(m){let b=1/0,E=1/0,I=-1/0,D=-1/0;for(const N of m)b=Math.min(b,N.x),E=Math.min(E,N.y),I=Math.max(I,N.x),D=Math.max(D,N.y);const z=Math.max(I-b,D-E),F=Math.max(0,Math.floor(-Math.log(z)/Math.LN2)),U=Math.pow(2,F);return new u.a1(F,Math.floor((b+I)/2*U),Math.floor((E+D)/2*U))}(s),this.terrainTileRanges=this._getOverlappingTileRanges(s),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=s.map(m=>this.tileID.getTilePoint(m)._round()),this.flippedWindingOrder=((f=this.tileCoords)[1].x-f[0].x)*(f[2].y-f[0].y)-(f[1].y-f[0].y)*(f[2].x-f[0].x)<0,this.fire(new u.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,s=t.gl;this.texture||(this.texture=new ut(t,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let f=!1;for(const m in this.tiles){const b=this.tiles[m];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,f=!0)}f&&this.fire(new u.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return u._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){let s=1/0,f=1/0,m=-1/0,b=-1/0;for(const I of t)s=Math.min(s,I.x),f=Math.min(f,I.y),m=Math.max(m,I.x),b=Math.max(b,I.y);const E={};for(let I=0;I<=u.a0;I++){const D=Math.pow(2,I),z=Math.floor(s*D),F=Math.floor(f*D),U=Math.floor(m*D),N=Math.floor(b*D);E[I]={minTileX:z,minTileY:F,maxTileX:U,maxTileY:N}}return E}}class fa extends Fa{constructor(t,s,f,m){super(t,s,f,m),this.roundZoom=!0,this.type="video",this.options=s}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const s of t.urls)this.urls.push(this.map._requestManager.transformRequest(s,"Source").url);try{const s=yield u.a2(this.urls);if(this._loaded=!0,!s)return;this.video=s,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(s){this.fire(new u.k(s))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const s=this.video.seekable;t<s.start(0)||t>s.end(0)?this.fire(new u.k(new u.a3(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,s=t.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new ut(t,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let f=!1;for(const m in this.tiles){const b=this.tiles[m];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,f=!0)}f&&this.fire(new u.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class vc extends Fa{constructor(t,s,f,m){super(t,s,f,m),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(E=>typeof E!="number"))||this.fire(new u.k(new u.a3(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.k(new u.a3(`sources.${t}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new u.k(new u.a3(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new u.k(new u.a3(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.k(new u.a3(`sources.${t}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){return u._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,f=s.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ut(s,this.canvas,f.RGBA,{premultiply:!0});let m=!1;for(const b in this.tiles){const E=this.tiles[b];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,m=!0)}m&&this.fire(new u.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const bl={},uu=y=>{switch(y){case"geojson":return no;case"image":return Fa;case"raster":return dr;case"raster-dem":return Po;case"vector":return vl;case"video":return fa;case"canvas":return vc}return bl[y]},xl="RTLPluginLoaded";class Na extends u.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=zi()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch(s=>{throw this.status="error",s})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return u._(this,arguments,void 0,function*(s,f=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ne.resolveURL(s),!this.url)throw new Error(`requested url ${s} is invalid`);if(this.status==="unavailable"){if(!f)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return u._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new u.l(xl))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ir=null;function $r(){return Ir||(Ir=new Na),Ir}class Wn{constructor(t,s){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=u.a4(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const s=t+this.timeAdded;s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,s,f){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(m,b){const E={};if(!b)return E;for(const I of m){const D=I.layerIds.map(z=>b.getLayer(z)).filter(Boolean);if(D.length!==0){I.layers=D,I.stateDependentLayerIds&&(I.stateDependentLayers=I.stateDependentLayerIds.map(z=>D.filter(F=>F.id===z)[0]));for(const z of D)E[z.id]=I}}return E}(t.buckets,s==null?void 0:s.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const b=this.buckets[m];if(b instanceof u.a6){if(this.hasSymbolBuckets=!0,!f)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const b=this.buckets[m];if(b instanceof u.a6&&b.hasRTLText){this.hasRTLText=!0,$r().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const b=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(m).queryRadius(b))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new u.a5}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const f in this.buckets){const m=this.buckets[f];m.uploadPending()&&m.upload(t)}const s=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ut(t,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ut(t,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,s,f,m,b,E,I,D,z,F,U){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:b,scale:E,tileSize:this.tileSize,pixelPosMatrix:F,transform:D,params:I,queryPadding:this.queryPadding*z,getElevation:U},t,s,f):{}}querySourceFeatures(t,s){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const m=f.loadVTLayers(),b=s&&s.sourceLayer?s.sourceLayer:"",E=m._geojsonTileLayer||m[b];if(!E)return;const I=u.a7(s&&s.filter),{z:D,x:z,y:F}=this.tileID.canonical,U={z:D,x:z,y:F};for(let N=0;N<E.length;N++){const Y=E.feature(N);if(I.needGeometry){const ae=u.a8(Y,!0);if(!I.filter(new u.C(this.tileID.overscaledZ),ae,this.tileID.canonical))continue}else if(!I.filter(new u.C(this.tileID.overscaledZ),Y))continue;const Q=f.getId(Y,b),se=new u.a9(Y,D,z,F,Q);se.tile=U,t.push(se)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const f=u.aa(t.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const f=Date.now();let m=!1;if(this.expirationTime>f)m=!1;else if(s)if(this.expirationTime<s)m=!0;else{const b=this.expirationTime-s;b?this.expirationTime=f+Math.max(b,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const f=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!s.style.hasLayer(m))continue;const b=this.buckets[m],E=b.layers[0].sourceLayer||"_geojsonTileLayer",I=f[E],D=t[E];if(!I||!D||Object.keys(D).length===0)continue;b.update(D,I,this.imageAtlas&&this.imageAtlas.patternPositions||{});const z=s&&s.style&&s.style.getLayer(m);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ne.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=ne.now()+t}setDependencies(t,s){const f={};for(const m of s)f[m]=!0;this.dependencies[t]=f}hasDependency(t,s){for(const f of t){const m=this.dependencies[f];if(m){for(const b of s)if(m[b])return!0}}return!1}}class ro{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,f){const m=t.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const b={value:s,timeout:void 0};if(f!==void 0&&(b.timeout=setTimeout(()=>{this.remove(t,b)},f)),this.data[m].push(b),this.order.push(m),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const f=t.wrapped().key,m=s===void 0?0:this.data[f].indexOf(s),b=this.data[f][m];return this.data[f].splice(m,1),b.timeout&&clearTimeout(b.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(b.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const f in this.data)for(const m of this.data[f])t(m.value)||s.push(m);for(const f of s)this.remove(f.value.tileID,f)}}class bc{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,f){const m=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][m]=this.stateChanges[t][m]||{},u.e(this.stateChanges[t][m],f),this.deletedStates[t]===null){this.deletedStates[t]={};for(const b in this.state[t])b!==m&&(this.deletedStates[t][b]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][m]===null){this.deletedStates[t][m]={};for(const b in this.state[t][m])f[b]||(this.deletedStates[t][m][b]=null)}else for(const b in f)this.deletedStates[t]&&this.deletedStates[t][m]&&this.deletedStates[t][m][b]===null&&delete this.deletedStates[t][m][b]}removeFeatureState(t,s,f){if(this.deletedStates[t]===null)return;const m=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},f&&s!==void 0)this.deletedStates[t][m]!==null&&(this.deletedStates[t][m]=this.deletedStates[t][m]||{},this.deletedStates[t][m][f]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][m])for(f in this.deletedStates[t][m]={},this.stateChanges[t][m])this.deletedStates[t][m][f]=null;else this.deletedStates[t][m]=null;else this.deletedStates[t]=null}getState(t,s){const f=String(s),m=u.e({},(this.state[t]||{})[f],(this.stateChanges[t]||{})[f]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const b=this.deletedStates[t][s];if(b===null)return{};for(const E in b)delete m[E]}return m}initializeTileState(t,s){t.setFeatureState(this.state,s)}coalesceChanges(t,s){const f={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const b={};for(const E in this.stateChanges[m])this.state[m][E]||(this.state[m][E]={}),u.e(this.state[m][E],this.stateChanges[m][E]),b[E]=this.state[m][E];f[m]=b}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const b={};if(this.deletedStates[m]===null)for(const E in this.state[m])b[E]={},this.state[m][E]={};else for(const E in this.deletedStates[m]){if(this.deletedStates[m][E]===null)this.state[m][E]={};else for(const I of Object.keys(this.deletedStates[m][E]))delete this.state[m][E][I];b[E]=this.state[m][E]}f[m]=f[m]||{},u.e(f[m],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const m in t)t[m].setFeatureState(f,s)}}function hu(y,t,s){const f=t.intersectsFrustum(y);if(!s)return f;const m=t.intersectsPlane(s);return f===0||m===0?0:f===2&&m===2?2:1}function wl(y,t,s,f,m){let b=y;const E=Math.atan(t/s),I=Math.hypot(t,s);return b=y+u.ab(f/I/Math.max(.5,Math.cos(u.ad(m/2)))),b+=1*u.ab(Math.cos(E))/2,b+=u.ae(y-b,-0,0),b}function Ua(y,t){const s=(t.roundZoom?Math.round:Math.floor)(y.zoom+u.ab(y.tileSize/t.tileSize));return Math.max(0,s)}function De(y,t){const s=y.getCameraFrustum(),f=y.getClippingPlane(),m=y.screenPointToMercatorCoordinate(y.getCameraPoint()),b=u.$.fromLngLat(y.center,y.elevation);m.z=b.z+Math.cos(y.pitchInRadians)*y.cameraToCenterDistance/y.worldSize;const E=y.getCoveringTilesDetailsProvider(),I=E.allowVariableZoom(y,t),D=Ua(y,t),z=t.minzoom||0,F=t.maxzoom!==void 0?t.maxzoom:y.maxZoom,U=Math.min(Math.max(0,D),F),N=Math.pow(2,U),Y=[N*m.x,N*m.y,0],Q=[N*b.x,N*b.y,0],se=Math.hypot(b.x-m.x,b.y-m.y),ae=Math.abs(b.z-m.z),ce=Math.hypot(se,ae),he=ye=>({zoom:0,x:0,y:0,wrap:ye,fullyVisible:!1}),me=[],ge=[];if(y.renderWorldCopies&&E.allowWorldCopies())for(let ye=1;ye<=3;ye++)me.push(he(-ye)),me.push(he(ye));for(me.push(he(0));me.length>0;){const ye=me.pop(),Me=ye.x,Se=ye.y;let Le=ye.fullyVisible;const Oe={x:Me,y:Se,z:ye.zoom},Xe=E.getTileAABB(Oe,ye.wrap,y.elevation,t);if(!Le){const mt=hu(s,Xe,f);if(mt===0)continue;Le=mt===2}const We=E.distanceToTile2d(m.x,m.y,Oe,Xe);let He=D;I&&(He=(t.calculateTileZoom||wl)(y.zoom+u.ab(y.tileSize/t.tileSize),We,ae,ce,y.fov)),He=(t.roundZoom?Math.round:Math.floor)(He),He=Math.max(0,He);const gt=Math.min(He,F);if(ye.wrap=E.getWrap(b,Oe,ye.wrap),ye.zoom>=gt){if(ye.zoom<z)continue;const mt=U-ye.zoom,it=Y[0]-.5-(Me<<mt),Lt=Y[1]-.5-(Se<<mt),ai=t.reparseOverscaled?Math.max(ye.zoom,He):ye.zoom;ge.push({tileID:new u.Y(ye.zoom===F?ai:ye.zoom,ye.wrap,ye.zoom,Me,Se),distanceSq:u.ac([Q[0]-.5-Me,Q[1]-.5-Se]),tileDistanceToCamera:Math.sqrt(it*it+Lt*Lt)})}else for(let mt=0;mt<4;mt++)me.push({zoom:ye.zoom+1,x:(Me<<1)+mt%2,y:(Se<<1)+(mt>>1),wrap:ye.wrap,fullyVisible:Le})}return ge.sort((ye,Me)=>ye.distanceSq-Me.distanceSq).map(ye=>ye.tileID)}class W extends u.E{constructor(t,s,f){super(),this.id=t,this.dispatcher=f,this.on("data",m=>this._dataHandler(m)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,b,E,I)=>{const D=new(uu(b.type))(m,b,E,I);if(D.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${D.id}`);return D})(t,s,f,this),this._tiles={},this._cache=new ro(0,m=>this._unloadTile(m)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new bc,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const s=this._tiles[t];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,s,f){return u._(this,void 0,void 0,function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,s,f)}catch(m){t.state="errored",m.status!==404?this._source.fire(new u.k(m,{tile:t})):this.update(this.transform,this.terrain)}})}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new u.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const f=this._tiles[s];f.upload(t),f.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(J).map(t=>t.key)}getRenderableIds(t){const s=[];for(const f in this._tiles)this._isIdRenderable(f,t)&&s.push(this._tiles[f]);return t?s.sort((f,m)=>{const b=f.tileID,E=m.tileID,I=new u.P(b.canonical.x,b.canonical.y)._rotate(-this.transform.bearingInRadians),D=new u.P(E.canonical.x,E.canonical.y)._rotate(-this.transform.bearingInRadians);return b.overscaledZ-E.overscaledZ||D.y-I.y||D.x-I.x}).map(f=>f.tileID.key):s.map(f=>f.tileID).sort(J).map(f=>f.key)}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())}reload(t){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)(t||this._tiles[s].state!=="errored")&&this._reloadTile(s,"reloading")}}_reloadTile(t,s){return u._(this,void 0,void 0,function*(){const f=this._tiles[t];f&&(f.state!=="loading"&&(f.state=s),yield this._loadTile(f,t,s))})}_tileLoaded(t,s,f){t.timeAdded=ne.now(),f==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new u.l("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const s=this.getRenderableIds();for(let m=0;m<s.length;m++){const b=s[m];if(t.neighboringTiles&&t.neighboringTiles[b]){const E=this.getTileByID(b);f(t,E),f(E,t)}}function f(m,b){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let E=b.tileID.canonical.x-m.tileID.canonical.x;const I=b.tileID.canonical.y-m.tileID.canonical.y,D=Math.pow(2,m.tileID.canonical.z),z=b.tileID.key;E===0&&I===0||Math.abs(I)>1||(Math.abs(E)>1&&(Math.abs(E+D)===1?E+=D:Math.abs(E-D)===1&&(E-=D)),b.dem&&m.dem&&(m.dem.backfillBorder(b.dem,E,I),m.neighboringTiles&&m.neighboringTiles[z]&&(m.neighboringTiles[z].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,f,m){for(const b in this._tiles){let E=this._tiles[b];if(m[b]||!E.hasData()||E.tileID.overscaledZ<=s||E.tileID.overscaledZ>f)continue;let I=E.tileID;for(;E&&E.tileID.overscaledZ>s+1;){const z=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[z.key],E&&E.hasData()&&(I=z)}let D=I;for(;D.overscaledZ>s;)if(D=D.scaledTo(D.overscaledZ-1),t[D.key]||t[D.canonical.key]){m[I.key]=I;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const f=this._loadedParentTiles[t.key];return f&&f.tileID.overscaledZ>=s?f:null}for(let f=t.overscaledZ-1;f>=s;f--){const m=t.scaledTo(f),b=this._getLoadedTile(m);if(b)return b}}findLoadedSibling(t){return this._getLoadedTile(t)}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const s=Math.ceil(t.width/this._source.tileSize)+1,f=Math.ceil(t.height/this._source.tileSize)+1,m=Math.floor(s*f*(this._maxTileCacheZoomLevels===null?u.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(b)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const f={};for(const m in this._tiles){const b=this._tiles[m];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+s),f[b.tileID.key]=b}this._tiles=f;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}_updateCoveredAndRetainedTiles(t,s,f,m,b,E){const I={},D={},z=Object.keys(t),F=ne.now();for(const U of z){const N=t[U],Y=this._tiles[U];if(!Y||Y.fadeEndTime!==0&&Y.fadeEndTime<=F)continue;const Q=this.findLoadedParent(N,s),se=this.findLoadedSibling(N),ae=Q||se||null;ae&&(this._addTile(ae.tileID),I[ae.tileID.key]=ae.tileID),D[U]=N}this._retainLoadedChildren(D,m,f,t);for(const U in I)t[U]||(this._coveredTiles[U]=!0,t[U]=I[U]);if(E){const U={},N={};for(const Y of b)this._tiles[Y.key].hasData()?U[Y.key]=Y:N[Y.key]=Y;for(const Y in N){const Q=N[Y].children(this._source.maxzoom);this._tiles[Q[0].key]&&this._tiles[Q[1].key]&&this._tiles[Q[2].key]&&this._tiles[Q[3].key]&&(U[Q[0].key]=t[Q[0].key]=Q[0],U[Q[1].key]=t[Q[1].key]=Q[1],U[Q[2].key]=t[Q[2].key]=Q[2],U[Q[3].key]=t[Q[3].key]=Q[3],delete N[Y])}for(const Y in N){const Q=N[Y],se=this.findLoadedParent(Q,this._source.minzoom),ae=this.findLoadedSibling(Q),ce=se||ae||null;if(ce){U[ce.tileID.key]=t[ce.tileID.key]=ce.tileID;for(const he in U)U[he].isChildOf(ce.tileID)&&delete U[he]}}for(const Y in this._tiles)U[Y]||(this._coveredTiles[Y]=!0)}}update(t,s){if(!this._sourceLoaded||this._paused)return;let f;this.transform=t,this.terrain=s,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(F=>new u.Y(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y)):(f=De(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(f=f.filter(F=>this._source.hasTile(F)))):f=[];const m=Ua(t,this._source),b=Math.max(m-W.maxOverzooming,this._source.minzoom),E=Math.max(m+W.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const F={};for(const U of f)if(U.canonical.z>this._source.minzoom){const N=U.scaledTo(U.canonical.z-1);F[N.key]=N;const Y=U.scaledTo(Math.max(this._source.minzoom,Math.min(U.canonical.z,5)));F[Y.key]=Y}f=f.concat(Object.values(F))}const I=f.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,I&&this.fire(new u.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const D=this._updateRetainedTiles(f,m);$(this._source.type)&&this._updateCoveredAndRetainedTiles(D,b,E,m,f,s);for(const F in D)this._tiles[F].clearFadeHold();const z=u.af(this._tiles,D);for(const F of z){const U=this._tiles[F];U.hasSymbolBuckets&&!U.holdingForFade()?U.setHoldDuration(this.map._fadeDuration):U.hasSymbolBuckets&&!U.symbolFadeFinished()||this._removeTile(F)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,s){var f;const m={},b={},E=Math.max(s-W.maxOverzooming,this._source.minzoom),I=Math.max(s+W.maxUnderzooming,this._source.minzoom),D={};for(const z of t){const F=this._addTile(z);m[z.key]=z,F.hasData()||s<this._source.maxzoom&&(D[z.key]=z)}this._retainLoadedChildren(D,s,I,m);for(const z of t){let F=this._tiles[z.key];if(F.hasData())continue;if(s+1>this._source.maxzoom){const N=z.children(this._source.maxzoom)[0],Y=this.getTile(N);if(Y&&Y.hasData()){m[N.key]=N;continue}}else{const N=z.children(this._source.maxzoom);if(m[N[0].key]&&m[N[1].key]&&m[N[2].key]&&m[N[3].key])continue}let U=F.wasRequested();for(let N=z.overscaledZ-1;N>=E;--N){const Y=z.scaledTo(N);if(b[Y.key])break;if(b[Y.key]=!0,F=this.getTile(Y),!F&&U&&(F=this._addTile(Y)),F){const Q=F.hasData();if((Q||!(!((f=this.map)===null||f===void 0)&&f.cancelPendingTileRequestsWhileZooming)||U)&&(m[Y.key]=Y),U=F.wasRequested(),Q)break}}}return m}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let f,m=this._tiles[t].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){f=this._loadedParentTiles[m.key];break}s.push(m.key);const b=m.scaledTo(m.overscaledZ-1);if(f=this._getLoadedTile(b),f)break;m=b}for(const b of s)this._loadedParentTiles[b]=f}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const t in this._tiles){const s=this._tiles[t].tileID,f=this._getLoadedTile(s);this._loadedSiblingTiles[s.key]=f}}_addTile(t){let s=this._tiles[t.key];if(s)return s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const f=s;return s||(s=new Wn(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(s,t.key,s.state)),s.uses++,this._tiles[t.key]=s,f||this._source.fire(new u.l("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const f=s.getExpiryTimeout();f&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},f))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}_dataHandler(t){const s=t.sourceDataType;t.dataType==="source"&&s==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&t.dataType==="source"&&s==="content"&&(this.reload(t.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,s,f){const m=[],b=this.transform;if(!b)return m;const E=f?b.getCameraQueryGeometry(t):t,I=t.map(Q=>b.screenPointToMercatorCoordinate(Q,this.terrain)),D=E.map(Q=>b.screenPointToMercatorCoordinate(Q,this.terrain)),z=this.getIds();let F=1/0,U=1/0,N=-1/0,Y=-1/0;for(const Q of D)F=Math.min(F,Q.x),U=Math.min(U,Q.y),N=Math.max(N,Q.x),Y=Math.max(Y,Q.y);for(let Q=0;Q<z.length;Q++){const se=this._tiles[z[Q]];if(se.holdingForFade())continue;const ae=se.tileID,ce=Math.pow(2,b.zoom-se.tileID.overscaledZ),he=s*se.queryPadding*u.Z/se.tileSize/ce,me=[ae.getTilePoint(new u.$(F,U)),ae.getTilePoint(new u.$(N,Y))];if(me[0].x-he<u.Z&&me[0].y-he<u.Z&&me[1].x+he>=0&&me[1].y+he>=0){const ge=I.map(Me=>ae.getTilePoint(Me)),ye=D.map(Me=>ae.getTilePoint(Me));m.push({tile:se,tileID:ae,queryGeometry:ge,cameraQueryGeometry:ye,scale:ce})}}return m}getVisibleCoordinates(t){const s=this.getRenderableIds(t).map(f=>this._tiles[f].tileID);return this.transform&&this.transform.populateCache(s),s}hasTransition(){if(this._source.hasTransition())return!0;if($(this._source.type)){const t=ne.now();for(const s in this._tiles)if(this._tiles[s].fadeEndTime>=t)return!0}return!1}setFeatureState(t,s,f){this._state.updateState(t=t||"_geojsonTileLayer",s,f)}removeFeatureState(t,s,f){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,f)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,f){const m=this._tiles[t];m&&m.setDependencies(s,f)}reloadTilesForDependencies(t,s){for(const f in this._tiles)this._tiles[f].hasDependency(t,s)&&this._reloadTile(f,"reloading");this._cache.filter(f=>!f.hasDependency(t,s))}}function J(y,t){const s=Math.abs(2*y.wrap)-+(y.wrap<0),f=Math.abs(2*t.wrap)-+(t.wrap<0);return y.overscaledZ-t.overscaledZ||f-s||t.canonical.y-y.canonical.y||t.canonical.x-y.canonical.x}function $(y){return y==="raster"||y==="image"||y==="video"}W.maxOverzooming=10,W.maxUnderzooming=3;class fe{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=u.ae(t,0,1);let s=1,f=this._distances[s];const m=t*this.paddedLength+this.padding;for(;f<m&&s<this._distances.length;)f=this._distances[++s];const b=s-1,E=this._distances[b],I=f-E,D=I>0?(m-E)/I:0;return this.points[b].mult(1-D).add(this.points[s].mult(D))}}function Ee(y,t){let s=!0;return y==="always"||y!=="never"&&t!=="never"||(s=!1),s}class we{constructor(t,s,f){const m=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(t/f),this.yCellCount=Math.ceil(s/f);for(let E=0;E<this.xCellCount*this.yCellCount;E++)m.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,f,m,b){this._forEachCell(s,f,m,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(f),this.bboxes.push(m),this.bboxes.push(b)}insertCircle(t,s,f,m){this._forEachCell(s-m,f-m,s+m,f+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(f),this.circles.push(m)}_insertBoxCell(t,s,f,m,b,E){this.boxCells[b].push(E)}_insertCircleCell(t,s,f,m,b,E){this.circleCells[b].push(E)}_query(t,s,f,m,b,E,I){if(f<0||t>this.width||m<0||s>this.height)return[];const D=[];if(t<=0&&s<=0&&this.width<=f&&this.height<=m){if(b)return[{key:null,x1:t,y1:s,x2:f,y2:m}];for(let z=0;z<this.boxKeys.length;z++)D.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const F=this.circles[3*z],U=this.circles[3*z+1],N=this.circles[3*z+2];D.push({key:this.circleKeys[z],x1:F-N,y1:U-N,x2:F+N,y2:U+N})}}else this._forEachCell(t,s,f,m,this._queryCell,D,{hitTest:b,overlapMode:E,seenUids:{box:{},circle:{}}},I);return D}query(t,s,f,m){return this._query(t,s,f,m,!1,null)}hitTest(t,s,f,m,b,E){return this._query(t,s,f,m,!0,b,E).length>0}hitTestCircle(t,s,f,m,b){const E=t-f,I=t+f,D=s-f,z=s+f;if(I<0||E>this.width||z<0||D>this.height)return!1;const F=[];return this._forEachCell(E,D,I,z,this._queryCellCircle,F,{hitTest:!0,overlapMode:m,circle:{x:t,y:s,radius:f},seenUids:{box:{},circle:{}}},b),F.length>0}_queryCell(t,s,f,m,b,E,I,D){const{seenUids:z,hitTest:F,overlapMode:U}=I,N=this.boxCells[b];if(N!==null){const Q=this.bboxes;for(const se of N)if(!z.box[se]){z.box[se]=!0;const ae=4*se,ce=this.boxKeys[se];if(t<=Q[ae+2]&&s<=Q[ae+3]&&f>=Q[ae+0]&&m>=Q[ae+1]&&(!D||D(ce))&&(!F||!Ee(U,ce.overlapMode))&&(E.push({key:ce,x1:Q[ae],y1:Q[ae+1],x2:Q[ae+2],y2:Q[ae+3]}),F))return!0}}const Y=this.circleCells[b];if(Y!==null){const Q=this.circles;for(const se of Y)if(!z.circle[se]){z.circle[se]=!0;const ae=3*se,ce=this.circleKeys[se];if(this._circleAndRectCollide(Q[ae],Q[ae+1],Q[ae+2],t,s,f,m)&&(!D||D(ce))&&(!F||!Ee(U,ce.overlapMode))){const he=Q[ae],me=Q[ae+1],ge=Q[ae+2];if(E.push({key:ce,x1:he-ge,y1:me-ge,x2:he+ge,y2:me+ge}),F)return!0}}}return!1}_queryCellCircle(t,s,f,m,b,E,I,D){const{circle:z,seenUids:F,overlapMode:U}=I,N=this.boxCells[b];if(N!==null){const Q=this.bboxes;for(const se of N)if(!F.box[se]){F.box[se]=!0;const ae=4*se,ce=this.boxKeys[se];if(this._circleAndRectCollide(z.x,z.y,z.radius,Q[ae+0],Q[ae+1],Q[ae+2],Q[ae+3])&&(!D||D(ce))&&!Ee(U,ce.overlapMode))return E.push(!0),!0}}const Y=this.circleCells[b];if(Y!==null){const Q=this.circles;for(const se of Y)if(!F.circle[se]){F.circle[se]=!0;const ae=3*se,ce=this.circleKeys[se];if(this._circlesCollide(Q[ae],Q[ae+1],Q[ae+2],z.x,z.y,z.radius)&&(!D||D(ce))&&!Ee(U,ce.overlapMode))return E.push(!0),!0}}}_forEachCell(t,s,f,m,b,E,I,D){const z=this._convertToXCellCoord(t),F=this._convertToYCellCoord(s),U=this._convertToXCellCoord(f),N=this._convertToYCellCoord(m);for(let Y=z;Y<=U;Y++)for(let Q=F;Q<=N;Q++)if(b.call(this,t,s,f,m,this.xCellCount*Q+Y,E,I,D))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,f,m,b,E){const I=m-t,D=b-s,z=f+E;return z*z>I*I+D*D}_circleAndRectCollide(t,s,f,m,b,E,I){const D=(E-m)/2,z=Math.abs(t-(m+D));if(z>D+f)return!1;const F=(I-b)/2,U=Math.abs(s-(b+F));if(U>F+f)return!1;if(z<=D||U<=F)return!0;const N=z-D,Y=U-F;return N*N+Y*Y<=f*f}}function ze(y,t,s){const f=u.K();if(!y){const{vecSouth:U,vecEast:N}=Ye(t),Y=B();Y[0]=N[0],Y[1]=N[1],Y[2]=U[0],Y[3]=U[1],m=Y,(F=(E=(b=Y)[0])*(z=b[3])-(D=b[2])*(I=b[1]))&&(m[0]=z*(F=1/F),m[1]=-I*F,m[2]=-D*F,m[3]=E*F),f[0]=Y[0],f[1]=Y[1],f[4]=Y[2],f[5]=Y[3]}var m,b,E,I,D,z,F;return u.M(f,f,[1/s,1/s,1]),f}function Ce(y,t,s,f){if(y){const m=u.K();if(!t){const{vecSouth:b,vecEast:E}=Ye(s);m[0]=E[0],m[1]=E[1],m[4]=b[0],m[5]=b[1]}return u.M(m,m,[f,f,1]),m}return s.pixelsToClipSpaceMatrix}function Ye(y){const t=Math.cos(y.rollInRadians),s=Math.sin(y.rollInRadians),f=Math.cos(y.pitchInRadians),m=Math.cos(y.bearingInRadians),b=Math.sin(y.bearingInRadians),E=u.ak();E[0]=-m*f*s-b*t,E[1]=-b*f*s+m*t;const I=u.al(E);I<1e-9?u.am(E):u.an(E,E,1/I);const D=u.ak();D[0]=m*f*t-b*s,D[1]=b*f*t+m*s;const z=u.al(D);return z<1e-9?u.am(D):u.an(D,D,1/z),{vecEast:D,vecSouth:E}}function Ze(y,t,s,f){let m;f?(m=[y,t,f(y,t),1],u.ap(m,m,s)):(m=[y,t,0,1],$n(m,m,s));const b=m[3];return{point:new u.P(m[0]/b,m[1]/b),signedDistanceFromCamera:b,isOccluded:!1}}function Pe(y,t){return .5+y/t*.5}function nt(y,t){return y.x>=-t[0]&&y.x<=t[0]&&y.y>=-t[1]&&y.y<=t[1]}function yt(y,t,s,f,m,b,E,I,D,z,F,U,N){const Y=s?y.textSizeData:y.iconSizeData,Q=u.ag(Y,t.transform.zoom),se=[256/t.width*2+1,256/t.height*2+1],ae=s?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;ae.clear();const ce=y.lineVertexArray,he=s?y.text.placedSymbolArray:y.icon.placedSymbolArray,me=t.transform.width/t.transform.height;let ge=!1;for(let ye=0;ye<he.length;ye++){const Me=he.get(ye);if(Me.hidden||Me.writingMode===u.ah.vertical&&!ge){Gt(Me.numGlyphs,ae);continue}ge=!1;const Se=new u.P(Me.anchorX,Me.anchorY),Le={getElevation:N,pitchedLabelPlaneMatrix:f,lineVertexArray:ce,pitchWithMap:b,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:Se,unwrappedTileID:D,width:z,height:F,translation:U},Oe=Bt(Me.anchorX,Me.anchorY,Le);if(!nt(Oe.point,se)){Gt(Me.numGlyphs,ae);continue}const Xe=Pe(t.transform.cameraToCenterDistance,Oe.signedDistanceFromCamera),We=u.ai(Y,Q,Me),He=b?We*t.transform.getPitchedTextCorrection(Me.anchorX,Me.anchorY,D)/Xe:We*Xe,gt=Vt({projectionContext:Le,pitchedLabelPlaneMatrixInverse:m,symbol:Me,fontSize:He,flip:!1,keepUpright:E,glyphOffsetArray:y.glyphOffsetArray,dynamicLayoutVertexArray:ae,aspectRatio:me,rotateToLine:I});ge=gt.useVertical,(gt.notEnoughRoom||ge||gt.needsFlipping&&Vt({projectionContext:Le,pitchedLabelPlaneMatrixInverse:m,symbol:Me,fontSize:He,flip:!0,keepUpright:E,glyphOffsetArray:y.glyphOffsetArray,dynamicLayoutVertexArray:ae,aspectRatio:me,rotateToLine:I}).notEnoughRoom)&&Gt(Me.numGlyphs,ae)}s?y.text.dynamicLayoutVertexBuffer.updateData(ae):y.icon.dynamicLayoutVertexBuffer.updateData(ae)}function St(y,t,s,f,m,b,E,I){const D=b.glyphStartIndex+b.numGlyphs,z=b.lineStartIndex,F=b.lineStartIndex+b.lineLength,U=t.getoffsetX(b.glyphStartIndex),N=t.getoffsetX(D-1),Y=In(y*U,s,f,m,b.segment,z,F,I,E);if(!Y)return null;const Q=In(y*N,s,f,m,b.segment,z,F,I,E);return Q?I.projectionCache.anyProjectionOccluded?null:{first:Y,last:Q}:null}function je(y,t,s,f){return y===u.ah.horizontal&&Math.abs(s.y-t.y)>Math.abs(s.x-t.x)*f?{useVertical:!0}:(y===u.ah.vertical?t.y<s.y:t.x>s.x)?{needsFlipping:!0}:null}function Vt(y){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:s,symbol:f,fontSize:m,flip:b,keepUpright:E,glyphOffsetArray:I,dynamicLayoutVertexArray:D,aspectRatio:z,rotateToLine:F}=y,U=m/24,N=f.lineOffsetX*U,Y=f.lineOffsetY*U;let Q;if(f.numGlyphs>1){const se=f.glyphStartIndex+f.numGlyphs,ae=f.lineStartIndex,ce=f.lineStartIndex+f.lineLength,he=St(U,I,N,Y,b,f,F,t);if(!he)return{notEnoughRoom:!0};const me=ct(he.first.point.x,he.first.point.y,t,s),ge=ct(he.last.point.x,he.last.point.y,t,s);if(E&&!b){const ye=je(f.writingMode,me,ge,z);if(ye)return ye}Q=[he.first];for(let ye=f.glyphStartIndex+1;ye<se-1;ye++)Q.push(In(U*I.getoffsetX(ye),N,Y,b,f.segment,ae,ce,t,F));Q.push(he.last)}else{if(E&&!b){const ae=ki(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,ce=f.lineStartIndex+f.segment+1,he=new u.P(t.lineVertexArray.getx(ce),t.lineVertexArray.gety(ce)),me=ki(he.x,he.y,t),ge=me.signedDistanceFromCamera>0?me.point:Ot(t.tileAnchorPoint,he,ae,1,t),ye=ct(ae.x,ae.y,t,s),Me=ct(ge.x,ge.y,t,s),Se=je(f.writingMode,ye,Me,z);if(Se)return Se}const se=In(U*I.getoffsetX(f.glyphStartIndex),N,Y,b,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,t,F);if(!se||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Q=[se]}for(const se of Q)u.ao(D,se.point,se.angle);return{}}function Ot(y,t,s,f,m){const b=y.add(y.sub(t)._unit()),E=ki(b.x,b.y,m).point,I=s.sub(E);return s.add(I._mult(f/I.mag()))}function Kt(y,t,s){const f=t.projectionCache;if(f.projections[y])return f.projections[y];const m=new u.P(t.lineVertexArray.getx(y),t.lineVertexArray.gety(y)),b=ki(m.x,m.y,t);if(b.signedDistanceFromCamera>0)return f.projections[y]=b.point,f.anyProjectionOccluded=f.anyProjectionOccluded||b.isOccluded,b.point;const E=y-s.direction;return Ot(s.distanceFromAnchor===0?t.tileAnchorPoint:new u.P(t.lineVertexArray.getx(E),t.lineVertexArray.gety(E)),m,s.previousVertex,s.absOffsetX-s.distanceFromAnchor+1,t)}function ki(y,t,s){const f=y+s.translation[0],m=t+s.translation[1];let b;return s.pitchWithMap?(b=Ze(f,m,s.pitchedLabelPlaneMatrix,s.getElevation),b.isOccluded=!1):(b=s.transform.projectTileCoordinates(f,m,s.unwrappedTileID,s.getElevation),b.point.x=(.5*b.point.x+.5)*s.width,b.point.y=(.5*-b.point.y+.5)*s.height),b}function ct(y,t,s,f){if(s.pitchWithMap){const m=[y,t,0,1];return u.ap(m,m,f),s.transform.projectTileCoordinates(m[0]/m[3],m[1]/m[3],s.unwrappedTileID,s.getElevation).point}return{x:y/s.width*2-1,y:t/s.height*2-1}}function Bt(y,t,s){return s.transform.projectTileCoordinates(y,t,s.unwrappedTileID,s.getElevation)}function _t(y,t,s){return y._unit()._perp()._mult(t*s)}function ii(y,t,s,f,m,b,E,I,D){if(I.projectionCache.offsets[y])return I.projectionCache.offsets[y];const z=s.add(t);if(y+D.direction<f||y+D.direction>=m)return I.projectionCache.offsets[y]=z,z;const F=Kt(y+D.direction,I,D),U=_t(F.sub(s),E,D.direction),N=s.add(U),Y=F.add(U);return I.projectionCache.offsets[y]=u.aq(b,z,N,Y)||z,I.projectionCache.offsets[y]}function In(y,t,s,f,m,b,E,I,D){const z=f?y-t:y+t;let F=z>0?1:-1,U=0;f&&(F*=-1,U=Math.PI),F<0&&(U+=Math.PI);let N,Y=F>0?b+m:b+m+1;I.projectionCache.cachedAnchorPoint?N=I.projectionCache.cachedAnchorPoint:(N=ki(I.tileAnchorPoint.x,I.tileAnchorPoint.y,I).point,I.projectionCache.cachedAnchorPoint=N);let Q,se,ae=N,ce=N,he=0,me=0;const ge=Math.abs(z),ye=[];let Me;for(;he+me<=ge;){if(Y+=F,Y<b||Y>=E)return null;he+=me,ce=ae,se=Q;const Oe={absOffsetX:ge,direction:F,distanceFromAnchor:he,previousVertex:ce};if(ae=Kt(Y,I,Oe),s===0)ye.push(ce),Me=ae.sub(ce);else{let Xe;const We=ae.sub(ce);Xe=We.mag()===0?_t(Kt(Y+F,I,Oe).sub(ae),s,F):_t(We,s,F),se||(se=ce.add(Xe)),Q=ii(Y,Xe,ae,b,E,se,s,I,Oe),ye.push(se),Me=Q.sub(se)}me=Me.mag()}const Se=Me._mult((ge-he)/me)._add(se||ce),Le=U+Math.atan2(ae.y-ce.y,ae.x-ce.x);return ye.push(Se),{point:Se,angle:D?Le:0,path:ye}}const pa=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Gt(y,t){for(let s=0;s<y;s++){const f=t.length;t.resize(f+4),t.float32.set(pa,3*f)}}function $n(y,t,s){const f=t[0],m=t[1];return y[0]=s[0]*f+s[4]*m+s[12],y[1]=s[1]*f+s[5]*m+s[13],y[3]=s[3]*f+s[7]*m+s[15],y}const Xi=100;class or{constructor(t,s=new we(t.width+200,t.height+200,25),f=new we(t.width+200,t.height+200,25)){this.transform=t,this.grid=s,this.ignoredGrid=f,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Xi,this.screenBottomBoundary=t.height+Xi,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,s,f,m,b,E,I,D,z,F,U,N){const Y=this.projectAndGetPerspectiveRatio(t.anchorPointX+D[0],t.anchorPointY+D[1],b,F,N),Q=f*Y.perspectiveRatio;let se;if(E||I)se=this._projectCollisionBox(t,Q,m,b,E,I,D,Y,F,U,N);else{const Me=Y.x+(U?U.x*Q:0),Se=Y.y+(U?U.y*Q:0);se={allPointsOccluded:!1,box:[Me+t.x1*Q,Se+t.y1*Q,Me+t.x2*Q,Se+t.y2*Q]}}const[ae,ce,he,me]=se.box,ge=E?se.allPointsOccluded:Y.isOccluded;let ye=ge;return ye||(ye=Y.perspectiveRatio<this.perspectiveRatioCutoff),ye||(ye=!this.isInsideGrid(ae,ce,he,me)),ye||s!=="always"&&this.grid.hitTest(ae,ce,he,me,s,z)?{box:[ae,ce,he,me],placeable:!1,offscreen:!1,occluded:ge}:{box:[ae,ce,he,me],placeable:!0,offscreen:this.isOffscreen(ae,ce,he,me),occluded:ge}}placeCollisionCircles(t,s,f,m,b,E,I,D,z,F,U,N,Y,Q){const se=[],ae=new u.P(s.anchorX,s.anchorY),ce=this.getPerspectiveRatio(ae.x,ae.y,E,Q),he=(z?b*this.transform.getPitchedTextCorrection(s.anchorX,s.anchorY,E)/ce:b*ce)/u.av,me={getElevation:Q,pitchedLabelPlaneMatrix:I,lineVertexArray:f,pitchWithMap:z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:ae,unwrappedTileID:E,width:this.transform.width,height:this.transform.height,translation:Y},ge=St(he,m,s.lineOffsetX*he,s.lineOffsetY*he,!1,s,!1,me);let ye=!1,Me=!1,Se=!0;if(ge){const Le=.5*U*ce+N,Oe=new u.P(-100,-100),Xe=new u.P(this.screenRightBoundary,this.screenBottomBoundary),We=new fe,He=ge.first,gt=ge.last;let mt=[];for(let ai=He.path.length-1;ai>=1;ai--)mt.push(He.path[ai]);for(let ai=1;ai<gt.path.length;ai++)mt.push(gt.path[ai]);const it=2.5*Le;if(z){const ai=this.projectPathToScreenSpace(mt,me);mt=ai.some(Li=>Li.signedDistanceFromCamera<=0)?[]:ai.map(Li=>Li.point)}let Lt=[];if(mt.length>0){const ai=mt[0].clone(),Li=mt[0].clone();for(let vi=1;vi<mt.length;vi++)ai.x=Math.min(ai.x,mt[vi].x),ai.y=Math.min(ai.y,mt[vi].y),Li.x=Math.max(Li.x,mt[vi].x),Li.y=Math.max(Li.y,mt[vi].y);Lt=ai.x>=Oe.x&&Li.x<=Xe.x&&ai.y>=Oe.y&&Li.y<=Xe.y?[mt]:Li.x<Oe.x||ai.x>Xe.x||Li.y<Oe.y||ai.y>Xe.y?[]:u.ar([mt],Oe.x,Oe.y,Xe.x,Xe.y)}for(const ai of Lt){We.reset(ai,.25*Le);let Li=0;Li=We.length<=.5*Le?1:Math.ceil(We.paddedLength/it)+1;for(let vi=0;vi<Li;vi++){const en=vi/Math.max(Li-1,1),ln=We.lerp(en),pn=ln.x+Xi,Ki=ln.y+Xi;se.push(pn,Ki,Le,0);const tn=pn-Le,Hn=Ki-Le,gr=pn+Le,wr=Ki+Le;if(Se=Se&&this.isOffscreen(tn,Hn,gr,wr),Me=Me||this.isInsideGrid(tn,Hn,gr,wr),t!=="always"&&this.grid.hitTestCircle(pn,Ki,Le,t,F)&&(ye=!0,!D))return{circles:[],offscreen:!1,collisionDetected:ye}}}}return{circles:!D&&ye||!Me||ce<this.perspectiveRatioCutoff?[]:se,offscreen:Se,collisionDetected:ye}}projectPathToScreenSpace(t,s){const f=function(m,b){const E=u.K();return u.aj(E,b.pitchedLabelPlaneMatrix),m.map(I=>{const D=Ze(I.x,I.y,E,b.getElevation),z=b.transform.projectTileCoordinates(D.point.x,D.point.y,b.unwrappedTileID,b.getElevation);return z.point.x=(.5*z.point.x+.5)*b.width,z.point.y=(.5*-z.point.y+.5)*b.height,z})}(t,s);return function(m){let b=0,E=0,I=0,D=0;for(let z=0;z<m.length;z++)m[z].isOccluded?(I=z+1,D=0):(D++,D>E&&(E=D,b=I));return m.slice(b,b+E)}(f)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let f=1/0,m=1/0,b=-1/0,E=-1/0;for(const F of t){const U=new u.P(F.x+Xi,F.y+Xi);f=Math.min(f,U.x),m=Math.min(m,U.y),b=Math.max(b,U.x),E=Math.max(E,U.y),s.push(U)}const I=this.grid.query(f,m,b,E).concat(this.ignoredGrid.query(f,m,b,E)),D={},z={};for(const F of I){const U=F.key;if(D[U.bucketInstanceId]===void 0&&(D[U.bucketInstanceId]={}),D[U.bucketInstanceId][U.featureIndex])continue;const N=[new u.P(F.x1,F.y1),new u.P(F.x2,F.y1),new u.P(F.x2,F.y2),new u.P(F.x1,F.y2)];u.as(s,N)&&(D[U.bucketInstanceId][U.featureIndex]=!0,z[U.bucketInstanceId]===void 0&&(z[U.bucketInstanceId]=[]),z[U.bucketInstanceId].push(U.featureIndex))}return z}insertCollisionBox(t,s,f,m,b,E){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:b,collisionGroupID:E,overlapMode:s},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,f,m,b,E){const I=f?this.ignoredGrid:this.grid,D={bucketInstanceId:m,featureIndex:b,collisionGroupID:E,overlapMode:s};for(let z=0;z<t.length;z+=4)I.insertCircle(D,t[z],t[z+1],t[z+2])}projectAndGetPerspectiveRatio(t,s,f,m,b){if(b){let E;m?(E=[t,s,m(t,s),1],u.ap(E,E,b)):(E=[t,s,0,1],$n(E,E,b));const I=E[3];return{x:(E[0]/I+1)/2*this.transform.width+Xi,y:(-E[1]/I+1)/2*this.transform.height+Xi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/I*.5,isOccluded:!1,signedDistanceFromCamera:I}}{const E=this.transform.projectTileCoordinates(t,s,f,m);return{x:(E.point.x+1)/2*this.transform.width+Xi,y:(1-E.point.y)/2*this.transform.height+Xi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/E.signedDistanceFromCamera*.5,isOccluded:E.isOccluded,signedDistanceFromCamera:E.signedDistanceFromCamera}}}getPerspectiveRatio(t,s,f,m){const b=this.transform.projectTileCoordinates(t,s,f,m);return .5+this.transform.cameraToCenterDistance/b.signedDistanceFromCamera*.5}isOffscreen(t,s,f,m){return f<Xi||t>=this.screenRightBoundary||m<Xi||s>this.screenBottomBoundary}isInsideGrid(t,s,f,m){return f>=0&&t<this.gridRightBoundary&&m>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=u.at([]);return u.L(t,t,[-100,-100,0]),t}_projectCollisionBox(t,s,f,m,b,E,I,D,z,F,U){let N=1,Y=0,Q=0,se=1;const ae=t.anchorPointX+I[0],ce=t.anchorPointY+I[1];if(E&&!b){const mt=this.projectAndGetPerspectiveRatio(ae+1,ce,m,z,U),it=mt.x-D.x,Lt=Math.atan((mt.y-D.y)/it)+(it<0?Math.PI:0),ai=Math.sin(Lt),Li=Math.cos(Lt);N=Li,Y=ai,Q=-ai,se=Li}else if(!E&&b){const mt=Ye(this.transform);N=mt.vecEast[0],Y=mt.vecEast[1],Q=mt.vecSouth[0],se=mt.vecSouth[1]}let he=D.x,me=D.y,ge=s;b&&(he=ae,me=ce,ge=Math.pow(2,-(this.transform.zoom-f.overscaledZ)),ge*=this.transform.getPitchedTextCorrection(ae,ce,m),F||(ge*=u.ae(.5+D.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),F&&(he+=N*F.x*ge+Q*F.y*ge,me+=Y*F.x*ge+se*F.y*ge);const ye=t.x1*ge,Me=t.x2*ge,Se=(ye+Me)/2,Le=t.y1*ge,Oe=t.y2*ge,Xe=(Le+Oe)/2,We=[{offsetX:ye,offsetY:Le},{offsetX:Se,offsetY:Le},{offsetX:Me,offsetY:Le},{offsetX:Me,offsetY:Xe},{offsetX:Me,offsetY:Oe},{offsetX:Se,offsetY:Oe},{offsetX:ye,offsetY:Oe},{offsetX:ye,offsetY:Xe}];let He=[];for(const{offsetX:mt,offsetY:it}of We)He.push(new u.P(he+N*mt+Q*it,me+Y*mt+se*it));let gt=!1;if(b){const mt=He.map(it=>this.projectAndGetPerspectiveRatio(it.x,it.y,m,z,U));gt=mt.some(it=>!it.isOccluded),He=mt.map(it=>new u.P(it.x,it.y))}else gt=!0;return{box:u.au(He),allPointsOccluded:!gt}}}class Sl{constructor(t,s,f,m){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):m&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class ao{constructor(t,s,f,m,b){this.text=new Sl(t?t.text:null,s,f,b),this.icon=new Sl(t?t.icon:null,s,m,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class fr{constructor(t,s,f){this.text=t,this.icon=s,this.skipFade=f}}class rn{constructor(t,s,f,m,b){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=f,this.bucketIndex=m,this.tileID=b}}class Tm{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:f=>f.collisionGroupID===s}}return this.collisionGroups[t]}}function Tl(y,t,s,f,m){const{horizontalAlign:b,verticalAlign:E}=u.aB(y);return new u.P(-(b-.5)*t+f[0]*m,-(E-.5)*s+f[1]*m)}class Th{constructor(t,s,f,m,b){this.transform=t.clone(),this.terrain=s,this.collisionIndex=new or(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new Tm(m),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const s=this.terrain;return s?(f,m)=>s.getElevation(t,f,m):null}getBucketParts(t,s,f,m){const b=f.getBucket(s),E=f.latestFeatureIndex;if(!b||!E||s.id!==b.layerIds[0])return;const I=f.collisionBoxArray,D=b.layers[0].layout,z=b.layers[0].paint,F=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),U=f.tileSize/u.Z,N=f.tileID.toUnwrapped(),Y=D.get("text-rotation-alignment")==="map",Q=u.aw(f,1,this.transform.zoom),se=u.ax(this.collisionIndex.transform,f,z.get("text-translate"),z.get("text-translate-anchor")),ae=u.ax(this.collisionIndex.transform,f,z.get("icon-translate"),z.get("icon-translate-anchor")),ce=ze(Y,this.transform,Q);this.retainedQueryData[b.bucketInstanceId]=new rn(b.bucketInstanceId,E,b.sourceLayerIndex,b.index,f.tileID);const he={bucket:b,layout:D,translationText:se,translationIcon:ae,unwrappedTileID:N,pitchedLabelPlaneMatrix:ce,scale:F,textPixelRatio:U,holdingForFade:f.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:u.ag(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(m)for(const me of b.sortKeyRanges){const{sortKey:ge,symbolInstanceStart:ye,symbolInstanceEnd:Me}=me;t.push({sortKey:ge,symbolInstanceStart:ye,symbolInstanceEnd:Me,parameters:he})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:he})}attemptAnchorPlacement(t,s,f,m,b,E,I,D,z,F,U,N,Y,Q,se,ae,ce,he,me,ge){const ye=u.ay[t.textAnchor],Me=[t.textOffset0,t.textOffset1],Se=Tl(ye,f,m,Me,b),Le=this.collisionIndex.placeCollisionBox(s,N,D,z,F,I,E,ae,U.predicate,me,Se,ge);if((!he||this.collisionIndex.placeCollisionBox(he,N,D,z,F,I,E,ce,U.predicate,me,Se,ge).placeable)&&Le.placeable){let Oe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Y.crossTileID]&&this.prevPlacement.placements[Y.crossTileID]&&this.prevPlacement.placements[Y.crossTileID].text&&(Oe=this.prevPlacement.variableOffsets[Y.crossTileID].anchor),Y.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Y.crossTileID]={textOffset:Me,width:f,height:m,anchor:ye,textBoxScale:b,prevAnchor:Oe},this.markUsedJustification(Q,ye,Y,se),Q.allowVerticalPlacement&&(this.markUsedOrientation(Q,se,Y),this.placedOrientations[Y.crossTileID]=se),{shift:Se,placedGlyphBoxes:Le}}}placeLayerBucketPart(t,s,f){const{bucket:m,layout:b,translationText:E,translationIcon:I,unwrappedTileID:D,pitchedLabelPlaneMatrix:z,textPixelRatio:F,holdingForFade:U,collisionBoxArray:N,partiallyEvaluatedTextSize:Y,collisionGroup:Q}=t.parameters,se=b.get("text-optional"),ae=b.get("icon-optional"),ce=u.az(b,"text-overlap","text-allow-overlap"),he=ce==="always",me=u.az(b,"icon-overlap","icon-allow-overlap"),ge=me==="always",ye=b.get("text-rotation-alignment")==="map",Me=b.get("text-pitch-alignment")==="map",Se=b.get("icon-text-fit")!=="none",Le=b.get("symbol-z-order")==="viewport-y",Oe=he&&(ge||!m.hasIconData()||ae),Xe=ge&&(he||!m.hasTextData()||se);!m.collisionArrays&&N&&m.deserializeCollisionBoxes(N);const We=this.retainedQueryData[m.bucketInstanceId].tileID,He=this._getTerrainElevationFunc(We),gt=this.transform.getFastPathSimpleProjectionMatrix(We),mt=(it,Lt,ai)=>{var Li,vi;if(s[it.crossTileID])return;if(U)return void(this.placements[it.crossTileID]=new fr(!1,!1,!1));let en=!1,ln=!1,pn=!0,Ki=null,tn={box:null,placeable:!1,offscreen:null,occluded:!1},Hn={placeable:!1},gr=null,wr=null,Wr=null,js=0,fs=0,tl=0;Lt.textFeatureIndex?js=Lt.textFeatureIndex:it.useRuntimeCollisionCircles&&(js=it.featureIndex),Lt.verticalTextFeatureIndex&&(fs=Lt.verticalTextFeatureIndex);const Vs=Lt.textBox;if(Vs){const xa=Vn=>{let mn=u.ah.horizontal;if(m.allowVerticalPlacement&&!Vn&&this.prevPlacement){const er=this.prevPlacement.placedOrientations[it.crossTileID];er&&(this.placedOrientations[it.crossTileID]=er,mn=er,this.markUsedOrientation(m,mn,it))}return mn},Zs=(Vn,mn)=>{if(m.allowVerticalPlacement&&it.numVerticalGlyphVertices>0&&Lt.verticalTextBox){for(const er of m.writingModes)if(er===u.ah.vertical?(tn=mn(),Hn=tn):tn=Vn(),tn&&tn.placeable)break}else tn=Vn()},Xl=it.textAnchorOffsetStartIndex,Kl=it.textAnchorOffsetEndIndex;if(Kl===Xl){const Vn=(mn,er)=>{const Wi=this.collisionIndex.placeCollisionBox(mn,ce,F,We,D,Me,ye,E,Q.predicate,He,void 0,gt);return Wi&&Wi.placeable&&(this.markUsedOrientation(m,er,it),this.placedOrientations[it.crossTileID]=er),Wi};Zs(()=>Vn(Vs,u.ah.horizontal),()=>{const mn=Lt.verticalTextBox;return m.allowVerticalPlacement&&it.numVerticalGlyphVertices>0&&mn?Vn(mn,u.ah.vertical):{box:null,offscreen:null}}),xa(tn&&tn.placeable)}else{let Vn=u.ay[(vi=(Li=this.prevPlacement)===null||Li===void 0?void 0:Li.variableOffsets[it.crossTileID])===null||vi===void 0?void 0:vi.anchor];const mn=(Wi,So,lf)=>{const Gs=Wi.x2-Wi.x1,sp=Wi.y2-Wi.y1,cf=it.textBoxScale,uf=Se&&me==="never"?So:null;let ka=null,Ya=ce==="never"?1:2,gs="never";Vn&&Ya++;for(let Wl=0;Wl<Ya;Wl++){for(let Lc=Xl;Lc<Kl;Lc++){const ju=m.textAnchorOffsets.get(Lc);if(Vn&&ju.textAnchor!==Vn)continue;const Vu=this.attemptAnchorPlacement(ju,Wi,Gs,sp,cf,ye,Me,F,We,D,Q,gs,it,m,lf,E,I,uf,He);if(Vu&&(ka=Vu.placedGlyphBoxes,ka&&ka.placeable))return en=!0,Ki=Vu.shift,ka}Vn?Vn=null:gs=ce}return f&&!ka&&(ka={box:this.collisionIndex.placeCollisionBox(Vs,"always",F,We,D,Me,ye,E,Q.predicate,He,void 0,gt).box,offscreen:!1,placeable:!1,occluded:!1}),ka};Zs(()=>mn(Vs,Lt.iconBox,u.ah.horizontal),()=>{const Wi=Lt.verticalTextBox;return m.allowVerticalPlacement&&(!tn||!tn.placeable)&&it.numVerticalGlyphVertices>0&&Wi?mn(Wi,Lt.verticalIconBox,u.ah.vertical):{box:null,occluded:!0,offscreen:null}}),tn&&(en=tn.placeable,pn=tn.offscreen);const er=xa(tn&&tn.placeable);if(!en&&this.prevPlacement){const Wi=this.prevPlacement.variableOffsets[it.crossTileID];Wi&&(this.variableOffsets[it.crossTileID]=Wi,this.markUsedJustification(m,Wi.anchor,it,er))}}}if(gr=tn,en=gr&&gr.placeable,pn=gr&&gr.offscreen,it.useRuntimeCollisionCircles){const xa=m.text.placedSymbolArray.get(it.centerJustifiedTextSymbolIndex),Zs=u.ai(m.textSizeData,Y,xa),Xl=b.get("text-padding");wr=this.collisionIndex.placeCollisionCircles(ce,xa,m.lineVertexArray,m.glyphOffsetArray,Zs,D,z,f,Me,Q.predicate,it.collisionCircleDiameter,Xl,E,He),wr.circles.length&&wr.collisionDetected&&!f&&u.w("Collisions detected, but collision boxes are not shown"),en=he||wr.circles.length>0&&!wr.collisionDetected,pn=pn&&wr.offscreen}if(Lt.iconFeatureIndex&&(tl=Lt.iconFeatureIndex),Lt.iconBox){const xa=Zs=>this.collisionIndex.placeCollisionBox(Zs,me,F,We,D,Me,ye,I,Q.predicate,He,Se&&Ki?Ki:void 0,gt);Hn&&Hn.placeable&&Lt.verticalIconBox?(Wr=xa(Lt.verticalIconBox),ln=Wr.placeable):(Wr=xa(Lt.iconBox),ln=Wr.placeable),pn=pn&&Wr.offscreen}const il=se||it.numHorizontalGlyphVertices===0&&it.numVerticalGlyphVertices===0,ps=ae||it.numIconVertices===0;il||ps?ps?il||(ln=ln&&en):en=ln&&en:ln=en=ln&&en;const ms=ln&&Wr.placeable;if(en&&gr.placeable&&this.collisionIndex.insertCollisionBox(gr.box,ce,b.get("text-ignore-placement"),m.bucketInstanceId,Hn&&Hn.placeable&&fs?fs:js,Q.ID),ms&&this.collisionIndex.insertCollisionBox(Wr.box,me,b.get("icon-ignore-placement"),m.bucketInstanceId,tl,Q.ID),wr&&en&&this.collisionIndex.insertCollisionCircles(wr.circles,ce,b.get("text-ignore-placement"),m.bucketInstanceId,js,Q.ID),f&&this.storeCollisionData(m.bucketInstanceId,ai,Lt,gr,Wr,wr),it.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[it.crossTileID]=new fr((en||Oe)&&!(gr!=null&&gr.occluded),(ln||Xe)&&!(Wr!=null&&Wr.occluded),pn||m.justReloaded),s[it.crossTileID]=!0};if(Le){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const it=m.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Lt=it.length-1;Lt>=0;--Lt){const ai=it[Lt];mt(m.symbolInstances.get(ai),m.collisionArrays[ai],ai)}}else for(let it=t.symbolInstanceStart;it<t.symbolInstanceEnd;it++)mt(m.symbolInstances.get(it),m.collisionArrays[it],it);m.justReloaded=!1}storeCollisionData(t,s,f,m,b,E){if(f.textBox||f.iconBox){let I,D;this.collisionBoxArrays.has(t)?I=this.collisionBoxArrays.get(t):(I=new Map,this.collisionBoxArrays.set(t,I)),I.has(s)?D=I.get(s):(D={text:null,icon:null},I.set(s,D)),f.textBox&&(D.text=m.box),f.iconBox&&(D.icon=b.box)}if(E){let I=this.collisionCircleArrays[t];I===void 0&&(I=this.collisionCircleArrays[t]=[]);for(let D=0;D<E.circles.length;D+=4)I.push(E.circles[D+0]-Xi),I.push(E.circles[D+1]-Xi),I.push(E.circles[D+2]),I.push(E.collisionDetected?1:0)}}markUsedJustification(t,s,f,m){let b;b=m===u.ah.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[u.aA(s)];const E=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];for(const I of E)I>=0&&(t.text.placedSymbolArray.get(I).crossTileID=b>=0&&I!==b?0:f.crossTileID)}markUsedOrientation(t,s,f){const m=s===u.ah.horizontal||s===u.ah.horizontalOnly?s:0,b=s===u.ah.vertical?s:0,E=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];for(const I of E)t.text.placedSymbolArray.get(I).placedOrientation=m;f.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let f=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const m=s?s.symbolFadeChange(t):1,b=s?s.opacities:{},E=s?s.variableOffsets:{},I=s?s.placedOrientations:{};for(const D in this.placements){const z=this.placements[D],F=b[D];F?(this.opacities[D]=new ao(F,m,z.text,z.icon),f=f||z.text!==F.text.placed||z.icon!==F.icon.placed):(this.opacities[D]=new ao(null,m,z.text,z.icon,z.skipFade),f=f||z.text||z.icon)}for(const D in b){const z=b[D];if(!this.opacities[D]){const F=new ao(z,m,!1,!1);F.isHidden()||(this.opacities[D]=F,f=f||z.text.placed||z.icon.placed)}}for(const D in E)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=E[D]);for(const D in I)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=I[D]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");f?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s){const f={};for(const m of s){const b=m.getBucket(t);b&&m.latestFeatureIndex&&t.id===b.layerIds[0]&&this.updateBucketOpacities(b,m.tileID,f,m.collisionBoxArray)}}updateBucketOpacities(t,s,f,m){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const b=t.layers[0],E=b.layout,I=new ao(null,0,!1,!1,!0),D=E.get("text-allow-overlap"),z=E.get("icon-allow-overlap"),F=b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"),U=E.get("text-rotation-alignment")==="map",N=E.get("text-pitch-alignment")==="map",Y=E.get("icon-text-fit")!=="none",Q=new ao(null,0,D&&(z||!t.hasIconData()||E.get("icon-optional")),z&&(D||!t.hasTextData()||E.get("text-optional")),!0);!t.collisionArrays&&m&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(m);const se=(ce,he,me)=>{for(let ge=0;ge<he/4;ge++)ce.opacityVertexArray.emplaceBack(me);ce.hasVisibleVertices=ce.hasVisibleVertices||me!==fu},ae=this.collisionBoxArrays.get(t.bucketInstanceId);for(let ce=0;ce<t.symbolInstances.length;ce++){const he=t.symbolInstances.get(ce),{numHorizontalGlyphVertices:me,numVerticalGlyphVertices:ge,crossTileID:ye}=he;let Me=this.opacities[ye];f[ye]?Me=I:Me||(Me=Q,this.opacities[ye]=Me),f[ye]=!0;const Se=he.numIconVertices>0,Le=this.placedOrientations[he.crossTileID],Oe=Le===u.ah.vertical,Xe=Le===u.ah.horizontal||Le===u.ah.horizontalOnly;if(me>0||ge>0){const He=Mh(Me.text);se(t.text,me,Oe?fu:He),se(t.text,ge,Xe?fu:He);const gt=Me.text.isHidden();[he.rightJustifiedTextSymbolIndex,he.centerJustifiedTextSymbolIndex,he.leftJustifiedTextSymbolIndex].forEach(Lt=>{Lt>=0&&(t.text.placedSymbolArray.get(Lt).hidden=gt||Oe?1:0)}),he.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(he.verticalPlacedTextSymbolIndex).hidden=gt||Xe?1:0);const mt=this.variableOffsets[he.crossTileID];mt&&this.markUsedJustification(t,mt.anchor,he,Le);const it=this.placedOrientations[he.crossTileID];it&&(this.markUsedJustification(t,"left",he,it),this.markUsedOrientation(t,it,he))}if(Se){const He=Mh(Me.icon),gt=!(Y&&he.verticalPlacedIconSymbolIndex&&Oe);he.placedIconSymbolIndex>=0&&(se(t.icon,he.numIconVertices,gt?He:fu),t.icon.placedSymbolArray.get(he.placedIconSymbolIndex).hidden=Me.icon.isHidden()),he.verticalPlacedIconSymbolIndex>=0&&(se(t.icon,he.numVerticalIconVertices,gt?fu:He),t.icon.placedSymbolArray.get(he.verticalPlacedIconSymbolIndex).hidden=Me.icon.isHidden())}const We=ae&&ae.has(ce)?ae.get(ce):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const He=t.collisionArrays[ce];if(He){let gt=new u.P(0,0);if(He.textBox||He.verticalTextBox){let mt=!0;if(F){const it=this.variableOffsets[ye];it?(gt=Tl(it.anchor,it.width,it.height,it.textOffset,it.textBoxScale),U&&gt._rotate(N?-this.transform.bearingInRadians:this.transform.bearingInRadians)):mt=!1}if(He.textBox||He.verticalTextBox){let it;He.textBox&&(it=Oe),He.verticalTextBox&&(it=Xe),zo(t.textCollisionBox.collisionVertexArray,Me.text.placed,!mt||it,We.text,gt.x,gt.y)}}if(He.iconBox||He.verticalIconBox){const mt=!!(!Xe&&He.verticalIconBox);let it;He.iconBox&&(it=mt),He.verticalIconBox&&(it=!mt),zo(t.iconCollisionBox.collisionVertexArray,Me.icon.placed,it,We.icon,Y?gt.x:0,Y?gt.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const f=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*f>t}setStale(){this.stale=!0}}function zo(y,t,s,f,m,b){f&&f.length!==0||(f=[0,0,0,0]);const E=f[0]-Xi,I=f[1]-Xi,D=f[2]-Xi,z=f[3]-Xi;y.emplaceBack(t?1:0,s?1:0,m||0,b||0,E,I),y.emplaceBack(t?1:0,s?1:0,m||0,b||0,D,I),y.emplaceBack(t?1:0,s?1:0,m||0,b||0,D,z),y.emplaceBack(t?1:0,s?1:0,m||0,b||0,E,z)}const so=Math.pow(2,25),du=Math.pow(2,24),Cs=Math.pow(2,17),Eh=Math.pow(2,16),El=Math.pow(2,9),Ml=Math.pow(2,8),Bd=Math.pow(2,1);function Mh(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const t=y.placed?1:0,s=Math.floor(127*y.opacity);return s*so+t*du+s*Cs+t*Eh+s*El+t*Ml+s*Bd+t}const fu=0;class Ld{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,s,f,m,b){const E=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(E,m,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((I,D)=>I.sortKey-D.sortKey));this._currentPartIndex<E.length;)if(s.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,b())return!0;return!1}}class Aa{constructor(t,s,f,m,b,E,I,D){this.placement=new Th(t,s,E,I,D),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(t,s,f){const m=ne.now(),b=()=>!this._forceFullPlacement&&ne.now()-m>2;for(;this._currentPlacementIndex>=0;){const E=s[t[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=I)&&(!E.maxzoom||E.maxzoom>I)){if(this._inProgressLayer||(this._inProgressLayer=new Ld(E)),this._inProgressLayer.continuePlacement(f[E.source],this.placement,this._showCollisionBoxes,E,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const ko=512/u.Z/2;class Fd{constructor(t,s,f){this.tileID=t,this.bucketInstanceId=f,this._symbolsByKey={};const m=new Map;for(let b=0;b<s.length;b++){const E=s.get(b),I=E.key,D=m.get(I);D?D.push(E):m.set(I,[E])}for(const[b,E]of m){const I={positions:E.map(D=>({x:Math.floor(D.anchorX*ko),y:Math.floor(D.anchorY*ko)})),crossTileIDs:E.map(D=>D.crossTileID)};if(I.positions.length>128){const D=new u.aC(I.positions.length,16,Uint16Array);for(const{x:z,y:F}of I.positions)D.add(z,F);D.finish(),delete I.positions,I.index=D}this._symbolsByKey[b]=I}}getScaledCoordinates(t,s){const{x:f,y:m,z:b}=this.tileID.canonical,{x:E,y:I,z:D}=s.canonical,z=ko/Math.pow(2,D-b),F=(I*u.Z+t.anchorY)*z,U=m*u.Z*ko;return{x:Math.floor((E*u.Z+t.anchorX)*z-f*u.Z*ko),y:Math.floor(F-U)}}findMatches(t,s,f){const m=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let b=0;b<t.length;b++){const E=t.get(b);if(E.crossTileID)continue;const I=this._symbolsByKey[E.key];if(!I)continue;const D=this.getScaledCoordinates(E,s);if(I.index){const z=I.index.range(D.x-m,D.y-m,D.x+m,D.y+m).sort();for(const F of z){const U=I.crossTileIDs[F];if(!f[U]){f[U]=!0,E.crossTileID=U;break}}}else if(I.positions)for(let z=0;z<I.positions.length;z++){const F=I.positions[z],U=I.crossTileIDs[z];if(Math.abs(F.x-D.x)<=m&&Math.abs(F.y-D.y)<=m&&!f[U]){f[U]=!0,E.crossTileID=U;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class pu{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ah{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const f in this.indexes){const m=this.indexes[f],b={};for(const E in m){const I=m[E];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+s),b[I.tileID.key]=I}this.indexes[f]=b}this.lng=t}addBucket(t,s,f){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let b=0;b<s.symbolInstances.length;b++)s.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const m=this.usedCrossTileIDs[t.overscaledZ];for(const b in this.indexes){const E=this.indexes[b];if(Number(b)>t.overscaledZ)for(const I in E){const D=E[I];D.tileID.isChildOf(t)&&D.findMatches(s.symbolInstances,t,m)}else{const I=E[t.scaledTo(Number(b)).key];I&&I.findMatches(s.symbolInstances,t,m)}}for(let b=0;b<s.symbolInstances.length;b++){const E=s.symbolInstances.get(b);E.crossTileID||(E.crossTileID=f.generate(),m[E.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Fd(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const f of s.getCrossTileIDsLists())for(const m of f)delete this.usedCrossTileIDs[t][m]}removeStaleBuckets(t){let s=!1;for(const f in this.indexes){const m=this.indexes[f];for(const b in m)t[m[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,m[b]),delete m[b],s=!0)}return s}}class Al{constructor(){this.layerIndexes={},this.crossTileIDs=new pu,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,f){let m=this.layerIndexes[t.id];m===void 0&&(m=this.layerIndexes[t.id]=new Ah);let b=!1;const E={};m.handleWrapJump(f);for(const I of s){const D=I.getBucket(t);D&&t.id===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(I.tileID,D,this.crossTileIDs)&&(b=!0),E[D.bucketInstanceId]=!0)}return m.removeStaleBuckets(E)&&(b=!0),b}pruneUnusedLayers(t){const s={};t.forEach(f=>{s[f]=!0});for(const f in this.layerIndexes)s[f]||delete this.layerIndexes[f]}}var mu="void main() {fragColor=vec4(1.0);}";const Qn={prelude:wi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:wi("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:wi("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:wi(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:wi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:wi(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:wi(mu,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:wi(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:wi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:wi("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:wi("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:wi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:wi(mu,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:wi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:wi(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:wi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:wi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:wi(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:wi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:wi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));fragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:wi(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:wi(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:wi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:wi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:wi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:wi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:wi(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:wi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:wi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:wi("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:wi("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:wi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:wi("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:wi(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:wi("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function wi(y,t){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=t.match(/in ([\w]+) ([\w]+)/g),m=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=b?b.concat(m):m,I={};return{fragmentSource:y=y.replace(s,(D,z,F,U,N)=>(I[N]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${N}
in ${F} ${U} ${N};
#else
uniform ${F} ${U} u_${N};
#endif
`:`
#ifdef HAS_UNIFORM_u_${N}
    ${F} ${U} ${N} = u_${N};
#endif
`)),vertexSource:t=t.replace(s,(D,z,F,U,N)=>{const Y=U==="float"?"vec2":"vec4",Q=N.match(/color/)?"color":Y;return I[N]?z==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${F} ${Y} a_${N};
out ${F} ${U} ${N};
#else
uniform ${F} ${U} u_${N};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${F} ${U} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${Q}(a_${N}, u_${N}_t);
#else
    ${F} ${U} ${N} = u_${N};
#endif
`:z==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${F} ${Y} a_${N};
#else
uniform ${F} ${U} u_${N};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${F} ${U} ${N} = a_${N};
#else
    ${F} ${U} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${F} ${U} ${N} = unpack_mix_${Q}(a_${N}, u_${N}_t);
#else
    ${F} ${U} ${N} = u_${N};
#endif
`}),staticAttributes:f,staticUniforms:E}}class Oo{constructor(t,s,f){this.vertexBuffer=t,this.indexBuffer=s,this.segments=f}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Ds=u.aD([{name:"a_pos",type:"Int16",components:2}]);const ma="#define PROJECTION_MERCATOR",Il="mercator";class Bi{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Il}get shaderDefine(){return ma}get shaderPreludeCode(){return Qn.projectionMercator}get vertexShaderPreludeCode(){return Qn.projectionMercator.vertexSource}get subdivisionGranularity(){return u.aE.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,s,f,m,b){if(this._cachedMesh)return this._cachedMesh;const E=new u.aF;E.emplaceBack(0,0),E.emplaceBack(u.Z,0),E.emplaceBack(0,u.Z),E.emplaceBack(u.Z,u.Z);const I=t.createVertexBuffer(E,Ds.members),D=u.aG.simpleSegment(0,0,4,2),z=new u.aH;z.emplaceBack(1,0,2),z.emplaceBack(1,2,3);const F=t.createIndexBuffer(z);return this._cachedMesh=new Oo(I,F,D),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}function kr(y,t){const s=u.ae(t.lat,-85.051129,u.aJ);return new u.P(u.U(t.lng)*y,u.S(s)*y)}function gu(y,t){return new u.$(t.x/y,t.y/y).toLngLat()}function Cl(y){return y.cameraToCenterDistance*Math.min(.85*Math.tan(u.ad(90-y.pitch)),Math.tan(u.ad(89.25-y.pitch)))}function Hr(y,t){const s=y.canonical,f=t/u.aI(s.z),m=s.x+Math.pow(2,s.z)*y.wrap,b=u.at(new Float64Array(16));return u.L(b,b,[m*f,s.y*f,0]),u.M(b,b,[f/u.Z,f/u.Z,1]),b}function xr(y,t,s,f,m){const b=u.$.fromLngLat(y,t),E=m*u.aK(1,y.lat),I=E*Math.cos(u.ad(s)),D=Math.sqrt(E*E-I*I),z=D*Math.sin(u.ad(-f)),F=D*Math.cos(u.ad(-f));return new u.$(b.x+z,b.y+F,b.z+I)}class Cn{constructor(t=0,s=0,f=0,m=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(f)||f<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=f,this.right=m}interpolate(t,s,f){return s.top!=null&&t.top!=null&&(this.top=u.B.number(t.top,s.top,f)),s.bottom!=null&&t.bottom!=null&&(this.bottom=u.B.number(t.bottom,s.bottom,f)),s.left!=null&&t.left!=null&&(this.left=u.B.number(t.left,s.left,f)),s.right!=null&&t.right!=null&&(this.right=u.B.number(t.right,s.right,f)),this}getCenter(t,s){const f=u.ae((this.left+t-this.right)/2,0,t),m=u.ae((this.top+s-this.bottom)/2,0,s);return new u.P(f,m)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Cn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ih(y,t){if(!y.renderWorldCopies||y.lngRange)return;const s=t.lng-y.center.lng;t.lng+=s>180?-360:s<-180?360:0}function Cr(y){return Math.max(0,Math.floor(y))}class Yr{constructor(t,s,f,m,b,E){this._callbacks=t,this._tileSize=512,this._renderWorldCopies=E===void 0||!!E,this._minZoom=s||0,this._maxZoom=f||22,this._minPitch=m??0,this._maxPitch=b??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new u.Q(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Cr(this._zoom),this._scale=u.aI(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Cn,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,s,f){this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=Cr(this._zoom),this._scale=u.aI(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new Cn(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!f&&t.autoCalculateNearFarZ,s&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const s=u.aL(t,-180,180)*Math.PI/180;var f,m,b,E,I,D,z,F,U;this._bearingInRadians!==s&&(this._unmodified=!1,this._bearingInRadians=s,this._calcMatrices(),this._rotationMatrix=B(),f=this._rotationMatrix,b=-this._bearingInRadians,E=(m=this._rotationMatrix)[0],I=m[1],D=m[2],z=m[3],F=Math.sin(b),U=Math.cos(b),f[0]=E*U+D*F,f[1]=I*U+z*F,f[2]=E*-F+D*U,f[3]=I*-F+z*U)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const s=u.ae(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==s&&(this._unmodified=!1,this._pitchInRadians=s,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const s=t/180*Math.PI;this._rollInRadians!==s&&(this._unmodified=!1,this._rollInRadians=s,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return u.aM(this._fovInRadians)}setFov(t){t=u.ae(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=u.ad(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const s=this.getConstrained(this._center,t).zoom;this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this._tileZoom=Math.max(0,Math.floor(s)),this._scale=u.aI(s),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,s){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=s,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,f){this._unmodified=!1,this._edgeInsets.interpolate(t,s,f),this._constrain(),this._calcMatrices()}resize(t,s,f=!0){this._width=t,this._height=s,f&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Nn([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,u.aJ])}getConstrained(t,s){return this._callbacks.getConstrained(t,s)}getCameraQueryGeometry(t,s){if(s.length===1)return[s[0],t];{let f=t.x,m=t.y,b=t.x,E=t.y;for(const I of s)f=Math.min(f,I.x),m=Math.min(m,I.y),b=Math.max(b,I.x),E=Math.max(E,I.y);return[new u.P(f,m),new u.P(b,m),new u.P(b,E),new u.P(f,E),new u.P(f,m)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:s,zoom:f}=this.getConstrained(this.center,this.zoom);this.setCenter(s),this.setZoom(f),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=u.at(new Float64Array(16));u.M(t,t,[this._width/2,-this._height/2,1]),u.L(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=u.at(new Float64Array(16)),u.M(t,t,[1,-1,1]),u.L(t,t,[-1,-1,0]),u.M(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,s,f,m){const b=f!==void 0?f:this.bearing,E=m=m!==void 0?m:this.pitch,I=u.$.fromLngLat(t,s),D=-Math.cos(u.ad(E)),z=Math.sin(u.ad(E)),F=z*Math.sin(u.ad(b)),U=-z*Math.cos(u.ad(b));let N=this.elevation;const Y=s-N;let Q;D*Y>=0||Math.abs(D)<.1?(Q=1e4,N=s+Q*D):Q=-Y/D;let se,ae,ce=u.aN(1,I.y),he=0;do{if(he+=1,he>10)break;ae=Q/ce,se=new u.$(I.x+F*ae,I.y+U*ae),ce=1/se.meterInMercatorCoordinateUnits()}while(Math.abs(Q-ae*ce)>1e-12);return{center:se.toLngLat(),elevation:N,zoom:u.ab(this.height/2/Math.tan(this.fovInRadians/2)/ae/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const s=u.aK(1,this.center.lat)*this.worldSize,f=this.cameraToCenterDistance/s,m=u.$.fromLngLat(this.center,this.elevation),b=xr(this.center,this.elevation,this.pitch,this.bearing,f);this._elevation=t;const E=this.calculateCenterFromCameraLngLatAlt(b.toLngLat(),u.aN(b.z,m.y),this.bearing,this.pitch);this._elevation=E.elevation,this._center=E.center,this.setZoom(E.zoom)}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=u.aK(1,this.center.lat)*this.worldSize;return xr(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const s=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/s,t.canonical.y/s,1/s/u.Z,1/s/u.Z]}}class lr{constructor(t,s){this.min=t,this.max=s,this.center=u.aO([],u.aP([],this.min,this.max),.5)}quadrant(t){const s=[t%2==0,t<2],f=u.aQ(this.min),m=u.aQ(this.max);for(let b=0;b<s.length;b++)f[b]=s[b]?this.min[b]:this.center[b],m[b]=s[b]?this.center[b]:this.max[b];return m[2]=this.max[2],new lr(f,m)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let s=!0;for(let f=0;f<t.planes.length;f++){const m=this.intersectsPlane(t.planes[f]);if(m===0)return 0;m===1&&(s=!1)}return s?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let s=t[3],f=t[3];for(let m=0;m<3;m++)t[m]>0?(s+=t[m]*this.min[m],f+=t[m]*this.max[m]):(f+=t[m]*this.min[m],s+=t[m]*this.max[m]);return s>=0?2:f<0?0:1}}class Dl{distanceToTile2d(t,s,f,m){const b=m.distanceX([t,s]),E=m.distanceY([t,s]);return Math.hypot(b,E)}getWrap(t,s,f){return f}getTileAABB(t,s,f,m){var b,E;let I=f,D=f;if(m.terrain){const F=new u.Y(t.z,s,t.z,t.x,t.y),U=m.terrain.getMinMaxElevation(F);I=(b=U.minElevation)!==null&&b!==void 0?b:f,D=(E=U.maxElevation)!==null&&E!==void 0?E:f}const z=1<<t.z;return new lr([s+t.x/z,t.y/z,I],[s+(t.x+1)/z,(t.y+1)/z,D])}allowVariableZoom(t,s){const f=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,m=u.ae(78.5-f/2,0,60);return!!s.terrain||t.pitch>m}allowWorldCopies(){return!0}recalculateCache(){}}class Ia{constructor(t,s,f){this.points=t,this.planes=s,this.aabb=f}static fromInvProjectionMatrix(t,s=1,f=0){const m=Math.pow(2,f),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(z=>{const F=1/(z=u.ap([],z,t))[3]/s*m;return u.aR(z,z,[F,F,1/z[3],F])}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(z=>{const F=u.aS([],b[z[0]],b[z[1]]),U=u.aS([],b[z[2]],b[z[1]]),N=u.aT([],u.aU([],F,U)),Y=-u.aV(N,b[z[1]]);return N.concat(Y)}),I=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],D=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const z of b)for(let F=0;F<3;F++)I[F]=Math.min(I[F],z[F]),D[F]=Math.max(D[F],z[F]);return new Ia(b,E,new lr(I,D))}}class vn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,s,f){return this._helper.interpolatePadding(t,s,f)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,s,f=!0){this._helper.resize(t,s,f)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,s){this._helper.overrideNearFarZ(t,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,s){}constructor(t,s,f,m,b){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Yr({calcMatrices:()=>{this._calcMatrices()},getConstrained:(E,I)=>this.getConstrained(E,I)},t,s,f,m,b),this._coveringTilesDetailsProvider=new Dl}clone(){const t=new vn;return t.apply(this),t}apply(t,s,f){this._helper.apply(t,s,f)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const s=[new u.aW(0,t)];if(this._helper._renderWorldCopies){const f=this.screenPointToMercatorCoordinate(new u.P(0,0)),m=this.screenPointToMercatorCoordinate(new u.P(this._helper._width,0)),b=this.screenPointToMercatorCoordinate(new u.P(this._helper._width,this._helper._height)),E=this.screenPointToMercatorCoordinate(new u.P(0,this._helper._height)),I=Math.floor(Math.min(f.x,m.x,b.x,E.x)),D=Math.floor(Math.max(f.x,m.x,b.x,E.x)),z=1;for(let F=I-z;F<=D+z;F++)F!==0&&s.push(new u.aW(F,t))}return s}getCameraFrustum(){return Ia.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const s=this.screenPointToLocation(this.centerPoint,t),f=t?t.getElevationForLngLatZoom(s,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(f)}setLocationAtPoint(t,s){const f=u.aK(this.elevation,this.center.lat),m=this.screenPointToMercatorCoordinateAtZ(s,f),b=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,f),E=u.$.fromLngLat(t),I=new u.$(E.x-(m.x-b.x),E.y-(m.y-b.y));this.setCenter(I==null?void 0:I.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,s){return s?this.coordinatePoint(u.$.fromLngLat(t),s.getElevationForLngLatZoom(t,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(u.$.fromLngLat(t))}screenPointToLocation(t,s){var f;return(f=this.screenPointToMercatorCoordinate(t,s))===null||f===void 0?void 0:f.toLngLat()}screenPointToMercatorCoordinate(t,s){if(s){const f=s.pointCoordinate(t);if(f!=null)return f}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,s){const f=s||0,m=[t.x,t.y,0,1],b=[t.x,t.y,1,1];u.ap(m,m,this._pixelMatrixInverse),u.ap(b,b,this._pixelMatrixInverse);const E=m[3],I=b[3],D=m[1]/E,z=b[1]/I,F=m[2]/E,U=b[2]/I,N=F===U?0:(f-F)/(U-F);return new u.$(u.B.number(m[0]/E,b[0]/I,N)/this.worldSize,u.B.number(D,z,N)/this.worldSize,f)}coordinatePoint(t,s=0,f=this._pixelMatrix){const m=[t.x*this.worldSize,t.y*this.worldSize,s,1];return u.ap(m,m,f),new u.P(m[0]/m[3],m[1]/m[3])}getBounds(){const t=Math.max(0,this._helper._height/2-Cl(this));return new Nn().extend(this.screenPointToLocation(new u.P(0,t))).extend(this.screenPointToLocation(new u.P(this._helper._width,t))).extend(this.screenPointToLocation(new u.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new u.P(0,this._helper._height)))}isPointOnMapSurface(t,s){return s?s.pointCoordinate(t)!=null:t.y>this.height/2-Cl(this)}calculatePosMatrix(t,s=!1,f){var m;const b=(m=t.key)!==null&&m!==void 0?m:u.aX(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),E=s?this._alignedPosMatrixCache:this._posMatrixCache;if(E.has(b)){const z=E.get(b);return f?z.f32:z.f64}const I=Hr(t,this.worldSize);u.N(I,s?this._alignedProjMatrix:this._viewProjMatrix,I);const D={f64:I,f32:new Float32Array(I)};return E.set(b,D),f?D.f32:D.f64}calculateFogMatrix(t){const s=t.key,f=this._fogMatrixCacheF32;if(f.has(s))return f.get(s);const m=Hr(t,this.worldSize);return u.N(m,this._fogMatrix,m),f.set(s,new Float32Array(m)),f.get(s)}getConstrained(t,s){s=u.ae(+s,this.minZoom,this.maxZoom);const f={center:new u.Q(t.lng,t.lat),zoom:s};let m=this._helper._lngRange;this._helper._renderWorldCopies||m!==null||(m=[-179.9999999999,180-1e-10]);const b=this.tileSize*u.aI(f.zoom);let E=0,I=b,D=0,z=b,F=0,U=0;const{x:N,y:Y}=this.size;if(this._helper._latRange){const me=this._helper._latRange;E=u.S(me[1])*b,I=u.S(me[0])*b,I-E<Y&&(F=Y/(I-E))}m&&(D=u.aL(u.U(m[0])*b,0,b),z=u.aL(u.U(m[1])*b,0,b),z<D&&(z+=b),z-D<N&&(U=N/(z-D)));const{x:Q,y:se}=kr(b,t);let ae,ce;const he=Math.max(U||0,F||0);if(he){const me=new u.P(U?(z+D)/2:Q,F?(I+E)/2:se);return f.center=gu(b,me).wrap(),f.zoom+=u.ab(he),f}if(this._helper._latRange){const me=Y/2;se-me<E&&(ce=E+me),se+me>I&&(ce=I-me)}if(m){const me=(D+z)/2;let ge=Q;this._helper._renderWorldCopies&&(ge=u.aL(Q,me-b/2,me+b/2));const ye=N/2;ge-ye<D&&(ae=D+ye),ge+ye>z&&(ae=z-ye)}if(ae!==void 0||ce!==void 0){const me=new u.P(ae??Q,ce??se);f.center=gu(b,me).wrap()}return f}calculateCenterFromCameraLngLatAlt(t,s,f,m){return this._helper.calculateCenterFromCameraLngLatAlt(t,s,f,m)}_calculateNearFarZIfNeeded(t,s,f){if(!this._helper.autoCalculateNearFarZ)return;const m=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),b=t-m*this._helper._pixelPerMeter/Math.cos(s),E=m<0?b:t,I=Math.PI/2+this.pitchInRadians,D=u.ad(this.fov)*(Math.abs(Math.cos(u.ad(this.roll)))*this.height+Math.abs(Math.sin(u.ad(this.roll)))*this.width)/this.height*(.5+f.y/this.height),z=Math.sin(D)*E/Math.sin(u.ae(Math.PI-I-D,.01,Math.PI-.01)),F=Cl(this),U=Math.atan(F/this._helper.cameraToCenterDistance),N=u.ad(.75),Y=U>N?2*U*(.5+f.y/(2*F)):N,Q=Math.sin(Y)*E/Math.sin(u.ae(Math.PI-I-Y,.01,Math.PI-.01)),se=Math.min(z,Q);this._helper._farZ=1.01*(Math.cos(Math.PI/2-s)*se+E),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,s=kr(this.worldSize,this.center),f=s.x,m=s.y;this._helper._pixelPerMeter=u.aK(1,this.center.lat)*this.worldSize;const b=u.ad(Math.min(this.pitch,89.25)),E=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(b));let I;this._calculateNearFarZIfNeeded(E,b,t),I=new Float64Array(16),u.aY(I,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),u.aj(this._invProjMatrix,I),I[8]=2*-t.x/this._helper._width,I[9]=2*t.y/this._helper._height,this._projectionMatrix=u.aZ(I),u.M(I,I,[1,-1,1]),u.L(I,I,[0,0,-this._helper.cameraToCenterDistance]),u.a_(I,I,-this.rollInRadians),u.a$(I,I,this.pitchInRadians),u.a_(I,I,-this.bearingInRadians),u.L(I,I,[-f,-m,0]),this._mercatorMatrix=u.M([],I,[this.worldSize,this.worldSize,this.worldSize]),u.M(I,I,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=u.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,I),u.L(I,I,[0,0,-this.elevation]),this._viewProjMatrix=I,this._invViewProjMatrix=u.aj([],I);const D=[0,0,-1,1];u.ap(D,D,this._invViewProjMatrix),this._cameraPosition=[D[0]/D[3],D[1]/D[3],D[2]/D[3]],this._fogMatrix=new Float64Array(16),u.aY(this._fogMatrix,this.fovInRadians,this.width/this.height,E,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,u.M(this._fogMatrix,this._fogMatrix,[1,-1,1]),u.L(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),u.a_(this._fogMatrix,this._fogMatrix,-this.rollInRadians),u.a$(this._fogMatrix,this._fogMatrix,this.pitchInRadians),u.a_(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),u.L(this._fogMatrix,this._fogMatrix,[-f,-m,0]),u.M(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),u.L(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=u.N(new Float64Array(16),this.clipSpaceToPixelsMatrix,I);const z=this._helper._width%2/2,F=this._helper._height%2/2,U=Math.cos(this.bearingInRadians),N=Math.sin(-this.bearingInRadians),Y=f-Math.round(f)+U*z+N*F,Q=m-Math.round(m)+U*F+N*z,se=new Float64Array(I);if(u.L(se,se,[Y>.5?Y-1:Y,Q>.5?Q-1:Q,0]),this._alignedProjMatrix=se,I=u.aj(new Float64Array(16),this._pixelMatrix),!I)throw new Error("failed to invert matrix");this._pixelMatrixInverse=I,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new u.P(0,0)),s=[t.x*this.worldSize,t.y*this.worldSize,0,1];return u.ap(s,s,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=u.aK(1,this.center.lat)*this.worldSize;return xr(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,s){const f=u.$.fromLngLat(t),m=[f.x*this.worldSize,f.y*this.worldSize,s,1];return u.ap(m,m,this._viewProjMatrix),m[2]/m[3]}getProjectionData(t){const{overscaledTileID:s,aligned:f,applyTerrainMatrix:m}=t,b=this._helper.getMercatorTileCoordinates(s),E=s?this.calculatePosMatrix(s,f,!0):null;let I;return I=s&&s.terrainRttPosMatrix32f&&m?s.terrainRttPosMatrix32f:E||u.b0(),{mainMatrix:I,tileMercatorCoords:b,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:I}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,s,f){return 1}transformLightDirection(t){return u.aQ(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,s,f,m){const b=this.calculatePosMatrix(f);let E;m?(E=[t,s,m(t,s),1],u.ap(E,E,b)):(E=[t,s,0,1],$n(E,E,b));const I=E[3];return{point:new u.P(E[0]/I,E[1]/I),signedDistanceFromCamera:I,isOccluded:!1}}populateCache(t){for(const s of t)this.calculatePosMatrix(s)}getMatrixForModel(t,s){const f=u.$.fromLngLat(t,s),m=f.meterInMercatorCoordinateUnits(),b=u.b1();return u.L(b,b,[f.x,f.y,f.z]),u.a_(b,b,Math.PI),u.a$(b,b,Math.PI/2),u.M(b,b,[-m,m,m]),b}getProjectionDataForCustomLayer(t=!0){const s=new u.Y(0,0,0,0,0),f=this.getProjectionData({overscaledTileID:s,applyGlobeMatrix:t}),m=Hr(s,this.worldSize);u.N(m,this._viewProjMatrix,m),f.tileMercatorCoords=[0,0,1,1];const b=[u.Z,u.Z,this.worldSize/this._helper.pixelsPerMeter],E=u.b2();return u.M(E,m,b),f.fallbackMatrix=E,f.mainMatrix=E,f}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function Bo(){u.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function oo(y){if(y.useSlerp)if(y.k<1){const t=u.b3(y.startEulerAngles.roll,y.startEulerAngles.pitch,y.startEulerAngles.bearing),s=u.b3(y.endEulerAngles.roll,y.endEulerAngles.pitch,y.endEulerAngles.bearing),f=new Float64Array(4);u.b4(f,t,s,y.k);const m=u.b5(f);y.tr.setRoll(m.roll),y.tr.setPitch(m.pitch),y.tr.setBearing(m.bearing)}else y.tr.setRoll(y.endEulerAngles.roll),y.tr.setPitch(y.endEulerAngles.pitch),y.tr.setBearing(y.endEulerAngles.bearing);else y.tr.setRoll(u.B.number(y.startEulerAngles.roll,y.endEulerAngles.roll,y.k)),y.tr.setPitch(u.B.number(y.startEulerAngles.pitch,y.endEulerAngles.pitch,y.k)),y.tr.setBearing(u.B.number(y.startEulerAngles.bearing,y.endEulerAngles.bearing,y.k))}function lo(y,t,s,f,m){const b=m.padding,E=kr(m.worldSize,s.getNorthWest()),I=kr(m.worldSize,s.getNorthEast()),D=kr(m.worldSize,s.getSouthEast()),z=kr(m.worldSize,s.getSouthWest()),F=u.ad(-f),U=E.rotate(F),N=I.rotate(F),Y=D.rotate(F),Q=z.rotate(F),se=new u.P(Math.max(U.x,N.x,Q.x,Y.x),Math.max(U.y,N.y,Q.y,Y.y)),ae=new u.P(Math.min(U.x,N.x,Q.x,Y.x),Math.min(U.y,N.y,Q.y,Y.y)),ce=se.sub(ae),he=(m.width-(b.left+b.right+t.left+t.right))/ce.x,me=(m.height-(b.top+b.bottom+t.top+t.bottom))/ce.y;if(me<0||he<0)return void Bo();const ge=Math.min(u.ab(m.scale*Math.min(he,me)),y.maxZoom),ye=u.P.convert(y.offset),Me=new u.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(u.ad(f)),Se=ye.add(Me).mult(m.scale/u.aI(ge));return{center:gu(m.worldSize,E.add(D).div(2).sub(Se)),zoom:ge,bearing:f}}class Jn{get useGlobeControls(){return!1}handlePanInertia(t,s){return{easingOffset:t,easingCenter:s.center}}handleMapControlsRollPitchBearingZoom(t,s){t.bearingDelta&&s.setBearing(s.bearing+t.bearingDelta),t.pitchDelta&&s.setPitch(s.pitch+t.pitchDelta),t.rollDelta&&s.setRoll(s.roll+t.rollDelta),t.zoomDelta&&s.setZoom(s.zoom+t.zoomDelta)}handleMapControlsPan(t,s,f){t.around.distSqr(s.centerPoint)<.01||s.setLocationAtPoint(f,t.around)}cameraForBoxAndBearing(t,s,f,m,b){return lo(t,s,f,m,b)}handleJumpToCenterZoom(t,s){t.zoom!==(s.zoom!==void 0?+s.zoom:t.zoom)&&t.setZoom(+s.zoom),s.center!==void 0&&t.setCenter(u.Q.convert(s.center))}handleEaseTo(t,s){const f=t.zoom,m=t.padding,b={roll:t.roll,pitch:t.pitch,bearing:t.bearing},E={roll:s.roll===void 0?t.roll:s.roll,pitch:s.pitch===void 0?t.pitch:s.pitch,bearing:s.bearing===void 0?t.bearing:s.bearing},I=s.zoom!==void 0,D=!t.isPaddingEqual(s.padding);let z=!1;const F=I?+s.zoom:t.zoom;let U=t.centerPoint.add(s.offsetAsPoint);const N=t.screenPointToLocation(U),{center:Y,zoom:Q}=t.getConstrained(u.Q.convert(s.center||N),F??f);Ih(t,Y);const se=kr(t.worldSize,N),ae=kr(t.worldSize,Y).sub(se),ce=u.aI(Q-f);return z=Q!==f,{easeFunc:he=>{if(z&&t.setZoom(u.B.number(f,Q,he)),u.b6(b,E)||oo({startEulerAngles:b,endEulerAngles:E,tr:t,k:he,useSlerp:b.roll!=E.roll}),D&&(t.interpolatePadding(m,s.padding,he),U=t.centerPoint.add(s.offsetAsPoint)),s.around)t.setLocationAtPoint(s.around,s.aroundPoint);else{const me=u.aI(t.zoom-f),ge=Q>f?Math.min(2,ce):Math.max(.5,ce),ye=Math.pow(ge,1-he),Me=gu(t.worldSize,se.add(ae.mult(he*ye)).mult(me));t.setLocationAtPoint(t.renderWorldCopies?Me.wrap():Me,U)}},isZooming:z,elevationCenter:Y}}handleFlyTo(t,s){const f=s.zoom!==void 0,m=t.zoom,b=t.getConstrained(u.Q.convert(s.center||s.locationAtOffset),f?+s.zoom:m),E=b.center,I=b.zoom;Ih(t,E);const D=kr(t.worldSize,s.locationAtOffset),z=kr(t.worldSize,E).sub(D),F=z.mag(),U=u.aI(I-m);let N;if(s.minZoom!==void 0){const Y=Math.min(+s.minZoom,m,I),Q=t.getConstrained(E,Y).zoom;N=u.aI(Q-m)}return{easeFunc:(Y,Q,se,ae)=>{t.setZoom(Y===1?I:m+u.ab(Q));const ce=Y===1?E:gu(t.worldSize,D.add(z.mult(se)).mult(Q));t.setLocationAtPoint(t.renderWorldCopies?ce.wrap():ce,ae)},scaleOfZoom:U,targetCenter:E,scaleOfMinZoom:N,pixelPathLength:F}}}class sn{constructor(t,s,f){this.blendFunction=t,this.blendColor=s,this.mask=f}}sn.Replace=[1,0],sn.disabled=new sn(sn.Replace,u.b7.transparent,[!1,!1,!1,!1]),sn.unblended=new sn(sn.Replace,u.b7.transparent,[!0,!0,!0,!0]),sn.alphaBlended=new sn([1,771],u.b7.transparent,[!0,!0,!0,!0]);const ga=2305;class Ei{constructor(t,s,f){this.enable=t,this.mode=s,this.frontFace=f}}Ei.disabled=new Ei(!1,1029,ga),Ei.backCCW=new Ei(!0,1029,ga),Ei.frontCCW=new Ei(!0,1028,ga);class gi{constructor(t,s,f){this.func=t,this.mask=s,this.range=f}}gi.ReadOnly=!1,gi.ReadWrite=!0,gi.disabled=new gi(519,gi.ReadOnly,[0,1]);const co=7680;class Oi{constructor(t,s,f,m,b,E){this.test=t,this.ref=s,this.mask=f,this.fail=m,this.depthFail=b,this.pass=E}}Oi.disabled=new Oi({func:519,mask:0},0,0,co,co,co);const uo=new WeakMap;function _a(y){var t;if(uo.has(y))return uo.get(y);{const s=(t=y.getParameter(y.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return uo.set(y,s),s}}class xc{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const s=t.context,f=s.gl;this._texFormat=f.RGBA,this._texType=f.UNSIGNED_BYTE;const m=new u.aF;m.emplaceBack(-1,-1),m.emplaceBack(2,-1),m.emplaceBack(-1,2);const b=new u.aH;b.emplaceBack(0,1,2),this._fullscreenTriangle=new Oo(s.createVertexBuffer(m,Ds.members),s.createIndexBuffer(b),u.aG.simpleSegment(0,0,m.length,b.length)),this._resultBuffer=new Uint8Array(4),s.activeTexture.set(f.TEXTURE1);const E=f.createTexture();f.bindTexture(f.TEXTURE_2D,E),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST),f.texImage2D(f.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=s.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(E),_a(f)&&(this._pbo=f.createBuffer(),f.bindBuffer(f.PIXEL_PACK_BUFFER,this._pbo),f.bufferData(f.PIXEL_PACK_BUFFER,4,f.STREAM_READ),f.bindBuffer(f.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,s){const f=this._updateCount;return this._readbackQueue?f>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():f>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,s),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,s=t.gl;t.activeTexture.set(s.TEXTURE1),s.bindTexture(s.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,s){const f=this._cachedRenderContext.context,m=f.gl;if(this._bindFramebuffer(),f.viewport.set([0,0,this._texWidth,this._texHeight]),f.clear({color:u.b7.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(f,m.TRIANGLES,gi.disabled,Oi.disabled,sn.unblended,Ei.disabled,((b,E)=>({u_input:b,u_output_expected:E}))(t,s),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&_a(m)){m.bindBuffer(m.PIXEL_PACK_BUFFER,this._pbo),m.readBuffer(m.COLOR_ATTACHMENT0),m.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),m.bindBuffer(m.PIXEL_PACK_BUFFER,null);const b=m.fenceSync(m.SYNC_GPU_COMMANDS_COMPLETE,0);m.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:b}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&_a(t)){const s=t.clientWaitSync(this._readbackQueue.sync,0,0);if(s===t.WAIT_FAILED)return u.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(s===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=xc._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let s=0;return s+=t[0]/256,s+=t[1]/65536,s+=t[2]/16777216,t[3]<127&&(s=-s),s/128}}const Dr=u.Z/128;function Rs(y,t){const s=y.granularity!==void 0?Math.max(y.granularity,1):1,f=s+(y.generateBorders?2:0),m=s+(y.extendToNorthPole||y.generateBorders?1:0)+(y.extendToSouthPole||y.generateBorders?1:0),b=f+1,E=m+1,I=y.generateBorders?-1:0,D=y.generateBorders||y.extendToNorthPole?-1:0,z=s+(y.generateBorders?1:0),F=s+(y.generateBorders||y.extendToSouthPole?1:0),U=b*E,N=f*m*6,Y=b*E>65536;if(Y&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const Q=Y||t==="32bit",se=new Int16Array(2*U);let ae=0;for(let me=D;me<=F;me++)for(let ge=I;ge<=z;ge++){let ye=ge/s*u.Z;ge===-1&&(ye=-64),ge===s+1&&(ye=u.Z+Dr);let Me=me/s*u.Z;me===-1&&(Me=y.extendToNorthPole?u.b9:-64),me===s+1&&(Me=y.extendToSouthPole?u.ba:u.Z+Dr),se[ae++]=ye,se[ae++]=Me}const ce=Q?new Uint32Array(N):new Uint16Array(N);let he=0;for(let me=0;me<m;me++)for(let ge=0;ge<f;ge++){const ye=ge+1+me*b,Me=ge+(me+1)*b,Se=ge+1+(me+1)*b;ce[he++]=ge+me*b,ce[he++]=Me,ce[he++]=ye,ce[he++]=ye,ce[he++]=Me,ce[he++]=Se}return{vertices:se.buffer.slice(0),indices:ce.buffer.slice(0),uses32bitIndices:Q}}const Lo=new u.aE({fill:new u.bb(128,2),line:new u.bb(512,0),tile:new u.bb(128,32),stencil:new u.bb(128,1),circle:3});class ho{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Qn.projectionGlobe}get vertexShaderPreludeCode(){return Qn.projectionMercator.vertexSource}get subdivisionGranularity(){return Lo}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new xc(t));const s=u.S(this._errorQueryLatitudeDegrees),f=2*Math.atan(Math.exp(Math.PI-s*Math.PI*2))-.5*Math.PI,m=this._errorMeasurement.updateErrorLoop(s,f),b=ne.now();m!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=m,this._errorMeasurementLastChangeTime=b);const E=Math.min(Math.max((b-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=u.bc(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,u.bd(E))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,s,f,m,b){const E=(b==="stencil"?Lo.stencil:Lo.tile).getGranularityForZoomLevel(s.z);return this._getMesh(t,{granularity:E,generateBorders:f,extendToNorthPole:s.y===0&&m,extendToSouthPole:s.y===(1<<s.z)-1&&m})}_getMesh(t,s){const f=this._getMeshKey(s);if(f in this._tileMeshCache)return this._tileMeshCache[f];const m=function(b,E){const I=Rs(E,"16bit"),D=u.aF.deserialize({arrayBuffer:I.vertices,length:I.vertices.byteLength/2/2}),z=u.aH.deserialize({arrayBuffer:I.indices,length:I.indices.byteLength/2/3});return new Oo(b.createVertexBuffer(D,Ds.members),b.createIndexBuffer(z),u.aG.simpleSegment(0,0,D.length,z.length))}(t,s);return this._tileMeshCache[f]=m,m}recalculate(t){}hasTransition(){const t=ne.now();let s=!1;return s=s||(t-this._errorMeasurementLastChangeTime)/1e3<.7,s=s||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,s}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const Ch=new u.r({type:new u.D(u.v.projection.type)});class Fo extends u.E{constructor(t){super(),this._transitionable=new u.T(Ch),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new u.C(0)),this._mercatorProjection=new Bi,this._verticalPerspectiveProjection=new ho}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof u.be){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,s,f,m,b){return this.currentProjection.getMeshFromTileID(t,s,f,m,b)}setProjection(t){this._transitionable.setValue("type",(t==null?void 0:t.type)||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function Dh(y){const t=_u(y.worldSize,y.center.lat);return 2*Math.PI*t}function ss(y,t,s,f,m){const b=1/(1<<m),E=t/u.Z*b+f*b,I=u.bg((y/u.Z*b+s*b)*Math.PI*2+Math.PI,2*Math.PI),D=2*Math.atan(Math.exp(Math.PI-E*Math.PI*2))-.5*Math.PI,z=Math.cos(D),F=new Float64Array(3);return F[0]=Math.sin(I)*z,F[1]=Math.sin(D),F[2]=Math.cos(I)*z,F}function pr(y){return function(t,s){const f=Math.cos(s),m=new Float64Array(3);return m[0]=Math.sin(t)*f,m[1]=Math.sin(s),m[2]=Math.cos(t)*f,m}(y.lng*Math.PI/180,y.lat*Math.PI/180)}function _u(y,t){return y/(2*Math.PI)/Math.cos(t*Math.PI/180)}function qf(y){const t=Math.asin(y[1])/Math.PI*180,s=Math.sqrt(y[0]*y[0]+y[2]*y[2]);if(s>1e-6){const f=y[0]/s,m=Math.acos(y[2]/s),b=(f>0?m:-m)/Math.PI*180;return new u.Q(u.aL(b,-180,180),t)}return new u.Q(0,t)}function Xr(y){return Math.cos(y*Math.PI/180)}function mr(y,t){const s=Xr(y),f=Xr(t);return u.ab(f/s)}function Ca(y,t){const s=y.rotate(t.bearingInRadians),f=t.zoom+mr(t.center.lat,0),m=u.bc(1/Xr(t.center.lat),1/Xr(Math.min(Math.abs(t.center.lat),60)),u.bf(f,7,3,0,1)),b=360/Dh({worldSize:t.worldSize,center:{lat:t.center.lat}});return new u.Q(t.center.lng-s.x*b*m,u.ae(t.center.lat+s.y*b,-85.051129,u.aJ))}function wc(y){const t=.5*y,s=Math.sin(t),f=Math.cos(t);return Math.log(s+f)-Math.log(f-s)}function Nd(y,t,s,f){const m=y.lat+s*f;if(Math.abs(s)>1){const b=(Math.sign(y.lat+s)!==Math.sign(y.lat)?-Math.abs(y.lat):Math.abs(y.lat))*Math.PI/180,E=Math.abs(y.lat+s)*Math.PI/180,I=wc(b+f*(E-b)),D=wc(b),z=wc(E);return new u.Q(y.lng+t*((I-D)/(z-D)),m)}return new u.Q(y.lng+t*f,m)}class $f{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=t}recalculateCache(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(t,s,f,m){const b=`${t.z}_${t.x}_${t.y}`,E=this._cache.get(b);if(E)return E;const I=this._cachePrevious.get(b);if(I)return this._cache.set(b,I),I;const D=this._aabbFactory(t,s,f,m);return this._cache.set(b,D),this._hadAnyChanges=!0,D}}function fo(y,t,s){const f=y-t;return f<0?-f:Math.max(0,f-s)}function Ud(y,t,s,f,m){const b=y-s;let E;return E=b<0?Math.min(-b,1+b-m):b>1?Math.min(Math.max(b-m,0),1-b):0,Math.max(E,fo(t,f,m))}class Hf{constructor(){this._aabbCache=new $f(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(t,s,f,m){const b=1<<f.z,E=1/b,I=f.x/b,D=f.y/b;let z=2;return z=Math.min(z,Ud(t,s,I,D,E)),z=Math.min(z,Ud(t,s,I+.5,-D-E,E)),z=Math.min(z,Ud(t,s,I+.5,2-D-E,E)),z}getWrap(t,s,f){const m=1<<s.z,b=1/m,E=s.x/m,I=fo(t.x,E,b),D=fo(t.x,E-1,b),z=fo(t.x,E+1,b),F=Math.min(I,D,z);return F===z?1:F===D?-1:0}allowVariableZoom(t,s){return Ua(t,s)>4}allowWorldCopies(){return!1}getTileAABB(t,s,f,m){return this._aabbCache.getTileAABB(t,s,f,m)}_computeTileAABB(t,s,f,m){if(t.z<=0)return new lr([-1,-1,-1],[1,1,1]);if(t.z===1)return new lr([t.x===0?-1:0,t.y===0?0:-1,-1],[t.x===0?0:1,t.y===0?1:0,1]);{const b=[ss(0,0,t.x,t.y,t.z),ss(u.Z,0,t.x,t.y,t.z),ss(u.Z,u.Z,t.x,t.y,t.z),ss(0,u.Z,t.x,t.y,t.z)],E=[1,1,1],I=[-1,-1,-1];for(const D of b)for(let z=0;z<3;z++)E[z]=Math.min(E[z],D[z]),I[z]=Math.max(I[z],D[z]);if(t.y===0||t.y===(1<<t.z)-1){const D=[0,t.y===0?1:-1,0];for(let z=0;z<3;z++)E[z]=Math.min(E[z],D[z]),I[z]=Math.max(I[z],D[z])}return new lr(E,I)}}}class Rh{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,s,f){return this._helper.interpolatePadding(t,s,f)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,s){this._helper.resize(t,s)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,s){this._helper.overrideNearFarZ(t,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(){this._cachedClippingPlane=u.bh(),this._projectionMatrix=u.b1(),this._globeViewProjMatrix32f=u.b0(),this._globeViewProjMatrixNoCorrection=u.b1(),this._globeViewProjMatrixNoCorrectionInverted=u.b1(),this._globeProjMatrixInverted=u.b1(),this._cameraPosition=u.bi(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Yr({calcMatrices:()=>{this._calcMatrices()},getConstrained:(t,s)=>this.getConstrained(t,s)}),this._coveringTilesDetailsProvider=new Hf}clone(){const t=new Rh;return t.apply(this),t}apply(t,s){this._globeLatitudeErrorCorrectionRadians=s||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=u.bi();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:s,applyGlobeMatrix:f}=t,m=this._helper.getMercatorTileCoordinates(s);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:m,clippingPlane:this._cachedClippingPlane,projectionTransition:f?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const s=this.pitchInRadians,f=this.cameraToCenterDistance/t,m=Math.sin(s)*f,b=Math.cos(s)*f+1,E=1/Math.sqrt(m*m+b*b)*1;let I=-m,D=b;const z=Math.sqrt(I*I+D*D);I/=z,D/=z;const F=[0,I,D];return u.bj(F,F,[0,0,0],-this.bearingInRadians),u.bk(F,F,[0,0,0],-1*this.center.lat*Math.PI/180),u.bl(F,F,[0,0,0],this.center.lng*Math.PI/180),u.aO(F,F,.25),[...F,.25*-E]}isLocationOccluded(t){return!this.isSurfacePointVisible(pr(t))}transformLightDirection(t){const s=this._helper._center.lng*Math.PI/180,f=this._helper._center.lat*Math.PI/180,m=Math.cos(f),b=[Math.sin(s)*m,Math.sin(f),Math.cos(s)*m],E=[b[2],0,-b[0]],I=[0,0,0];u.aU(I,E,b),u.aT(E,E),u.aT(I,I);const D=[0,0,0];return u.aT(D,[E[0]*t[0]+I[0]*t[1]+b[0]*t[2],E[1]*t[0]+I[1]*t[1]+b[1]*t[2],E[2]*t[0]+I[2]*t[1]+b[2]*t[2]]),D}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,s,f){const m=function(I,D,z){const F=1/(1<<z.z);return new u.$(I/u.Z*F+z.x*F,D/u.Z*F+z.y*F)}(t,s,f.canonical),b=(E=m.y,[u.bg(m.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-E*Math.PI*2))-.5*Math.PI]);var E;return this.getCircleRadiusCorrection()/Math.cos(b[1])}projectTileCoordinates(t,s,f,m){const b=f.canonical,E=ss(t,s,b.x,b.y,b.z),I=1+(m?m(t,s):0)/u.br,D=[E[0]*I,E[1]*I,E[2]*I,1];u.ap(D,D,this._globeViewProjMatrixNoCorrection);const z=this._cachedClippingPlane,F=z[0]*E[0]+z[1]*E[1]+z[2]*E[2]+z[3]<0;return{point:new u.P(D[0]/D[3],D[1]/D[3]),signedDistanceFromCamera:D[3],isOccluded:F}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=_u(this.worldSize,this.center.lat),s=u.b2(),f=u.b2();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),u.aY(s,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const m=this.centerOffset;s[8]=2*-m.x/this._helper._width,s[9]=2*m.y/this._helper._height,this._projectionMatrix=u.aZ(s),this._globeProjMatrixInverted=u.b2(),u.aj(this._globeProjMatrixInverted,s),u.L(s,s,[0,0,-this.cameraToCenterDistance]),u.a_(s,s,this.rollInRadians),u.a$(s,s,-this.pitchInRadians),u.a_(s,s,this.bearingInRadians),u.L(s,s,[0,0,-t]);const b=u.bi();b[0]=t,b[1]=t,b[2]=t,u.a$(f,s,this.center.lat*Math.PI/180),u.bm(f,f,-this.center.lng*Math.PI/180),u.M(f,f,b),this._globeViewProjMatrixNoCorrection=f,u.a$(s,s,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),u.bm(s,s,-this.center.lng*Math.PI/180),u.M(s,s,b),this._globeViewProjMatrix32f=new Float32Array(s),this._globeViewProjMatrixNoCorrectionInverted=u.b2(),u.aj(this._globeViewProjMatrixNoCorrectionInverted,f);const E=u.bi();this._cameraPosition=u.bi(),this._cameraPosition[2]=this.cameraToCenterDistance/t,u.bj(this._cameraPosition,this._cameraPosition,E,-this.rollInRadians),u.bk(this._cameraPosition,this._cameraPosition,E,this.pitchInRadians),u.bj(this._cameraPosition,this._cameraPosition,E,-this.bearingInRadians),u.aP(this._cameraPosition,this._cameraPosition,[0,0,1]),u.bk(this._cameraPosition,this._cameraPosition,E,-this.center.lat*Math.PI/180),u.bl(this._cameraPosition,this._cameraPosition,E,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const I=u.aZ(this._globeViewProjMatrixNoCorrectionInverted);u.M(I,I,[1,1,-1]),this._cachedFrustum=Ia.fromInvProjectionMatrix(I)}calculateFogMatrix(t){u.w("calculateFogMatrix is not supported on globe projection.");const s=u.b2();return u.at(s),s}getVisibleUnwrappedCoordinates(t){return[new u.aW(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&u.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,s){if(!this._globeViewProjMatrixNoCorrection)return 1;const f=pr(t);u.aO(f,f,1+s/u.br);const m=u.bh();return u.ap(m,[f[0],f[1],f[2],1],this._globeViewProjMatrixNoCorrection),m[2]/m[3]}populateCache(t){}getBounds(){const t=.5*this.width,s=.5*this.height,f=[new u.P(0,0),new u.P(t,0),new u.P(this.width,0),new u.P(this.width,s),new u.P(this.width,this.height),new u.P(t,this.height),new u.P(0,this.height),new u.P(0,s)],m=[];for(const U of f)m.push(this.unprojectScreenPoint(U));let b=0,E=0,I=0,D=0;const z=this.center;for(const U of m){const N=u.bn(z.lng,U.lng),Y=u.bn(z.lat,U.lat);N<E&&(E=N),N>b&&(b=N),Y<D&&(D=Y),Y>I&&(I=Y)}const F=[z.lng+E,z.lat+D,z.lng+b,z.lat+I];return this.isSurfacePointOnScreen([0,1,0])&&(F[3]=90,F[0]=-180,F[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(F[1]=-90,F[0]=-180,F[2]=180),new Nn(F)}getConstrained(t,s){const f=u.ae(t.lat,-85.051129,u.aJ),m=u.ae(+s,this.minZoom+mr(0,f),this.maxZoom);return{center:new u.Q(t.lng,f),zoom:m}}calculateCenterFromCameraLngLatAlt(t,s,f,m){return this._helper.calculateCenterFromCameraLngLatAlt(t,s,f,m)}setLocationAtPoint(t,s){const f=pr(this.unprojectScreenPoint(s)),m=pr(t),b=u.bi();u.bo(b);const E=u.bi();u.bl(E,f,b,-this.center.lng*Math.PI/180),u.bk(E,E,b,this.center.lat*Math.PI/180);const I=m[0]*m[0]+m[2]*m[2],D=E[0]*E[0];if(I<D)return;const z=Math.sqrt(I-D),F=-z,U=u.bp(m[0],m[2],E[0],z),N=u.bp(m[0],m[2],E[0],F),Y=u.bi();u.bl(Y,m,b,-U);const Q=u.bp(Y[1],Y[2],E[1],E[2]),se=u.bi();u.bl(se,m,b,-N);const ae=u.bp(se[1],se[2],E[1],E[2]),ce=.5*Math.PI,he=Q>=-ce&&Q<=ce,me=ae>=-ce&&ae<=ce;let ge,ye;if(he&&me){const Oe=this.center.lng*Math.PI/180,Xe=this.center.lat*Math.PI/180;u.bs(U,Oe)+u.bs(Q,Xe)<u.bs(N,Oe)+u.bs(ae,Xe)?(ge=U,ye=Q):(ge=N,ye=ae)}else if(he)ge=U,ye=Q;else{if(!me)return;ge=N,ye=ae}const Me=ge/Math.PI*180,Se=ye/Math.PI*180,Le=this.center.lat;this.setCenter(new u.Q(Me,u.ae(Se,-90,90))),this.setZoom(this.zoom+mr(Le,this.center.lat))}locationToScreenPoint(t,s){const f=pr(t);if(s){const m=s.getElevationForLngLatZoom(t,this._helper._tileZoom);u.aO(f,f,1+m/u.br)}return this._projectSurfacePointToScreen(f)}_projectSurfacePointToScreen(t){const s=u.bh();return u.ap(s,[...t,1],this._globeViewProjMatrixNoCorrection),s[0]/=s[3],s[1]/=s[3],new u.P((.5*s[0]+.5)*this.width,(.5*-s[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,s){if(s){const f=s.pointCoordinate(t);if(f)return f}return u.$.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,s){var f;return(f=this.screenPointToMercatorCoordinate(t,s))===null||f===void 0?void 0:f.toLngLat()}isPointOnMapSurface(t,s){const f=this._cameraPosition,m=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(f,m)}getRayDirectionFromPixel(t){const s=u.bh();s[0]=t.x/this.width*2-1,s[1]=-1*(t.y/this.height*2-1),s[2]=1,s[3]=1,u.ap(s,s,this._globeViewProjMatrixNoCorrectionInverted),s[0]/=s[3],s[1]/=s[3],s[2]/=s[3];const f=u.bi();f[0]=s[0]-this._cameraPosition[0],f[1]=s[1]-this._cameraPosition[1],f[2]=s[2]-this._cameraPosition[2];const m=u.bi();return u.aT(m,f),m}isSurfacePointVisible(t){const s=this._cachedClippingPlane;return s[0]*t[0]+s[1]*t[1]+s[2]*t[2]+s[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const s=u.bh();return u.ap(s,[...t,1],this._globeViewProjMatrixNoCorrection),s[0]/=s[3],s[1]/=s[3],s[2]/=s[3],s[0]>-1&&s[0]<1&&s[1]>-1&&s[1]<1&&s[2]>-1&&s[2]<1}rayPlanetIntersection(t,s){const f=u.aV(t,s),m=u.bi(),b=u.bi();u.aO(b,s,f),u.aS(m,t,b);const E=1-u.aV(m,m);if(E<0)return null;const I=u.aV(t,t)-1,D=-f+(f<0?1:-1)*Math.sqrt(E),z=I/D,F=D;return{tMin:Math.min(z,F),tMax:Math.max(z,F)}}unprojectScreenPoint(t){const s=this._cameraPosition,f=this.getRayDirectionFromPixel(t),m=this.rayPlanetIntersection(s,f);if(m){const z=u.bi();u.aP(z,s,[f[0]*m.tMin,f[1]*m.tMin,f[2]*m.tMin]);const F=u.bi();return u.aT(F,z),qf(F)}const b=this._cachedClippingPlane[0]*f[0]+this._cachedClippingPlane[1]*f[1]+this._cachedClippingPlane[2]*f[2],E=-u.bq(this._cachedClippingPlane,s)/b,I=u.bi();if(E>0)u.aP(I,s,[f[0]*E,f[1]*E,f[2]*E]);else{const z=u.bi();u.aP(z,s,[2*f[0],2*f[1],2*f[2]]);const F=u.bq(this._cachedClippingPlane,z);u.aS(I,z,[this._cachedClippingPlane[0]*F,this._cachedClippingPlane[1]*F,this._cachedClippingPlane[2]*F])}const D=u.bi();return u.aT(D,I),qf(D)}getMatrixForModel(t,s){const f=u.Q.convert(t),m=1/u.br,b=u.b1();return u.bm(b,b,f.lng/180*Math.PI),u.a$(b,b,-f.lat/180*Math.PI),u.L(b,b,[0,0,1+s/u.br]),u.a$(b,b,.5*Math.PI),u.M(b,b,[m,m,m]),b}getProjectionDataForCustomLayer(t=!0){const s=this.getProjectionData({overscaledTileID:new u.Y(0,0,0,0,0),applyGlobeMatrix:t});return s.tileMercatorCoords=[0,0,1,1],s}getFastPathSimpleProjectionMatrix(t){}}class Ph{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,s,f){return this._helper.interpolatePadding(t,s,f)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,s,f=!0){this._helper.resize(t,s,f)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}overrideNearFarZ(t,s){this._helper.overrideNearFarZ(t,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,s){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=s,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Yr({calcMatrices:()=>{this._calcMatrices()},getConstrained:(t,s)=>this.getConstrained(t,s)}),this._globeness=1,this._mercatorTransform=new vn,this._verticalPerspectiveTransform=new Rh}clone(){const t=new Ph;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const s=this._mercatorTransform.getProjectionData(t),f=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?f.mainMatrix:s.mainMatrix,clippingPlane:f.clippingPlane,tileMercatorCoords:f.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:s.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return u.bc(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return u.bc(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,s,f){const m=this._mercatorTransform.getPitchedTextCorrection(t,s,f),b=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,s,f);return u.bc(m,b,this._globeness)}projectTileCoordinates(t,s,f,m){return this.currentTransform.projectTileCoordinates(t,s,f,m)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,s){return this.currentTransform.lngLatToCameraDepth(t,s)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}getConstrained(t,s){return this.currentTransform.getConstrained(t,s)}calculateCenterFromCameraLngLatAlt(t,s,f,m){return this._helper.calculateCenterFromCameraLngLatAlt(t,s,f,m)}setLocationAtPoint(t,s){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,s),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,s),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,s){return this.currentTransform.locationToScreenPoint(t,s)}screenPointToMercatorCoordinate(t,s){return this.currentTransform.screenPointToMercatorCoordinate(t,s)}screenPointToLocation(t,s){return this.currentTransform.screenPointToLocation(t,s)}isPointOnMapSurface(t,s){return this.currentTransform.isPointOnMapSurface(t,s)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,s){return this.currentTransform.getMatrixForModel(t,s)}getProjectionDataForCustomLayer(t=!0){const s=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return s;const f=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return f.fallbackMatrix=s.mainMatrix,f}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class os{get useGlobeControls(){return!0}handlePanInertia(t,s){const f=Ca(t,s);return Math.abs(f.lng-s.center.lng)>180&&(f.lng=s.center.lng+179.5*Math.sign(f.lng-s.center.lng)),{easingCenter:f,easingOffset:new u.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,s){const f=t.around,m=s.screenPointToLocation(f);t.bearingDelta&&s.setBearing(s.bearing+t.bearingDelta),t.pitchDelta&&s.setPitch(s.pitch+t.pitchDelta),t.rollDelta&&s.setRoll(s.roll+t.rollDelta);const b=s.zoom;t.zoomDelta&&s.setZoom(s.zoom+t.zoomDelta);const E=s.zoom-b;if(E===0)return;const I=u.bn(s.center.lng,m.lng),D=I/(Math.abs(I/180)+1),z=u.bn(s.center.lat,m.lat),F=s.getRayDirectionFromPixel(f),U=s.cameraPosition,N=-1*u.aV(U,F),Y=u.bi();u.aP(Y,U,[F[0]*N,F[1]*N,F[2]*N]);const Q=u.bt(Y)-1,se=Math.exp(.5*-Math.max(Q-.3,0)),ae=_u(s.worldSize,s.center.lat)/Math.min(s.width,s.height),ce=u.bf(ae,.9,.5,1,.25),he=(1-u.aI(-E))*Math.min(se,ce),me=s.center.lat,ge=s.zoom,ye=new u.Q(s.center.lng+D*he,u.ae(s.center.lat+z*he,-85.051129,u.aJ));s.setLocationAtPoint(m,f);const Me=s.center,Se=u.bf(Math.abs(I),45,85,0,1),Le=u.bf(ae,.75,.35,0,1),Oe=Math.pow(Math.max(Se,Le),.25),Xe=u.bn(Me.lng,ye.lng),We=u.bn(Me.lat,ye.lat);s.setCenter(new u.Q(Me.lng+Xe*Oe,Me.lat+We*Oe).wrap()),s.setZoom(ge+mr(me,s.center.lat))}handleMapControlsPan(t,s,f){if(!t.panDelta)return;const m=s.center.lat,b=s.zoom;s.setCenter(Ca(t.panDelta,s).wrap()),s.setZoom(b+mr(m,s.center.lat))}cameraForBoxAndBearing(t,s,f,m,b){const E=lo(t,s,f,m,b),I=s.left/b.width*2-1,D=(b.width-s.right)/b.width*2-1,z=s.top/b.height*-2+1,F=(b.height-s.bottom)/b.height*-2+1,U=u.bn(f.getWest(),f.getEast())<0,N=U?f.getEast():f.getWest(),Y=U?f.getWest():f.getEast(),Q=Math.max(f.getNorth(),f.getSouth()),se=Math.min(f.getNorth(),f.getSouth()),ae=N+.5*u.bn(N,Y),ce=Q+.5*u.bn(Q,se),he=b.clone();he.setCenter(E.center),he.setBearing(E.bearing),he.setPitch(0),he.setRoll(0),he.setZoom(E.zoom);const me=he.modelViewProjectionMatrix,ge=[pr(f.getNorthWest()),pr(f.getNorthEast()),pr(f.getSouthWest()),pr(f.getSouthEast()),pr(new u.Q(Y,ce)),pr(new u.Q(N,ce)),pr(new u.Q(ae,Q)),pr(new u.Q(ae,se))],ye=pr(E.center);let Me=Number.POSITIVE_INFINITY;for(const Se of ge)I<0&&(Me=os.getLesserNonNegativeNonNull(Me,os.solveVectorScale(Se,ye,me,"x",I))),D>0&&(Me=os.getLesserNonNegativeNonNull(Me,os.solveVectorScale(Se,ye,me,"x",D))),z>0&&(Me=os.getLesserNonNegativeNonNull(Me,os.solveVectorScale(Se,ye,me,"y",z))),F<0&&(Me=os.getLesserNonNegativeNonNull(Me,os.solveVectorScale(Se,ye,me,"y",F)));if(Number.isFinite(Me)&&Me!==0)return E.zoom=he.zoom+u.ab(Me),E;Bo()}handleJumpToCenterZoom(t,s){const f=t.center.lat,m=t.getConstrained(s.center?u.Q.convert(s.center):t.center,t.zoom).center;t.setCenter(m.wrap());const b=s.zoom!==void 0?+s.zoom:t.zoom+mr(f,m.lat);t.zoom!==b&&t.setZoom(b)}handleEaseTo(t,s){const f=t.zoom,m=t.center,b=t.padding,E={roll:t.roll,pitch:t.pitch,bearing:t.bearing},I={roll:s.roll===void 0?t.roll:s.roll,pitch:s.pitch===void 0?t.pitch:s.pitch,bearing:s.bearing===void 0?t.bearing:s.bearing},D=s.zoom!==void 0,z=!t.isPaddingEqual(s.padding);let F=!1;const U=s.center?u.Q.convert(s.center):m,N=t.getConstrained(U,f).center;Ih(t,N);const Y=t.clone();Y.setCenter(N),Y.setZoom(D?+s.zoom:f+mr(m.lat,U.lat)),Y.setBearing(s.bearing);const Q=new u.P(u.ae(t.centerPoint.x+s.offsetAsPoint.x,0,t.width),u.ae(t.centerPoint.y+s.offsetAsPoint.y,0,t.height));Y.setLocationAtPoint(N,Q);const se=(s.offset&&s.offsetAsPoint.mag())>0?Y.center:N,ae=D?+s.zoom:f+mr(m.lat,se.lat),ce=f+mr(m.lat,0),he=ae+mr(se.lat,0),me=u.bn(m.lng,se.lng),ge=u.bn(m.lat,se.lat),ye=u.aI(he-ce);return F=ae!==f,{easeFunc:Me=>{if(u.b6(E,I)||oo({startEulerAngles:E,endEulerAngles:I,tr:t,k:Me,useSlerp:E.roll!=I.roll}),z&&t.interpolatePadding(b,s.padding,Me),s.around)u.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(s.around,s.aroundPoint);else{const Se=he>ce?Math.min(2,ye):Math.max(.5,ye),Le=Math.pow(Se,1-Me),Oe=Nd(m,me,ge,Me*Le);t.setCenter(Oe.wrap())}if(F){const Se=u.B.number(ce,he,Me)+mr(0,t.center.lat);t.setZoom(Se)}},isZooming:F,elevationCenter:se}}handleFlyTo(t,s){const f=s.zoom!==void 0,m=t.center,b=t.zoom,E=t.padding,I=!t.isPaddingEqual(s.padding),D=t.getConstrained(u.Q.convert(s.center||s.locationAtOffset),b).center,z=f?+s.zoom:t.zoom+mr(t.center.lat,D.lat),F=t.clone();F.setCenter(D),F.setZoom(z),F.setBearing(s.bearing);const U=new u.P(u.ae(t.centerPoint.x+s.offsetAsPoint.x,0,t.width),u.ae(t.centerPoint.y+s.offsetAsPoint.y,0,t.height));F.setLocationAtPoint(D,U);const N=F.center;Ih(t,N);const Y=function(ge,ye,Me){const Se=pr(ye),Le=pr(Me),Oe=u.aV(Se,Le),Xe=Math.acos(Oe),We=Dh(ge);return Xe/(2*Math.PI)*We}(t,m,N),Q=b+mr(m.lat,0),se=z+mr(N.lat,0),ae=u.aI(se-Q);let ce;if(typeof s.minZoom=="number"){const ge=+s.minZoom+mr(N.lat,0),ye=Math.min(ge,Q,se)+mr(0,N.lat),Me=t.getConstrained(N,ye).zoom+mr(N.lat,0);ce=u.aI(Me-Q)}const he=u.bn(m.lng,N.lng),me=u.bn(m.lat,N.lat);return{easeFunc:(ge,ye,Me,Se)=>{const Le=Nd(m,he,me,Me);I&&t.interpolatePadding(E,s.padding,ge);const Oe=ge===1?N:Le;t.setCenter(Oe.wrap());const Xe=Q+u.ab(ye);t.setZoom(ge===1?z:Xe+mr(0,Oe.lat))},scaleOfZoom:ae,targetCenter:N,scaleOfMinZoom:ce,pixelPathLength:Y}}static solveVectorScale(t,s,f,m,b){const E=m==="x"?[f[0],f[4],f[8],f[12]]:[f[1],f[5],f[9],f[13]],I=[f[3],f[7],f[11],f[15]],D=t[0]*E[0]+t[1]*E[1]+t[2]*E[2],z=t[0]*I[0]+t[1]*I[1]+t[2]*I[2],F=s[0]*E[0]+s[1]*E[1]+s[2]*E[2],U=s[0]*I[0]+s[1]*I[1]+s[2]*I[2];return F+b*z===D+b*U||I[3]*(D-F)+E[3]*(U-z)+D*U==F*z?null:(F+E[3]-b*U-b*I[3])/(F-D-b*U+b*z)}static getLesserNonNegativeNonNull(t,s){return s!==null&&s>=0&&s<t?s:t}}class Yf{constructor(t){this._globe=t,this._mercatorCameraHelper=new Jn,this._verticalPerspectiveCameraHelper=new os}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,s){return this.currentHelper.handlePanInertia(t,s)}handleMapControlsRollPitchBearingZoom(t,s){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,s)}handleMapControlsPan(t,s,f){this.currentHelper.handleMapControlsPan(t,s,f)}cameraForBoxAndBearing(t,s,f,m,b){return this.currentHelper.cameraForBoxAndBearing(t,s,f,m,b)}handleJumpToCenterZoom(t,s){this.currentHelper.handleJumpToCenterZoom(t,s)}handleEaseTo(t,s){return this.currentHelper.handleEaseTo(t,s)}handleFlyTo(t,s){return this.currentHelper.handleFlyTo(t,s)}}const po=(y,t)=>u.x(y,t&&t.filter(s=>s.identifier!=="source.canvas")),jd=u.bu();class Sc extends u.E{constructor(t,s={}){super(),this._rtlPluginLoaded=()=>{for(const f in this.sourceCaches){const m=this.sourceCaches[f].getSource().type;m!=="vector"&&m!=="geojson"||this.sourceCaches[f].reload()}},this.map=t,this.dispatcher=new ar(Jt(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",(f,m)=>this.getGlyphs(f,m)),this.dispatcher.registerMessageHandler("GI",(f,m)=>this.getImages(f,m)),this.imageManager=new Ri,this.imageManager.setEventedParent(this),this.glyphManager=new Fe(t._requestManager,s.localIdeographFontFamily),this.lineAtlas=new xe(256,512),this.crossTileSymbolIndex=new Al,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new u.bv,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",u.bw()),$r().on(xl,this._rtlPluginLoaded),this.on("data",f=>{if(f.dataType!=="source"||f.sourceDataType!=="metadata")return;const m=this.sourceCaches[f.sourceId];if(!m)return;const b=m.getSource();if(b&&b.vectorLayerIds)for(const E in this._layers){const I=this._layers[E];I.source===b.id&&this._validateLayer(I)}})}loadURL(t,s={},f){this.fire(new u.l("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const m=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const b=this._loadStyleRequest;u.j(m,this._loadStyleRequest).then(E=>{this._loadStyleRequest=null,this._load(E.data,s,f)}).catch(E=>{this._loadStyleRequest=null,E&&!b.signal.aborted&&this.fire(new u.k(E))})}loadJSON(t,s={},f){this.fire(new u.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ne.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,s.validate=s.validate!==!1,this._load(t,s,f)}).catch(()=>{})}loadEmpty(){this.fire(new u.l("dataloading",{dataType:"style"})),this._load(jd,{validate:!1})}_load(t,s,f){var m,b;const E=s.transformStyle?s.transformStyle(f,t):t;if(!s.validate||!po(this,u.y(E))){this._loaded=!0,this.stylesheet=E;for(const I in E.sources)this.addSource(I,E.sources[I],{validate:!1});E.sprite?this._loadSprite(E.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(E.glyphs),this._createLayers(),this.light=new st(this.stylesheet.light),this._setProjectionInternal(((m=this.stylesheet.projection)===null||m===void 0?void 0:m.type)||"mercator"),this.sky=new yi(this.stylesheet.sky),this.map.setTerrain((b=this.stylesheet.terrain)!==null&&b!==void 0?b:null),this.fire(new u.l("data",{dataType:"style"})),this.fire(new u.l("style.load"))}}_createLayers(){const t=u.bx(this.stylesheet.layers);this.dispatcher.broadcast("SL",t),this._order=t.map(s=>s.id),this._layers={},this._serializedLayers=null;for(const s of t){const f=u.by(s);f.setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=f}}_loadSprite(t,s=!1,f=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(b,E,I,D){return u._(this,void 0,void 0,function*(){const z=zt(b),F=I>1?"@2x":"",U={},N={};for(const{id:Y,url:Q}of z){const se=E.transformRequest(Pt(Q,F,".json"),"SpriteJSON");U[Y]=u.j(se,D);const ae=E.transformRequest(Pt(Q,F,".png"),"SpriteImage");N[Y]=It.getImage(ae,D)}return yield Promise.all([...Object.values(U),...Object.values(N)]),function(Y,Q){return u._(this,void 0,void 0,function*(){const se={};for(const ae in Y){se[ae]={};const ce=ne.getImageCanvasContext((yield Q[ae]).data),he=(yield Y[ae]).data;for(const me in he){const{width:ge,height:ye,x:Me,y:Se,sdf:Le,pixelRatio:Oe,stretchX:Xe,stretchY:We,content:He,textFitWidth:gt,textFitHeight:mt}=he[me];se[ae][me]={data:null,pixelRatio:Oe,sdf:Le,stretchX:Xe,stretchY:We,content:He,textFitWidth:gt,textFitHeight:mt,spriteData:{width:ge,height:ye,x:Me,y:Se,context:ce}}}}return se})}(U,N)})}(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(b=>{if(this._spriteRequest=null,b)for(const E in b){this._spritesImagesIds[E]=[];const I=this._spritesImagesIds[E]?this._spritesImagesIds[E].filter(D=>!(D in b)):[];for(const D of I)this.imageManager.removeImage(D),this._changedImages[D]=!0;for(const D in b[E]){const z=E==="default"?D:`${E}:${D}`;this._spritesImagesIds[E].push(z),z in this.imageManager.images?this.imageManager.updateImage(z,b[E][D],!1):this.imageManager.addImage(z,b[E][D]),s&&(this._changedImages[z]=!0)}}}).catch(b=>{this._spriteRequest=null,m=b,this.fire(new u.k(m))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.l("data",{dataType:"style"})),f&&f(m)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.l("data",{dataType:"style"}))}_validateLayer(t){const s=this.sourceCaches[t.source];if(!s)return;const f=t.sourceLayer;if(!f)return;const m=s.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(f)===-1)&&this.fire(new u.k(new Error(`Source layer "${f}" does not exist on source "${m.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,s=!1){const f=this._serializedAllLayers();if(!t||t.length===0)return Object.values(s?u.bz(f):f);const m=[];for(const b of t)if(f[b]){const E=s?u.bz(f[b]):f[b];m.push(E)}return m}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const s=Object.keys(this._layers);for(const f of s){const m=this._layers[f];m.type!=="custom"&&(t[f]=m.serialize())}return t}hasTransitions(){var t,s,f;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((s=this.sky)===null||s===void 0)&&s.hasTransition()||!((f=this.projection)===null||f===void 0)&&f.hasTransition())return!0;for(const m in this.sourceCaches)if(this.sourceCaches[m].hasTransition())return!0;for(const m in this._layers)if(this._layers[m].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const s=this._changed;if(s){const m=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(m.length||b.length)&&this._updateWorkerLayers(m,b);for(const E in this._updatedSources){const I=this._updatedSources[E];if(I==="reload")this._reloadSource(E);else{if(I!=="clear")throw new Error(`Invalid action ${I}`);this._clearSource(E)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const f={};for(const m in this.sourceCaches){const b=this.sourceCaches[m];f[m]=b.used,b.used=!1}for(const m of this._order){const b=this._layers[m];b.recalculate(t,this._availableImages),!b.isHidden(t.zoom)&&b.source&&(this.sourceCaches[b.source].used=!0)}for(const m in f){const b=this.sourceCaches[m];!!f[m]!=!!b.used&&b.fire(new u.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,s&&this.fire(new u.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,s){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,s={}){var f;this._checkLoaded();const m=this.serialize();if(t=s.transformStyle?s.transformStyle(m,t):t,((f=s.validate)===null||f===void 0||f)&&po(this,u.y(t)))return!1;(t=u.bz(t)).layers=u.bx(t.layers);const b=u.bA(m,t),E=this._getOperationsToPerform(b);if(E.unimplemented.length>0)throw new Error(`Unimplemented: ${E.unimplemented.join(", ")}.`);if(E.operations.length===0)return!1;for(const I of E.operations)I();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const s=[],f=[];for(const m of t)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":s.push(()=>this.addLayer.apply(this,m.args));break;case"removeLayer":s.push(()=>this.removeLayer.apply(this,m.args));break;case"setPaintProperty":s.push(()=>this.setPaintProperty.apply(this,m.args));break;case"setLayoutProperty":s.push(()=>this.setLayoutProperty.apply(this,m.args));break;case"setFilter":s.push(()=>this.setFilter.apply(this,m.args));break;case"addSource":s.push(()=>this.addSource.apply(this,m.args));break;case"removeSource":s.push(()=>this.removeSource.apply(this,m.args));break;case"setLayerZoomRange":s.push(()=>this.setLayerZoomRange.apply(this,m.args));break;case"setLight":s.push(()=>this.setLight.apply(this,m.args));break;case"setGeoJSONSourceData":s.push(()=>this.setGeoJSONSourceData.apply(this,m.args));break;case"setGlyphs":s.push(()=>this.setGlyphs.apply(this,m.args));break;case"setSprite":s.push(()=>this.setSprite.apply(this,m.args));break;case"setTerrain":s.push(()=>this.map.setTerrain.apply(this,m.args));break;case"setSky":s.push(()=>this.setSky.apply(this,m.args));break;case"setProjection":this.setProjection.apply(this,m.args);break;case"setTransition":s.push(()=>{});break;default:f.push(m.command)}return{operations:s,unimplemented:f}}addImage(t,s){if(this.getImage(t))return this.fire(new u.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,s),this._afterImageUpdated(t)}updateImage(t,s){this.imageManager.updateImage(t,s)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new u.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,s,f={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(u.y.source,`sources.${t}`,s,null,f))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const m=this.sourceCaches[t]=new W(t,s,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:t})),m.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===t)return this.fire(new u.k(new Error(`Source "${t}" cannot be removed while layer "${f}" is using it.`)));const s=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],s.fire(new u.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,s){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const f=this.sourceCaches[t].getSource();if(f.type!=="geojson")throw new Error(`geojsonSource.type is ${f.type}, which is !== 'geojson`);f.setData(s),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,s,f={}){this._checkLoaded();const m=t.id;if(this.getLayer(m))return void this.fire(new u.k(new Error(`Layer "${m}" already exists on this map.`)));let b;if(t.type==="custom"){if(po(this,u.bB(t)))return;b=u.by(t)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(m,t.source),t=u.bz(t),t=u.e(t,{source:m})),this._validate(u.y.layer,`layers.${m}`,t,{arrayIndex:-1},f))return;b=u.by(t),this._validateLayer(b),b.setEventedParent(this,{layer:{id:m}})}const E=s?this._order.indexOf(s):this._order.length;if(s&&E===-1)this.fire(new u.k(new Error(`Cannot add layer "${m}" before non-existing layer "${s}".`)));else{if(this._order.splice(E,0,m),this._layerOrderChanged=!0,this._layers[m]=b,this._removedLayers[m]&&b.source&&b.type!=="custom"){const I=this._removedLayers[m];delete this._removedLayers[m],I.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.sourceCaches[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(t,s){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new u.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===s)return;const f=this._order.indexOf(t);this._order.splice(f,1);const m=s?this._order.indexOf(s):this._order.length;s&&m===-1?this.fire(new u.k(new Error(`Cannot move layer "${t}" before non-existing layer "${s}".`))):(this._order.splice(m,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const s=this._layers[t];if(!s)return void this.fire(new u.k(new Error(`Cannot remove non-existing layer "${t}".`)));s.setEventedParent(null);const f=this._order.indexOf(t);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=s,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],s.onRemove&&s.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,s,f){this._checkLoaded();const m=this.getLayer(t);m?m.minzoom===s&&m.maxzoom===f||(s!=null&&(m.minzoom=s),f!=null&&(m.maxzoom=f),this._updateLayer(m)):this.fire(new u.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,s,f={}){this._checkLoaded();const m=this.getLayer(t);if(m){if(!u.bC(m.filter,s))return s==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(u.y.filter,`layers.${m.id}.filter`,s,null,f)||(m.filter=u.bz(s),this._updateLayer(m)))}else this.fire(new u.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return u.bz(this.getLayer(t).filter)}setLayoutProperty(t,s,f,m={}){this._checkLoaded();const b=this.getLayer(t);b?u.bC(b.getLayoutProperty(s),f)||(b.setLayoutProperty(s,f,m),this._updateLayer(b)):this.fire(new u.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,s){const f=this.getLayer(t);if(f)return f.getLayoutProperty(s);this.fire(new u.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,s,f,m={}){this._checkLoaded();const b=this.getLayer(t);b?u.bC(b.getPaintProperty(s),f)||(b.setPaintProperty(s,f,m)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[t]=!0,this._serializedLayers=null):this.fire(new u.k(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,s){return this.getLayer(t).getPaintProperty(s)}setFeatureState(t,s){this._checkLoaded();const f=t.source,m=t.sourceLayer,b=this.sourceCaches[f];if(b===void 0)return void this.fire(new u.k(new Error(`The source '${f}' does not exist in the map's style.`)));const E=b.getSource().type;E==="geojson"&&m?this.fire(new u.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):E!=="vector"||m?(t.id===void 0&&this.fire(new u.k(new Error("The feature id parameter must be provided."))),b.setFeatureState(m,t.id,s)):this.fire(new u.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,s){this._checkLoaded();const f=t.source,m=this.sourceCaches[f];if(m===void 0)return void this.fire(new u.k(new Error(`The source '${f}' does not exist in the map's style.`)));const b=m.getSource().type,E=b==="vector"?t.sourceLayer:void 0;b!=="vector"||E?s&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new u.k(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(E,t.id,s):this.fire(new u.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const s=t.source,f=t.sourceLayer,m=this.sourceCaches[s];if(m!==void 0)return m.getSource().type!=="vector"||f?(t.id===void 0&&this.fire(new u.k(new Error("The feature id parameter must be provided."))),m.getFeatureState(f,t.id)):void this.fire(new u.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new u.k(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return u.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=u.bD(this.sourceCaches,b=>b.serialize()),s=this._serializeByIds(this._order,!0),f=this.map.getTerrain()||void 0,m=this.stylesheet;return u.bE({version:m.version,name:m.name,metadata:m.metadata,light:m.light,sky:m.sky,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,projection:m.projection,sources:t,layers:s,terrain:f},b=>b!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const s=E=>this._layers[E].type==="fill-extrusion",f={},m=[];for(let E=this._order.length-1;E>=0;E--){const I=this._order[E];if(s(I)){f[I]=E;for(const D of t){const z=D[I];if(z)for(const F of z)m.push(F)}}}m.sort((E,I)=>I.intersectionZ-E.intersectionZ);const b=[];for(let E=this._order.length-1;E>=0;E--){const I=this._order[E];if(s(I))for(let D=m.length-1;D>=0;D--){const z=m[D].feature;if(f[z.layer.id]<E)break;b.push(z),m.pop()}else for(const D of t){const z=D[I];if(z)for(const F of z)b.push(F.feature)}}return b}queryRenderedFeatures(t,s,f){s&&s.filter&&this._validate(u.y.filter,"queryRenderedFeatures.filter",s.filter,null,s);const m={};if(s&&s.layers){if(!(Array.isArray(s.layers)||s.layers instanceof Set))return this.fire(new u.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const z of s.layers){const F=this._layers[z];if(!F)return this.fire(new u.k(new Error(`The layer '${z}' does not exist in the map's style and cannot be queried for features.`))),[];m[F.source]=!0}}const b=[];s.availableImages=this._availableImages;const E=this._serializedAllLayers(),I=s.layers instanceof Set?s.layers:Array.isArray(s.layers)?new Set(s.layers):null,D=Object.assign(Object.assign({},s),{layers:I});for(const z in this.sourceCaches)s.layers&&!m[z]||b.push(Is(this.sourceCaches[z],this._layers,E,t,D,f,this.map.terrain?(F,U,N)=>this.map.terrain.getElevation(F,U,N):void 0));return this.placement&&b.push(function(z,F,U,N,Y,Q,se){const ae={},ce=Q.queryRenderedSymbols(N),he=[];for(const me of Object.keys(ce).map(Number))he.push(se[me]);he.sort(qn);for(const me of he){const ge=me.featureIndex.lookupSymbolFeatures(ce[me.bucketInstanceId],F,me.bucketIndex,me.sourceLayerIndex,Y.filter,Y.layers,Y.availableImages,z);for(const ye in ge){const Me=ae[ye]=ae[ye]||[],Se=ge[ye];Se.sort((Le,Oe)=>{const Xe=me.featureSortOrder;if(Xe){const We=Xe.indexOf(Le.featureIndex);return Xe.indexOf(Oe.featureIndex)-We}return Oe.featureIndex-Le.featureIndex});for(const Le of Se)Me.push(Le)}}return function(me,ge,ye){for(const Me in me)for(const Se of me[Me])sr(Se,ye[ge[Me].source]);return me}(ae,z,U)}(this._layers,E,this.sourceCaches,t,D,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(t,s){s&&s.filter&&this._validate(u.y.filter,"querySourceFeatures.filter",s.filter,null,s);const f=this.sourceCaches[t];return f?function(m,b){const E=m.getRenderableIds().map(z=>m.getTileByID(z)),I=[],D={};for(let z=0;z<E.length;z++){const F=E[z],U=F.tileID.canonical.key;D[U]||(D[U]=!0,F.querySourceFeatures(I,b))}return I}(f,s):[]}getLight(){return this.light.getLight()}setLight(t,s={}){this._checkLoaded();const f=this.light.getLight();let m=!1;for(const E in t)if(!u.bC(t[E],f[E])){m=!0;break}if(!m)return;const b={now:ne.now(),transition:u.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,s),this.light.updateTransitions(b)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,s={}){this._checkLoaded();const f=this.getSky();let m=!1;if(!t&&!f)return;if(t&&!f)m=!0;else if(!t&&f)m=!0;else for(const E in t)if(!u.bC(t[E],f[E])){m=!0;break}if(!m)return;const b={now:ne.now(),transition:u.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,s),this.sky.updateTransitions(b)}_setProjectionInternal(t){const s=function(f){if(Array.isArray(f)){const m=new Fo({type:f});return{projection:m,transform:new Ph,cameraHelper:new Yf(m)}}switch(f){case"mercator":return{projection:new Bi,transform:new vn,cameraHelper:new Jn};case"globe":{const m=new Fo({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:m,transform:new Ph,cameraHelper:new Yf(m)}}case"vertical-perspective":return{projection:new ho,transform:new Rh,cameraHelper:new os};default:return u.w(`Unknown projection name: ${f}. Falling back to mercator projection.`),{projection:new Bi,transform:new vn,cameraHelper:new Jn}}}(t);this.projection=s.projection,this.map.migrateProjection(s.transform,s.cameraHelper);for(const f in this.sourceCaches)this.sourceCaches[f].reload()}_validate(t,s,f,m,b={}){return(!b||b.validate!==!1)&&po(this,t.call(u.y,u.e({key:s,style:this.serialize(),value:f,styleSpec:u.v},m)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),$r().off(xl,this._rtlPluginLoaded);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const f=this.sourceCaches[s];f.setEventedParent(null),f.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const s in this.sourceCaches)this.sourceCaches[s].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,s,f,m,b=!1){let E=!1,I=!1;const D={};for(const z of this._order){const F=this._layers[z];if(F.type!=="symbol")continue;if(!D[F.source]){const N=this.sourceCaches[F.source];D[F.source]=N.getRenderableIds(!0).map(Y=>N.getTileByID(Y)).sort((Y,Q)=>Q.tileID.overscaledZ-Y.tileID.overscaledZ||(Y.tileID.isLessThan(Q.tileID)?-1:1))}const U=this.crossTileSymbolIndex.addLayer(F,D[F.source],t.center.lng);E=E||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||f===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ne.now(),t.zoom))&&(this.pauseablePlacement=new Aa(t,this.map.terrain,this._order,b,s,f,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,D),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ne.now()),I=!0),E&&this.pauseablePlacement.placement.setStale()),I||E)for(const z of this._order){const F=this._layers[z];F.type==="symbol"&&this.placement.updateLayerOpacities(F,D[F.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ne.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,s){return u._(this,void 0,void 0,function*(){const f=yield this.imageManager.getImages(s.icons);this._updateTilesForChangedImages();const m=this.sourceCaches[s.source];return m&&m.setDependencies(s.tileID.key,s.type,s.icons),f})}getGlyphs(t,s){return u._(this,void 0,void 0,function*(){const f=yield this.glyphManager.getGlyphs(s.stacks),m=this.sourceCaches[s.source];return m&&m.setDependencies(s.tileID.key,s.type,[""]),f})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,s={}){this._checkLoaded(),t&&this._validate(u.y.glyphs,"glyphs",t,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,s,f={},m){this._checkLoaded();const b=[{id:t,url:s}],E=[...zt(this.stylesheet.sprite),...b];this._validate(u.y.sprite,"sprite",E,null,f)||(this.stylesheet.sprite=E,this._loadSprite(b,!0,m))}removeSprite(t){this._checkLoaded();const s=zt(this.stylesheet.sprite);if(s.find(f=>f.id===t)){if(this._spritesImagesIds[t])for(const f of this._spritesImagesIds[t])this.imageManager.removeImage(f),this._changedImages[f]=!0;s.splice(s.findIndex(f=>f.id===t),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.l("data",{dataType:"style"}))}else this.fire(new u.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return zt(this.stylesheet.sprite)}setSprite(t,s={},f){this._checkLoaded(),t&&this._validate(u.y.sprite,"sprite",t,null,s)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,f):(this._unloadSprite(),f&&f(null)))}}var Vd=u.aD([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class zh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,s,f,m,b,E,I,D,z){this.context=t;let F=this.boundPaintVertexBuffers.length!==m.length;for(let U=0;!F&&U<m.length;U++)this.boundPaintVertexBuffers[U]!==m[U]&&(F=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==f||F||this.boundIndexBuffer!==b||this.boundVertexOffset!==E||this.boundDynamicVertexBuffer!==I||this.boundDynamicVertexBuffer2!==D||this.boundDynamicVertexBuffer3!==z?this.freshBind(s,f,m,b,E,I,D,z):(t.bindVertexArray.set(this.vao),I&&I.bind(),b&&b.dynamicDraw&&b.bind(),D&&D.bind(),z&&z.bind())}freshBind(t,s,f,m,b,E,I,D){const z=t.numAttributes,F=this.context,U=F.gl;this.vao&&this.destroy(),this.vao=F.createVertexArray(),F.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=m,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=I,this.boundDynamicVertexBuffer3=D,s.enableAttributes(U,t);for(const N of f)N.enableAttributes(U,t);E&&E.enableAttributes(U,t),I&&I.enableAttributes(U,t),D&&D.enableAttributes(U,t),s.bind(),s.setVertexAttribPointers(U,t,b);for(const N of f)N.bind(),N.setVertexAttribPointers(U,t,b);E&&(E.bind(),E.setVertexAttribPointers(U,t,b)),m&&m.bind(),I&&(I.bind(),I.setVertexAttribPointers(U,t,b)),D&&(D.bind(),D.setVertexAttribPointers(U,t,b)),F.currentNumAttributes=z}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Ps=(y,t,s,f,m)=>({u_texture:0,u_ele_delta:y,u_fog_matrix:t,u_fog_color:s?s.properties.get("fog-color"):u.b7.white,u_fog_ground_blend:s?s.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:m?0:s?s.calculateFogBlendOpacity(f):0,u_horizon_color:s?s.properties.get("horizon-color"):u.b7.white,u_horizon_fog_blend:s?s.properties.get("horizon-fog-blend"):1,u_is_globe_mode:m?1:0}),Em={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Tc(y){const t=[];for(let s=0;s<y.length;s++){if(y[s]===null)continue;const f=y[s].split(" ");t.push(f.pop())}return t}class yu{constructor(t,s,f,m,b,E,I,D){const z=t.gl;this.program=z.createProgram();const F=Tc(s.staticAttributes),U=f?f.getBinderAttributes():[],N=F.concat(U),Y=Qn.prelude.staticUniforms?Tc(Qn.prelude.staticUniforms):[],Q=I.staticUniforms?Tc(I.staticUniforms):[],se=s.staticUniforms?Tc(s.staticUniforms):[],ae=f?f.getBinderUniforms():[],ce=Y.concat(Q).concat(se).concat(ae),he=[];for(const Oe of ce)he.indexOf(Oe)<0&&he.push(Oe);const me=f?f.defines():[];_a(z)&&me.unshift("#version 300 es"),b&&me.push("#define OVERDRAW_INSPECTOR;"),E&&me.push("#define TERRAIN3D;"),D&&me.push(D);let ge=me.concat(Qn.prelude.fragmentSource,I.fragmentSource,s.fragmentSource).join(`
`),ye=me.concat(Qn.prelude.vertexSource,I.vertexSource,s.vertexSource).join(`
`);_a(z)||(ge=function(Oe){return Oe.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(ge),ye=function(Oe){return Oe.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(ye));const Me=z.createShader(z.FRAGMENT_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);if(z.shaderSource(Me,ge),z.compileShader(Me),!z.getShaderParameter(Me,z.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${z.getShaderInfoLog(Me)}`);z.attachShader(this.program,Me);const Se=z.createShader(z.VERTEX_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);if(z.shaderSource(Se,ye),z.compileShader(Se),!z.getShaderParameter(Se,z.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${z.getShaderInfoLog(Se)}`);z.attachShader(this.program,Se),this.attributes={};const Le={};this.numAttributes=N.length;for(let Oe=0;Oe<this.numAttributes;Oe++)N[Oe]&&(z.bindAttribLocation(this.program,Oe,N[Oe]),this.attributes[N[Oe]]=Oe);if(z.linkProgram(this.program),!z.getProgramParameter(this.program,z.LINK_STATUS))throw new Error(`Program failed to link: ${z.getProgramInfoLog(this.program)}`);z.deleteShader(Se),z.deleteShader(Me);for(let Oe=0;Oe<he.length;Oe++){const Xe=he[Oe];if(Xe&&!Le[Xe]){const We=z.getUniformLocation(this.program,Xe);We&&(Le[Xe]=We)}}this.fixedUniforms=m(t,Le),this.terrainUniforms=((Oe,Xe)=>({u_depth:new u.bF(Oe,Xe.u_depth),u_terrain:new u.bF(Oe,Xe.u_terrain),u_terrain_dim:new u.b8(Oe,Xe.u_terrain_dim),u_terrain_matrix:new u.bH(Oe,Xe.u_terrain_matrix),u_terrain_unpack:new u.bI(Oe,Xe.u_terrain_unpack),u_terrain_exaggeration:new u.b8(Oe,Xe.u_terrain_exaggeration)}))(t,Le),this.projectionUniforms=((Oe,Xe)=>({u_projection_matrix:new u.bH(Oe,Xe.u_projection_matrix),u_projection_tile_mercator_coords:new u.bI(Oe,Xe.u_projection_tile_mercator_coords),u_projection_clipping_plane:new u.bI(Oe,Xe.u_projection_clipping_plane),u_projection_transition:new u.b8(Oe,Xe.u_projection_transition),u_projection_fallback_matrix:new u.bH(Oe,Xe.u_projection_fallback_matrix)}))(t,Le),this.binderUniforms=f?f.getUniforms(t,Le):[]}draw(t,s,f,m,b,E,I,D,z,F,U,N,Y,Q,se,ae,ce,he,me){const ge=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(f),t.setStencilMode(m),t.setColorMode(b),t.setCullFace(E),D){t.activeTexture.set(ge.TEXTURE2),ge.bindTexture(ge.TEXTURE_2D,D.depthTexture),t.activeTexture.set(ge.TEXTURE3),ge.bindTexture(ge.TEXTURE_2D,D.texture);for(const Me in this.terrainUniforms)this.terrainUniforms[Me].set(D[Me])}if(z)for(const Me in z)this.projectionUniforms[Em[Me]].set(z[Me]);if(I)for(const Me in this.fixedUniforms)this.fixedUniforms[Me].set(I[Me]);ae&&ae.setUniforms(t,this.binderUniforms,Q,{zoom:se});let ye=0;switch(s){case ge.LINES:ye=2;break;case ge.TRIANGLES:ye=3;break;case ge.LINE_STRIP:ye=1}for(const Me of Y.get()){const Se=Me.vaos||(Me.vaos={});(Se[F]||(Se[F]=new zh)).bind(t,this,U,ae?ae.getPaintVertexBuffers():[],N,Me.vertexOffset,ce,he,me),ge.drawElements(s,Me.primitiveLength*ye,ge.UNSIGNED_SHORT,Me.primitiveOffset*ye*2)}}}function Ec(y,t,s){const f=1/u.aw(s,1,t.transform.tileZoom),m=Math.pow(2,s.tileID.overscaledZ),b=s.tileSize*Math.pow(2,t.transform.tileZoom)/m,E=b*(s.tileID.canonical.x+s.tileID.wrap*m),I=b*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[f,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[E>>16,I>>16],u_pixel_coord_lower:[65535&E,65535&I]}}const Xf=(y,t,s,f)=>{const m=y.style.light,b=m.properties.get("position"),E=[b.x,b.y,b.z],I=u.bL();m.properties.get("anchor")==="viewport"&&u.bM(I,y.transform.bearingInRadians),u.bN(E,E,I);const D=y.transform.transformLightDirection(E),z=m.properties.get("color");return{u_lightpos:E,u_lightpos_globe:D,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+t,u_opacity:s,u_fill_translate:f}},kh=(y,t,s,f,m,b,E)=>u.e(Xf(y,t,s,f),Ec(b,y,E),{u_height_factor:-Math.pow(2,m.overscaledZ)/E.tileSize/8}),Kf=(y,t,s,f)=>u.e(Ec(t,y,s),{u_fill_translate:f}),Mc=(y,t)=>({u_world:y,u_fill_translate:t}),Zd=(y,t,s,f,m)=>u.e(Kf(y,t,s,m),{u_world:f}),Ac=(y,t,s,f,m)=>{const b=y.transform;let E,I,D=0;if(s.paint.get("circle-pitch-alignment")==="map"){const z=u.aw(t,1,b.zoom);E=!0,I=[z,z],D=z/(u.Z*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*m}else E=!1,I=b.pixelsToGLUnits;return{u_camera_to_center_distance:b.cameraToCenterDistance,u_scale_with_map:+(s.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+E,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:I,u_globe_extrude_scale:D,u_translate:f}},Mm=y=>({u_pixel_extrude_scale:[1/y.width,1/y.height]}),Gd=y=>({u_viewport_size:[y.width,y.height]}),vu=(y,t=1)=>({u_color:y,u_overlay:0,u_overlay_scale:t}),Oh=(y,t,s,f)=>{const m=u.aw(y,1,t)/(u.Z*Math.pow(2,y.tileID.overscaledZ))*2*Math.PI*f;return{u_extrude_scale:u.aw(y,1,t),u_intensity:s,u_globe_extrude_scale:m}},Bh=(y,t,s,f)=>{const m=u.K();u.bO(m,0,y.width,y.height,0,0,1);const b=y.context.gl;return{u_matrix:m,u_world:[b.drawingBufferWidth,b.drawingBufferHeight],u_image:s,u_color_ramp:f,u_opacity:t.paint.get("heatmap-opacity")}},qd=(y,t,s)=>{const f=s.paint.get("hillshade-shadow-color"),m=s.paint.get("hillshade-highlight-color"),b=s.paint.get("hillshade-accent-color");let E=s.paint.get("hillshade-illumination-direction")*(Math.PI/180);return s.paint.get("hillshade-illumination-anchor")==="viewport"&&(E+=y.transform.bearingInRadians),{u_image:0,u_latrange:Pl(0,t.tileID),u_light:[s.paint.get("hillshade-exaggeration"),E],u_shadow:f,u_highlight:m,u_accent:b}},Rl=(y,t)=>{const s=t.stride,f=u.K();return u.bO(f,0,u.Z,-8192,0,0,1),u.L(f,f,[0,-8192,0]),{u_matrix:f,u_image:1,u_dimension:[s,s],u_zoom:y.overscaledZ,u_unpack:t.getUnpackVector()}};function Pl(y,t){const s=Math.pow(2,t.canonical.z),f=t.canonical.y;return[new u.$(0,f/s).toLngLat().lat,new u.$(0,(f+1)/s).toLngLat().lat]}const Lh=(y,t,s,f)=>{const m=y.transform;return{u_translation:Cc(y,t,s),u_ratio:f/u.aw(t,1,m.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Wf=(y,t,s,f,m)=>u.e(Lh(y,t,s,f),{u_image:0,u_image_height:m}),Ic=(y,t,s,f,m)=>{const b=y.transform,E=mo(t,b);return{u_translation:Cc(y,t,s),u_texsize:t.imageAtlasTexture.size,u_ratio:f/u.aw(t,1,b.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[E,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},Qf=(y,t,s,f,m,b)=>{const E=y.lineAtlas,I=mo(t,y.transform),D=s.layout.get("line-cap")==="round",z=E.getDash(m.from,D),F=E.getDash(m.to,D),U=z.width*b.fromScale,N=F.width*b.toScale;return u.e(Lh(y,t,s,f),{u_patternscale_a:[I/U,-z.height/2],u_patternscale_b:[I/N,-F.height/2],u_sdfgamma:E.width/(256*Math.min(U,N)*y.pixelRatio)/2,u_image:0,u_tex_y_a:z.y,u_tex_y_b:F.y,u_mix:b.t})};function mo(y,t){return 1/u.aw(y,1,t.tileZoom)}function Cc(y,t,s){return u.ax(y.transform,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const Am=(y,t,s,f,m)=>{return{u_tl_parent:y,u_scale_parent:t,u_buffer_scale:1,u_fade_t:s.mix,u_opacity:s.opacity*f.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:f.paint.get("raster-brightness-min"),u_brightness_high:f.paint.get("raster-brightness-max"),u_saturation_factor:(E=f.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(b=f.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:bu(f.paint.get("raster-hue-rotate")),u_coords_top:[m[0].x,m[0].y,m[1].x,m[1].y],u_coords_bottom:[m[3].x,m[3].y,m[2].x,m[2].y]};var b,E};function bu(y){y*=Math.PI/180;const t=Math.sin(y),s=Math.cos(y);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const Fh=(y,t,s,f,m,b,E,I,D,z,F,U,N)=>{const Y=E.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:Y.cameraToCenterDistance,u_pitch:Y.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:Y.width/Y.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_label_plane_matrix:I,u_coord_matrix:D,u_is_text:+F,u_pitch_with_map:+f,u_is_along_line:m,u_is_variable_anchor:b,u_texsize:U,u_texture:0,u_translation:z,u_pitched_scale:N}},Nh=(y,t,s,f,m,b,E,I,D,z,F,U,N,Y)=>{const Q=E.transform;return u.e(Fh(y,t,s,f,m,b,E,I,D,z,F,U,Y),{u_gamma_scale:f?Math.cos(Q.pitch*Math.PI/180)*Q.cameraToCenterDistance:1,u_device_pixel_ratio:E.pixelRatio,u_is_halo:1})},xu=(y,t,s,f,m,b,E,I,D,z,F,U,N)=>u.e(Nh(y,t,s,f,m,b,E,I,D,z,!0,F,0,N),{u_texsize_icon:U,u_texture_icon:1}),Uh=(y,t)=>({u_opacity:y,u_color:t}),wu=(y,t,s,f,m)=>u.e(function(b,E,I,D){const z=I.imageManager.getPattern(b.from.toString()),F=I.imageManager.getPattern(b.to.toString()),{width:U,height:N}=I.imageManager.getPixelSize(),Y=Math.pow(2,D.tileID.overscaledZ),Q=D.tileSize*Math.pow(2,I.transform.tileZoom)/Y,se=Q*(D.tileID.canonical.x+D.tileID.wrap*Y),ae=Q*D.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:F.tl,u_pattern_br_b:F.br,u_texsize:[U,N],u_mix:E.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:F.displaySize,u_scale_a:E.fromScale,u_scale_b:E.toScale,u_tile_units_to_pixels:1/u.aw(D,1,I.transform.tileZoom),u_pixel_coord_upper:[se>>16,ae>>16],u_pixel_coord_lower:[65535&se,65535&ae]}}(s,m,t,f),{u_opacity:y}),ls=(y,t)=>{},jh={fillExtrusion:(y,t)=>({u_lightpos:new u.bJ(y,t.u_lightpos),u_lightpos_globe:new u.bJ(y,t.u_lightpos_globe),u_lightintensity:new u.b8(y,t.u_lightintensity),u_lightcolor:new u.bJ(y,t.u_lightcolor),u_vertical_gradient:new u.b8(y,t.u_vertical_gradient),u_opacity:new u.b8(y,t.u_opacity),u_fill_translate:new u.bK(y,t.u_fill_translate)}),fillExtrusionPattern:(y,t)=>({u_lightpos:new u.bJ(y,t.u_lightpos),u_lightpos_globe:new u.bJ(y,t.u_lightpos_globe),u_lightintensity:new u.b8(y,t.u_lightintensity),u_lightcolor:new u.bJ(y,t.u_lightcolor),u_vertical_gradient:new u.b8(y,t.u_vertical_gradient),u_height_factor:new u.b8(y,t.u_height_factor),u_opacity:new u.b8(y,t.u_opacity),u_fill_translate:new u.bK(y,t.u_fill_translate),u_image:new u.bF(y,t.u_image),u_texsize:new u.bK(y,t.u_texsize),u_pixel_coord_upper:new u.bK(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.bK(y,t.u_pixel_coord_lower),u_scale:new u.bJ(y,t.u_scale),u_fade:new u.b8(y,t.u_fade)}),fill:(y,t)=>({u_fill_translate:new u.bK(y,t.u_fill_translate)}),fillPattern:(y,t)=>({u_image:new u.bF(y,t.u_image),u_texsize:new u.bK(y,t.u_texsize),u_pixel_coord_upper:new u.bK(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.bK(y,t.u_pixel_coord_lower),u_scale:new u.bJ(y,t.u_scale),u_fade:new u.b8(y,t.u_fade),u_fill_translate:new u.bK(y,t.u_fill_translate)}),fillOutline:(y,t)=>({u_world:new u.bK(y,t.u_world),u_fill_translate:new u.bK(y,t.u_fill_translate)}),fillOutlinePattern:(y,t)=>({u_world:new u.bK(y,t.u_world),u_image:new u.bF(y,t.u_image),u_texsize:new u.bK(y,t.u_texsize),u_pixel_coord_upper:new u.bK(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.bK(y,t.u_pixel_coord_lower),u_scale:new u.bJ(y,t.u_scale),u_fade:new u.b8(y,t.u_fade),u_fill_translate:new u.bK(y,t.u_fill_translate)}),circle:(y,t)=>({u_camera_to_center_distance:new u.b8(y,t.u_camera_to_center_distance),u_scale_with_map:new u.bF(y,t.u_scale_with_map),u_pitch_with_map:new u.bF(y,t.u_pitch_with_map),u_extrude_scale:new u.bK(y,t.u_extrude_scale),u_device_pixel_ratio:new u.b8(y,t.u_device_pixel_ratio),u_globe_extrude_scale:new u.b8(y,t.u_globe_extrude_scale),u_translate:new u.bK(y,t.u_translate)}),collisionBox:(y,t)=>({u_pixel_extrude_scale:new u.bK(y,t.u_pixel_extrude_scale)}),collisionCircle:(y,t)=>({u_viewport_size:new u.bK(y,t.u_viewport_size)}),debug:(y,t)=>({u_color:new u.bG(y,t.u_color),u_overlay:new u.bF(y,t.u_overlay),u_overlay_scale:new u.b8(y,t.u_overlay_scale)}),depth:ls,clippingMask:ls,heatmap:(y,t)=>({u_extrude_scale:new u.b8(y,t.u_extrude_scale),u_intensity:new u.b8(y,t.u_intensity),u_globe_extrude_scale:new u.b8(y,t.u_globe_extrude_scale)}),heatmapTexture:(y,t)=>({u_matrix:new u.bH(y,t.u_matrix),u_world:new u.bK(y,t.u_world),u_image:new u.bF(y,t.u_image),u_color_ramp:new u.bF(y,t.u_color_ramp),u_opacity:new u.b8(y,t.u_opacity)}),hillshade:(y,t)=>({u_image:new u.bF(y,t.u_image),u_latrange:new u.bK(y,t.u_latrange),u_light:new u.bK(y,t.u_light),u_shadow:new u.bG(y,t.u_shadow),u_highlight:new u.bG(y,t.u_highlight),u_accent:new u.bG(y,t.u_accent)}),hillshadePrepare:(y,t)=>({u_matrix:new u.bH(y,t.u_matrix),u_image:new u.bF(y,t.u_image),u_dimension:new u.bK(y,t.u_dimension),u_zoom:new u.b8(y,t.u_zoom),u_unpack:new u.bI(y,t.u_unpack)}),line:(y,t)=>({u_translation:new u.bK(y,t.u_translation),u_ratio:new u.b8(y,t.u_ratio),u_device_pixel_ratio:new u.b8(y,t.u_device_pixel_ratio),u_units_to_pixels:new u.bK(y,t.u_units_to_pixels)}),lineGradient:(y,t)=>({u_translation:new u.bK(y,t.u_translation),u_ratio:new u.b8(y,t.u_ratio),u_device_pixel_ratio:new u.b8(y,t.u_device_pixel_ratio),u_units_to_pixels:new u.bK(y,t.u_units_to_pixels),u_image:new u.bF(y,t.u_image),u_image_height:new u.b8(y,t.u_image_height)}),linePattern:(y,t)=>({u_translation:new u.bK(y,t.u_translation),u_texsize:new u.bK(y,t.u_texsize),u_ratio:new u.b8(y,t.u_ratio),u_device_pixel_ratio:new u.b8(y,t.u_device_pixel_ratio),u_image:new u.bF(y,t.u_image),u_units_to_pixels:new u.bK(y,t.u_units_to_pixels),u_scale:new u.bJ(y,t.u_scale),u_fade:new u.b8(y,t.u_fade)}),lineSDF:(y,t)=>({u_translation:new u.bK(y,t.u_translation),u_ratio:new u.b8(y,t.u_ratio),u_device_pixel_ratio:new u.b8(y,t.u_device_pixel_ratio),u_units_to_pixels:new u.bK(y,t.u_units_to_pixels),u_patternscale_a:new u.bK(y,t.u_patternscale_a),u_patternscale_b:new u.bK(y,t.u_patternscale_b),u_sdfgamma:new u.b8(y,t.u_sdfgamma),u_image:new u.bF(y,t.u_image),u_tex_y_a:new u.b8(y,t.u_tex_y_a),u_tex_y_b:new u.b8(y,t.u_tex_y_b),u_mix:new u.b8(y,t.u_mix)}),raster:(y,t)=>({u_tl_parent:new u.bK(y,t.u_tl_parent),u_scale_parent:new u.b8(y,t.u_scale_parent),u_buffer_scale:new u.b8(y,t.u_buffer_scale),u_fade_t:new u.b8(y,t.u_fade_t),u_opacity:new u.b8(y,t.u_opacity),u_image0:new u.bF(y,t.u_image0),u_image1:new u.bF(y,t.u_image1),u_brightness_low:new u.b8(y,t.u_brightness_low),u_brightness_high:new u.b8(y,t.u_brightness_high),u_saturation_factor:new u.b8(y,t.u_saturation_factor),u_contrast_factor:new u.b8(y,t.u_contrast_factor),u_spin_weights:new u.bJ(y,t.u_spin_weights),u_coords_top:new u.bI(y,t.u_coords_top),u_coords_bottom:new u.bI(y,t.u_coords_bottom)}),symbolIcon:(y,t)=>({u_is_size_zoom_constant:new u.bF(y,t.u_is_size_zoom_constant),u_is_size_feature_constant:new u.bF(y,t.u_is_size_feature_constant),u_size_t:new u.b8(y,t.u_size_t),u_size:new u.b8(y,t.u_size),u_camera_to_center_distance:new u.b8(y,t.u_camera_to_center_distance),u_pitch:new u.b8(y,t.u_pitch),u_rotate_symbol:new u.bF(y,t.u_rotate_symbol),u_aspect_ratio:new u.b8(y,t.u_aspect_ratio),u_fade_change:new u.b8(y,t.u_fade_change),u_label_plane_matrix:new u.bH(y,t.u_label_plane_matrix),u_coord_matrix:new u.bH(y,t.u_coord_matrix),u_is_text:new u.bF(y,t.u_is_text),u_pitch_with_map:new u.bF(y,t.u_pitch_with_map),u_is_along_line:new u.bF(y,t.u_is_along_line),u_is_variable_anchor:new u.bF(y,t.u_is_variable_anchor),u_texsize:new u.bK(y,t.u_texsize),u_texture:new u.bF(y,t.u_texture),u_translation:new u.bK(y,t.u_translation),u_pitched_scale:new u.b8(y,t.u_pitched_scale)}),symbolSDF:(y,t)=>({u_is_size_zoom_constant:new u.bF(y,t.u_is_size_zoom_constant),u_is_size_feature_constant:new u.bF(y,t.u_is_size_feature_constant),u_size_t:new u.b8(y,t.u_size_t),u_size:new u.b8(y,t.u_size),u_camera_to_center_distance:new u.b8(y,t.u_camera_to_center_distance),u_pitch:new u.b8(y,t.u_pitch),u_rotate_symbol:new u.bF(y,t.u_rotate_symbol),u_aspect_ratio:new u.b8(y,t.u_aspect_ratio),u_fade_change:new u.b8(y,t.u_fade_change),u_label_plane_matrix:new u.bH(y,t.u_label_plane_matrix),u_coord_matrix:new u.bH(y,t.u_coord_matrix),u_is_text:new u.bF(y,t.u_is_text),u_pitch_with_map:new u.bF(y,t.u_pitch_with_map),u_is_along_line:new u.bF(y,t.u_is_along_line),u_is_variable_anchor:new u.bF(y,t.u_is_variable_anchor),u_texsize:new u.bK(y,t.u_texsize),u_texture:new u.bF(y,t.u_texture),u_gamma_scale:new u.b8(y,t.u_gamma_scale),u_device_pixel_ratio:new u.b8(y,t.u_device_pixel_ratio),u_is_halo:new u.bF(y,t.u_is_halo),u_translation:new u.bK(y,t.u_translation),u_pitched_scale:new u.b8(y,t.u_pitched_scale)}),symbolTextAndIcon:(y,t)=>({u_is_size_zoom_constant:new u.bF(y,t.u_is_size_zoom_constant),u_is_size_feature_constant:new u.bF(y,t.u_is_size_feature_constant),u_size_t:new u.b8(y,t.u_size_t),u_size:new u.b8(y,t.u_size),u_camera_to_center_distance:new u.b8(y,t.u_camera_to_center_distance),u_pitch:new u.b8(y,t.u_pitch),u_rotate_symbol:new u.bF(y,t.u_rotate_symbol),u_aspect_ratio:new u.b8(y,t.u_aspect_ratio),u_fade_change:new u.b8(y,t.u_fade_change),u_label_plane_matrix:new u.bH(y,t.u_label_plane_matrix),u_coord_matrix:new u.bH(y,t.u_coord_matrix),u_is_text:new u.bF(y,t.u_is_text),u_pitch_with_map:new u.bF(y,t.u_pitch_with_map),u_is_along_line:new u.bF(y,t.u_is_along_line),u_is_variable_anchor:new u.bF(y,t.u_is_variable_anchor),u_texsize:new u.bK(y,t.u_texsize),u_texsize_icon:new u.bK(y,t.u_texsize_icon),u_texture:new u.bF(y,t.u_texture),u_texture_icon:new u.bF(y,t.u_texture_icon),u_gamma_scale:new u.b8(y,t.u_gamma_scale),u_device_pixel_ratio:new u.b8(y,t.u_device_pixel_ratio),u_is_halo:new u.bF(y,t.u_is_halo),u_translation:new u.bK(y,t.u_translation),u_pitched_scale:new u.b8(y,t.u_pitched_scale)}),background:(y,t)=>({u_opacity:new u.b8(y,t.u_opacity),u_color:new u.bG(y,t.u_color)}),backgroundPattern:(y,t)=>({u_opacity:new u.b8(y,t.u_opacity),u_image:new u.bF(y,t.u_image),u_pattern_tl_a:new u.bK(y,t.u_pattern_tl_a),u_pattern_br_a:new u.bK(y,t.u_pattern_br_a),u_pattern_tl_b:new u.bK(y,t.u_pattern_tl_b),u_pattern_br_b:new u.bK(y,t.u_pattern_br_b),u_texsize:new u.bK(y,t.u_texsize),u_mix:new u.b8(y,t.u_mix),u_pattern_size_a:new u.bK(y,t.u_pattern_size_a),u_pattern_size_b:new u.bK(y,t.u_pattern_size_b),u_scale_a:new u.b8(y,t.u_scale_a),u_scale_b:new u.b8(y,t.u_scale_b),u_pixel_coord_upper:new u.bK(y,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.bK(y,t.u_pixel_coord_lower),u_tile_units_to_pixels:new u.b8(y,t.u_tile_units_to_pixels)}),terrain:(y,t)=>({u_texture:new u.bF(y,t.u_texture),u_ele_delta:new u.b8(y,t.u_ele_delta),u_fog_matrix:new u.bH(y,t.u_fog_matrix),u_fog_color:new u.bG(y,t.u_fog_color),u_fog_ground_blend:new u.b8(y,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new u.b8(y,t.u_fog_ground_blend_opacity),u_horizon_color:new u.bG(y,t.u_horizon_color),u_horizon_fog_blend:new u.b8(y,t.u_horizon_fog_blend),u_is_globe_mode:new u.b8(y,t.u_is_globe_mode)}),terrainDepth:(y,t)=>({u_ele_delta:new u.b8(y,t.u_ele_delta)}),terrainCoords:(y,t)=>({u_texture:new u.bF(y,t.u_texture),u_terrain_coords_id:new u.b8(y,t.u_terrain_coords_id),u_ele_delta:new u.b8(y,t.u_ele_delta)}),projectionErrorMeasurement:(y,t)=>({u_input:new u.b8(y,t.u_input),u_output_expected:new u.b8(y,t.u_output_expected)}),atmosphere:(y,t)=>({u_sun_pos:new u.bJ(y,t.u_sun_pos),u_atmosphere_blend:new u.b8(y,t.u_atmosphere_blend),u_globe_position:new u.bJ(y,t.u_globe_position),u_globe_radius:new u.b8(y,t.u_globe_radius),u_inv_proj_matrix:new u.bH(y,t.u_inv_proj_matrix)}),sky:(y,t)=>({u_sky_color:new u.bG(y,t.u_sky_color),u_horizon_color:new u.bG(y,t.u_horizon_color),u_horizon:new u.bK(y,t.u_horizon),u_horizon_normal:new u.bK(y,t.u_horizon_normal),u_sky_horizon_blend:new u.b8(y,t.u_sky_horizon_blend),u_sky_blend:new u.b8(y,t.u_sky_blend)})};class $d{constructor(t,s,f){this.context=t;const m=t.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Hd={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Jf{constructor(t,s,f,m){this.length=s.length,this.attributes=f,this.itemSize=s.bytesPerElement,this.dynamicDraw=m,this.context=t;const b=t.gl;this.buffer=b.createBuffer(),t.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let f=0;f<this.attributes.length;f++){const m=s.attributes[this.attributes[f].name];m!==void 0&&t.enableVertexAttribArray(m)}}setVertexAttribPointers(t,s,f){for(let m=0;m<this.attributes.length;m++){const b=this.attributes[m],E=s.attributes[b.name];E!==void 0&&t.vertexAttribPointer(E,b.components,t[Hd[b.type]],!1,this.itemSize,b.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class qi{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class zl extends qi{getDefault(){return u.b7.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ta extends qi{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Su extends qi{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class ep extends qi{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class tp extends qi{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class ip extends qi{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Yd extends qi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Xd extends qi{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class np extends qi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class go extends qi{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Dc extends qi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class No extends qi{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Tu extends qi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class Uo extends qi{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class ja extends qi{getDefault(){return u.b7.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Or extends qi{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Vh extends qi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class Kd extends qi{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class _o extends qi{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class jo extends qi{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Eu extends qi{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Mu extends qi{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Au extends qi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Zh extends qi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class rp extends qi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class kl extends qi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Ol extends qi{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Gh extends qi{getDefault(){return null}set(t){var s;if(t===this.current&&!this.dirty)return;const f=this.gl;_a(f)?f.bindVertexArray(t):(s=f.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Da extends qi{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Ui extends qi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class ia extends qi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class ya extends qi{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class Bl extends ya{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Ll extends ya{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class qh extends ya{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const Iu="Framebuffer is not complete";class $h{constructor(t,s,f,m,b){this.context=t,this.width=s,this.height=f;const E=t.gl,I=this.framebuffer=E.createFramebuffer();if(this.colorAttachment=new Bl(t,I),m)this.depthAttachment=b?new qh(t,I):new Ll(t,I);else if(b)throw new Error("Stencil cannot be set without depth");if(E.checkFramebufferStatus(E.FRAMEBUFFER)!==E.FRAMEBUFFER_COMPLETE)throw new Error(Iu)}destroy(){const t=this.context.gl,s=this.colorAttachment.get();if(s&&t.deleteTexture(s),this.depthAttachment){const f=this.depthAttachment.get();f&&t.deleteRenderbuffer(f)}t.deleteFramebuffer(this.framebuffer)}}class Rc{constructor(t){var s,f;if(this.gl=t,this.clearColor=new zl(this),this.clearDepth=new ta(this),this.clearStencil=new Su(this),this.colorMask=new ep(this),this.depthMask=new tp(this),this.stencilMask=new ip(this),this.stencilFunc=new Yd(this),this.stencilOp=new Xd(this),this.stencilTest=new np(this),this.depthRange=new go(this),this.depthTest=new Dc(this),this.depthFunc=new No(this),this.blend=new Tu(this),this.blendFunc=new Uo(this),this.blendColor=new ja(this),this.blendEquation=new Or(this),this.cullFace=new Vh(this),this.cullFaceSide=new Kd(this),this.frontFace=new _o(this),this.program=new jo(this),this.activeTexture=new Eu(this),this.viewport=new Mu(this),this.bindFramebuffer=new Au(this),this.bindRenderbuffer=new Zh(this),this.bindTexture=new rp(this),this.bindVertexBuffer=new kl(this),this.bindElementBuffer=new Ol(this),this.bindVertexArray=new Gh(this),this.pixelStoreUnpack=new Da(this),this.pixelStoreUnpackPremultiplyAlpha=new Ui(this),this.pixelStoreUnpackFlipY=new ia(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),_a(t)){this.HALF_FLOAT=t.HALF_FLOAT;const m=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=t.RGBA16F)!==null&&s!==void 0?s:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(f=t.RGB16F)!==null&&f!==void 0?f:m==null?void 0:m.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const m=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s){return new $d(this,t,s)}createVertexBuffer(t,s,f){return new Jf(this,t,s,f)}createRenderbuffer(t,s,f){const m=this.gl,b=m.createRenderbuffer();return this.bindRenderbuffer.set(b),m.renderbufferStorage(m.RENDERBUFFER,t,s,f),this.bindRenderbuffer.set(null),b}createFramebuffer(t,s,f,m){return new $h(this,t,s,f,m)}clear({color:t,depth:s,stencil:f}){const m=this.gl;let b=0;t&&(b|=m.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(b|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),f!==void 0&&(b|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),m.clear(b)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){u.bC(t.blendFunction,sn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return _a(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var s;return _a(this.gl)?this.gl.deleteVertexArray(t):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let Fl;function Vo(y,t,s,f,m){const b=y.context,E=y.transform,I=b.gl,D=y.useProgram("collisionBox"),z=[];let F=0,U=0;for(let ce=0;ce<f.length;ce++){const he=f[ce],me=t.getTile(he).getBucket(s);if(!me)continue;const ge=m?me.textCollisionBox:me.iconCollisionBox,ye=me.collisionCircleArray;ye.length>0&&(z.push({circleArray:ye,circleOffset:U,coord:he}),F+=ye.length/4,U=F),ge&&D.draw(b,I.LINES,gi.disabled,Oi.disabled,y.colorModeForRenderPass(),Ei.disabled,Mm(y.transform),y.style.map.terrain&&y.style.map.terrain.getTerrainData(he),E.getProjectionData({overscaledTileID:he,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),s.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,null,y.transform.zoom,null,null,ge.collisionVertexBuffer)}if(!m||!z.length)return;const N=y.useProgram("collisionCircle"),Y=new u.bP;Y.resize(4*F),Y._trim();let Q=0;for(const ce of z)for(let he=0;he<ce.circleArray.length/4;he++){const me=4*he,ge=ce.circleArray[me+0],ye=ce.circleArray[me+1],Me=ce.circleArray[me+2],Se=ce.circleArray[me+3];Y.emplace(Q++,ge,ye,Me,Se,0),Y.emplace(Q++,ge,ye,Me,Se,1),Y.emplace(Q++,ge,ye,Me,Se,2),Y.emplace(Q++,ge,ye,Me,Se,3)}(!Fl||Fl.length<2*F)&&(Fl=function(ce){const he=2*ce,me=new u.bR;me.resize(he),me._trim();for(let ge=0;ge<he;ge++){const ye=6*ge;me.uint16[ye+0]=4*ge+0,me.uint16[ye+1]=4*ge+1,me.uint16[ye+2]=4*ge+2,me.uint16[ye+3]=4*ge+2,me.uint16[ye+4]=4*ge+3,me.uint16[ye+5]=4*ge+0}return me}(F));const se=b.createIndexBuffer(Fl,!0),ae=b.createVertexBuffer(Y,u.bQ.members,!0);for(const ce of z){const he=Gd(y.transform);N.draw(b,I.TRIANGLES,gi.disabled,Oi.disabled,y.colorModeForRenderPass(),Ei.disabled,he,y.style.map.terrain&&y.style.map.terrain.getTerrainData(ce.coord),null,s.id,ae,se,u.aG.simpleSegment(0,2*ce.circleOffset,ce.circleArray.length,ce.circleArray.length/2),null,y.transform.zoom,null,null,null)}ae.destroy(),se.destroy()}const yo=u.at(new Float32Array(16));function Wd(y,t,s,f,m,b){const{horizontalAlign:E,verticalAlign:I}=u.aB(y);return new u.P((-(E-.5)*t/m+f[0])*b,(-(I-.5)*s/m+f[1])*b)}function na(y,t,s,f,m,b){const E=t.tileAnchorPoint.add(new u.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let I=f.mult(b);s||(I=I.rotate(-m));const D=E.add(I);return Ze(D.x,D.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(s){const I=ki(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(y),D=Math.atan(I.y/I.x)+(I.x<0?Math.PI:0);return y.add(f.rotate(D))}return y.add(f)}function Hh(y,t,s,f,m,b,E,I,D,z,F,U){const N=y.text.placedSymbolArray,Y=y.text.dynamicLayoutVertexArray,Q=y.icon.dynamicLayoutVertexArray,se={};Y.clear();for(let ae=0;ae<N.length;ae++){const ce=N.get(ae),he=ce.hidden||!ce.crossTileID||y.allowVerticalPlacement&&!ce.placedOrientation?null:f[ce.crossTileID];if(he){const me=new u.P(ce.anchorX,ce.anchorY),ge={getElevation:U,width:m.width,height:m.height,pitchedLabelPlaneMatrix:b,pitchWithMap:s,transform:m,tileAnchorPoint:me,translation:z,unwrappedTileID:F},ye=s?Bt(me.x,me.y,ge):ki(me.x,me.y,ge),Me=Pe(m.cameraToCenterDistance,ye.signedDistanceFromCamera);let Se=u.ai(y.textSizeData,I,ce)*Me/u.av;s&&(Se*=y.tilePixelRatio/E);const{width:Le,height:Oe,anchor:Xe,textOffset:We,textBoxScale:He}=he,gt=Wd(Xe,Le,Oe,We,He,Se),mt=m.getPitchedTextCorrection(me.x+z[0],me.y+z[1],F),it=na(ye.point,ge,t,gt,-m.bearingInRadians,mt),Lt=y.allowVerticalPlacement&&ce.placedOrientation===u.ah.vertical?Math.PI/2:0;for(let ai=0;ai<ce.numGlyphs;ai++)u.ao(Y,it,Lt);D&&ce.associatedIconIndex>=0&&(se[ce.associatedIconIndex]={shiftedAnchor:it,angle:Lt})}else Gt(ce.numGlyphs,Y)}if(D){Q.clear();const ae=y.icon.placedSymbolArray;for(let ce=0;ce<ae.length;ce++){const he=ae.get(ce);if(he.hidden)Gt(he.numGlyphs,Q);else{const me=se[ce];if(me)for(let ge=0;ge<he.numGlyphs;ge++)u.ao(Q,me.shiftedAnchor,me.angle);else Gt(he.numGlyphs,Q)}}y.icon.dynamicLayoutVertexBuffer.updateData(Q)}y.text.dynamicLayoutVertexBuffer.updateData(Y)}function Va(y,t,s){return s.iconsInText&&t?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function Pc(y,t,s,f,m,b,E,I,D,z,F,U,N){const Y=y.context,Q=Y.gl,se=y.transform,ae=I==="map",ce=D==="map",he=I!=="viewport"&&s.layout.get("symbol-placement")!=="point",me=ae&&!ce&&!he,ge=!s.layout.get("symbol-sort-key").isConstant();let ye=!1;const Me=y.getDepthModeForSublayer(0,gi.ReadOnly),Se=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Le=[],Oe=se.getCircleRadiusCorrection();for(const Xe of f){const We=t.getTile(Xe),He=We.getBucket(s);if(!He)continue;const gt=m?He.text:He.icon;if(!gt||!gt.segments.get().length||!gt.hasVisibleVertices)continue;const mt=gt.programConfigurations.get(s.id),it=m||He.sdfIcons,Lt=m?He.textSizeData:He.iconSizeData,ai=ce||se.pitch!==0,Li=y.useProgram(Va(it,m,He),mt),vi=u.ag(Lt,se.zoom),en=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Xe);let ln,pn,Ki,tn,Hn=[0,0],gr=null;if(m)pn=We.glyphAtlasTexture,Ki=Q.LINEAR,ln=We.glyphAtlasTexture.size,He.iconsInText&&(Hn=We.imageAtlasTexture.size,gr=We.imageAtlasTexture,tn=ai||y.options.rotating||y.options.zooming||Lt.kind==="composite"||Lt.kind==="camera"?Q.LINEAR:Q.NEAREST);else{const Vn=s.layout.get("icon-size").constantOr(0)!==1||He.iconsNeedLinear;pn=We.imageAtlasTexture,Ki=it||y.options.rotating||y.options.zooming||Vn||ai?Q.LINEAR:Q.NEAREST,ln=We.imageAtlasTexture.size}const wr=u.aw(We,1,y.transform.zoom),Wr=ze(ae,y.transform,wr),js=u.K();u.aj(js,Wr);const fs=Ce(ce,ae,y.transform,wr),tl=u.ax(se,We,b,E),Vs=se.getProjectionData({overscaledTileID:Xe,applyGlobeMatrix:!N,applyTerrainMatrix:!0}),il=Se&&He.hasTextData(),ps=s.layout.get("icon-text-fit")!=="none"&&il&&He.hasIconData();if(he){const Vn=y.style.map.terrain?(er,Wi)=>y.style.map.terrain.getElevation(Xe,er,Wi):null,mn=s.layout.get("text-rotation-alignment")==="map";yt(He,y,m,Wr,js,ce,z,mn,Xe.toUnwrapped(),se.width,se.height,tl,Vn)}const ms=m&&Se||ps,xa=he||ms?yo:ce?Wr:y.transform.clipSpaceToPixelsMatrix,Zs=it&&s.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Xl;Xl=it?He.iconsInText?xu(Lt.kind,vi,me,ce,he,ms,y,xa,fs,tl,ln,Hn,Oe):Nh(Lt.kind,vi,me,ce,he,ms,y,xa,fs,tl,m,ln,0,Oe):Fh(Lt.kind,vi,me,ce,he,ms,y,xa,fs,tl,m,ln,Oe);const Kl={program:Li,buffers:gt,uniformValues:Xl,projectionData:Vs,atlasTexture:pn,atlasTextureIcon:gr,atlasInterpolation:Ki,atlasInterpolationIcon:tn,isSDF:it,hasHalo:Zs};if(ge&&He.canOverlap){ye=!0;const Vn=gt.segments.get();for(const mn of Vn)Le.push({segments:new u.aG([mn]),sortKey:mn.sortKey,state:Kl,terrainData:en})}else Le.push({segments:gt.segments,sortKey:0,state:Kl,terrainData:en})}ye&&Le.sort((Xe,We)=>Xe.sortKey-We.sortKey);for(const Xe of Le){const We=Xe.state;if(Y.activeTexture.set(Q.TEXTURE0),We.atlasTexture.bind(We.atlasInterpolation,Q.CLAMP_TO_EDGE),We.atlasTextureIcon&&(Y.activeTexture.set(Q.TEXTURE1),We.atlasTextureIcon&&We.atlasTextureIcon.bind(We.atlasInterpolationIcon,Q.CLAMP_TO_EDGE)),We.isSDF){const He=We.uniformValues;We.hasHalo&&(He.u_is_halo=1,Nl(We.buffers,Xe.segments,s,y,We.program,Me,F,U,He,We.projectionData,Xe.terrainData)),He.u_is_halo=0}Nl(We.buffers,Xe.segments,s,y,We.program,Me,F,U,We.uniformValues,We.projectionData,Xe.terrainData)}}function Nl(y,t,s,f,m,b,E,I,D,z,F){const U=f.context;m.draw(U,U.gl.TRIANGLES,b,E,I,Ei.backCCW,D,F,z,s.id,y.layoutVertexBuffer,y.indexBuffer,t,s.paint,f.transform.zoom,y.programConfigurations.get(s.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function Ul(y,t,s,f,m){const b=y.context,E=b.gl,I=Oi.disabled,D=new sn([E.ONE,E.ONE],u.b7.transparent,[!0,!0,!0,!0]),z=t.getBucket(s);if(!z)return;const F=f.key;let U=s.heatmapFbos.get(F);U||(U=Yh(b,t.tileSize,t.tileSize),s.heatmapFbos.set(F,U)),b.bindFramebuffer.set(U.framebuffer),b.viewport.set([0,0,t.tileSize,t.tileSize]),b.clear({color:u.b7.transparent});const N=z.programConfigurations.get(s.id),Y=y.useProgram("heatmap",N,!m),Q=y.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),se=y.style.map.terrain.getTerrainData(f);Y.draw(b,E.TRIANGLES,gi.disabled,I,D,Ei.disabled,Oh(t,y.transform.zoom,s.paint.get("heatmap-intensity"),1),se,Q,s.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,s.paint,y.transform.zoom,N)}function Cu(y,t,s,f,m){const b=y.context,E=b.gl,I=y.transform;b.setColorMode(y.colorModeForRenderPass());const D=Zo(b,t),z=s.key,F=t.heatmapFbos.get(z);if(!F)return;b.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,F.colorAttachment.get()),b.activeTexture.set(E.TEXTURE1),D.bind(E.LINEAR,E.CLAMP_TO_EDGE);const U=I.getProjectionData({overscaledTileID:s,applyTerrainMatrix:m,applyGlobeMatrix:!f});y.useProgram("heatmapTexture").draw(b,E.TRIANGLES,gi.disabled,Oi.disabled,y.colorModeForRenderPass(),Ei.disabled,Bh(y,t,0,1),null,U,t.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments,t.paint,I.zoom),F.destroy(),t.heatmapFbos.delete(z)}function Yh(y,t,s){var f,m;const b=y.gl,E=b.createTexture();b.bindTexture(b.TEXTURE_2D,E),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);const I=(f=y.HALF_FLOAT)!==null&&f!==void 0?f:b.UNSIGNED_BYTE,D=(m=y.RGBA16F)!==null&&m!==void 0?m:b.RGBA;b.texImage2D(b.TEXTURE_2D,0,D,t,s,0,b.RGBA,I,null);const z=y.createFramebuffer(t,s,!1,!1);return z.colorAttachment.set(E),z}function Zo(y,t){return t.colorRampTexture||(t.colorRampTexture=new ut(y,t.colorRamp,y.gl.RGBA)),t.colorRampTexture}function zs(y,t,s,f,m){if(!s||!f||!f.imageAtlas)return;const b=f.imageAtlas.patternPositions;let E=b[s.to.toString()],I=b[s.from.toString()];if(!E&&I&&(E=I),!I&&E&&(I=E),!E||!I){const D=m.getPaintProperty(t);E=b[D],I=b[D]}E&&I&&y.setConstantPatternPositions(E,I)}function jl(y,t,s,f,m,b,E,I){const D=y.context.gl,z="fill-pattern",F=s.paint.get(z),U=F&&F.constantOr(1),N=s.getCrossfadeParameters();let Y,Q,se,ae,ce;const he=y.transform,me=s.paint.get("fill-translate"),ge=s.paint.get("fill-translate-anchor");E?(Q=U&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Y=D.LINES):(Q=U?"fillPattern":"fill",Y=D.TRIANGLES);const ye=F.constantOr(null);for(const Me of f){const Se=t.getTile(Me);if(U&&!Se.patternsLoaded())continue;const Le=Se.getBucket(s);if(!Le)continue;const Oe=Le.programConfigurations.get(s.id),Xe=y.useProgram(Q,Oe),We=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Me);U&&(y.context.activeTexture.set(D.TEXTURE0),Se.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Oe.updatePaintBuffers(N)),zs(Oe,z,ye,Se,s);const He=he.getProjectionData({overscaledTileID:Me,applyGlobeMatrix:!I,applyTerrainMatrix:!0}),gt=u.ax(he,Se,me,ge);if(E){ae=Le.indexBuffer2,ce=Le.segments2;const it=[D.drawingBufferWidth,D.drawingBufferHeight];se=Q==="fillOutlinePattern"&&U?Zd(y,N,Se,it,gt):Mc(it,gt)}else ae=Le.indexBuffer,ce=Le.segments,se=U?Kf(y,N,Se,gt):{u_fill_translate:gt};let mt;if(y.renderPass==="translucent"&&I){const[it]=y.getStencilConfigForOverlapAndUpdateStencilID(f);mt=it[Me.overscaledZ]}else mt=y.stencilModeForClipping(Me);Xe.draw(y.context,Y,m,mt,b,Ei.backCCW,se,We,He,s.id,Le.layoutVertexBuffer,ae,ce,s.paint,y.transform.zoom,Oe)}}function Vl(y,t,s,f,m,b,E,I){const D=y.context,z=D.gl,F="fill-extrusion-pattern",U=s.paint.get(F),N=U.constantOr(1),Y=s.getCrossfadeParameters(),Q=s.paint.get("fill-extrusion-opacity"),se=U.constantOr(null),ae=y.transform;for(const ce of f){const he=t.getTile(ce),me=he.getBucket(s);if(!me)continue;const ge=y.style.map.terrain&&y.style.map.terrain.getTerrainData(ce),ye=me.programConfigurations.get(s.id),Me=y.useProgram(N?"fillExtrusionPattern":"fillExtrusion",ye);N&&(y.context.activeTexture.set(z.TEXTURE0),he.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),ye.updatePaintBuffers(Y));const Se=ae.getProjectionData({overscaledTileID:ce,applyGlobeMatrix:!I,applyTerrainMatrix:!0});zs(ye,F,se,he,s);const Le=u.ax(ae,he,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Oe=s.paint.get("fill-extrusion-vertical-gradient"),Xe=N?kh(y,Oe,Q,Le,ce,Y,he):Xf(y,Oe,Q,Le);Me.draw(D,D.gl.TRIANGLES,m,b,E,Ei.backCCW,Xe,ge,Se,s.id,me.layoutVertexBuffer,me.indexBuffer,me.segments,s.paint,y.transform.zoom,ye,y.style.map.terrain&&me.centroidVertexBuffer)}}function ra(y,t,s,f,m,b,E,I,D){var z;const F=y.style.projection,U=y.context,N=y.transform,Y=U.gl,Q=y.useProgram("hillshade"),se=!y.options.moving;for(const ae of f){const ce=t.getTile(ae),he=ce.fbo;if(!he)continue;const me=F.getMeshFromTileID(U,ae.canonical,I,!0,"raster"),ge=(z=y.style.map.terrain)===null||z===void 0?void 0:z.getTerrainData(ae);U.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_2D,he.colorAttachment.get());const ye=N.getProjectionData({overscaledTileID:ae,aligned:se,applyGlobeMatrix:!D,applyTerrainMatrix:!0});Q.draw(U,Y.TRIANGLES,b,m[ae.overscaledZ],E,Ei.backCCW,qd(y,ce,s),ge,ye,s.id,me.vertexBuffer,me.indexBuffer,me.segments)}}const Br=[new u.P(0,0),new u.P(u.Z,0),new u.P(u.Z,u.Z),new u.P(0,u.Z)];function Za(y,t,s,f,m,b,E,I,D=!1,z=!1){const F=f[f.length-1].overscaledZ,U=y.context,N=U.gl,Y=y.useProgram("raster"),Q=y.transform,se=y.style.projection,ae=y.colorModeForRenderPass(),ce=!y.options.moving;for(const he of f){const me=y.getDepthModeForSublayer(he.overscaledZ-F,s.paint.get("raster-opacity")===1?gi.ReadWrite:gi.ReadOnly,N.LESS),ge=t.getTile(he);ge.registerFadeDuration(s.paint.get("raster-fade-duration"));const ye=t.findLoadedParent(he,0),Me=t.findLoadedSibling(he),Se=vo(ge,ye||Me||null,t,s,y.transform,y.style.map.terrain);let Le,Oe;const Xe=s.paint.get("raster-resampling")==="nearest"?N.NEAREST:N.LINEAR;U.activeTexture.set(N.TEXTURE0),ge.texture.bind(Xe,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),U.activeTexture.set(N.TEXTURE1),ye?(ye.texture.bind(Xe,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),Le=Math.pow(2,ye.tileID.overscaledZ-ge.tileID.overscaledZ),Oe=[ge.tileID.canonical.x*Le%1,ge.tileID.canonical.y*Le%1]):ge.texture.bind(Xe,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),ge.texture.useMipmap&&U.extTextureFilterAnisotropic&&y.transform.pitch>20&&N.texParameterf(N.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax);const We=y.style.map.terrain&&y.style.map.terrain.getTerrainData(he),He=Q.getProjectionData({overscaledTileID:he,aligned:ce,applyGlobeMatrix:!z,applyTerrainMatrix:!0}),gt=Am(Oe||[0,0],Le||1,Se,s,I),mt=se.getMeshFromTileID(U,he.canonical,b,E,"raster");Y.draw(U,N.TRIANGLES,me,m?m[he.overscaledZ]:Oi.disabled,ae,D?Ei.frontCCW:Ei.backCCW,gt,We,He,s.id,mt.vertexBuffer,mt.indexBuffer,mt.segments)}}function vo(y,t,s,f,m,b){const E=f.paint.get("raster-fade-duration");if(!b&&E>0){const I=ne.now(),D=(I-y.timeAdded)/E,z=t?(I-t.timeAdded)/E:-1,F=s.getSource(),U=Ua(m,{tileSize:F.tileSize,roundZoom:F.roundZoom}),N=!t||Math.abs(t.tileID.overscaledZ-U)>Math.abs(y.tileID.overscaledZ-U),Y=N&&y.refreshedUponExpiration?1:u.ae(N?D:1-z,0,1);return y.refreshedUponExpiration&&D>=1&&(y.refreshedUponExpiration=!1),t?{opacity:1,mix:1-Y}:{opacity:Y,mix:0}}return{opacity:1,mix:0}}const ks=new u.b7(1,0,0,1),on=new u.b7(0,1,0,1),Go=new u.b7(0,0,1,1),va=new u.b7(1,0,1,1),Du=new u.b7(0,1,1,1);function Rr(y,t,s,f){Pi(y,0,t+s/2,y.transform.width,s,f)}function Un(y,t,s,f){Pi(y,t-s/2,0,s,y.transform.height,f)}function Pi(y,t,s,f,m,b){const E=y.context,I=E.gl;I.enable(I.SCISSOR_TEST),I.scissor(t*y.pixelRatio,s*y.pixelRatio,f*y.pixelRatio,m*y.pixelRatio),E.clear({color:b}),I.disable(I.SCISSOR_TEST)}function cs(y,t,s){const f=y.context,m=f.gl,b=y.useProgram("debug"),E=gi.disabled,I=Oi.disabled,D=y.colorModeForRenderPass(),z="$debug",F=y.style.map.terrain&&y.style.map.terrain.getTerrainData(s);f.activeTexture.set(m.TEXTURE0);const U=t.getTileByID(s.key).latestRawTileData,N=Math.floor((U&&U.byteLength||0)/1024),Y=t.getTile(s).tileSize,Q=512/Math.min(Y,512)*(s.overscaledZ/y.transform.zoom)*.5;let se=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(se+=` => ${s.overscaledZ}`),function(ce,he){ce.initDebugOverlayCanvas();const me=ce.debugOverlayCanvas,ge=ce.context.gl,ye=ce.debugOverlayCanvas.getContext("2d");ye.clearRect(0,0,me.width,me.height),ye.shadowColor="white",ye.shadowBlur=2,ye.lineWidth=1.5,ye.strokeStyle="white",ye.textBaseline="top",ye.font="bold 36px Open Sans, sans-serif",ye.fillText(he,5,5),ye.strokeText(he,5,5),ce.debugOverlayTexture.update(me),ce.debugOverlayTexture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE)}(y,`${se} ${N}kB`);const ae=y.transform.getProjectionData({overscaledTileID:s,applyGlobeMatrix:!0,applyTerrainMatrix:!0});b.draw(f,m.TRIANGLES,E,I,sn.alphaBlended,Ei.disabled,vu(u.b7.transparent,Q),null,ae,z,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),b.draw(f,m.LINE_STRIP,E,I,D,Ei.disabled,vu(u.b7.red),F,ae,z,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function Ra(y,t,s,f){const{isRenderingGlobe:m}=f,b=y.context,E=b.gl,I=y.transform,D=y.colorModeForRenderPass(),z=y.getDepthModeFor3D(),F=y.useProgram("terrain");b.bindFramebuffer.set(null),b.viewport.set([0,0,y.width,y.height]);for(const U of s){const N=t.getTerrainMesh(U.tileID),Y=y.renderToTexture.getTexture(U),Q=t.getTerrainData(U.tileID);b.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,Y.texture);const se=t.getMeshFrameDelta(I.zoom),ae=I.calculateFogMatrix(U.tileID.toUnwrapped()),ce=Ps(se,ae,y.style.sky,I.pitch,m),he=I.getProjectionData({overscaledTileID:U.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});F.draw(b,E.TRIANGLES,z,Oi.disabled,D,Ei.backCCW,ce,Q,he,"terrain",N.vertexBuffer,N.indexBuffer,N.segments)}}function Ru(y,t){if(!t.mesh){const s=new u.aF;s.emplaceBack(-1,-1),s.emplaceBack(1,-1),s.emplaceBack(1,1),s.emplaceBack(-1,1);const f=new u.aH;f.emplaceBack(0,1,2),f.emplaceBack(0,2,3),t.mesh=new Oo(y.createVertexBuffer(s,Ds.members),y.createIndexBuffer(f),u.aG.simpleSegment(0,0,s.length,f.length))}return t.mesh}class qo{constructor(t,s){this.context=new Rc(t),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:u.at(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=W.maxUnderzooming+W.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Al}resize(t,s,f){if(this.width=Math.floor(t*f),this.height=Math.floor(s*f),this.pixelRatio=f,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const t=this.context,s=new u.aF;s.emplaceBack(0,0),s.emplaceBack(u.Z,0),s.emplaceBack(0,u.Z),s.emplaceBack(u.Z,u.Z),this.tileExtentBuffer=t.createVertexBuffer(s,Ds.members),this.tileExtentSegments=u.aG.simpleSegment(0,0,4,2);const f=new u.aF;f.emplaceBack(0,0),f.emplaceBack(u.Z,0),f.emplaceBack(0,u.Z),f.emplaceBack(u.Z,u.Z),this.debugBuffer=t.createVertexBuffer(f,Ds.members),this.debugSegments=u.aG.simpleSegment(0,0,4,5);const m=new u.bW;m.emplaceBack(0,0,0,0),m.emplaceBack(u.Z,0,u.Z,0),m.emplaceBack(0,u.Z,0,u.Z),m.emplaceBack(u.Z,u.Z,u.Z,u.Z),this.rasterBoundsBuffer=t.createVertexBuffer(m,Vd.members),this.rasterBoundsSegments=u.aG.simpleSegment(0,0,4,2);const b=new u.aF;b.emplaceBack(0,0),b.emplaceBack(u.Z,0),b.emplaceBack(0,u.Z),b.emplaceBack(u.Z,u.Z),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(b,Ds.members),this.rasterBoundsSegmentsPosOnly=u.aG.simpleSegment(0,0,4,5);const E=new u.aF;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(E,Ds.members),this.viewportSegments=u.aG.simpleSegment(0,0,4,2);const I=new u.bX;I.emplaceBack(0),I.emplaceBack(1),I.emplaceBack(3),I.emplaceBack(2),I.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(I);const D=new u.aH;D.emplaceBack(1,0,2),D.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(D);const z=this.context.gl;this.stencilClearMode=new Oi({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO),this.tileExtentMesh=new Oo(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,s=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const f=u.K();u.bO(f,0,this.width,this.height,0,0,1),u.M(f,f,[s.drawingBufferWidth,s.drawingBufferHeight,0]);const m={mainMatrix:f,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:f};this.useProgram("clippingMask",null,!0).draw(t,s.TRIANGLES,gi.disabled,this.stencilClearMode,sn.disabled,Ei.disabled,null,null,m,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,s,f){if(this.currentStencilSource===t.source||!t.isTileClipped()||!s||!s.length)return;this.currentStencilSource=t.source,this.nextStencilID+s.length>256&&this.clearStencil();const m=this.context;m.setColorMode(sn.disabled),m.setDepthMode(gi.disabled);const b={};for(const E of s)b[E.key]=this.nextStencilID++;this._renderTileMasks(b,s,f,!0),this._renderTileMasks(b,s,f,!1),this._tileClippingMaskIDs=b}_renderTileMasks(t,s,f,m){const b=this.context,E=b.gl,I=this.style.projection,D=this.transform,z=this.useProgram("clippingMask");for(const F of s){const U=t[F.key],N=this.style.map.terrain&&this.style.map.terrain.getTerrainData(F),Y=I.getMeshFromTileID(this.context,F.canonical,m,!0,"stencil"),Q=D.getProjectionData({overscaledTileID:F,applyGlobeMatrix:!0,applyTerrainMatrix:!0});z.draw(b,E.TRIANGLES,gi.disabled,new Oi({func:E.ALWAYS,mask:0},U,255,E.KEEP,E.KEEP,E.REPLACE),sn.disabled,f?Ei.disabled:Ei.backCCW,null,N,Q,"$clipping",Y.vertexBuffer,Y.indexBuffer,Y.segments)}}_renderTilesDepthBuffer(){const t=this.context,s=t.gl,f=this.style.projection,m=this.transform,b=this.useProgram("depth"),E=this.getDepthModeFor3D(),I=De(m,{tileSize:m.tileSize});for(const D of I){const z=this.style.map.terrain&&this.style.map.terrain.getTerrainData(D),F=f.getMeshFromTileID(this.context,D.canonical,!0,!0,"raster"),U=m.getProjectionData({overscaledTileID:D,applyGlobeMatrix:!0,applyTerrainMatrix:!0});b.draw(t,s.TRIANGLES,E,Oi.disabled,sn.disabled,Ei.backCCW,null,z,U,"$clipping",F.vertexBuffer,F.indexBuffer,F.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new Oi({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){const s=this.context.gl;return new Oi({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const s=this.context.gl,f=t.sort((E,I)=>I.overscaledZ-E.overscaledZ),m=f[f.length-1].overscaledZ,b=f[0].overscaledZ-m+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const E={};for(let I=0;I<b;I++)E[I+m]=new Oi({func:s.GEQUAL,mask:255},I+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=b,[E,f]}return[{[m]:Oi.disabled},f]}stencilConfigForOverlapTwoPass(t){const s=this.context.gl,f=t.sort((E,I)=>I.overscaledZ-E.overscaledZ),m=f[f.length-1].overscaledZ,b=f[0].overscaledZ-m+1;if(this.clearStencil(),b>1){const E={},I={};for(let D=0;D<b;D++)E[D+m]=new Oi({func:s.GREATER,mask:255},b+1+D,255,s.KEEP,s.KEEP,s.REPLACE),I[D+m]=new Oi({func:s.GREATER,mask:255},1+D,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID=2*b+1,[E,I,f]}return this.nextStencilID=3,[{[m]:new Oi({func:s.GREATER,mask:255},2,255,s.KEEP,s.KEEP,s.REPLACE)},{[m]:new Oi({func:s.GREATER,mask:255},1,255,s.KEEP,s.KEEP,s.REPLACE)},f]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new sn([t.CONSTANT_COLOR,t.ONE],new u.b7(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?sn.unblended:sn.alphaBlended}getDepthModeForSublayer(t,s,f){if(!this.opaquePassEnabledForLayer())return gi.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new gi(f||this.context.gl.LEQUAL,s,[m,m])}getDepthModeFor3D(){return new gi(this.context.gl.LEQUAL,gi.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,s){var f,m;this.style=t,this.options=s,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(ne.now()),this.imageManager.beginFrame();const b=this.style._order,E=this.style.sourceCaches,I={},D={},z={},F={isRenderingToTexture:!1,isRenderingGlobe:((f=t.projection)===null||f===void 0?void 0:f.transitionState)>0};for(const N in E){const Y=E[N];Y.used&&Y.prepare(this.context),I[N]=Y.getVisibleCoordinates(!1),D[N]=I[N].slice().reverse(),z[N]=Y.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let N=0;N<b.length;N++)if(this.style._layers[b[N]].is3D()){this.opaquePassCutoff=N;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const N of b){const Y=this.style._layers[N];if(!Y.hasOffscreenPass()||Y.isHidden(this.transform.zoom))continue;const Q=D[Y.source];(Y.type==="custom"||Q.length)&&this.renderLayer(this,E[Y.source],Y,Q,F)}if((m=this.style.projection)===null||m===void 0||m.updateGPUdependent({context:this.context,useProgram:N=>this.useProgram(N)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?u.b7.black:u.b7.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(N,Y){const Q=N.context,se=Q.gl,ae=((Me,Se,Le)=>{const Oe=Math.cos(Se.rollInRadians),Xe=Math.sin(Se.rollInRadians),We=Cl(Se),He=Se.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Me.properties.get("sky-color"),u_horizon_color:Me.properties.get("horizon-color"),u_horizon:[(Se.width/2-We*Xe)*Le,(Se.height/2+We*Oe)*Le],u_horizon_normal:[-Xe,Oe],u_sky_horizon_blend:Me.properties.get("sky-horizon-blend")*Se.height/2*Le,u_sky_blend:He}})(Y,N.style.map.transform,N.pixelRatio),ce=new gi(se.LEQUAL,gi.ReadWrite,[0,1]),he=Oi.disabled,me=N.colorModeForRenderPass(),ge=N.useProgram("sky"),ye=Ru(Q,Y);ge.draw(Q,se.TRIANGLES,ce,he,me,Ei.disabled,ae,null,void 0,"sky",ye.vertexBuffer,ye.indexBuffer,ye.segments)}(this,this.style.sky),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=b.length-1;this.currentLayer>=0;this.currentLayer--){const N=this.style._layers[b[this.currentLayer]],Y=E[N.source],Q=I[N.source];this._renderTileClippingMasks(N,Q,!1),this.renderLayer(this,Y,N,Q,F)}this.renderPass="translucent";let U=!1;for(this.currentLayer=0;this.currentLayer<b.length;this.currentLayer++){const N=this.style._layers[b[this.currentLayer]],Y=E[N.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(N,F))continue;this.opaquePassEnabledForLayer()||U||(U=!0,F.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const Q=(N.type==="symbol"?z:D)[N.source];this._renderTileClippingMasks(N,I[N.source],!1),this.renderLayer(this,Y,N,Q,F)}if(F.isRenderingGlobe&&function(N,Y,Q){const se=N.context,ae=se.gl,ce=N.useProgram("atmosphere"),he=new gi(ae.LEQUAL,gi.ReadOnly,[0,1]),me=N.transform,ge=function(He,gt){const mt=He.properties.get("position"),it=[-mt.x,-mt.y,-mt.z],Lt=u.at(new Float64Array(16));return He.properties.get("anchor")==="map"&&(u.a_(Lt,Lt,gt.rollInRadians),u.a$(Lt,Lt,-gt.pitchInRadians),u.a_(Lt,Lt,gt.bearingInRadians),u.a$(Lt,Lt,gt.center.lat*Math.PI/180),u.bm(Lt,Lt,-gt.center.lng*Math.PI/180)),u.bV(it,it,Lt),it}(Q,N.transform),ye=me.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Me=Y.properties.get("atmosphere-blend")*ye.projectionTransition;if(Me===0)return;const Se=_u(me.worldSize,me.center.lat),Le=me.inverseProjectionMatrix,Oe=new Float64Array(4);Oe[3]=1,u.ap(Oe,Oe,me.modelViewProjectionMatrix),Oe[0]/=Oe[3],Oe[1]/=Oe[3],Oe[2]/=Oe[3],Oe[3]=1,u.ap(Oe,Oe,Le),Oe[0]/=Oe[3],Oe[1]/=Oe[3],Oe[2]/=Oe[3],Oe[3]=1;const Xe=((He,gt,mt,it,Lt)=>({u_sun_pos:He,u_atmosphere_blend:gt,u_globe_position:mt,u_globe_radius:it,u_inv_proj_matrix:Lt}))(ge,Me,[Oe[0],Oe[1],Oe[2]],Se,Le),We=Ru(se,Y);ce.draw(se,ae.TRIANGLES,he,Oi.disabled,sn.alphaBlended,Ei.disabled,Xe,null,null,"atmosphere",We.vertexBuffer,We.indexBuffer,We.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const N=function(Y,Q){let se=null;const ae=Object.values(Y._layers).flatMap(ge=>ge.source&&!ge.isHidden(Q)?[Y.sourceCaches[ge.source]]:[]),ce=ae.filter(ge=>ge.getSource().type==="vector"),he=ae.filter(ge=>ge.getSource().type!=="vector"),me=ge=>{(!se||se.getSource().maxzoom<ge.getSource().maxzoom)&&(se=ge)};return ce.forEach(ge=>me(ge)),se||he.forEach(ge=>me(ge)),se}(this.style,this.transform.zoom);N&&function(Y,Q,se){for(let ae=0;ae<se.length;ae++)cs(Y,Q,se[ae])}(this,N,N.getVisibleCoordinates())}this.options.showPadding&&function(N){const Y=N.transform.padding;Rr(N,N.transform.height-(Y.top||0),3,ks),Rr(N,Y.bottom||0,3,on),Un(N,Y.left||0,3,Go),Un(N,N.transform.width-(Y.right||0),3,va);const Q=N.transform.centerPoint;(function(se,ae,ce,he){Pi(se,ae-1,ce-10,2,20,he),Pi(se,ae-10,ce-1,20,2,he)})(N,Q.x,N.transform.height-Q.y,Du)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const s=this.terrainFacilitator.matrix,f=this.transform.modelViewProjectionMatrix;let m=this.terrainFacilitator.dirty;m||(m=t?!u.bY(s,f):!u.bZ(s,f)),m||(m=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),m&&(u.b_(s,f),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(b,E){const I=b.context,D=I.gl,z=b.transform,F=sn.unblended,U=new gi(D.LEQUAL,gi.ReadWrite,[0,1]),N=E.sourceCache.getRenderableTiles(),Y=b.useProgram("terrainDepth");I.bindFramebuffer.set(E.getFramebuffer("depth").framebuffer),I.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),I.clear({color:u.b7.transparent,depth:1});for(const Q of N){const se=E.getTerrainMesh(Q.tileID),ae=E.getTerrainData(Q.tileID),ce=z.getProjectionData({overscaledTileID:Q.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),he={u_ele_delta:E.getMeshFrameDelta(z.zoom)};Y.draw(I,D.TRIANGLES,U,Oi.disabled,F,Ei.backCCW,he,ae,ce,"terrain",se.vertexBuffer,se.indexBuffer,se.segments)}I.bindFramebuffer.set(null),I.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain),function(b,E){const I=b.context,D=I.gl,z=b.transform,F=sn.unblended,U=new gi(D.LEQUAL,gi.ReadWrite,[0,1]),N=E.getCoordsTexture(),Y=E.sourceCache.getRenderableTiles(),Q=b.useProgram("terrainCoords");I.bindFramebuffer.set(E.getFramebuffer("coords").framebuffer),I.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),I.clear({color:u.b7.transparent,depth:1}),E.coordsIndex=[];for(const se of Y){const ae=E.getTerrainMesh(se.tileID),ce=E.getTerrainData(se.tileID);I.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,N.texture);const he={u_terrain_coords_id:(255-E.coordsIndex.length)/255,u_texture:0,u_ele_delta:E.getMeshFrameDelta(z.zoom)},me=z.getProjectionData({overscaledTileID:se.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});Q.draw(I,D.TRIANGLES,U,Oi.disabled,F,Ei.backCCW,he,ce,me,"terrain",ae.vertexBuffer,ae.indexBuffer,ae.segments),E.coordsIndex.push(se.tileID.key)}I.bindFramebuffer.set(null),I.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain))}renderLayer(t,s,f,m,b){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="custom"||(m||[]).length)&&(this.id=f.id,u.b$(f)?function(E,I,D,z,F,U){if(E.renderPass!=="translucent")return;const{isRenderingToTexture:N}=U,Y=Oi.disabled,Q=E.colorModeForRenderPass();(D._unevaluatedLayout.hasValue("text-variable-anchor")||D._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(se,ae,ce,he,me,ge,ye,Me,Se){const Le=ae.transform,Oe=ae.style.map.terrain,Xe=me==="map",We=ge==="map";for(const He of se){const gt=he.getTile(He),mt=gt.getBucket(ce);if(!mt||!mt.text||!mt.text.segments.get().length)continue;const it=u.ag(mt.textSizeData,Le.zoom),Lt=u.aw(gt,1,ae.transform.zoom),ai=ze(Xe,ae.transform,Lt),Li=ce.layout.get("icon-text-fit")!=="none"&&mt.hasIconData();if(it){const vi=Math.pow(2,Le.zoom-gt.tileID.overscaledZ),en=Oe?(ln,pn)=>Oe.getElevation(He,ln,pn):null;Hh(mt,Xe,We,Se,Le,ai,vi,it,Li,u.ax(Le,gt,ye,Me),He.toUnwrapped(),en)}}}(z,E,D,I,D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),F),D.paint.get("icon-opacity").constantOr(1)!==0&&Pc(E,I,D,z,!1,D.paint.get("icon-translate"),D.paint.get("icon-translate-anchor"),D.layout.get("icon-rotation-alignment"),D.layout.get("icon-pitch-alignment"),D.layout.get("icon-keep-upright"),Y,Q,N),D.paint.get("text-opacity").constantOr(1)!==0&&Pc(E,I,D,z,!0,D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),D.layout.get("text-keep-upright"),Y,Q,N),I.map.showCollisionBoxes&&(Vo(E,I,D,z,!0),Vo(E,I,D,z,!1))}(t,s,f,m,this.style.placement.variableOffsets,b):u.c0(f)?function(E,I,D,z,F){if(E.renderPass!=="translucent")return;const{isRenderingToTexture:U}=F,N=D.paint.get("circle-opacity"),Y=D.paint.get("circle-stroke-width"),Q=D.paint.get("circle-stroke-opacity"),se=!D.layout.get("circle-sort-key").isConstant();if(N.constantOr(1)===0&&(Y.constantOr(1)===0||Q.constantOr(1)===0))return;const ae=E.context,ce=ae.gl,he=E.transform,me=E.getDepthModeForSublayer(0,gi.ReadOnly),ge=Oi.disabled,ye=E.colorModeForRenderPass(),Me=[],Se=he.getCircleRadiusCorrection();for(let Le=0;Le<z.length;Le++){const Oe=z[Le],Xe=I.getTile(Oe),We=Xe.getBucket(D);if(!We)continue;const He=D.paint.get("circle-translate"),gt=D.paint.get("circle-translate-anchor"),mt=u.ax(he,Xe,He,gt),it=We.programConfigurations.get(D.id),Lt=E.useProgram("circle",it),ai=We.layoutVertexBuffer,Li=We.indexBuffer,vi=E.style.map.terrain&&E.style.map.terrain.getTerrainData(Oe),en={programConfiguration:it,program:Lt,layoutVertexBuffer:ai,indexBuffer:Li,uniformValues:Ac(E,Xe,D,mt,Se),terrainData:vi,projectionData:he.getProjectionData({overscaledTileID:Oe,applyGlobeMatrix:!U,applyTerrainMatrix:!0})};if(se){const ln=We.segments.get();for(const pn of ln)Me.push({segments:new u.aG([pn]),sortKey:pn.sortKey,state:en})}else Me.push({segments:We.segments,sortKey:0,state:en})}se&&Me.sort((Le,Oe)=>Le.sortKey-Oe.sortKey);for(const Le of Me){const{programConfiguration:Oe,program:Xe,layoutVertexBuffer:We,indexBuffer:He,uniformValues:gt,terrainData:mt,projectionData:it}=Le.state;Xe.draw(ae,ce.TRIANGLES,me,ge,ye,Ei.backCCW,gt,mt,it,D.id,We,He,Le.segments,D.paint,E.transform.zoom,Oe)}}(t,s,f,m,b):u.c1(f)?function(E,I,D,z,F){if(D.paint.get("heatmap-opacity")===0)return;const U=E.context,{isRenderingToTexture:N,isRenderingGlobe:Y}=F;if(E.style.map.terrain){for(const Q of z){const se=I.getTile(Q);I.hasRenderableParent(Q)||(E.renderPass==="offscreen"?Ul(E,se,D,Q,Y):E.renderPass==="translucent"&&Cu(E,D,Q,N,Y))}U.viewport.set([0,0,E.width,E.height])}else E.renderPass==="offscreen"?function(Q,se,ae,ce){const he=Q.context,me=he.gl,ge=Q.transform,ye=Oi.disabled,Me=new sn([me.ONE,me.ONE],u.b7.transparent,[!0,!0,!0,!0]);(function(Se,Le,Oe){const Xe=Se.gl;Se.activeTexture.set(Xe.TEXTURE1),Se.viewport.set([0,0,Le.width/4,Le.height/4]);let We=Oe.heatmapFbos.get(u.bS);We?(Xe.bindTexture(Xe.TEXTURE_2D,We.colorAttachment.get()),Se.bindFramebuffer.set(We.framebuffer)):(We=Yh(Se,Le.width/4,Le.height/4),Oe.heatmapFbos.set(u.bS,We))})(he,Q,ae),he.clear({color:u.b7.transparent});for(let Se=0;Se<ce.length;Se++){const Le=ce[Se];if(se.hasRenderableParent(Le))continue;const Oe=se.getTile(Le),Xe=Oe.getBucket(ae);if(!Xe)continue;const We=Xe.programConfigurations.get(ae.id),He=Q.useProgram("heatmap",We),gt=ge.getProjectionData({overscaledTileID:Le,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),mt=ge.getCircleRadiusCorrection();He.draw(he,me.TRIANGLES,gi.disabled,ye,Me,Ei.backCCW,Oh(Oe,ge.zoom,ae.paint.get("heatmap-intensity"),mt),null,gt,ae.id,Xe.layoutVertexBuffer,Xe.indexBuffer,Xe.segments,ae.paint,ge.zoom,We)}he.viewport.set([0,0,Q.width,Q.height])}(E,I,D,z):E.renderPass==="translucent"&&function(Q,se){const ae=Q.context,ce=ae.gl;ae.setColorMode(Q.colorModeForRenderPass());const he=se.heatmapFbos.get(u.bS);he&&(ae.activeTexture.set(ce.TEXTURE0),ce.bindTexture(ce.TEXTURE_2D,he.colorAttachment.get()),ae.activeTexture.set(ce.TEXTURE1),Zo(ae,se).bind(ce.LINEAR,ce.CLAMP_TO_EDGE),Q.useProgram("heatmapTexture").draw(ae,ce.TRIANGLES,gi.disabled,Oi.disabled,Q.colorModeForRenderPass(),Ei.disabled,Bh(Q,se,0,1),null,null,se.id,Q.viewportBuffer,Q.quadTriangleIndexBuffer,Q.viewportSegments,se.paint,Q.transform.zoom))}(E,D)}(t,s,f,m,b):u.c2(f)?function(E,I,D,z,F){if(E.renderPass!=="translucent")return;const{isRenderingToTexture:U}=F,N=D.paint.get("line-opacity"),Y=D.paint.get("line-width");if(N.constantOr(1)===0||Y.constantOr(1)===0)return;const Q=E.getDepthModeForSublayer(0,gi.ReadOnly),se=E.colorModeForRenderPass(),ae=D.paint.get("line-dasharray"),ce=D.paint.get("line-pattern"),he=ce.constantOr(1),me=D.paint.get("line-gradient"),ge=D.getCrossfadeParameters(),ye=he?"linePattern":ae?"lineSDF":me?"lineGradient":"line",Me=E.context,Se=Me.gl,Le=E.transform;let Oe=!0;for(const Xe of z){const We=I.getTile(Xe);if(he&&!We.patternsLoaded())continue;const He=We.getBucket(D);if(!He)continue;const gt=He.programConfigurations.get(D.id),mt=E.context.program.get(),it=E.useProgram(ye,gt),Lt=Oe||it.program!==mt,ai=E.style.map.terrain&&E.style.map.terrain.getTerrainData(Xe),Li=ce.constantOr(null);if(Li&&We.imageAtlas){const Ki=We.imageAtlas,tn=Ki.patternPositions[Li.to.toString()],Hn=Ki.patternPositions[Li.from.toString()];tn&&Hn&&gt.setConstantPatternPositions(tn,Hn)}const vi=Le.getProjectionData({overscaledTileID:Xe,applyGlobeMatrix:!U,applyTerrainMatrix:!0}),en=Le.getPixelScale(),ln=he?Ic(E,We,D,en,ge):ae?Qf(E,We,D,en,ae,ge):me?Wf(E,We,D,en,He.lineClipsArray.length):Lh(E,We,D,en);if(he)Me.activeTexture.set(Se.TEXTURE0),We.imageAtlasTexture.bind(Se.LINEAR,Se.CLAMP_TO_EDGE),gt.updatePaintBuffers(ge);else if(ae&&(Lt||E.lineAtlas.dirty))Me.activeTexture.set(Se.TEXTURE0),E.lineAtlas.bind(Me);else if(me){const Ki=He.gradients[D.id];let tn=Ki.texture;if(D.gradientVersion!==Ki.version){let Hn=256;if(D.stepInterpolant){const gr=I.getSource().maxzoom,wr=Xe.canonical.z===gr?Math.ceil(1<<E.transform.maxZoom-Xe.canonical.z):1;Hn=u.ae(u.bT(He.maxLineLength/u.Z*1024*wr),256,Me.maxTextureSize)}Ki.gradient=u.bU({expression:D.gradientExpression(),evaluationKey:"lineProgress",resolution:Hn,image:Ki.gradient||void 0,clips:He.lineClipsArray}),Ki.texture?Ki.texture.update(Ki.gradient):Ki.texture=new ut(Me,Ki.gradient,Se.RGBA),Ki.version=D.gradientVersion,tn=Ki.texture}Me.activeTexture.set(Se.TEXTURE0),tn.bind(D.stepInterpolant?Se.NEAREST:Se.LINEAR,Se.CLAMP_TO_EDGE)}let pn;if(U){const[Ki]=E.getStencilConfigForOverlapAndUpdateStencilID(z);pn=Ki[Xe.overscaledZ]}else pn=E.stencilModeForClipping(Xe);it.draw(Me,Se.TRIANGLES,Q,pn,se,Ei.disabled,ln,ai,vi,D.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,D.paint,E.transform.zoom,gt,He.layoutVertexBuffer2),Oe=!1}}(t,s,f,m,b):u.c3(f)?function(E,I,D,z,F){const U=D.paint.get("fill-color"),N=D.paint.get("fill-opacity");if(N.constantOr(1)===0)return;const{isRenderingToTexture:Y}=F,Q=E.colorModeForRenderPass(),se=D.paint.get("fill-pattern"),ae=E.opaquePassEnabledForLayer()&&!se.constantOr(1)&&U.constantOr(u.b7.transparent).a===1&&N.constantOr(0)===1?"opaque":"translucent";if(E.renderPass===ae){const ce=E.getDepthModeForSublayer(1,E.renderPass==="opaque"?gi.ReadWrite:gi.ReadOnly);jl(E,I,D,z,ce,Q,!1,Y)}if(E.renderPass==="translucent"&&D.paint.get("fill-antialias")){const ce=E.getDepthModeForSublayer(D.getPaintProperty("fill-outline-color")?2:0,gi.ReadOnly);jl(E,I,D,z,ce,Q,!0,Y)}}(t,s,f,m,b):u.c4(f)?function(E,I,D,z,F){const U=D.paint.get("fill-extrusion-opacity");if(U===0)return;const{isRenderingToTexture:N}=F;if(E.renderPass==="translucent"){const Y=new gi(E.context.gl.LEQUAL,gi.ReadWrite,E.depthRangeFor3D);if(U!==1||D.paint.get("fill-extrusion-pattern").constantOr(1))Vl(E,I,D,z,Y,Oi.disabled,sn.disabled,N),Vl(E,I,D,z,Y,E.stencilModeFor3D(),E.colorModeForRenderPass(),N);else{const Q=E.colorModeForRenderPass();Vl(E,I,D,z,Y,Oi.disabled,Q,N)}}}(t,s,f,m,b):u.c5(f)?function(E,I,D,z,F){if(E.renderPass!=="offscreen"&&E.renderPass!=="translucent")return;const{isRenderingToTexture:U}=F,N=E.context,Y=E.style.projection.useSubdivision,Q=E.getDepthModeForSublayer(0,gi.ReadOnly),se=E.colorModeForRenderPass();if(E.renderPass==="offscreen")(function(ae,ce,he,me,ge,ye,Me){const Se=ae.context,Le=Se.gl;for(const Oe of he){const Xe=ce.getTile(Oe),We=Xe.dem;if(!We||!We.data||!Xe.needsHillshadePrepare)continue;const He=We.dim,gt=We.stride,mt=We.getPixels();if(Se.activeTexture.set(Le.TEXTURE1),Se.pixelStoreUnpackPremultiplyAlpha.set(!1),Xe.demTexture=Xe.demTexture||ae.getTileTexture(gt),Xe.demTexture){const Lt=Xe.demTexture;Lt.update(mt,{premultiply:!1}),Lt.bind(Le.NEAREST,Le.CLAMP_TO_EDGE)}else Xe.demTexture=new ut(Se,mt,Le.RGBA,{premultiply:!1}),Xe.demTexture.bind(Le.NEAREST,Le.CLAMP_TO_EDGE);Se.activeTexture.set(Le.TEXTURE0);let it=Xe.fbo;if(!it){const Lt=new ut(Se,{width:He,height:He,data:null},Le.RGBA);Lt.bind(Le.LINEAR,Le.CLAMP_TO_EDGE),it=Xe.fbo=Se.createFramebuffer(He,He,!0,!1),it.colorAttachment.set(Lt.texture)}Se.bindFramebuffer.set(it.framebuffer),Se.viewport.set([0,0,He,He]),ae.useProgram("hillshadePrepare").draw(Se,Le.TRIANGLES,ge,ye,Me,Ei.disabled,Rl(Xe.tileID,We),null,null,me.id,ae.rasterBoundsBuffer,ae.quadTriangleIndexBuffer,ae.rasterBoundsSegments),Xe.needsHillshadePrepare=!1}})(E,I,z,D,Q,Oi.disabled,se),N.viewport.set([0,0,E.width,E.height]);else if(E.renderPass==="translucent")if(Y){const[ae,ce,he]=E.stencilConfigForOverlapTwoPass(z);ra(E,I,D,he,ae,Q,se,!1,U),ra(E,I,D,he,ce,Q,se,!0,U)}else{const[ae,ce]=E.getStencilConfigForOverlapAndUpdateStencilID(z);ra(E,I,D,ce,ae,Q,se,!1,U)}}(t,s,f,m,b):u.c6(f)?function(E,I,D,z,F){if(E.renderPass!=="translucent"||D.paint.get("raster-opacity")===0||!z.length)return;const{isRenderingToTexture:U}=F,N=I.getSource(),Y=E.style.projection.useSubdivision;if(N instanceof Fa)Za(E,I,D,z,null,!1,!1,N.tileCoords,N.flippedWindingOrder,U);else if(Y){const[Q,se,ae]=E.stencilConfigForOverlapTwoPass(z);Za(E,I,D,ae,Q,!1,!0,Br,!1,U),Za(E,I,D,ae,se,!0,!0,Br,!1,U)}else{const[Q,se]=E.getStencilConfigForOverlapAndUpdateStencilID(z);Za(E,I,D,se,Q,!1,!0,Br,!1,U)}}(t,s,f,m,b):u.c7(f)?function(E,I,D,z,F){const U=D.paint.get("background-color"),N=D.paint.get("background-opacity");if(N===0)return;const{isRenderingToTexture:Y}=F,Q=E.context,se=Q.gl,ae=E.style.projection,ce=E.transform,he=ce.tileSize,me=D.paint.get("background-pattern");if(E.isPatternMissing(me))return;const ge=!me&&U.a===1&&N===1&&E.opaquePassEnabledForLayer()?"opaque":"translucent";if(E.renderPass!==ge)return;const ye=Oi.disabled,Me=E.getDepthModeForSublayer(0,ge==="opaque"?gi.ReadWrite:gi.ReadOnly),Se=E.colorModeForRenderPass(),Le=E.useProgram(me?"backgroundPattern":"background"),Oe=z||De(ce,{tileSize:he,terrain:E.style.map.terrain});me&&(Q.activeTexture.set(se.TEXTURE0),E.imageManager.bind(E.context));const Xe=D.getCrossfadeParameters();for(const We of Oe){const He=ce.getProjectionData({overscaledTileID:We,applyGlobeMatrix:!Y,applyTerrainMatrix:!0}),gt=me?wu(N,E,me,{tileID:We,tileSize:he},Xe):Uh(N,U),mt=E.style.map.terrain&&E.style.map.terrain.getTerrainData(We),it=ae.getMeshFromTileID(Q,We.canonical,!1,!0,"raster");Le.draw(Q,se.TRIANGLES,Me,ye,Se,Ei.backCCW,gt,mt,He,D.id,it.vertexBuffer,it.indexBuffer,it.segments)}}(t,0,f,m,b):u.c8(f)&&function(E,I,D,z){const{isRenderingGlobe:F}=z,U=E.context,N=D.implementation,Y=E.style.projection,Q=E.transform,se=Q.getProjectionDataForCustomLayer(F),ae={farZ:Q.farZ,nearZ:Q.nearZ,fov:Q.fov*Math.PI/180,modelViewProjectionMatrix:Q.modelViewProjectionMatrix,projectionMatrix:Q.projectionMatrix,shaderData:{variantName:Y.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${Y.shaderPreludeCode.vertexSource}`,define:Y.shaderDefine},defaultProjectionData:se},ce=N.renderingMode?N.renderingMode:"2d";if(E.renderPass==="offscreen"){const he=N.prerender;he&&(E.setCustomLayerDefaults(),U.setColorMode(E.colorModeForRenderPass()),he.call(N,U.gl,ae),U.setDirty(),E.setBaseState())}else if(E.renderPass==="translucent"){E.setCustomLayerDefaults(),U.setColorMode(E.colorModeForRenderPass()),U.setStencilMode(Oi.disabled);const he=ce==="3d"?E.getDepthModeFor3D():E.getDepthModeForSublayer(0,gi.ReadOnly);U.setDepthMode(he),N.render(U.gl,ae),U.setDirty(),E.setBaseState(),U.bindFramebuffer.set(null)}}(t,0,f,b))}saveTileTexture(t){const s=this._tileTextures[t.size[0]];s?s.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const s=this.imageManager.getPattern(t.from.toString()),f=this.imageManager.getPattern(t.to.toString());return!s||!f}useProgram(t,s,f=!1){this.cache=this.cache||{};const m=!!this.style.map.terrain,b=this.style.projection,E=t+(s?s.cacheKey:"")+`/${f?Il:b.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(m?"/terrain":"");return this.cache[E]||(this.cache[E]=new yu(this.context,Qn[t],s,jh[t],this._showOverdrawInspector,m,f?Qn.projectionMercator:b.shaderPreludeCode,f?ma:b.shaderDefine)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ut(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:s}=this.context.gl;return this.width!==t||this.height!==s}}function Xh(y,t){let s,f=!1,m=null,b=null;const E=()=>{m=null,f&&(y.apply(b,s),m=setTimeout(E,t),f=!1)};return(...I)=>(f=!0,b=this,s=I,m||E(),m)}class Kh{constructor(t){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let f;return s.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(f=m)}),(f&&f[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(!this._isValidHash(s))return!1;const f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:f,pitch:+(s[4]||0)}),!0},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,s)},this._removeHash=()=>{const s=this._getCurrentHash();if(s.length===0)return;const f=s.join("/");let m=f;m.split("&").length>0&&(m=m.split("&")[0]),this._hashName&&(m=`${this._hashName}=${f}`);let b=window.location.hash.replace(m,"");b.startsWith("#&")?b=b.slice(0,1)+b.slice(2):b==="#"&&(b="");let E=window.location.href.replace(/(#.+)?$/,b);E=E.replace("&&","&"),window.history.replaceState(window.history.state,null,E)},this._updateHash=Xh(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const s=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,m=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,m),E=Math.round(s.lng*b)/b,I=Math.round(s.lat*b)/b,D=this._map.getBearing(),z=this._map.getPitch();let F="";if(F+=t?`/${E}/${I}/${f}`:`${f}/${I}/${E}`,(D||z)&&(F+="/"+Math.round(10*D)/10),z&&(F+=`/${Math.round(z)}`),this._hashName){const U=this._hashName;let N=!1;const Y=window.location.hash.slice(1).split("&").map(Q=>{const se=Q.split("=")[0];return se===U?(N=!0,`${se}=${F}`):Q}).filter(Q=>Q);return N||Y.push(`${U}=${F}`),`#${Y.join("&")}`}return`#${F}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new u.Q(+t[2],+t[1])}catch{return!1}const s=+t[0],f=+(t[3]||0),m=+(t[4]||0);return s>=this._map.getMinZoom()&&s<=this._map.getMaxZoom()&&f>=-180&&f<=180&&m>=this._map.getMinPitch()&&m<=this._map.getMaxPitch()}}const Os={linearity:.3,easing:u.c9(0,0,.3,1)},us=u.e({deceleration:2500,maxSpeed:1400},Os),Qd=u.e({deceleration:20,maxSpeed:1400},Os),zc=u.e({deceleration:1e3,maxSpeed:360},Os),Wh=u.e({deceleration:1e3,maxSpeed:90},Os),$o=u.e({deceleration:1e3,maxSpeed:360},Os);class Bs{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ne.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=ne.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,roll:0,pan:new u.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)s.zoom+=b.zoomDelta||0,s.bearing+=b.bearingDelta||0,s.pitch+=b.pitchDelta||0,s.roll+=b.rollDelta||0,b.panDelta&&s.pan._add(b.panDelta),b.around&&(s.around=b.around),b.pinchAround&&(s.pinchAround=b.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(s.pan.mag()){const b=ba(s.pan.mag(),f,u.e({},us,t||{})),E=s.pan.mult(b.amount/s.pan.mag()),I=this._map.cameraHelper.handlePanInertia(E,this._map.transform);m.center=I.easingCenter,m.offset=I.easingOffset,Pa(m,b)}if(s.zoom){const b=ba(s.zoom,f,Qd);m.zoom=this._map.transform.zoom+b.amount,Pa(m,b)}if(s.bearing){const b=ba(s.bearing,f,zc);m.bearing=this._map.transform.bearing+u.ae(b.amount,-179,179),Pa(m,b)}if(s.pitch){const b=ba(s.pitch,f,Wh);m.pitch=this._map.transform.pitch+b.amount,Pa(m,b)}if(s.roll){const b=ba(s.roll,f,$o);m.roll=this._map.transform.roll+u.ae(b.amount,-179,179),Pa(m,b)}if(m.zoom||m.bearing){const b=s.pinchAround===void 0?s.around:s.pinchAround;m.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),u.e(m,{noMoveStart:!0})}}function Pa(y,t){(!y.duration||y.duration<t.duration)&&(y.duration=t.duration,y.easing=t.easing)}function ba(y,t,s){const{maxSpeed:f,linearity:m,deceleration:b}=s,E=u.ae(y*m/(t/1e3),-f,f),I=Math.abs(E)/(b*m);return{easing:s.easing,duration:1e3*I,amount:E*(I/2)}}class Pr extends u.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,f,m={}){f=f instanceof MouseEvent?f:new MouseEvent(t,f);const b=K.mousePos(s.getCanvas(),f),E=s.unproject(b);super(t,u.e({point:b,lngLat:E,originalEvent:f},m)),this._defaultPrevented=!1,this.target=s}}class Ho extends u.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,f){const m=t==="touchend"?f.changedTouches:f.touches,b=K.touchPos(s.getCanvasContainer(),m),E=b.map(D=>s.unproject(D)),I=b.reduce((D,z,F,U)=>D.add(z.div(U.length)),new u.P(0,0));super(t,{points:b,point:I,lngLats:E,lngLat:s.unproject(I),originalEvent:f}),this._defaultPrevented=!1}}class Kr extends u.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,f){super(t,{originalEvent:f}),this._defaultPrevented=!1}}class za{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Kr(t.type,this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new Pr(t.type,this._map,t))}mouseup(t){this._map.fire(new Pr(t.type,this._map,t))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new Pr(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Pr(t.type,this._map,t))}mouseover(t){this._map.fire(new Pr(t.type,this._map,t))}mouseout(t){this._map.fire(new Pr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Ho(t.type,this._map,t))}touchmove(t){this._map.fire(new Ho(t.type,this._map,t))}touchend(t){this._map.fire(new Ho(t.type,this._map,t))}touchcancel(t){this._map.fire(new Ho(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Yo{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Pr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Pr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Pr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class an{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(u.P.convert(t),this._map.terrain)}}class Ls{constructor(t,s){this._map=t,this._tr=new an(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(K.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const f=s;if(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=f,this._box||(this._box=K.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const b=Math.min(m.x,f.x),E=Math.max(m.x,f.x),I=Math.min(m.y,f.y),D=Math.max(m.y,f.y);K.setTransform(this._box,`translate(${b}px,${I}px)`),this._box.style.width=E-b+"px",this._box.style.height=D-I+"px"}mouseupWindow(t,s){if(!this._active||t.button!==0)return;const f=this._startPos,m=s;if(this.reset(),K.suppressClick(),f.x!==m.x||f.y!==m.y)return this._map.fire(new u.l("boxzoomend",{originalEvent:t})),{cameraAnimation:b=>b.fitScreenCoordinates(f,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(K.remove(this._box),this._box=null),K.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new u.l(t,{originalEvent:s}))}}function Qh(y,t){if(y.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${t.length}`);const s={};for(let f=0;f<y.length;f++)s[y[f].identifier]=t[f];return s}class Im{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,s,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),f.length===this.numTouches&&(this.centroid=function(m){const b=new u.P(0,0);for(const E of m)b._add(E);return b.div(m.length)}(s),this.touches=Qh(f,s)))}touchmove(t,s,f){if(this.aborted||!this.centroid)return;const m=Qh(f,s);for(const b in this.touches){const E=m[b];(!E||E.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(t,s,f){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Jd{constructor(t){this.singleTap=new Im(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,s,f){this.singleTap.touchstart(t,s,f)}touchmove(t,s,f){this.singleTap.touchmove(t,s,f)}touchend(t,s,f){const m=this.singleTap.touchend(t,s,f);if(m){const b=t.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(m)<30;if(b&&E||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class Cm{constructor(t){this._tr=new an(t),this._zoomIn=new Jd({numTouches:1,numTaps:2}),this._zoomOut=new Jd({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,f){this._zoomIn.touchstart(t,s,f),this._zoomOut.touchstart(t,s,f)}touchmove(t,s,f){this._zoomIn.touchmove(t,s,f),this._zoomOut.touchmove(t,s,f)}touchend(t,s,f){const m=this._zoomIn.touchend(t,s,f),b=this._zoomOut.touchend(t,s,f),E=this._tr;return m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:E.zoom+1,around:E.unproject(m)},{originalEvent:t})}):b?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:E.zoom-1,around:E.unproject(b)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class jn{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const s=this._moveFunction(...t);if(s.bearingDelta||s.pitchDelta||s.rollDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(t,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(s)?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,s){if(!this.isEnabled())return;const f=this._lastPoint;if(!f)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const m=Array.isArray(s)?s[0]:s;return!this._moved&&m.dist(f)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(f,m))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&K.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Zl={0:1,2:2};class Lr{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const s=K.mouseButton(t);this._eventButton=s}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(s,f){const m=Zl[f];return s.buttons===void 0||(s.buttons&m)!==m}(t,this._eventButton)}isValidEndEvent(t){return K.mouseButton(t)===this._eventButton}}class Rt{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class Jh{constructor(t=new Lr({checkCorrectEvent:()=>!0}),s=new Rt){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=s}_executeRelevantHandler(t,s,f){return t instanceof MouseEvent?s(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?f(t):void 0}startMove(t){this._executeRelevantHandler(t,s=>this.mouseMoveStateManager.startMove(s),s=>this.oneFingerTouchMoveStateManager.startMove(s))}endMove(t){this._executeRelevantHandler(t,s=>this.mouseMoveStateManager.endMove(s),s=>this.oneFingerTouchMoveStateManager.endMove(s))}isValidStartEvent(t){return this._executeRelevantHandler(t,s=>this.mouseMoveStateManager.isValidStartEvent(s),s=>this.oneFingerTouchMoveStateManager.isValidStartEvent(s))}isValidMoveEvent(t){return this._executeRelevantHandler(t,s=>this.mouseMoveStateManager.isValidMoveEvent(s),s=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(s))}isValidEndEvent(t){return this._executeRelevantHandler(t,s=>this.mouseMoveStateManager.isValidEndEvent(s),s=>this.oneFingerTouchMoveStateManager.isValidEndEvent(s))}}const hs=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=t=>{t.preventDefault()}};class Gl{constructor(t,s){this._clickTolerance=t.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new u.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,s,f){return this._calculateTransform(t,s,f)}touchmove(t,s,f){if(this._active){if(!this._shouldBePrevented(f.length))return t.preventDefault(),this._calculateTransform(t,s,f);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,s,f){this._calculateTransform(t,s,f),this._active&&this._shouldBePrevented(f.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,f){f.length>0&&(this._active=!0);const m=Qh(f,s),b=new u.P(0,0),E=new u.P(0,0);let I=0;for(const z in m){const F=m[z],U=this._touches[z];U&&(b._add(F),E._add(F.sub(U)),I++,m[z]=F)}if(this._touches=m,this._shouldBePrevented(I)||!E.mag())return;const D=E.div(I);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(I),panDelta:D}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ql{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,s,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,f){if(!this._firstTwoTouches)return;t.preventDefault();const[m,b]=this._firstTwoTouches,E=bo(f,s,m),I=bo(f,s,b);if(!E||!I)return;const D=this._aroundCenter?null:E.add(I).div(2);return this._move([E,I],D,t)}touchend(t,s,f){if(!this._firstTwoTouches)return;const[m,b]=this._firstTwoTouches,E=bo(f,s,m),I=bo(f,s,b);E&&I||(this._active&&K.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function bo(y,t,s){for(let f=0;f<y.length;f++)if(y[f].identifier===s)return t[f]}function ef(y,t){return Math.log(y/t)/Math.LN2}class Mi extends ql{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const f=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(ef(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ef(this._distance,f),pinchAround:s}}}function Fs(y,t){return 180*y.angleWith(t)/Math.PI}class ed extends ql{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s,f){const m=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Fs(this._vector,m),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,f=Fs(t,this._startVector);return Math.abs(f)<s}}function Xo(y){return Math.abs(y.y)>Math.abs(y.x)}class tf extends ql{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,s,f){super.touchstart(t,s,f),this._currentTouchCount=f.length}_start(t){this._lastPoints=t,Xo(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,f){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=t[0].sub(this._lastPoints[0]),b=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,b,f.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(m.y+b.y)/2*-.5}):void 0}gestureBeginsVertically(t,s,f){if(this._valid!==void 0)return this._valid;const m=t.mag()>=2,b=s.mag()>=2;if(!m&&!b)return;if(!m||!b)return this._firstMove===void 0&&(this._firstMove=f),f-this._firstMove<100&&void 0;const E=t.y>0==s.y>0;return Xo(t)&&Xo(s)&&E}}const Pu={panStep:100,bearingStep:15,pitchStep:10};class td{constructor(t){this._tr=new an(t);const s=Pu;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,f=0,m=0,b=0,E=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?f=-1:(t.preventDefault(),b=-1);break;case 39:t.shiftKey?f=1:(t.preventDefault(),b=1);break;case 38:t.shiftKey?m=1:(t.preventDefault(),E=-1);break;case 40:t.shiftKey?m=-1:(t.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(f=0,m=0),{cameraAnimation:I=>{const D=this._tr;I.easeTo({duration:300,easeId:"keyboardHandler",easing:kc,zoom:s?Math.round(D.zoom)+s*(t.shiftKey?2:1):D.zoom,bearing:D.bearing+f*this._bearingStep,pitch:D.pitch+m*this._pitchStep,offset:[-b*this._panStep,-E*this._panStep],center:D.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function kc(y){return y*(2-y)}const zu=4.000244140625;class nf{constructor(t,s){this._onTimeout=f=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(f)},this._map=t,this._tr=new an(t),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const f=ne.now(),m=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,s!==0&&s%zu==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(m*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=K.mousePos(this._map.getCanvas(),t),f=this._tr;this._aroundPoint=this._aroundCenter?f.transform.locationToScreenPoint(u.Q.convert(f.center)):s,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const I=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=I),typeof this._targetZoom=="number"&&(this._targetZoom+=I)}if(this._delta!==0){const I=this._type==="wheel"&&Math.abs(this._delta)>zu?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&D!==0&&(D=1/D);const z=typeof this._targetZoom!="number"?t.scale:u.aI(this._targetZoom);this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,u.ab(z*D))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,f=this._startZoom,m=this._easing;let b,E=!1;if(this._type==="wheel"&&f&&m){const I=ne.now()-this._lastWheelEventTime,D=Math.min((I+5)/200,1),z=m(D);b=u.B.number(f,s,z),D<1?this._frameId||(this._frameId=!0):E=!0}else b=s,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=b,{noInertia:!0,needsRenderFrame:!E,zoomDelta:b-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=u.cb;if(this._prevEase){const f=this._prevEase,m=(ne.now()-f.start)/f.duration,b=f.easing(m+.01)-f.easing(m),E=.27/Math.sqrt(b*b+1e-4)*.01,I=Math.sqrt(.0729-E*E);s=u.c9(E,I,.25,1)}return this._prevEase={start:ne.now(),duration:t,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Oc{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ap{constructor(t){this._tr=new an(t),this.reset()}reset(){this._active=!1}dblclick(t,s){return t.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ku{constructor(){this._tap=new Jd({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,s,f){if(!this._swipePoint)if(this._tapTime){const m=s[0],b=t.timeStamp-this._tapTime<500,E=this._tapPoint.dist(m)<30;b&&E?f.length>0&&(this._swipePoint=m,this._swipeTouch=f[0].identifier):this.reset()}else this._tap.touchstart(t,s,f)}touchmove(t,s,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const m=s[0],b=m.y-this._swipePoint.y;return this._swipePoint=m,t.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(t,s,f)}touchend(t,s,f){if(this._tapTime)this._swipePoint&&f.length===0&&this.reset();else{const m=this._tap.touchend(t,s,f);m&&(this._tapTime=t.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ns{constructor(t,s,f){this._el=t,this._mousePan=s,this._touchPan=f}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class fn{constructor(t,s,f,m){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=s,this._mousePitch=f,this._mouseRoll=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Ga{constructor(t,s,f,m){this._el=t,this._touchZoom=s,this._touchRotate=f,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Bc{constructor(t,s){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=s,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=K.create("div","maplibregl-cooperative-gesture-screen",t);let s=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(s=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const f=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=s,this._container.appendChild(m);const b=document.createElement("div");b.className="maplibregl-mobile-message",b.textContent=f,this._container.appendChild(b),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(K.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,s){this._enabled&&(this._map.fire(new u.l("cooperativegestureprevented",{gestureType:t,originalEvent:s})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const $l=y=>y.zoom||y.drag||y.roll||y.pitch||y.rotate;class xo extends u.l{}function ds(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta||y.rollDelta}class Ou{constructor(t,s){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,b)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const E=m.type==="renderFrame"?void 0:m,I={needsRenderFrame:!1},D={},z={};for(const{handlerName:N,handler:Y,allowed:Q}of this._handlers){if(!Y.isEnabled())continue;let se;if(this._blockedByActive(z,Q,N))Y.reset();else if(Y[b||m.type]){if(u.cc(m,b||m.type)){const ae=K.mousePos(this._map.getCanvas(),m);se=Y[b||m.type](m,ae)}else if(u.cd(m,b||m.type)){const ae=this._getMapTouches(m.touches),ce=K.touchPos(this._map.getCanvas(),ae);se=Y[b||m.type](m,ce,ae)}else u.ce(b||m.type)||(se=Y[b||m.type](m));this.mergeHandlerResult(I,D,se,N,E),se&&se.needsRenderFrame&&this._triggerRenderFrame()}(se||Y.isActive())&&(z[N]=Y)}const F={};for(const N in this._previousActiveHandlers)z[N]||(F[N]=E);this._previousActiveHandlers=z,(Object.keys(F).length||ds(I))&&(this._changes.push([I,D,F]),this._triggerRenderFrame()),(Object.keys(z).length||ds(I))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=I;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Bs(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,b,E]of this._listeners)K.addEventListener(m,b,m===document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[t,s,f]of this._listeners)K.removeEventListener(t,s,t===document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(t){const s=this._map,f=s.getCanvasContainer();this._add("mapEvent",new za(s,t));const m=s.boxZoom=new Ls(s,t);this._add("boxZoom",m),t.interactive&&t.boxZoom&&m.enable();const b=s.cooperativeGestures=new Bc(s,t.cooperativeGestures);this._add("cooperativeGestures",b),t.cooperativeGestures&&b.enable();const E=new Cm(s),I=new ap(s);s.doubleClickZoom=new Oc(I,E),this._add("tapZoom",E),this._add("clickZoom",I),t.interactive&&t.doubleClickZoom&&s.doubleClickZoom.enable();const D=new ku;this._add("tapDragZoom",D);const z=s.touchPitch=new tf(s);this._add("touchPitch",z),t.interactive&&t.touchPitch&&s.touchPitch.enable(t.touchPitch);const F=()=>s.project(s.getCenter()),U=function({enable:ge,clickTolerance:ye,aroundCenter:Me=!0,minPixelCenterThreshold:Se=100,rotateDegreesPerPixelMoved:Le=.8},Oe){const Xe=new Lr({checkCorrectEvent:We=>K.mouseButton(We)===0&&We.ctrlKey||K.mouseButton(We)===2&&!We.ctrlKey});return new jn({clickTolerance:ye,move:(We,He)=>{const gt=Oe();if(Me&&Math.abs(gt.y-We.y)>Se)return{bearingDelta:u.ca(new u.P(We.x,He.y),He,gt)};let mt=(He.x-We.x)*Le;return Me&&He.y<gt.y&&(mt=-mt),{bearingDelta:mt}},moveStateManager:Xe,enable:ge,assignEvents:hs})}(t,F),N=function({enable:ge,clickTolerance:ye,pitchDegreesPerPixelMoved:Me=-.5}){const Se=new Lr({checkCorrectEvent:Le=>K.mouseButton(Le)===0&&Le.ctrlKey||K.mouseButton(Le)===2});return new jn({clickTolerance:ye,move:(Le,Oe)=>({pitchDelta:(Oe.y-Le.y)*Me}),moveStateManager:Se,enable:ge,assignEvents:hs})}(t),Y=function({enable:ge,clickTolerance:ye,rollDegreesPerPixelMoved:Me=.3},Se){const Le=new Lr({checkCorrectEvent:Oe=>K.mouseButton(Oe)===2&&Oe.ctrlKey});return new jn({clickTolerance:ye,move:(Oe,Xe)=>{const We=Se();let He=(Xe.x-Oe.x)*Me;return Xe.y<We.y&&(He=-He),{rollDelta:He}},moveStateManager:Le,enable:ge,assignEvents:hs})}(t,F);s.dragRotate=new fn(t,U,N,Y),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",N,["mouseRotate","mouseRoll"]),this._add("mouseRoll",Y,["mousePitch"]),t.interactive&&t.dragRotate&&s.dragRotate.enable();const Q=function({enable:ge,clickTolerance:ye}){const Me=new Lr({checkCorrectEvent:Se=>K.mouseButton(Se)===0&&!Se.ctrlKey});return new jn({clickTolerance:ye,move:(Se,Le)=>({around:Le,panDelta:Le.sub(Se)}),activateOnStart:!0,moveStateManager:Me,enable:ge,assignEvents:hs})}(t),se=new Gl(t,s);s.dragPan=new Ns(f,Q,se),this._add("mousePan",Q),this._add("touchPan",se,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&s.dragPan.enable(t.dragPan);const ae=new ed,ce=new Mi;s.touchZoomRotate=new Ga(f,ce,ae,D),this._add("touchRotate",ae,["touchPan","touchZoom"]),this._add("touchZoom",ce,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&s.touchZoomRotate.enable(t.touchZoomRotate);const he=s.scrollZoom=new nf(s,()=>this._triggerRenderFrame());this._add("scrollZoom",he,["mousePan"]),t.interactive&&t.scrollZoom&&s.scrollZoom.enable(t.scrollZoom);const me=s.keyboard=new td(s);this._add("keyboard",me),t.interactive&&t.keyboard&&s.keyboard.enable(),this._add("blockableMapEvent",new Yo(s))}_add(t,s,f){this._handlers.push({handlerName:t,handler:s,allowed:f}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!$l(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,s,f){for(const m in t)if(m!==f&&(!s||s.indexOf(m)<0))return!0;return!1}_getMapTouches(t){const s=[];for(const f of t)this._el.contains(f.target)&&s.push(f);return s}mergeHandlerResult(t,s,f,m,b){if(!f)return;u.e(t,f);const E={handlerName:m,originalEvent:f.originalEvent||b};f.zoomDelta!==void 0&&(s.zoom=E),f.panDelta!==void 0&&(s.drag=E),f.rollDelta!==void 0&&(s.roll=E),f.pitchDelta!==void 0&&(s.pitch=E),f.bearingDelta!==void 0&&(s.rotate=E)}_applyChanges(){const t={},s={},f={};for(const[m,b,E]of this._changes)m.panDelta&&(t.panDelta=(t.panDelta||new u.P(0,0))._add(m.panDelta)),m.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+m.pitchDelta),m.rollDelta&&(t.rollDelta=(t.rollDelta||0)+m.rollDelta),m.around!==void 0&&(t.around=m.around),m.pinchAround!==void 0&&(t.pinchAround=m.pinchAround),m.noInertia&&(t.noInertia=m.noInertia),u.e(s,b),u.e(f,E);this._updateMapTransform(t,s,f),this._changes=[]}_updateMapTransform(t,s,f){const m=this._map,b=m._getTransformForUpdate(),E=m.terrain;if(!(ds(t)||E&&this._terrainMovement))return this._fireEvents(s,f,!0);m._stop(!0);let{panDelta:I,zoomDelta:D,bearingDelta:z,pitchDelta:F,rollDelta:U,around:N,pinchAround:Y}=t;Y!==void 0&&(N=Y),N=N||m.transform.centerPoint,E&&!b.isPointOnMapSurface(N)&&(N=b.centerPoint);const Q={panDelta:I,zoomDelta:D,rollDelta:U,pitchDelta:F,bearingDelta:z,around:N};this._map.cameraHelper.useGlobeControls&&!b.isPointOnMapSurface(N)&&(N=b.centerPoint);const se=N.distSqr(b.centerPoint)<.01?b.center:b.screenPointToLocation(I?N.sub(I):N);E?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(Q,b),this._terrainMovement||!s.drag&&!s.zoom?s.drag&&this._terrainMovement?b.setCenter(b.screenPointToLocation(b.centerPoint.sub(I))):this._map.cameraHelper.handleMapControlsPan(Q,b,se):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(Q,b,se))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(Q,b),this._map.cameraHelper.handleMapControlsPan(Q,b,se)),m._applyUpdatedTransform(b),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,f,!0)}_fireEvents(t,s,f){const m=$l(this._eventsInProgress),b=$l(t),E={};for(const U in t){const{originalEvent:N}=t[U];this._eventsInProgress[U]||(E[`${U}start`]=N),this._eventsInProgress[U]=t[U]}!m&&b&&this._fireEvent("movestart",b.originalEvent);for(const U in E)this._fireEvent(U,E[U]);b&&this._fireEvent("move",b.originalEvent);for(const U in t){const{originalEvent:N}=t[U];this._fireEvent(U,N)}const I={};let D;for(const U in this._eventsInProgress){const{handlerName:N,originalEvent:Y}=this._eventsInProgress[U];this._handlersById[N].isActive()||(delete this._eventsInProgress[U],D=s[N]||Y,I[`${U}end`]=D)}for(const U in I)this._fireEvent(U,I[U]);const z=$l(this._eventsInProgress),F=(m||b)&&!z;if(F&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const U=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&U.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(U)}if(f&&F){this._updatingCamera=!0;const U=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=Y=>Y!==0&&-this._bearingSnap<Y&&Y<this._bearingSnap;!U||!U.essential&&ne.prefersReducedMotion?(this._map.fire(new u.l("moveend",{originalEvent:D})),N(this._map.getBearing())&&this._map.resetNorth()):(N(U.bearing||this._map.getBearing())&&(U.bearing=0),U.freezeElevation=!0,this._map.easeTo(U,{originalEvent:D})),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new u.l(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new xo("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class qa extends u.E{constructor(t,s,f){super(),this._renderFrameCallback=()=>{const m=Math.min((ne.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(m)),m<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=f.bearingSnap,this.cameraHelper=s,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(t,s){t.apply(this.transform),this.transform=t,this.cameraHelper=s}getCenter(){return new u.Q(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,s){return this.jumpTo({elevation:t},s),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,s,f){return t=u.P.convert(t).mult(-1),this.panTo(this.transform.center,u.e({offset:t},s),f)}panTo(t,s,f){return this.easeTo(u.e({center:t},s),f)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,f){return this.easeTo(u.e({zoom:t},s),f)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,s){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new u.l("movestart",s)).fire(new u.l("move",s)).fire(new u.l("moveend",s))),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,f){return this.easeTo(u.e({bearing:t},s),f)}resetNorth(t,s){return this.rotateTo(0,u.e({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(u.e({bearing:0,pitch:0,roll:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}getRoll(){return this.transform.roll}setRoll(t,s){return this.jumpTo({roll:t},s),this}cameraForBounds(t,s){t=Nn.convert(t).adjustAntiMeridian();const f=s&&s.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),f,s)}_cameraForBoxAndBearing(t,s,f,m){const b={top:0,bottom:0,right:0,left:0};if(typeof(m=u.e({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const z=m.padding;m.padding={top:z,bottom:z,right:z,left:z}}const E=u.e(b,m.padding);m.padding=E;const I=this.transform,D=new Nn(t,s);return this.cameraHelper.cameraForBoxAndBearing(m,E,D,f,I)}fitBounds(t,s,f){return this._fitInternal(this.cameraForBounds(t,s),s,f)}fitScreenCoordinates(t,s,f,m,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(u.P.convert(t)),this.transform.screenPointToLocation(u.P.convert(s)),f,m),m,b)}_fitInternal(t,s,f){return t?(delete(s=u.e(t,s)).padding,s.linear?this.easeTo(s,f):this.flyTo(s,f)):this}jumpTo(t,s){this.stop();const f=this._getTransformForUpdate();let m=!1,b=!1,E=!1;const I=f.zoom;this.cameraHelper.handleJumpToCenterZoom(f,t);const D=f.zoom!==I;return"elevation"in t&&f.elevation!==+t.elevation&&f.setElevation(+t.elevation),"bearing"in t&&f.bearing!==+t.bearing&&(m=!0,f.setBearing(+t.bearing)),"pitch"in t&&f.pitch!==+t.pitch&&(b=!0,f.setPitch(+t.pitch)),"roll"in t&&f.roll!==+t.roll&&(E=!0,f.setRoll(+t.roll)),t.padding==null||f.isPaddingEqual(t.padding)||f.setPadding(t.padding),this._applyUpdatedTransform(f),this.fire(new u.l("movestart",s)).fire(new u.l("move",s)),D&&this.fire(new u.l("zoomstart",s)).fire(new u.l("zoom",s)).fire(new u.l("zoomend",s)),m&&this.fire(new u.l("rotatestart",s)).fire(new u.l("rotate",s)).fire(new u.l("rotateend",s)),b&&this.fire(new u.l("pitchstart",s)).fire(new u.l("pitch",s)).fire(new u.l("pitchend",s)),E&&this.fire(new u.l("rollstart",s)).fire(new u.l("roll",s)).fire(new u.l("rollend",s)),this.fire(new u.l("moveend",s))}calculateCameraOptionsFromTo(t,s,f,m=0){const b=u.$.fromLngLat(t,s),E=u.$.fromLngLat(f,m),I=E.x-b.x,D=E.y-b.y,z=E.z-b.z,F=Math.hypot(I,D,z);if(F===0)throw new Error("Can't calculate camera options with same From and To");const U=Math.hypot(I,D),N=u.ab(this.transform.cameraToCenterDistance/F/this.transform.tileSize),Y=180*Math.atan2(I,-D)/Math.PI;let Q=180*Math.acos(U/F)/Math.PI;return Q=z<0?90-Q:90+Q,{center:E.toLngLat(),elevation:m,zoom:N,pitch:Q,bearing:Y}}calculateCameraOptionsFromCameraLngLatAltRotation(t,s,f,m,b){const E=this.transform.calculateCenterFromCameraLngLatAlt(t,s,f,m);return{center:E.center,elevation:E.elevation,zoom:E.zoom,bearing:f,pitch:m,roll:b}}easeTo(t,s){this._stop(!1,t.easeId),((t=u.e({offset:[0,0],duration:500,easing:u.cb},t)).animate===!1||!t.essential&&ne.prefersReducedMotion)&&(t.duration=0);const f=this._getTransformForUpdate(),m=this.getBearing(),b=f.pitch,E=f.roll,I="bearing"in t?this._normalizeBearing(t.bearing,m):m,D="pitch"in t?+t.pitch:b,z="roll"in t?this._normalizeBearing(t.roll,E):E,F="padding"in t?t.padding:f.padding,U=u.P.convert(t.offset);let N,Y;t.around&&(N=u.Q.convert(t.around),Y=f.locationToScreenPoint(N));const Q={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},se=this.cameraHelper.handleEaseTo(f,{bearing:I,pitch:D,roll:z,padding:F,around:N,aroundPoint:Y,offsetAsPoint:U,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||m!==I,this._pitching=this._pitching||D!==b,this._rolling=this._rolling||z!==E,this._padding=!f.isPaddingEqual(F),this._zooming=this._zooming||se.isZooming,this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,Q),this.terrain&&this._prepareElevation(se.elevationCenter),this._ease(ae=>{se.easeFunc(ae),this.terrain&&!t.freezeElevation&&this._updateElevation(ae),this._applyUpdatedTransform(f),this._fireMoveEvents(s)},ae=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(s,ae)},t),this}_prepareEase(t,s,f={}){this._moving=!0,s||f.moving||this.fire(new u.l("movestart",t)),this._zooming&&!f.zooming&&this.fire(new u.l("zoomstart",t)),this._rotating&&!f.rotating&&this.fire(new u.l("rotatestart",t)),this._pitching&&!f.pitching&&this.fire(new u.l("pitchstart",t)),this._rolling&&!f.rolling&&this.fire(new u.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&s!==this._elevationTarget){const f=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(f-(s-(f*t+this._elevationStart))/(1-t)),this._elevationTarget=s}this.transform.setElevation(u.B.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const s=t.getCameraLngLat(),f=t.getCameraAltitude(),m=this.terrain?this.terrain.getElevationForLngLatZoom(s,t.zoom):0;if(f<m){const b=this.calculateCameraOptionsFromTo(s,m,t.center,t.elevation);return{pitch:b.pitch,zoom:b.zoom}}return{}}_applyUpdatedTransform(t){const s=[];if(s.push(m=>this._elevateCameraIfInsideTerrain(m)),this.transformCameraUpdate&&s.push(m=>this.transformCameraUpdate(m)),!s.length)return;const f=t.clone();for(const m of s){const b=f.clone(),{center:E,zoom:I,roll:D,pitch:z,bearing:F,elevation:U}=m(b);E&&b.setCenter(E),U!==void 0&&b.setElevation(U),I!==void 0&&b.setZoom(I),D!==void 0&&b.setRoll(D),z!==void 0&&b.setPitch(z),F!==void 0&&b.setBearing(F),f.apply(b)}this.transform.apply(f)}_fireMoveEvents(t){this.fire(new u.l("move",t)),this._zooming&&this.fire(new u.l("zoom",t)),this._rotating&&this.fire(new u.l("rotate",t)),this._pitching&&this.fire(new u.l("pitch",t)),this._rolling&&this.fire(new u.l("roll",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const f=this._zooming,m=this._rotating,b=this._pitching,E=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,f&&this.fire(new u.l("zoomend",t)),m&&this.fire(new u.l("rotateend",t)),b&&this.fire(new u.l("pitchend",t)),E&&this.fire(new u.l("rollend",t)),this.fire(new u.l("moveend",t))}flyTo(t,s){if(!t.essential&&ne.prefersReducedMotion){const He=u.O(t,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(He,s)}this.stop(),t=u.e({offset:[0,0],speed:1.2,curve:1.42,easing:u.cb},t);const f=this._getTransformForUpdate(),m=f.bearing,b=f.pitch,E=f.roll,I=f.padding,D="bearing"in t?this._normalizeBearing(t.bearing,m):m,z="pitch"in t?+t.pitch:b,F="roll"in t?this._normalizeBearing(t.roll,E):E,U="padding"in t?t.padding:f.padding,N=u.P.convert(t.offset);let Y=f.centerPoint.add(N);const Q=f.screenPointToLocation(Y),se=this.cameraHelper.handleFlyTo(f,{bearing:D,pitch:z,roll:F,padding:U,locationAtOffset:Q,offsetAsPoint:N,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let ae=t.curve;const ce=Math.max(f.width,f.height),he=ce/se.scaleOfZoom,me=se.pixelPathLength;typeof se.scaleOfMinZoom=="number"&&(ae=Math.sqrt(ce/se.scaleOfMinZoom/me*2));const ge=ae*ae;function ye(He){const gt=(he*he-ce*ce+(He?-1:1)*ge*ge*me*me)/(2*(He?he:ce)*ge*me);return Math.log(Math.sqrt(gt*gt+1)-gt)}function Me(He){return(Math.exp(He)-Math.exp(-He))/2}function Se(He){return(Math.exp(He)+Math.exp(-He))/2}const Le=ye(!1);let Oe=function(He){return Se(Le)/Se(Le+ae*He)},Xe=function(He){return ce*((Se(Le)*(Me(gt=Le+ae*He)/Se(gt))-Me(Le))/ge)/me;var gt},We=(ye(!0)-Le)/ae;if(Math.abs(me)<2e-6||!isFinite(We)){if(Math.abs(ce-he)<1e-6)return this.easeTo(t,s);const He=he<ce?-1:1;We=Math.abs(Math.log(he/ce))/ae,Xe=()=>0,Oe=gt=>Math.exp(He*ae*gt)}return t.duration="duration"in t?+t.duration:1e3*We/("screenSpeed"in t?+t.screenSpeed/ae:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=m!==D,this._pitching=z!==b,this._rolling=F!==E,this._padding=!f.isPaddingEqual(U),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(se.targetCenter),this._ease(He=>{const gt=He*We,mt=1/Oe(gt),it=Xe(gt);this._rotating&&f.setBearing(u.B.number(m,D,He)),this._pitching&&f.setPitch(u.B.number(b,z,He)),this._rolling&&f.setRoll(u.B.number(E,F,He)),this._padding&&(f.interpolatePadding(I,U,He),Y=f.centerPoint.add(N)),se.easeFunc(He,mt,it,Y),this.terrain&&!t.freezeElevation&&this._updateElevation(He),this._applyUpdatedTransform(f),this._fireMoveEvents(s)},()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(s)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,s){var f;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,s)}return t||(f=this.handlers)===null||f===void 0||f.stop(!1),this}_ease(t,s,f){f.animate===!1||f.duration===0?(t(1),s()):(this._easeStart=ne.now(),this._easeOptions=f,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,s){t=u.aL(t,-180,180);const f=Math.abs(t-s);return Math.abs(t-360-s)<f&&(t-=360),Math.abs(t+360-s)<f&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLatZoom(u.Q.convert(t),this.transform.tileZoom):null}}const Hl={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Nt{constructor(t=Hl){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=K.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=K.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=K.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){K.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,s){const f=this._map._getUIString(`AttributionControl.${s}`);t.title=f,t.setAttribute("aria-label",f)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const s=this._map.style.sourceCaches;for(const m in s){const b=s[m];if(b.used||b.usedForTerrain){const E=b.getSource();E.attribution&&t.indexOf(E.attribution)<0&&t.push(E.attribution)}}t=t.filter(m=>String(m).trim()),t.sort((m,b)=>m.length-b.length),t=t.filter((m,b)=>{for(let E=b+1;E<t.length;E++)if(t[E].indexOf(m)>=0)return!1;return!0});const f=t.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,t.length?(this._innerContainer.innerHTML=K.sanitize(f),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class qt{constructor(t={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const f=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&f.classList.add("maplibregl-compact"):f.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=K.create("div","maplibregl-ctrl");const s=K.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){K.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Bu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,f=s?this._queue.concat(s):this._queue;for(const m of f)if(m.id===t)return void(m.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const f of s)if(!f.cancelled&&(f.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var id=u.aD([{name:"a_pos3d",type:"Int16",components:3}]);class Ko extends u.E{constructor(t){super(),this._lastTilesetChange=ne.now(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,s){this.sourceCache.update(t,s),this._renderableTilesKeys=[];const f={};for(const m of De(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))f[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.terrainRttPosMatrix32f=new Float64Array(16),u.bO(m.terrainRttPosMatrix32f,0,u.Z,u.Z,0,0,1),this._tiles[m.key]=new Wn(m,this.tileSize),this._lastTilesetChange=ne.now());for(const m in this._tiles)f[m]||delete this._tiles[m]}freeRtt(t){for(const s in this._tiles){const f=this._tiles[s];(!t||f.tileID.equals(t)||f.tileID.isChildOf(t)||t.isChildOf(f.tileID))&&(f.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,s){return s?this._getTerrainCoordsForTileRanges(t,s):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const s={};for(const f of this._renderableTilesKeys){const m=this._tiles[f].tileID,b=t.clone(),E=u.b2();if(m.canonical.equals(t.canonical))u.bO(E,0,u.Z,u.Z,0,0,1);else if(m.canonical.isChildOf(t.canonical)){const I=m.canonical.z-t.canonical.z,D=m.canonical.x-(m.canonical.x>>I<<I),z=m.canonical.y-(m.canonical.y>>I<<I),F=u.Z>>I;u.bO(E,0,F,F,0,0,1),u.L(E,E,[-D*F,-z*F,0])}else{if(!t.canonical.isChildOf(m.canonical))continue;{const I=t.canonical.z-m.canonical.z,D=t.canonical.x-(t.canonical.x>>I<<I),z=t.canonical.y-(t.canonical.y>>I<<I),F=u.Z>>I;u.bO(E,0,u.Z,u.Z,0,0,1),u.L(E,E,[D*F,z*F,0]),u.M(E,E,[1/2**I,1/2**I,0])}}b.terrainRttPosMatrix32f=new Float32Array(E),s[f]=b}return s}_getTerrainCoordsForTileRanges(t,s){const f={};for(const m of this._renderableTilesKeys){const b=this._tiles[m].tileID;if(!this._isWithinTileRanges(b,s))continue;const E=t.clone(),I=u.b2();if(b.canonical.z===t.canonical.z){const D=t.canonical.x-b.canonical.x,z=t.canonical.y-b.canonical.y;u.bO(I,0,u.Z,u.Z,0,0,1),u.L(I,I,[D*u.Z,z*u.Z,0])}else if(b.canonical.z>t.canonical.z){const D=b.canonical.z-t.canonical.z,z=b.canonical.x-(b.canonical.x>>D<<D),F=b.canonical.y-(b.canonical.y>>D<<D),U=t.canonical.x-(b.canonical.x>>D),N=t.canonical.y-(b.canonical.y>>D),Y=u.Z>>D;u.bO(I,0,Y,Y,0,0,1),u.L(I,I,[-z*Y+U*u.Z,-F*Y+N*u.Z,0])}else{const D=t.canonical.z-b.canonical.z,z=t.canonical.x-(t.canonical.x>>D<<D),F=t.canonical.y-(t.canonical.y>>D<<D),U=(t.canonical.x>>D)-b.canonical.x,N=(t.canonical.y>>D)-b.canonical.y,Y=u.Z<<D;u.bO(I,0,Y,Y,0,0,1),u.L(I,I,[z*u.Z+U*Y,F*u.Z+N*Y,0])}E.terrainRttPosMatrix32f=new Float32Array(I),f[m]=E}return f}getSourceTile(t,s){const f=this.sourceCache._source;let m=t.overscaledZ-this.deltaZoom;if(m>f.maxzoom&&(m=f.maxzoom),m<f.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(m).key);let b=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!b||!b.dem)&&s)for(;m>=f.minzoom&&(!b||!b.dem);)b=this.sourceCache.getTileByID(t.scaledTo(m--).key);return b}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,s){return s[t.canonical.z]&&t.canonical.x>=s[t.canonical.z].minTileX&&t.canonical.x<=s[t.canonical.z].maxTileX&&t.canonical.y>=s[t.canonical.z].minTileY&&t.canonical.y<=s[t.canonical.z].maxTileY}}class Fr{constructor(t,s,f){this._meshCache={},this.painter=t,this.sourceCache=new Ko(s),this.options=f,this.exaggeration=typeof f.exaggeration=="number"?f.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,s,f,m=u.Z){var b;if(!(s>=0&&s<m&&f>=0&&f<m))return 0;const E=this.getTerrainData(t),I=(b=E.tile)===null||b===void 0?void 0:b.dem;if(!I)return 0;const D=u.cf([],[s/m*u.Z,f/m*u.Z],E.u_terrain_matrix),z=[D[0]*I.dim,D[1]*I.dim],F=Math.floor(z[0]),U=Math.floor(z[1]),N=z[0]-F,Y=z[1]-U;return I.get(F,U)*(1-N)*(1-Y)+I.get(F+1,U)*N*(1-Y)+I.get(F,U+1)*(1-N)*Y+I.get(F+1,U+1)*N*Y}getElevationForLngLatZoom(t,s){if(!u.cg(s,t.wrap()))return 0;const{tileID:f,mercatorX:m,mercatorY:b}=this._getOverscaledTileIDFromLngLatZoom(t,s);return this.getElevation(f,m%u.Z,b%u.Z,u.Z)}getElevation(t,s,f,m=u.Z){return this.getDEMElevation(t,s,f,m)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const m=this.painter.context,b=new u.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ut(m,b,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ut(m,new u.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=u.at([])}const s=this.sourceCache.getSourceTile(t,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const m=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new ut(m,s.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),s.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const f=s&&s+s.tileID.key+t.key;if(f&&!this._demMatrixCache[f]){const m=this.sourceCache.sourceCache._source.maxzoom;let b=t.canonical.z-s.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=m?b=t.canonical.z-m:u.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const E=t.canonical.x-(t.canonical.x>>b<<b),I=t.canonical.y-(t.canonical.y>>b<<b),D=u.ch(new Float64Array(16),[1/(u.Z<<b),1/(u.Z<<b),0]);u.L(D,D,[E*u.Z,I*u.Z,0]),this._demMatrixCache[t.key]={matrix:D,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:f?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(t){const s=this.painter,f=s.width/devicePixelRatio,m=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===f&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ut(s.context,{width:f,height:m,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ut(s.context,{width:f,height:m,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(f,m,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,f,m))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let b=0,E=0;b<this._coordsTextureSize;b++)for(let I=0;I<this._coordsTextureSize;I++,E+=4)s[E+0]=255&I,s[E+1]=255&b,s[E+2]=I>>8<<4|b>>8,s[E+3]=0;const f=new u.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),m=new ut(t,f,t.gl.RGBA,{premultiply:!1});return m.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const s=new Uint8Array(4),f=this.painter.context,m=f.gl,b=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),E=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),I=Math.round(this.painter.height/devicePixelRatio);f.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(b,I-E-1,1,1,m.RGBA,m.UNSIGNED_BYTE,s),f.bindFramebuffer.set(null);const D=s[0]+(s[2]>>4<<8),z=s[1]+((15&s[2])<<8),F=this.coordsIndex[255-s[3]],U=F&&this.sourceCache.getTileByID(F);if(!U)return null;const N=this._coordsTextureSize,Y=(1<<U.tileID.canonical.z)*N;return new u.$((U.tileID.canonical.x*N+D)/Y+U.tileID.wrap,(U.tileID.canonical.y*N+z)/Y,this.getElevation(U.tileID,D,z,N))}depthAtPoint(t){const s=new Uint8Array(4),f=this.painter.context,m=f.gl;return f.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,s),f.bindFramebuffer.set(null),(s[0]/16777216+s[1]/65536+s[2]/256+s[3])/256}getTerrainMesh(t){var s;const f=((s=this.painter.style.projection)===null||s===void 0?void 0:s.transitionState)>0,m=f&&t.canonical.y===0,b=f&&t.canonical.y===(1<<t.canonical.z)-1,E=`m_${m?"n":""}_${b?"s":""}`;if(this._meshCache[E])return this._meshCache[E];const I=this.painter.context,D=new u.ci,z=new u.aH,F=this.meshSize,U=u.Z/F,N=F*F;for(let Se=0;Se<=F;Se++)for(let Le=0;Le<=F;Le++)D.emplaceBack(Le*U,Se*U,0);for(let Se=0;Se<N;Se+=F+1)for(let Le=0;Le<F;Le++)z.emplaceBack(Le+Se,F+Le+Se+1,F+Le+Se+2),z.emplaceBack(Le+Se,F+Le+Se+2,Le+Se+1);const Y=D.length,Q=Y+(F+1),se=(F+1)*F,ae=m?u.b9:0,ce=m?0:1,he=b?u.ba:u.Z,me=b?0:1;for(let Se=0;Se<=F;Se++)D.emplaceBack(Se*U,ae,ce);for(let Se=0;Se<=F;Se++)D.emplaceBack(Se*U,he,me);for(let Se=0;Se<F;Se++)z.emplaceBack(se+Se,Q+Se,Q+Se+1),z.emplaceBack(se+Se,Q+Se+1,se+Se+1),z.emplaceBack(0+Se,Y+Se+1,Y+Se),z.emplaceBack(0+Se,0+Se+1,Y+Se+1);const ge=D.length,ye=ge+2*(F+1);for(const Se of[0,1])for(let Le=0;Le<=F;Le++)for(const Oe of[0,1])D.emplaceBack(Se*u.Z,Le*U,Oe);for(let Se=0;Se<2*F;Se+=2)z.emplaceBack(ge+Se,ge+Se+1,ge+Se+3),z.emplaceBack(ge+Se,ge+Se+3,ge+Se+2),z.emplaceBack(ye+Se,ye+Se+3,ye+Se+1),z.emplaceBack(ye+Se,ye+Se+2,ye+Se+3);const Me=new Oo(I.createVertexBuffer(D,id.members),I.createIndexBuffer(z),u.aG.simpleSegment(0,0,D.length,z.length));return this._meshCache[E]=Me,Me}getMeshFrameDelta(t){return 2*Math.PI*u.br/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,s){var f;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(t,s);return(f=this.getMinMaxElevation(m).minElevation)!==null&&f!==void 0?f:0}getMinMaxElevation(t){const s=this.getTerrainData(t).tile,f={minElevation:null,maxElevation:null};return s&&s.dem&&(f.minElevation=s.dem.min*this.exaggeration,f.maxElevation=s.dem.max*this.exaggeration),f}_getOverscaledTileIDFromLngLatZoom(t,s){const f=u.$.fromLngLat(t.wrap()),m=(1<<s)*u.Z,b=f.x*m,E=f.y*m,I=Math.floor(b/u.Z),D=Math.floor(E/u.Z);return{tileID:new u.Y(s,0,s,I,D),mercatorX:b,mercatorY:E}}}class rf{constructor(t,s,f){this._context=t,this._size=s,this._tileSize=f,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),f=new ut(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return f.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(f.texture),{id:t,fbo:s,texture:f,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(s=>t.id!==s),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const Nr={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class af{constructor(t,s){this.painter=t,this.terrain=s,this.pool=new rf(t.context,30,s.sourceCache.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(f=>!t._layers[f].isHidden(s)),this._coordsAscending={};for(const f in t.sourceCaches){this._coordsAscending[f]={};const m=t.sourceCaches[f].getVisibleCoordinates(),b=t.sourceCaches[f].getSource(),E=b instanceof Fa?b.terrainTileRanges:null;for(const I of m){const D=this.terrain.sourceCache.getTerrainCoords(I,E);for(const z in D)this._coordsAscending[f][z]||(this._coordsAscending[f][z]=[]),this._coordsAscending[f][z].push(D[z])}}this._coordsAscendingStr={};for(const f of t._order){const m=t._layers[f],b=m.source;if(Nr[m.type]&&!this._coordsAscendingStr[b]){this._coordsAscendingStr[b]={};for(const E in this._coordsAscending[b])this._coordsAscendingStr[b][E]=this._coordsAscending[b][E].map(I=>I.key).sort().join()}}for(const f of this._renderableTiles)for(const m in this._coordsAscendingStr){const b=this._coordsAscendingStr[m][f.tileID.key];b&&b!==f.rttCoords[m]&&(f.rtt=[])}}renderLayer(t,s){if(t.isHidden(this.painter.transform.zoom))return!1;const f=Object.assign(Object.assign({},s),{isRenderingToTexture:!0}),m=t.type,b=this.painter,E=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Nr[m]&&(this._prevType&&Nr[this._prevType]||this._stacks.push([]),this._prevType=m,this._stacks[this._stacks.length-1].push(t.id),!E))return!0;if(Nr[this._prevType]||Nr[m]&&E){this._prevType=m;const I=this._stacks.length-1,D=this._stacks[I]||[];for(const z of this._renderableTiles){if(this.pool.isFull()&&(Ra(this.painter,this.terrain,this._rttTiles,f),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(z),z.rtt[I]){const U=this.pool.getObjectForId(z.rtt[I].id);if(U.stamp===z.rtt[I].stamp){this.pool.useObject(U);continue}}const F=this.pool.getOrCreateFreeObject();this.pool.useObject(F),this.pool.stampObject(F),z.rtt[I]={id:F.id,stamp:F.stamp},b.context.bindFramebuffer.set(F.fbo.framebuffer),b.context.clear({color:u.b7.transparent,stencil:0}),b.currentStencilSource=void 0;for(let U=0;U<D.length;U++){const N=b.style._layers[D[U]],Y=N.source?this._coordsAscending[N.source][z.tileID.key]:[z.tileID];b.context.viewport.set([0,0,F.fbo.width,F.fbo.height]),b._renderTileClippingMasks(N,Y,!0),b.renderLayer(b,b.style.sourceCaches[N.source],N,Y,f),N.source&&(z.rttCoords[N.source]=this._coordsAscendingStr[N.source][z.tileID.key])}}return Ra(this.painter,this.terrain,this._rttTiles,f),this._rttTiles=[],this.pool.freeAllObjects(),Nr[m]}return!1}}const $a={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ht=k,ni={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Hl,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:u.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},cr={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Wo{constructor(t,s,f=!1){this.mousedown=b=>{this.startMove(b,K.mousePos(this.element,b)),K.addEventListener(window,"mousemove",this.mousemove),K.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=b=>{this.move(b,K.mousePos(this.element,b))},this.mouseup=b=>{this._rotatePitchHanlder.dragEnd(b),this.offTemp()},this.touchstart=b=>{b.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=K.touchPos(this.element,b.targetTouches)[0],this.startMove(b,this._startPos),K.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),K.addEventListener(window,"touchend",this.touchend))},this.touchmove=b=>{b.targetTouches.length!==1?this.reset():(this._lastPos=K.touchPos(this.element,b.targetTouches)[0],this.move(b,this._lastPos))},this.touchend=b=>{b.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=s;const m=new Jh;this._rotatePitchHanlder=new jn({clickTolerance:3,move:(b,E)=>{const I=s.getBoundingClientRect(),D=new u.P((I.bottom-I.top)/2,(I.right-I.left)/2);return{bearingDelta:u.ca(new u.P(b.x,E.y),E,D),pitchDelta:f?-.5*(E.y-b.y):void 0}},moveStateManager:m,enable:!0,assignEvents:()=>{}}),this.map=t,K.addEventListener(s,"mousedown",this.mousedown),K.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),K.addEventListener(s,"touchcancel",this.reset)}startMove(t,s){this._rotatePitchHanlder.dragStart(t,s),K.disableDrag()}move(t,s){const f=this.map,{bearingDelta:m,pitchDelta:b}=this._rotatePitchHanlder.dragMove(t,s)||{};m&&f.setBearing(f.getBearing()+m),b&&f.setPitch(f.getPitch()+b)}off(){const t=this.element;K.removeEventListener(t,"mousedown",this.mousedown),K.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),K.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),K.removeEventListener(window,"touchend",this.touchend),K.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){K.enableDrag(),K.removeEventListener(window,"mousemove",this.mousemove),K.removeEventListener(window,"mouseup",this.mouseup),K.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),K.removeEventListener(window,"touchend",this.touchend)}}let aa;function Us(y,t,s){const f=new u.Q(y.lng,y.lat);if(y=new u.Q(y.lng,y.lat),t){const m=new u.Q(y.lng-360,y.lat),b=new u.Q(y.lng+360,y.lat),E=s.locationToScreenPoint(y).distSqr(t);s.locationToScreenPoint(m).distSqr(t)<E?y=m:s.locationToScreenPoint(b).distSqr(t)<E&&(y=b)}for(;Math.abs(y.lng-s.center.lng)>180;){const m=s.locationToScreenPoint(y);if(m.x>=0&&m.y>=0&&m.x<=s.width&&m.y<=s.height)break;y.lng>s.center.lng?y.lng-=360:y.lng+=360}return y.lng!==f.lng&&s.isPointOnMapSurface(s.locationToScreenPoint(y))?y:f}const Qo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Jo(y,t,s){const f=y.classList;for(const m in Qo)f.remove(`maplibregl-${s}-anchor-${m}`);f.add(`maplibregl-${s}-anchor-${t}`)}class Ha extends u.E{constructor(t){if(super(),this._onKeyPress=s=>{const f=s.code,m=s.charCode||s.keyCode;f!=="Space"&&f!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=s=>{const f=s.originalEvent.target,m=this._element;this._popup&&(f===m||m.contains(f))&&this.togglePopup()},this._update=s=>{var f;if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();((s==null?void 0:s.type)==="terrain"||(s==null?void 0:s.type)==="render"&&!m)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Us(this._lngLat,this._flatPos,this._map.transform):(f=this._lngLat)===null||f===void 0?void 0:f.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let b="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?b=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(b=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||s&&s.type!=="moveend"||(this._pos=this._pos.round()),K.setTransform(this._element,`${Qo[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${E} ${b}`),ne.frameAsync(new AbortController).then(()=>{this._updateOpacity(s&&s.type==="moveend")}).catch(()=>{})},this._onMove=s=>{if(!this._isDragging){const f=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=f}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new u.l("dragstart"))),this.fire(new u.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new u.l("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t==null?void 0:t.opacity,t==null?void 0:t.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=u.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=K.create("div");const s=K.createNS("http://www.w3.org/2000/svg","svg"),f=41,m=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${f}px`),s.setAttributeNS(null,"width",`${m}px`),s.setAttributeNS(null,"viewBox",`0 0 ${m} ${f}`);const b=K.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");const E=K.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill-rule","nonzero");const I=K.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"transform","translate(3.0, 29.0)"),I.setAttributeNS(null,"fill","#000000");const D=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ce of D){const he=K.createNS("http://www.w3.org/2000/svg","ellipse");he.setAttributeNS(null,"opacity","0.04"),he.setAttributeNS(null,"cx","10.5"),he.setAttributeNS(null,"cy","5.80029008"),he.setAttributeNS(null,"rx",ce.rx),he.setAttributeNS(null,"ry",ce.ry),I.appendChild(he)}const z=K.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill",this._color);const F=K.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),z.appendChild(F);const U=K.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"opacity","0.25"),U.setAttributeNS(null,"fill","#000000");const N=K.createNS("http://www.w3.org/2000/svg","path");N.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),U.appendChild(N);const Y=K.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Y.setAttributeNS(null,"fill","#FFFFFF");const Q=K.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"transform","translate(8.0, 8.0)");const se=K.createNS("http://www.w3.org/2000/svg","circle");se.setAttributeNS(null,"fill","#000000"),se.setAttributeNS(null,"opacity","0.25"),se.setAttributeNS(null,"cx","5.5"),se.setAttributeNS(null,"cy","5.5"),se.setAttributeNS(null,"r","5.4999962");const ae=K.createNS("http://www.w3.org/2000/svg","circle");ae.setAttributeNS(null,"fill","#FFFFFF"),ae.setAttributeNS(null,"cx","5.5"),ae.setAttributeNS(null,"cy","5.5"),ae.setAttributeNS(null,"r","5.4999962"),Q.appendChild(se),Q.appendChild(ae),E.appendChild(I),E.appendChild(z),E.appendChild(U),E.appendChild(Y),E.appendChild(Q),s.appendChild(E),s.setAttributeNS(null,"height",f*this._scale+"px"),s.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(s),this._offset=u.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",s=>{s.preventDefault()}),this._element.addEventListener("mousedown",s=>{s.preventDefault()}),Jo(this._element,this._anchor,"marker"),t&&t.className)for(const s of t.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),K.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=u.Q.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const m=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var s,f;if(!(!((s=this._map)===null||s===void 0)&&s.terrain)){const U=this._map.transform.isLocationOccluded(this._lngLat)?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==U&&(this._element.style.opacity=U))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const m=this._map,b=m.terrain.depthAtPoint(this._pos),E=m.terrain.getElevationForLngLatZoom(this._lngLat,m.transform.tileZoom);if(m.transform.lngLatToCameraDepth(this._lngLat,E)-b<.006)return void(this._element.style.opacity=this._opacity);const I=-this._offset.y/m.transform.pixelsPerMeter,D=Math.sin(m.getPitch()*Math.PI/180)*I,z=m.terrain.depthAtPoint(new u.P(this._pos.x,this._pos.y-this._offset.y)),F=m.transform.lngLatToCameraDepth(this._lngLat,E+D)-z>.006;!((f=this._popup)===null||f===void 0)&&f.isOpen()&&F&&this._popup.remove(),this._element.style.opacity=F?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=u.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,s){return(this._opacity===void 0||t===void 0&&s===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),s!==void 0&&(this._opacityWhenCovered=s),this._map&&this._updateOpacity(!0),this}}const sf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let bn=0,wo=!1;const Lu={maxWidth:100,unit:"metric"};function Fu(y,t,s){const f=s&&s.maxWidth||100,m=y._container.clientHeight/2,b=y._container.clientWidth/2,E=y.unproject([b-f/2,m]),I=y.unproject([b+f/2,m]),D=Math.round(y.project(I).x-y.project(E).x),z=Math.min(f,D,y._container.clientWidth),F=E.distanceTo(I);if(s&&s.unit==="imperial"){const U=3.2808*F;U>5280?el(t,z,U/5280,y._getUIString("ScaleControl.Miles")):el(t,z,U,y._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?el(t,z,F/1852,y._getUIString("ScaleControl.NauticalMiles")):F>=1e3?el(t,z,F/1e3,y._getUIString("ScaleControl.Kilometers")):el(t,z,F,y._getUIString("ScaleControl.Meters"))}function el(y,t,s,f){const m=function(b){const E=Math.pow(10,`${Math.floor(b)}`.length-1);let I=b/E;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(D){const z=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*z)/z}(I),E*I}(s);y.style.width=t*(m/s)+"px",y.innerHTML=`${m}&nbsp;${f}`}const of={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Nu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Yl(y){if(y){if(typeof y=="number"){const t=Math.round(Math.abs(y)/Math.SQRT2);return{center:new u.P(0,0),top:new u.P(0,y),"top-left":new u.P(t,t),"top-right":new u.P(-t,t),bottom:new u.P(0,-y),"bottom-left":new u.P(t,-t),"bottom-right":new u.P(-t,-t),left:new u.P(y,0),right:new u.P(-y,0)}}if(y instanceof u.P||Array.isArray(y)){const t=u.P.convert(y);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:u.P.convert(y.center||[0,0]),top:u.P.convert(y.top||[0,0]),"top-left":u.P.convert(y["top-left"]||[0,0]),"top-right":u.P.convert(y["top-right"]||[0,0]),bottom:u.P.convert(y.bottom||[0,0]),"bottom-left":u.P.convert(y["bottom-left"]||[0,0]),"bottom-right":u.P.convert(y["bottom-right"]||[0,0]),left:u.P.convert(y.left||[0,0]),right:u.P.convert(y.right||[0,0])}}return Yl(new u.P(0,0))}const Uu=k;S.AJAXError=u.cm,S.Event=u.l,S.Evented=u.E,S.LngLat=u.Q,S.MercatorCoordinate=u.$,S.Point=u.P,S.addProtocol=u.cn,S.config=u.a,S.removeProtocol=u.co,S.AttributionControl=Nt,S.BoxZoomHandler=Ls,S.CanvasSource=vc,S.CooperativeGesturesHandler=Bc,S.DoubleClickZoomHandler=Oc,S.DragPanHandler=Ns,S.DragRotateHandler=fn,S.EdgeInsets=Cn,S.FullscreenControl=class extends u.E{constructor(y={}){super(),this._onFullscreenChange=()=>{var t;let s=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=s==null?void 0:s.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)s=s.shadowRoot.fullscreenElement;s===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:u.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){K.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=K.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);K.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new u.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new u.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},S.GeoJSONSource=no,S.GeolocateControl=class extends u.E{constructor(y){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new u.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new u.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const s=new u.Q(t.coords.longitude,t.coords.latitude),f=t.coords.accuracy,m=this._map.getBearing(),b=u.e({bearing:m},this.options.fitBoundsOptions),E=Nn.fromLngLat(s,f);this._map.fitBounds(E,b,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const s=new u.Q(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&wo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new u.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=K.create("button","maplibregl-ctrl-geolocate",this._container),K.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){u.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=K.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ha({element:this._dotElement}),this._circleElement=K.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ha({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new u.l("trackuserlocationend")),this.fire(new u.l("userlocationlostfocus")))})}},this.options=u.e({},sf,y)}onAdd(y){return this._map=y,this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return u._(this,arguments,void 0,function*(t=!1){if(aa!==void 0&&!t)return aa;if(window.navigator.permissions===void 0)return aa=!!window.navigator.geolocation,aa;try{aa=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{aa=!!window.navigator.geolocation}return aa})}().then(t=>this._finishSetupUI(t)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),K.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,bn=0,wo=!1}_isOutOfMapMaxBounds(y){const t=this._map.getMaxBounds(),s=y.coords;return t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const y=this._map.getBounds(),t=y.getSouthEast(),s=y.getNorthEast(),f=t.distanceTo(s),m=Math.ceil(this._accuracy/(f/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return u.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":bn--,wo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new u.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.l("trackuserlocationstart")),this.fire(new u.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),bn++,bn>1?(y={maximumAge:6e5,timeout:0},wo=!0):(y=this.options.positionOptions,wo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},S.GlobeControl=class{constructor(){this._toggleProjection=()=>{var y;const t=(y=this._map.getProjection())===null||y===void 0?void 0:y.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var y;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((y=this._map.getProjection())===null||y===void 0?void 0:y.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(y){return this._map=y,this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=K.create("button","maplibregl-ctrl-globe",this._container),K.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){K.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},S.Hash=Kh,S.ImageSource=Fa,S.KeyboardHandler=td,S.LngLatBounds=Nn,S.LogoControl=qt,S.Map=class extends qa{constructor(y){var t,s;u.cj.mark(u.ck.create);const f=Object.assign(Object.assign(Object.assign({},ni),y),{canvasContextAttributes:Object.assign(Object.assign({},ni.canvasContextAttributes),y.canvasContextAttributes)});if(f.minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const m=new vn,b=new Jn;if(f.minZoom!==void 0&&m.setMinZoom(f.minZoom),f.maxZoom!==void 0&&m.setMaxZoom(f.maxZoom),f.minPitch!==void 0&&m.setMinPitch(f.minPitch),f.maxPitch!==void 0&&m.setMaxPitch(f.maxPitch),f.renderWorldCopies!==void 0&&m.setRenderWorldCopies(f.renderWorldCopies),super(m,b,{bearingSnap:f.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Bu,this._controls=[],this._mapId=u.a4(),this._contextLost=I=>{I.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new u.l("webglcontextlost",{originalEvent:I}))},this._contextRestored=I=>{this._setupPainter(),this.resize(),this._update(),this.fire(new u.l("webglcontextrestored",{originalEvent:I}))},this._onMapScroll=I=>{if(I.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=f.interactive,this._maxTileCacheSize=f.maxTileCacheSize,this._maxTileCacheZoomLevels=f.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},f.canvasContextAttributes),this._trackResize=f.trackResize===!0,this._bearingSnap=f.bearingSnap,this._centerClampedToGround=f.centerClampedToGround,this._refreshExpiredTiles=f.refreshExpiredTiles===!0,this._fadeDuration=f.fadeDuration,this._crossSourceCollisions=f.crossSourceCollisions===!0,this._collectResourceTiming=f.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},$a),f.locale),this._clickTolerance=f.clickTolerance,this._overridePixelRatio=f.pixelRatio,this._maxCanvasSize=f.maxCanvasSize,this.transformCameraUpdate=f.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=f.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=It.addThrottleControl(()=>this.isMoving()),this._requestManager=new wt(f.transformRequest),typeof f.container=="string"){if(this._container=document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(f.maxBounds&&this.setMaxBounds(f.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let I=!1;const D=Xh(z=>{this._trackResize&&!this._removed&&(this.resize(z),this.redraw())},50);this._resizeObserver=new ResizeObserver(z=>{I?D(z):I=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Ou(this,f),this._hash=f.hash&&new Kh(typeof f.hash=="string"&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,elevation:f.elevation,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch,roll:f.roll}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,u.e({},f.fitBoundsOptions,{duration:0}))));const E=typeof f.style=="string"||((s=(t=f.style)===null||t===void 0?void 0:t.projection)===null||s===void 0?void 0:s.type)!=="globe";this.resize(null,E),this._localIdeographFontFamily=f.localIdeographFontFamily,this._validateStyle=f.validateStyle,f.style&&this.setStyle(f.style,{localIdeographFontFamily:f.localIdeographFontFamily}),f.attributionControl&&this.addControl(new Nt(typeof f.attributionControl=="boolean"?void 0:f.attributionControl)),f.maplibreLogo&&this.addControl(new qt,f.logoPosition),this.on("style.load",()=>{if(E||this._resizeTransform(),this.transform.unmodified){const I=u.O(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(I)}}),this.on("data",I=>{this._update(I.dataType==="style"),this.fire(new u.l(`${I.dataType}data`,I))}),this.on("dataloading",I=>{this.fire(new u.l(`${I.dataType}dataloading`,I))}),this.on("dataabort",I=>{this.fire(new u.l("sourcedataabort",I))})}_getMapId(){return this._mapId}addControl(y,t){if(t===void 0&&(t=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new u.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=y.onAdd(this);this._controls.push(y);const f=this._controlPositions[t];return t.indexOf("bottom")!==-1?f.insertBefore(s,f.firstChild):f.appendChild(s),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new u.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(y);return t>-1&&this._controls.splice(t,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}calculateCameraOptionsFromTo(y,t,s,f){return f==null&&this.terrain&&(f=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(y,t,s,f)}resize(y,t=!0){const[s,f]=this._containerDimensions(),m=this._getClampedPixelRatio(s,f);if(this._resizeCanvas(s,f,m),this.painter.resize(s,f,m),this.painter.overLimit()){const E=this.painter.context.gl;this._maxCanvasSize=[E.drawingBufferWidth,E.drawingBufferHeight];const I=this._getClampedPixelRatio(s,f);this._resizeCanvas(s,f,I),this.painter.resize(s,f,I)}this._resizeTransform(t);const b=!this._moving;return b&&(this.stop(),this.fire(new u.l("movestart",y)).fire(new u.l("move",y))),this.fire(new u.l("resize",y)),b&&this.fire(new u.l("moveend",y)),this}_resizeTransform(y=!0){var t;const[s,f]=this._containerDimensions();this.transform.resize(s,f,y),(t=this._requestedCameraState)===null||t===void 0||t.resize(s,f,y)}_getClampedPixelRatio(y,t){const{0:s,1:f}=this._maxCanvasSize,m=this.getPixelRatio(),b=y*m,E=t*m;return Math.min(b>s?s/b:1,E>f?f/E:1)*m}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(Nn.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.setMinZoom(y),this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.setMaxZoom(y),this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.setMinPitch(y),this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(y>=this.transform.minPitch)return this.transform.setMaxPitch(y),this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.setRenderWorldCopies(y),this._update()}project(y){return this.transform.locationToScreenPoint(u.Q.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.screenPointToLocation(u.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,t,s){if(y==="mouseenter"||y==="mouseover"){let f=!1;return{layers:t,listener:s,delegates:{mousemove:b=>{const E=t.filter(D=>this.getLayer(D)),I=E.length!==0?this.queryRenderedFeatures(b.point,{layers:E}):[];I.length?f||(f=!0,s.call(this,new Pr(y,this,b.originalEvent,{features:I}))):f=!1},mouseout:()=>{f=!1}}}}if(y==="mouseleave"||y==="mouseout"){let f=!1;return{layers:t,listener:s,delegates:{mousemove:E=>{const I=t.filter(D=>this.getLayer(D));(I.length!==0?this.queryRenderedFeatures(E.point,{layers:I}):[]).length?f=!0:f&&(f=!1,s.call(this,new Pr(y,this,E.originalEvent)))},mouseout:E=>{f&&(f=!1,s.call(this,new Pr(y,this,E.originalEvent)))}}}}{const f=m=>{const b=t.filter(I=>this.getLayer(I)),E=b.length!==0?this.queryRenderedFeatures(m.point,{layers:b}):[];E.length&&(m.features=E,s.call(this,m),delete m.features)};return{layers:t,listener:s,delegates:{[y]:f}}}}_saveDelegatedListener(y,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(t)}_removeDelegatedListener(y,t,s){if(!this._delegatedListeners||!this._delegatedListeners[y])return;const f=this._delegatedListeners[y];for(let m=0;m<f.length;m++){const b=f[m];if(b.listener===s&&b.layers.length===t.length&&b.layers.every(E=>t.includes(E))){for(const E in b.delegates)this.off(E,b.delegates[E]);return void f.splice(m,1)}}}on(y,t,s){if(s===void 0)return super.on(y,t);const f=typeof t=="string"?[t]:t,m=this._createDelegatedListener(y,f,s);this._saveDelegatedListener(y,m);for(const b in m.delegates)this.on(b,m.delegates[b]);return{unsubscribe:()=>{this._removeDelegatedListener(y,f,s)}}}once(y,t,s){if(s===void 0)return super.once(y,t);const f=typeof t=="string"?[t]:t,m=this._createDelegatedListener(y,f,s);for(const b in m.delegates){const E=m.delegates[b];m.delegates[b]=(...I)=>{this._removeDelegatedListener(y,f,s),E(...I)}}this._saveDelegatedListener(y,m);for(const b in m.delegates)this.once(b,m.delegates[b]);return this}off(y,t,s){return s===void 0?super.off(y,t):(this._removeDelegatedListener(y,typeof t=="string"?[t]:t,s),this)}queryRenderedFeatures(y,t){if(!this.style)return[];let s;const f=y instanceof u.P||Array.isArray(y),m=f?y:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(f?{}:y)||{},m instanceof u.P||typeof m[0]=="number")s=[u.P.convert(m)];else{const b=u.P.convert(m[0]),E=u.P.convert(m[1]);s=[b,new u.P(E.x,b.y),E,new u.P(b.x,E.y),b]}return this.style.queryRenderedFeatures(s,t,this.transform)}querySourceFeatures(y,t){return this.style.querySourceFeatures(y,t)}setStyle(y,t){return(t=u.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(y,t))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const t=this._locale[y];if(t==null)throw new Error(`Missing UI string '${y}'`);return t}_updateStyle(y,t){var s,f;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(y,t));const m=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new Sc(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,t,m):this.style.loadJSON(y,t,m),this):((f=(s=this.style)===null||s===void 0?void 0:s.projection)===null||f===void 0||f.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Sc(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,t){if(typeof y=="string"){const s=this._requestManager.transformRequest(y,"Style");u.j(s,new AbortController).then(f=>{this._updateDiff(f.data,t)}).catch(f=>{f&&this.fire(new u.k(f))})}else typeof y=="object"&&this._updateDiff(y,t)}_updateDiff(y,t){try{this.style.setState(y,t)&&this._update(!0)}catch(s){u.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(y,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():u.w("There is no style added to the map.")}addSource(y,t){return this._lazyInitEmptyStyle(),this.style.addSource(y,t),this._update(!0)}isSourceLoaded(y){const t=this.style&&this.style.sourceCaches[y];if(t!==void 0)return t.loaded();this.fire(new u.k(new Error(`There is no source with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const t=this.style.sourceCaches[y.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);this.terrain===null&&t.reload();for(const s in this.style._layers){const f=this.style._layers[s];f.type==="hillshade"&&f.source===y.source&&u.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Fr(this.painter,t,y),this.painter.renderToTexture=new af(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=s=>{var f;s.dataType==="style"?this.terrain.sourceCache.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==y.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((f=s.source)===null||f===void 0?void 0:f.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new u.l("terrain",{terrain:y})),this}getTerrain(){var y,t;return(t=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const y=this.style&&this.style.sourceCaches;for(const t in y){const s=y[t]._tiles;for(const f in s){const m=s[f];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,t,s={}){const{pixelRatio:f=1,sdf:m=!1,stretchX:b,stretchY:E,content:I,textFitWidth:D,textFitHeight:z}=s;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||u.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new u.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:F,height:U,data:N}=t,Y=t;return this.style.addImage(y,{data:new u.R({width:F,height:U},new Uint8Array(N)),pixelRatio:f,stretchX:b,stretchY:E,content:I,textFitWidth:D,textFitHeight:z,sdf:m,version:0,userImage:Y}),Y.onAdd&&Y.onAdd(this,y),this}}{const{width:F,height:U,data:N}=ne.getImageData(t);this.style.addImage(y,{data:new u.R({width:F,height:U},N),pixelRatio:f,stretchX:b,stretchY:E,content:I,textFitWidth:D,textFitHeight:z,sdf:m,version:0})}}updateImage(y,t){const s=this.style.getImage(y);if(!s)return this.fire(new u.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=t instanceof HTMLImageElement||u.b(t)?ne.getImageData(t):t,{width:m,height:b,data:E}=f;if(m===void 0||b===void 0)return this.fire(new u.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==s.data.width||b!==s.data.height)return this.fire(new u.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const I=!(t instanceof HTMLImageElement||u.b(t));return s.data.replace(E,I),this.style.updateImage(y,s),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new u.k(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y){return It.getImage(this._requestManager.transformRequest(y,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(y,t){return this._lazyInitEmptyStyle(),this.style.addLayer(y,t),this._update(!0)}moveLayer(y,t){return this.style.moveLayer(y,t),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(y,t,s){return this.style.setLayerZoomRange(y,t,s),this._update(!0)}setFilter(y,t,s={}){return this.style.setFilter(y,t,s),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,t,s,f={}){return this.style.setPaintProperty(y,t,s,f),this._update(!0)}getPaintProperty(y,t){return this.style.getPaintProperty(y,t)}setLayoutProperty(y,t,s,f={}){return this.style.setLayoutProperty(y,t,s,f),this._update(!0)}getLayoutProperty(y,t){return this.style.getLayoutProperty(y,t)}setGlyphs(y,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,t,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(y,t,s,f=>{f||this._update(!0)}),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(y,t,s=>{s||this._update(!0)}),this}setLight(y,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(y,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(y,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(y,t){return this.style.setFeatureState(y,t),this._update()}removeFeatureState(y,t){return this.style.removeFeatureState(y,t),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,t=0;return this._container&&(y=this._container.clientWidth||400,t=this._container.clientHeight||300),[y,t]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const t=this._canvasContainer=K.create("div","maplibregl-canvas-container",y);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=K.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),f=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],f);const m=this._controlContainer=K.create("div","maplibregl-control-container",y),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(E=>{b[E]=K.create("div",`maplibregl-ctrl-${E} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,t,s){this._canvas.width=Math.floor(s*y),this._canvas.height=Math.floor(s*t),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const y=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",f=>{t={requestedAttributes:y},f&&(t.statusMessage=f.statusMessage,t.type=f.type)},{once:!0});let s=null;if(s=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,y):this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y),!s){const f="Failed to initialize WebGL";throw t?(t.message=f,new Error(JSON.stringify(t))):new Error(f)}this.painter=new qo(s,this.transform),le.testSupport(s)}migrateProjection(y,t){super.migrateProjection(y,t),this.painter.transform=y,this.fire(new u.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){var t,s,f,m,b;const E=this._idleTriggered?this._fadeDuration:0,I=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let D=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const U=this.transform.zoom,N=ne.now();this.style.zoomHistory.update(U,N);const Y=new u.C(U,{now:N,fadeDuration:E,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Q=Y.crossFadingFactor();Q===1&&Q===this._crossFadingFactor||(D=!0,this._crossFadingFactor=Q),this.style.update(Y)}const z=((s=this.style.projection)===null||s===void 0?void 0:s.transitionState)>0!==I;(f=this.style.projection)===null||f===void 0||f.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((m=this.style.projection)===null||m===void 0?void 0:m.transitionState,(b=this.style.projection)===null||b===void 0?void 0:b.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||z)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,E,this._crossSourceCollisions,z),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:E,showPadding:this.showPadding}),this.fire(new u.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,u.cj.mark(u.ck.load),this.fire(new u.l("load"))),this.style&&(this.style.hasTransitions()||D)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const F=this._sourcesDirty||this._styleDirty||this._placementDirty;return F||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new u.l("idle")),!this._loaded||this._fullyLoaded||F||(this._fullyLoaded=!0,u.cj.mark(u.ck.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),It.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t!=null&&t.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),K.remove(this._canvasContainer),K.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),u.cj.clearMetrics(),this._removed=!0,this.fire(new u.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ne.frame(this._frameRequest,y=>{u.cj.frame(y),this._frameRequest=null;try{this._render(y)}catch(t){if(!u.cl(t)&&!function(s){return s.message===Iu}(t))throw t}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return Ht}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(y){return this._lazyInitEmptyStyle(),this.style.setProjection(y),this._update(!0)}},S.MapMouseEvent=Pr,S.MapTouchEvent=Ho,S.MapWheelEvent=Kr,S.Marker=Ha,S.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const t=this._map.getZoom(),s=t===this._map.getMaxZoom(),f=t===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,s)=>{const f=this._map._getUIString(`NavigationControl.${s}`);t.title=f,t.setAttribute("aria-label",f)},this.options=u.e({},cr,y),this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),K.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),K.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=K.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Wo(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){K.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,t){const s=K.create("button",y,this._container);return s.type="button",s.addEventListener("click",t),s}},S.Popup=class extends u.E{constructor(y){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:void 0)},this.remove=()=>(this._content&&K.remove(this._content),this._container&&(K.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new u.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{var s;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=K.create("div","maplibregl-popup",this._map.getContainer()),this._tip=K.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const I of this.options.className.split(" "))this._container.classList.add(I);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Us(this._lngLat,this._flatPos,this._map.transform):(s=this._lngLat)===null||s===void 0?void 0:s.wrap(),this._trackPointer&&!t)return;const f=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let m=this.options.anchor;const b=Yl(this.options.offset);if(!m){const I=this._container.offsetWidth,D=this._container.offsetHeight;let z;z=f.y+b.bottom.y<D?["top"]:f.y>this._map.transform.height-D?["bottom"]:[],f.x<I/2?z.push("left"):f.x>this._map.transform.width-I/2&&z.push("right"),m=z.length===0?"bottom":z.join("-")}let E=f.add(b[m]);this.options.subpixelPositioning||(E=E.round()),K.setTransform(this._container,`${Qo[m]} translate(${E.x}px,${E.y}px)`),Jo(this._container,m,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=u.e(Object.create(of),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new u.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=u.Q.convert(y),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const t=document.createDocumentFragment(),s=document.createElement("body");let f;for(s.innerHTML=y;f=s.firstChild,f;)t.appendChild(f);return this.setDOMContent(t)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=K.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){return this._container&&this._container.classList.add(y),this}removeClassName(y){return this._container&&this._container.classList.remove(y),this}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}setSubpixelPositioning(y){this.options.subpixelPositioning=y}_createCloseButton(){this.options.closeButton&&(this._closeButton=K.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(Nu);y&&y.focus()}},S.RasterDEMTileSource=Po,S.RasterTileSource=dr,S.ScaleControl=class{constructor(y){this._onMove=()=>{Fu(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Fu(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Lu),y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){K.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},S.ScrollZoomHandler=nf,S.Style=Sc,S.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=y}onAdd(y){return this._map=y,this._container=K.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=K.create("button","maplibregl-ctrl-terrain",this._container),K.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){K.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},S.TwoFingersTouchPitchHandler=tf,S.TwoFingersTouchRotateHandler=ed,S.TwoFingersTouchZoomHandler=Mi,S.TwoFingersTouchZoomRotateHandler=Ga,S.VectorTileSource=vl,S.VideoSource=fa,S.addSourceType=(y,t)=>u._(void 0,void 0,void 0,function*(){if(uu(y))throw new Error(`A source type called "${y}" already exists.`);((s,f)=>{bl[s]=f})(y,t)}),S.clearPrewarmedResources=function(){const y=Zt;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(lt),Zt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},S.createTileMesh=Rs,S.getMaxParallelImageRequests=function(){return u.a.MAX_PARALLEL_IMAGE_REQUESTS},S.getRTLTextPluginStatus=function(){return $r().getRTLTextPluginStatus()},S.getVersion=function(){return Uu},S.getWorkerCount=function(){return Dt.workerCount},S.getWorkerUrl=function(){return u.a.WORKER_URL},S.importScriptInWorkers=function(y){return zi().broadcast("IS",y)},S.prewarm=function(){Jt().acquire(lt)},S.setMaxParallelImageRequests=function(y){u.a.MAX_PARALLEL_IMAGE_REQUESTS=y},S.setRTLTextPlugin=function(y,t){return $r().setRTLTextPlugin(y,t)},S.setWorkerCount=function(y){Dt.workerCount=y},S.setWorkerUrl=function(y){u.a.WORKER_URL=y}});var T=n;return T})}(iy)),iy.exports}var SA=wA();const Pv=z0(SA);var X_={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var ex;function TA(){return ex||(ex=1,X_.read=function(r,e,n,h,_){var T,S,u=_*8-h-1,k=(1<<u)-1,B=k>>1,q=-7,oe=n?_-1:0,ne=n?-1:1,K=r[e+oe];for(oe+=ne,T=K&(1<<-q)-1,K>>=-q,q+=u;q>0;T=T*256+r[e+oe],oe+=ne,q-=8);for(S=T&(1<<-q)-1,T>>=-q,q+=h;q>0;S=S*256+r[e+oe],oe+=ne,q-=8);if(T===0)T=1-B;else{if(T===k)return S?NaN:(K?-1:1)*(1/0);S=S+Math.pow(2,h),T=T-B}return(K?-1:1)*S*Math.pow(2,T-h)},X_.write=function(r,e,n,h,_,T){var S,u,k,B=T*8-_-1,q=(1<<B)-1,oe=q>>1,ne=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,K=h?0:T-1,le=h?1:-1,Ge=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(u=isNaN(e)?1:0,S=q):(S=Math.floor(Math.log(e)/Math.LN2),e*(k=Math.pow(2,-S))<1&&(S--,k*=2),S+oe>=1?e+=ne/k:e+=ne*Math.pow(2,1-oe),e*k>=2&&(S++,k/=2),S+oe>=q?(u=0,S=q):S+oe>=1?(u=(e*k-1)*Math.pow(2,_),S=S+oe):(u=e*Math.pow(2,oe-1)*Math.pow(2,_),S=0));_>=8;r[n+K]=u&255,K+=le,u/=256,_-=8);for(S=S<<_|u,B+=_;B>0;r[n+K]=S&255,K+=le,S/=256,B-=8);r[n+K-le]|=Ge*128}),X_}var zv,tx;function U1(){if(tx)return zv;tx=1,zv=e;var r=TA();function e(te){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(te)?te:new Uint8Array(te||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var n=65536*65536,h=1/n,_=12,T=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");e.prototype={destroy:function(){this.buf=null},readFields:function(te,be,Fe){for(Fe=Fe||this.length;this.pos<Fe;){var xt=this.readVarint(),Ae=xt>>3,st=this.pos;this.type=xt&7,te(Ae,be,this),this.pos===st&&this.skip(xt)}return be},readMessage:function(te,be){return this.readFields(te,be,this.readVarint()+this.pos)},readFixed32:function(){var te=zt(this.buf,this.pos);return this.pos+=4,te},readSFixed32:function(){var te=ut(this.buf,this.pos);return this.pos+=4,te},readFixed64:function(){var te=zt(this.buf,this.pos)+zt(this.buf,this.pos+4)*n;return this.pos+=8,te},readSFixed64:function(){var te=zt(this.buf,this.pos)+ut(this.buf,this.pos+4)*n;return this.pos+=8,te},readFloat:function(){var te=r.read(this.buf,this.pos,!0,23,4);return this.pos+=4,te},readDouble:function(){var te=r.read(this.buf,this.pos,!0,52,8);return this.pos+=8,te},readVarint:function(te){var be=this.buf,Fe,xt;return xt=be[this.pos++],Fe=xt&127,xt<128||(xt=be[this.pos++],Fe|=(xt&127)<<7,xt<128)||(xt=be[this.pos++],Fe|=(xt&127)<<14,xt<128)||(xt=be[this.pos++],Fe|=(xt&127)<<21,xt<128)?Fe:(xt=be[this.pos],Fe|=(xt&15)<<28,S(Fe,te,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var te=this.readVarint();return te%2===1?(te+1)/-2:te/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var te=this.readVarint()+this.pos,be=this.pos;return this.pos=te,te-be>=_&&T?Ri(this.buf,be,te):Mt(this.buf,be,te)},readBytes:function(){var te=this.readVarint()+this.pos,be=this.buf.subarray(this.pos,te);return this.pos=te,be},readPackedVarint:function(te,be){if(this.type!==e.Bytes)return te.push(this.readVarint(be));var Fe=u(this);for(te=te||[];this.pos<Fe;)te.push(this.readVarint(be));return te},readPackedSVarint:function(te){if(this.type!==e.Bytes)return te.push(this.readSVarint());var be=u(this);for(te=te||[];this.pos<be;)te.push(this.readSVarint());return te},readPackedBoolean:function(te){if(this.type!==e.Bytes)return te.push(this.readBoolean());var be=u(this);for(te=te||[];this.pos<be;)te.push(this.readBoolean());return te},readPackedFloat:function(te){if(this.type!==e.Bytes)return te.push(this.readFloat());var be=u(this);for(te=te||[];this.pos<be;)te.push(this.readFloat());return te},readPackedDouble:function(te){if(this.type!==e.Bytes)return te.push(this.readDouble());var be=u(this);for(te=te||[];this.pos<be;)te.push(this.readDouble());return te},readPackedFixed32:function(te){if(this.type!==e.Bytes)return te.push(this.readFixed32());var be=u(this);for(te=te||[];this.pos<be;)te.push(this.readFixed32());return te},readPackedSFixed32:function(te){if(this.type!==e.Bytes)return te.push(this.readSFixed32());var be=u(this);for(te=te||[];this.pos<be;)te.push(this.readSFixed32());return te},readPackedFixed64:function(te){if(this.type!==e.Bytes)return te.push(this.readFixed64());var be=u(this);for(te=te||[];this.pos<be;)te.push(this.readFixed64());return te},readPackedSFixed64:function(te){if(this.type!==e.Bytes)return te.push(this.readSFixed64());var be=u(this);for(te=te||[];this.pos<be;)te.push(this.readSFixed64());return te},skip:function(te){var be=te&7;if(be===e.Varint)for(;this.buf[this.pos++]>127;);else if(be===e.Bytes)this.pos=this.readVarint()+this.pos;else if(be===e.Fixed32)this.pos+=4;else if(be===e.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+be)},writeTag:function(te,be){this.writeVarint(te<<3|be)},realloc:function(te){for(var be=this.length||16;be<this.pos+te;)be*=2;if(be!==this.length){var Fe=new Uint8Array(be);Fe.set(this.buf),this.buf=Fe,this.length=be}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(te){this.realloc(4),Pt(this.buf,te,this.pos),this.pos+=4},writeSFixed32:function(te){this.realloc(4),Pt(this.buf,te,this.pos),this.pos+=4},writeFixed64:function(te){this.realloc(8),Pt(this.buf,te&-1,this.pos),Pt(this.buf,Math.floor(te*h),this.pos+4),this.pos+=8},writeSFixed64:function(te){this.realloc(8),Pt(this.buf,te&-1,this.pos),Pt(this.buf,Math.floor(te*h),this.pos+4),this.pos+=8},writeVarint:function(te){if(te=+te||0,te>268435455||te<0){B(te,this);return}this.realloc(4),this.buf[this.pos++]=te&127|(te>127?128:0),!(te<=127)&&(this.buf[this.pos++]=(te>>>=7)&127|(te>127?128:0),!(te<=127)&&(this.buf[this.pos++]=(te>>>=7)&127|(te>127?128:0),!(te<=127)&&(this.buf[this.pos++]=te>>>7&127)))},writeSVarint:function(te){this.writeVarint(te<0?-te*2-1:te*2)},writeBoolean:function(te){this.writeVarint(!!te)},writeString:function(te){te=String(te),this.realloc(te.length*4),this.pos++;var be=this.pos;this.pos=bi(this.buf,te,this.pos);var Fe=this.pos-be;Fe>=128&&ne(be,Fe,this),this.pos=be-1,this.writeVarint(Fe),this.pos+=Fe},writeFloat:function(te){this.realloc(4),r.write(this.buf,te,this.pos,!0,23,4),this.pos+=4},writeDouble:function(te){this.realloc(8),r.write(this.buf,te,this.pos,!0,52,8),this.pos+=8},writeBytes:function(te){var be=te.length;this.writeVarint(be),this.realloc(be);for(var Fe=0;Fe<be;Fe++)this.buf[this.pos++]=te[Fe]},writeRawMessage:function(te,be){this.pos++;var Fe=this.pos;te(be,this);var xt=this.pos-Fe;xt>=128&&ne(Fe,xt,this),this.pos=Fe-1,this.writeVarint(xt),this.pos+=xt},writeMessage:function(te,be,Fe){this.writeTag(te,e.Bytes),this.writeRawMessage(be,Fe)},writePackedVarint:function(te,be){be.length&&this.writeMessage(te,K,be)},writePackedSVarint:function(te,be){be.length&&this.writeMessage(te,le,be)},writePackedBoolean:function(te,be){be.length&&this.writeMessage(te,Ke,be)},writePackedFloat:function(te,be){be.length&&this.writeMessage(te,Ge,be)},writePackedDouble:function(te,be){be.length&&this.writeMessage(te,tt,be)},writePackedFixed32:function(te,be){be.length&&this.writeMessage(te,ht,be)},writePackedSFixed32:function(te,be){be.length&&this.writeMessage(te,bt,be)},writePackedFixed64:function(te,be){be.length&&this.writeMessage(te,It,be)},writePackedSFixed64:function(te,be){be.length&&this.writeMessage(te,wt,be)},writeBytesField:function(te,be){this.writeTag(te,e.Bytes),this.writeBytes(be)},writeFixed32Field:function(te,be){this.writeTag(te,e.Fixed32),this.writeFixed32(be)},writeSFixed32Field:function(te,be){this.writeTag(te,e.Fixed32),this.writeSFixed32(be)},writeFixed64Field:function(te,be){this.writeTag(te,e.Fixed64),this.writeFixed64(be)},writeSFixed64Field:function(te,be){this.writeTag(te,e.Fixed64),this.writeSFixed64(be)},writeVarintField:function(te,be){this.writeTag(te,e.Varint),this.writeVarint(be)},writeSVarintField:function(te,be){this.writeTag(te,e.Varint),this.writeSVarint(be)},writeStringField:function(te,be){this.writeTag(te,e.Bytes),this.writeString(be)},writeFloatField:function(te,be){this.writeTag(te,e.Fixed32),this.writeFloat(be)},writeDoubleField:function(te,be){this.writeTag(te,e.Fixed64),this.writeDouble(be)},writeBooleanField:function(te,be){this.writeVarintField(te,!!be)}};function S(te,be,Fe){var xt=Fe.buf,Ae,st;if(st=xt[Fe.pos++],Ae=(st&112)>>4,st<128||(st=xt[Fe.pos++],Ae|=(st&127)<<3,st<128)||(st=xt[Fe.pos++],Ae|=(st&127)<<10,st<128)||(st=xt[Fe.pos++],Ae|=(st&127)<<17,st<128)||(st=xt[Fe.pos++],Ae|=(st&127)<<24,st<128)||(st=xt[Fe.pos++],Ae|=(st&1)<<31,st<128))return k(te,Ae,be);throw new Error("Expected varint not more than 10 bytes")}function u(te){return te.type===e.Bytes?te.readVarint()+te.pos:te.pos+1}function k(te,be,Fe){return Fe?be*4294967296+(te>>>0):(be>>>0)*4294967296+(te>>>0)}function B(te,be){var Fe,xt;if(te>=0?(Fe=te%4294967296|0,xt=te/4294967296|0):(Fe=~(-te%4294967296),xt=~(-te/4294967296),Fe^4294967295?Fe=Fe+1|0:(Fe=0,xt=xt+1|0)),te>=18446744073709552e3||te<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");be.realloc(10),q(Fe,xt,be),oe(xt,be)}function q(te,be,Fe){Fe.buf[Fe.pos++]=te&127|128,te>>>=7,Fe.buf[Fe.pos++]=te&127|128,te>>>=7,Fe.buf[Fe.pos++]=te&127|128,te>>>=7,Fe.buf[Fe.pos++]=te&127|128,te>>>=7,Fe.buf[Fe.pos]=te&127}function oe(te,be){var Fe=(te&7)<<4;be.buf[be.pos++]|=Fe|((te>>>=3)?128:0),te&&(be.buf[be.pos++]=te&127|((te>>>=7)?128:0),te&&(be.buf[be.pos++]=te&127|((te>>>=7)?128:0),te&&(be.buf[be.pos++]=te&127|((te>>>=7)?128:0),te&&(be.buf[be.pos++]=te&127|((te>>>=7)?128:0),te&&(be.buf[be.pos++]=te&127)))))}function ne(te,be,Fe){var xt=be<=16383?1:be<=2097151?2:be<=268435455?3:Math.floor(Math.log(be)/(Math.LN2*7));Fe.realloc(xt);for(var Ae=Fe.pos-1;Ae>=te;Ae--)Fe.buf[Ae+xt]=Fe.buf[Ae]}function K(te,be){for(var Fe=0;Fe<te.length;Fe++)be.writeVarint(te[Fe])}function le(te,be){for(var Fe=0;Fe<te.length;Fe++)be.writeSVarint(te[Fe])}function Ge(te,be){for(var Fe=0;Fe<te.length;Fe++)be.writeFloat(te[Fe])}function tt(te,be){for(var Fe=0;Fe<te.length;Fe++)be.writeDouble(te[Fe])}function Ke(te,be){for(var Fe=0;Fe<te.length;Fe++)be.writeBoolean(te[Fe])}function ht(te,be){for(var Fe=0;Fe<te.length;Fe++)be.writeFixed32(te[Fe])}function bt(te,be){for(var Fe=0;Fe<te.length;Fe++)be.writeSFixed32(te[Fe])}function It(te,be){for(var Fe=0;Fe<te.length;Fe++)be.writeFixed64(te[Fe])}function wt(te,be){for(var Fe=0;Fe<te.length;Fe++)be.writeSFixed64(te[Fe])}function zt(te,be){return(te[be]|te[be+1]<<8|te[be+2]<<16)+te[be+3]*16777216}function Pt(te,be,Fe){te[Fe]=be,te[Fe+1]=be>>>8,te[Fe+2]=be>>>16,te[Fe+3]=be>>>24}function ut(te,be){return(te[be]|te[be+1]<<8|te[be+2]<<16)+(te[be+3]<<24)}function Mt(te,be,Fe){for(var xt="",Ae=be;Ae<Fe;){var st=te[Ae],Ct=null,yi=st>239?4:st>223?3:st>191?2:1;if(Ae+yi>Fe)break;var xe,lt,Dt;yi===1?st<128&&(Ct=st):yi===2?(xe=te[Ae+1],(xe&192)===128&&(Ct=(st&31)<<6|xe&63,Ct<=127&&(Ct=null))):yi===3?(xe=te[Ae+1],lt=te[Ae+2],(xe&192)===128&&(lt&192)===128&&(Ct=(st&15)<<12|(xe&63)<<6|lt&63,(Ct<=2047||Ct>=55296&&Ct<=57343)&&(Ct=null))):yi===4&&(xe=te[Ae+1],lt=te[Ae+2],Dt=te[Ae+3],(xe&192)===128&&(lt&192)===128&&(Dt&192)===128&&(Ct=(st&15)<<18|(xe&63)<<12|(lt&63)<<6|Dt&63,(Ct<=65535||Ct>=1114112)&&(Ct=null))),Ct===null?(Ct=65533,yi=1):Ct>65535&&(Ct-=65536,xt+=String.fromCharCode(Ct>>>10&1023|55296),Ct=56320|Ct&1023),xt+=String.fromCharCode(Ct),Ae+=yi}return xt}function Ri(te,be,Fe){return T.decode(te.subarray(be,Fe))}function bi(te,be,Fe){for(var xt=0,Ae,st;xt<be.length;xt++){if(Ae=be.charCodeAt(xt),Ae>55295&&Ae<57344)if(st)if(Ae<56320){te[Fe++]=239,te[Fe++]=191,te[Fe++]=189,st=Ae;continue}else Ae=st-55296<<10|Ae-56320|65536,st=null;else{Ae>56319||xt+1===be.length?(te[Fe++]=239,te[Fe++]=191,te[Fe++]=189):st=Ae;continue}else st&&(te[Fe++]=239,te[Fe++]=191,te[Fe++]=189,st=null);Ae<128?te[Fe++]=Ae:(Ae<2048?te[Fe++]=Ae>>6|192:(Ae<65536?te[Fe++]=Ae>>12|224:(te[Fe++]=Ae>>18|240,te[Fe++]=Ae>>12&63|128),te[Fe++]=Ae>>6&63|128),te[Fe++]=Ae&63|128)}return Fe}return zv}U1();const ix=new Map;function EA(r){const e=r.split("/").slice(-3);if(e.length!==3||!e[0]||!e[1]||!e[2])return;const[n,h,_]=e.map(T=>Number(T.split(".")[0]));if(!(isNaN(n)||isNaN(h)||isNaN(_)))return{z:n,x:h,y:_}}function MA(r,e,n){const h=`${r}/${e}/${n}`,_=ix.get(h);if(_)return _;const S=1/(1<<r),u=180/Math.PI,k=e*S*360-180,B=(e+1)*S*360-180,q=1-2*n*S,oe=1-2*(n+1)*S,ne=Math.atan(Math.sinh(Math.PI*q))*u,K=Math.atan(Math.sinh(Math.PI*oe))*u,le={minLng:k,minLat:Math.min(ne,K),maxLng:B,maxLat:Math.max(ne,K)};return ix.set(h,le),le}function _0(r,e,n,h){let _=h;const T=e+(n-e>>1);let S=n-e,u;const k=r[e],B=r[e+1],q=r[n],oe=r[n+1];for(let ne=e+3;ne<n;ne+=3){const K=AA(r[ne],r[ne+1],k,B,q,oe);if(K>_)u=ne,_=K;else if(K===_){const le=Math.abs(ne-T);le<S&&(u=ne,S=le)}}_>h&&(u-e>3&&_0(r,e,u,h),r[u+2]=_,n-u>3&&_0(r,u,n,h))}function AA(r,e,n,h,_,T){let S=_-n,u=T-h;if(S!==0||u!==0){const k=((r-n)*S+(e-h)*u)/(S*S+u*u);k>1?(n=_,h=T):k>0&&(n+=S*k,h+=u*k)}return S=r-n,u=e-h,S*S+u*u}function Xg(r,e,n,h){const _={id:r??null,type:e,geometry:n,tags:h,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(e==="Point"||e==="MultiPoint"||e==="LineString")K_(_,n);else if(e==="Polygon")K_(_,n[0]);else if(e==="MultiLineString")for(const T of n)K_(_,T);else if(e==="MultiPolygon")for(const T of n)K_(_,T[0]);return _}function K_(r,e){for(let n=0;n<e.length;n+=3)r.minX=Math.min(r.minX,e[n]),r.minY=Math.min(r.minY,e[n+1]),r.maxX=Math.max(r.maxX,e[n]),r.maxY=Math.max(r.maxY,e[n+1])}function IA(r,e){const n=[];if(r.type==="FeatureCollection")for(let h=0;h<r.features.length;h++)ny(n,r.features[h],e,h);else r.type==="Feature"?ny(n,r,e):ny(n,{geometry:r},e);return n}function ny(r,e,n,h){if(!e.geometry)return;const _=e.geometry.coordinates;if(_&&_.length===0)return;const T=e.geometry.type,S=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2);let u=[],k=e.id;if(n.promoteId?k=e.properties[n.promoteId]:n.generateId&&(k=h||0),T==="Point")nx(_,u);else if(T==="MultiPoint")for(const B of _)nx(B,u);else if(T==="LineString")y0(_,u,S,!1);else if(T==="MultiLineString")if(n.lineMetrics){for(const B of _)u=[],y0(B,u,S,!1),r.push(Xg(k,"LineString",u,e.properties));return}else kv(_,u,S,!1);else if(T==="Polygon")kv(_,u,S,!0);else if(T==="MultiPolygon")for(const B of _){const q=[];kv(B,q,S,!0),u.push(q)}else if(T==="GeometryCollection"){for(const B of e.geometry.geometries)ny(r,{id:k,geometry:B,properties:e.properties},n,h);return}else throw new Error("Input data is not a valid GeoJSON object.");r.push(Xg(k,T,u,e.properties))}function nx(r,e){e.push(j1(r[0]),V1(r[1]),0)}function y0(r,e,n,h){let _,T,S=0;for(let k=0;k<r.length;k++){const B=j1(r[k][0]),q=V1(r[k][1]);e.push(B,q,0),k>0&&(h?S+=(_*q-B*T)/2:S+=Math.sqrt(Math.pow(B-_,2)+Math.pow(q-T,2))),_=B,T=q}const u=e.length-3;e[2]=1,_0(e,0,u,n),e[u+2]=1,e.size=Math.abs(S),e.start=0,e.end=e.size}function kv(r,e,n,h){for(let _=0;_<r.length;_++){const T=[];y0(r[_],T,n,h),e.push(T)}}function j1(r){return r/360+.5}function V1(r){const e=Math.sin(r*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function dh(r,e,n,h,_,T,S,u){if(n/=e,h/=e,T>=n&&S<h)return r;if(S<n||T>=h)return null;const k=[];for(const B of r){const q=B.geometry;let oe=B.type;const ne=_===0?B.minX:B.minY,K=_===0?B.maxX:B.maxY;if(ne>=n&&K<h){k.push(B);continue}else if(K<n||ne>=h)continue;let le=[];if(oe==="Point"||oe==="MultiPoint")CA(q,le,n,h,_);else if(oe==="LineString")Z1(q,le,n,h,_,!1,u.lineMetrics);else if(oe==="MultiLineString")Ov(q,le,n,h,_,!1);else if(oe==="Polygon")Ov(q,le,n,h,_,!0);else if(oe==="MultiPolygon")for(const Ge of q){const tt=[];Ov(Ge,tt,n,h,_,!0),tt.length&&le.push(tt)}if(le.length){if(u.lineMetrics&&oe==="LineString"){for(const Ge of le)k.push(Xg(B.id,oe,Ge,B.tags));continue}(oe==="LineString"||oe==="MultiLineString")&&(le.length===1?(oe="LineString",le=le[0]):oe="MultiLineString"),(oe==="Point"||oe==="MultiPoint")&&(oe=le.length===3?"Point":"MultiPoint"),k.push(Xg(B.id,oe,le,B.tags))}}return k.length?k:null}function CA(r,e,n,h,_){for(let T=0;T<r.length;T+=3){const S=r[T+_];S>=n&&S<=h&&am(e,r[T],r[T+1],r[T+2])}}function Z1(r,e,n,h,_,T,S){let u=rx(r);const k=_===0?DA:RA;let B=r.start,q,oe;for(let Ke=0;Ke<r.length-3;Ke+=3){const ht=r[Ke],bt=r[Ke+1],It=r[Ke+2],wt=r[Ke+3],zt=r[Ke+4],Pt=_===0?ht:bt,ut=_===0?wt:zt;let Mt=!1;S&&(q=Math.sqrt(Math.pow(ht-wt,2)+Math.pow(bt-zt,2))),Pt<n?ut>n&&(oe=k(u,ht,bt,wt,zt,n),S&&(u.start=B+q*oe)):Pt>h?ut<h&&(oe=k(u,ht,bt,wt,zt,h),S&&(u.start=B+q*oe)):am(u,ht,bt,It),ut<n&&Pt>=n&&(oe=k(u,ht,bt,wt,zt,n),Mt=!0),ut>h&&Pt<=h&&(oe=k(u,ht,bt,wt,zt,h),Mt=!0),!T&&Mt&&(S&&(u.end=B+q*oe),e.push(u),u=rx(r)),S&&(B+=q)}let ne=r.length-3;const K=r[ne],le=r[ne+1],Ge=r[ne+2],tt=_===0?K:le;tt>=n&&tt<=h&&am(u,K,le,Ge),ne=u.length-3,T&&ne>=3&&(u[ne]!==u[0]||u[ne+1]!==u[1])&&am(u,u[0],u[1],u[2]),u.length&&e.push(u)}function rx(r){const e=[];return e.size=r.size,e.start=r.start,e.end=r.end,e}function Ov(r,e,n,h,_,T){for(const S of r)Z1(S,e,n,h,_,T,!1)}function am(r,e,n,h){r.push(e,n,h)}function DA(r,e,n,h,_,T){const S=(T-e)/(h-e);return am(r,T,n+(_-n)*S,1),S}function RA(r,e,n,h,_,T){const S=(T-n)/(_-n);return am(r,e+(h-e)*S,T,1),S}function PA(r,e){const n=e.buffer/e.extent;let h=r;const _=dh(r,1,-1-n,n,0,-1,2,e),T=dh(r,1,1-n,2+n,0,-1,2,e);return(_||T)&&(h=dh(r,1,-n,1+n,0,-1,2,e)||[],_&&(h=ax(_,1).concat(h)),T&&(h=h.concat(ax(T,-1)))),h}function ax(r,e){const n=[];for(let h=0;h<r.length;h++){const _=r[h],T=_.type;let S;if(T==="Point"||T==="MultiPoint"||T==="LineString")S=Bv(_.geometry,e);else if(T==="MultiLineString"||T==="Polygon"){S=[];for(const u of _.geometry)S.push(Bv(u,e))}else if(T==="MultiPolygon"){S=[];for(const u of _.geometry){const k=[];for(const B of u)k.push(Bv(B,e));S.push(k)}}n.push(Xg(_.id,T,S,_.tags))}return n}function Bv(r,e){const n=[];n.size=r.size,r.start!==void 0&&(n.start=r.start,n.end=r.end);for(let h=0;h<r.length;h+=3)n.push(r[h]+e,r[h+1],r[h+2]);return n}function sx(r,e){if(r.transformed)return r;const n=1<<r.z,h=r.x,_=r.y;for(const T of r.features){const S=T.geometry,u=T.type;if(T.geometry=[],u===1)for(let k=0;k<S.length;k+=2)T.geometry.push(ox(S[k],S[k+1],e,n,h,_));else for(let k=0;k<S.length;k++){const B=[];for(let q=0;q<S[k].length;q+=2)B.push(ox(S[k][q],S[k][q+1],e,n,h,_));T.geometry.push(B)}}return r.transformed=!0,r}function ox(r,e,n,h,_,T){return[Math.round(n*(r*h-_)),Math.round(n*(e*h-T))]}function zA(r,e,n,h,_){const T=e===_.maxZoom?0:_.tolerance/((1<<e)*_.extent),S={features:[],numPoints:0,numSimplified:0,numFeatures:r.length,source:null,x:n,y:h,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const u of r)kA(S,u,T,_);return S}function kA(r,e,n,h){const _=e.geometry,T=e.type,S=[];if(r.minX=Math.min(r.minX,e.minX),r.minY=Math.min(r.minY,e.minY),r.maxX=Math.max(r.maxX,e.maxX),r.maxY=Math.max(r.maxY,e.maxY),T==="Point"||T==="MultiPoint")for(let u=0;u<_.length;u+=3)S.push(_[u],_[u+1]),r.numPoints++,r.numSimplified++;else if(T==="LineString")Lv(S,_,r,n,!1,!1);else if(T==="MultiLineString"||T==="Polygon")for(let u=0;u<_.length;u++)Lv(S,_[u],r,n,T==="Polygon",u===0);else if(T==="MultiPolygon")for(let u=0;u<_.length;u++){const k=_[u];for(let B=0;B<k.length;B++)Lv(S,k[B],r,n,!0,B===0)}if(S.length){let u=e.tags||null;if(T==="LineString"&&h.lineMetrics){u={};for(const B in e.tags)u[B]=e.tags[B];u.mapbox_clip_start=_.start/_.size,u.mapbox_clip_end=_.end/_.size}const k={geometry:S,type:T==="Polygon"||T==="MultiPolygon"?3:T==="LineString"||T==="MultiLineString"?2:1,tags:u};e.id!==null&&(k.id=e.id),r.features.push(k)}}function Lv(r,e,n,h,_,T){const S=h*h;if(h>0&&e.size<(_?S:h)){n.numPoints+=e.length/3;return}const u=[];for(let k=0;k<e.length;k+=3)(h===0||e[k+2]>S)&&(n.numSimplified++,u.push(e[k],e[k+1])),n.numPoints++;_&&OA(u,T),r.push(u)}function OA(r,e){let n=0;for(let h=0,_=r.length,T=_-2;h<_;T=h,h+=2)n+=(r[h]-r[T])*(r[h+1]+r[T+1]);if(n>0===e)for(let h=0,_=r.length;h<_/2;h+=2){const T=r[h],S=r[h+1];r[h]=r[_-2-h],r[h+1]=r[_-1-h],r[_-2-h]=T,r[_-1-h]=S}}const BA={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class LA{constructor(e,n){n=this.options=FA(Object.create(BA),n);const h=n.debug;if(h&&console.time("preprocess data"),n.maxZoom<0||n.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(n.promoteId&&n.generateId)throw new Error("promoteId and generateId cannot be used together.");let _=IA(e,n);this.tiles={},this.tileCoords=[],h&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",n.indexMaxZoom,n.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),_=PA(_,n),_.length&&this.splitTile(_,0,0,0),h&&(_.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(e,n,h,_,T,S,u){const k=[e,n,h,_],B=this.options,q=B.debug;for(;k.length;){_=k.pop(),h=k.pop(),n=k.pop(),e=k.pop();const oe=1<<n,ne=Fv(n,h,_);let K=this.tiles[ne];if(!K&&(q>1&&console.time("creation"),K=this.tiles[ne]=zA(e,n,h,_,B),this.tileCoords.push({z:n,x:h,y:_}),q)){q>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",n,h,_,K.numFeatures,K.numPoints,K.numSimplified),console.timeEnd("creation"));const ut=`z${n}`;this.stats[ut]=(this.stats[ut]||0)+1,this.total++}if(K.source=e,T==null){if(n===B.indexMaxZoom||K.numPoints<=B.indexMaxPoints)continue}else{if(n===B.maxZoom||n===T)continue;if(T!=null){const ut=T-n;if(h!==S>>ut||_!==u>>ut)continue}}if(K.source=null,e.length===0)continue;q>1&&console.time("clipping");const le=.5*B.buffer/B.extent,Ge=.5-le,tt=.5+le,Ke=1+le;let ht=null,bt=null,It=null,wt=null,zt=dh(e,oe,h-le,h+tt,0,K.minX,K.maxX,B),Pt=dh(e,oe,h+Ge,h+Ke,0,K.minX,K.maxX,B);e=null,zt&&(ht=dh(zt,oe,_-le,_+tt,1,K.minY,K.maxY,B),bt=dh(zt,oe,_+Ge,_+Ke,1,K.minY,K.maxY,B),zt=null),Pt&&(It=dh(Pt,oe,_-le,_+tt,1,K.minY,K.maxY,B),wt=dh(Pt,oe,_+Ge,_+Ke,1,K.minY,K.maxY,B),Pt=null),q>1&&console.timeEnd("clipping"),k.push(ht||[],n+1,h*2,_*2),k.push(bt||[],n+1,h*2,_*2+1),k.push(It||[],n+1,h*2+1,_*2),k.push(wt||[],n+1,h*2+1,_*2+1)}}getTile(e,n,h){e=+e,n=+n,h=+h;const _=this.options,{extent:T,debug:S}=_;if(e<0||e>24)return null;const u=1<<e;n=n+u&u-1;const k=Fv(e,n,h);if(this.tiles[k])return sx(this.tiles[k],T);S>1&&console.log("drilling down to z%d-%d-%d",e,n,h);let B=e,q=n,oe=h,ne;for(;!ne&&B>0;)B--,q=q>>1,oe=oe>>1,ne=this.tiles[Fv(B,q,oe)];return!ne||!ne.source?null:(S>1&&(console.log("found parent tile z%d-%d-%d",B,q,oe),console.time("drilling down")),this.splitTile(ne.source,B,q,oe,e,n,h),S>1&&console.timeEnd("drilling down"),this.tiles[k]?sx(this.tiles[k],T):null)}}function Fv(r,e,n){return((1<<r)*n+e)*32+r}function FA(r,e){for(const n in e)r[n]=e[n];return r}function NA(r,e){return new LA(r,e)}var qp={exports:{}},Nv,lx;function G1(){if(lx)return Nv;lx=1,Nv=r;function r(e,n){this.x=e,this.y=n}return r.prototype={clone:function(){return new r(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,n){return this.clone()._rotateAround(e,n)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var n=e.x-this.x,h=e.y-this.y;return n*n+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,n){return Math.atan2(this.x*n-this.y*e,this.x*e+this.y*n)},_matMult:function(e){var n=e[0]*this.x+e[1]*this.y,h=e[2]*this.x+e[3]*this.y;return this.x=n,this.y=h,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var n=Math.cos(e),h=Math.sin(e),_=n*this.x-h*this.y,T=h*this.x+n*this.y;return this.x=_,this.y=T,this},_rotateAround:function(e,n){var h=Math.cos(e),_=Math.sin(e),T=n.x+h*(this.x-n.x)-_*(this.y-n.y),S=n.y+_*(this.x-n.x)+h*(this.y-n.y);return this.x=T,this.y=S,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},r.convert=function(e){return e instanceof r?e:Array.isArray(e)?new r(e[0],e[1]):e},Nv}var Mg={},Uv,cx;function q1(){if(cx)return Uv;cx=1;var r=G1();Uv=e;function e(S,u,k,B,q){this.properties={},this.extent=k,this.type=0,this._pbf=S,this._geometry=-1,this._keys=B,this._values=q,S.readFields(n,this,u)}function n(S,u,k){S==1?u.id=k.readVarint():S==2?h(k,u):S==3?u.type=k.readVarint():S==4&&(u._geometry=k.pos)}function h(S,u){for(var k=S.readVarint()+S.pos;S.pos<k;){var B=u._keys[S.readVarint()],q=u._values[S.readVarint()];u.properties[B]=q}}e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var S=this._pbf;S.pos=this._geometry;for(var u=S.readVarint()+S.pos,k=1,B=0,q=0,oe=0,ne=[],K;S.pos<u;){if(B<=0){var le=S.readVarint();k=le&7,B=le>>3}if(B--,k===1||k===2)q+=S.readSVarint(),oe+=S.readSVarint(),k===1&&(K&&ne.push(K),K=[]),K.push(new r(q,oe));else if(k===7)K&&K.push(K[0].clone());else throw new Error("unknown command "+k)}return K&&ne.push(K),ne},e.prototype.bbox=function(){var S=this._pbf;S.pos=this._geometry;for(var u=S.readVarint()+S.pos,k=1,B=0,q=0,oe=0,ne=1/0,K=-1/0,le=1/0,Ge=-1/0;S.pos<u;){if(B<=0){var tt=S.readVarint();k=tt&7,B=tt>>3}if(B--,k===1||k===2)q+=S.readSVarint(),oe+=S.readSVarint(),q<ne&&(ne=q),q>K&&(K=q),oe<le&&(le=oe),oe>Ge&&(Ge=oe);else if(k!==7)throw new Error("unknown command "+k)}return[ne,le,K,Ge]},e.prototype.toGeoJSON=function(S,u,k){var B=this.extent*Math.pow(2,k),q=this.extent*S,oe=this.extent*u,ne=this.loadGeometry(),K=e.types[this.type],le,Ge;function tt(bt){for(var It=0;It<bt.length;It++){var wt=bt[It],zt=180-(wt.y+oe)*360/B;bt[It]=[(wt.x+q)*360/B-180,360/Math.PI*Math.atan(Math.exp(zt*Math.PI/180))-90]}}switch(this.type){case 1:var Ke=[];for(le=0;le<ne.length;le++)Ke[le]=ne[le][0];ne=Ke,tt(ne);break;case 2:for(le=0;le<ne.length;le++)tt(ne[le]);break;case 3:for(ne=_(ne),le=0;le<ne.length;le++)for(Ge=0;Ge<ne[le].length;Ge++)tt(ne[le][Ge]);break}ne.length===1?ne=ne[0]:K="Multi"+K;var ht={type:"Feature",geometry:{type:K,coordinates:ne},properties:this.properties};return"id"in this&&(ht.id=this.id),ht};function _(S){var u=S.length;if(u<=1)return[S];for(var k=[],B,q,oe=0;oe<u;oe++){var ne=T(S[oe]);ne!==0&&(q===void 0&&(q=ne<0),q===ne<0?(B&&k.push(B),B=[S[oe]]):B.push(S[oe]))}return B&&k.push(B),k}function T(S){for(var u=0,k=0,B=S.length,q=B-1,oe,ne;k<B;q=k++)oe=S[k],ne=S[q],u+=(ne.x-oe.x)*(oe.y+ne.y);return u}return Uv}var jv,ux;function $1(){if(ux)return jv;ux=1;var r=q1();jv=e;function e(_,T){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=_,this._keys=[],this._values=[],this._features=[],_.readFields(n,this,T),this.length=this._features.length}function n(_,T,S){_===15?T.version=S.readVarint():_===1?T.name=S.readString():_===5?T.extent=S.readVarint():_===2?T._features.push(S.pos):_===3?T._keys.push(S.readString()):_===4&&T._values.push(h(S))}function h(_){for(var T=null,S=_.readVarint()+_.pos;_.pos<S;){var u=_.readVarint()>>3;T=u===1?_.readString():u===2?_.readFloat():u===3?_.readDouble():u===4?_.readVarint64():u===5?_.readVarint():u===6?_.readSVarint():u===7?_.readBoolean():null}return T}return e.prototype.feature=function(_){if(_<0||_>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[_];var T=this._pbf.readVarint()+this._pbf.pos;return new r(this._pbf,T,this.extent,this._keys,this._values)},jv}var Vv,hx;function UA(){if(hx)return Vv;hx=1;var r=$1();Vv=e;function e(h,_){this.layers=h.readFields(n,{},_)}function n(h,_,T){if(h===3){var S=new r(T,T.readVarint()+T.pos);S.length&&(_[S.name]=S)}}return Vv}var dx;function jA(){return dx||(dx=1,Mg.VectorTile=UA(),Mg.VectorTileFeature=q1(),Mg.VectorTileLayer=$1()),Mg}var Zv,fx;function VA(){if(fx)return Zv;fx=1;var r=G1(),e=jA().VectorTileFeature;Zv=n;function n(_,T){this.options=T||{},this.features=_,this.length=_.length}n.prototype.feature=function(_){return new h(this.features[_],this.options.extent)};function h(_,T){this.id=typeof _.id=="number"?_.id:void 0,this.type=_.type,this.rawGeometry=_.type===1?[_.geometry]:_.geometry,this.properties=_.tags,this.extent=T||4096}return h.prototype.loadGeometry=function(){var _=this.rawGeometry;this.geometry=[];for(var T=0;T<_.length;T++){for(var S=_[T],u=[],k=0;k<S.length;k++)u.push(new r(S[k][0],S[k][1]));this.geometry.push(u)}return this.geometry},h.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var _=this.geometry,T=1/0,S=-1/0,u=1/0,k=-1/0,B=0;B<_.length;B++)for(var q=_[B],oe=0;oe<q.length;oe++){var ne=q[oe];T=Math.min(T,ne.x),S=Math.max(S,ne.x),u=Math.min(u,ne.y),k=Math.max(k,ne.y)}return[T,u,S,k]},h.prototype.toGeoJSON=e.prototype.toGeoJSON,Zv}var px;function ZA(){if(px)return qp.exports;px=1;var r=U1(),e=VA();qp.exports=n,qp.exports.fromVectorTileJs=n,qp.exports.fromGeojsonVt=h,qp.exports.GeoJSONWrapper=e;function n(ne){var K=new r;return _(ne,K),K.finish()}function h(ne,K){K=K||{};var le={};for(var Ge in ne)le[Ge]=new e(ne[Ge].features,K),le[Ge].name=Ge,le[Ge].version=K.version,le[Ge].extent=K.extent;return n({layers:le})}function _(ne,K){for(var le in ne.layers)K.writeMessage(3,T,ne.layers[le])}function T(ne,K){K.writeVarintField(15,ne.version||1),K.writeStringField(1,ne.name||""),K.writeVarintField(5,ne.extent||4096);var le,Ge={keys:[],values:[],keycache:{},valuecache:{}};for(le=0;le<ne.length;le++)Ge.feature=ne.feature(le),K.writeMessage(2,S,Ge);var tt=Ge.keys;for(le=0;le<tt.length;le++)K.writeStringField(3,tt[le]);var Ke=Ge.values;for(le=0;le<Ke.length;le++)K.writeMessage(4,oe,Ke[le])}function S(ne,K){var le=ne.feature;le.id!==void 0&&K.writeVarintField(1,le.id),K.writeMessage(2,u,ne),K.writeVarintField(3,le.type),K.writeMessage(4,q,le)}function u(ne,K){var le=ne.feature,Ge=ne.keys,tt=ne.values,Ke=ne.keycache,ht=ne.valuecache;for(var bt in le.properties){var It=le.properties[bt],wt=Ke[bt];if(It!==null){typeof wt>"u"&&(Ge.push(bt),wt=Ge.length-1,Ke[bt]=wt),K.writeVarint(wt);var zt=typeof It;zt!=="string"&&zt!=="boolean"&&zt!=="number"&&(It=JSON.stringify(It));var Pt=zt+":"+It,ut=ht[Pt];typeof ut>"u"&&(tt.push(It),ut=tt.length-1,ht[Pt]=ut),K.writeVarint(ut)}}}function k(ne,K){return(K<<3)+(ne&7)}function B(ne){return ne<<1^ne>>31}function q(ne,K){for(var le=ne.loadGeometry(),Ge=ne.type,tt=0,Ke=0,ht=le.length,bt=0;bt<ht;bt++){var It=le[bt],wt=1;Ge===1&&(wt=It.length),K.writeVarint(k(1,wt));for(var zt=Ge===3?It.length-1:It.length,Pt=0;Pt<zt;Pt++){Pt===1&&Ge!==1&&K.writeVarint(k(2,zt-1));var ut=It[Pt].x-tt,Mt=It[Pt].y-Ke;K.writeVarint(B(ut)),K.writeVarint(B(Mt)),tt+=ut,Ke+=Mt}Ge===3&&K.writeVarint(k(7,1))}}function oe(ne,K){var le=typeof ne;le==="string"?K.writeStringField(1,ne):le==="boolean"?K.writeBooleanField(7,ne):le==="number"&&(ne%1!==0?K.writeDoubleField(3,ne):ne<0?K.writeSVarintField(6,ne):K.writeVarintField(5,ne))}return qp.exports}var GA=ZA();const qA=z0(GA);function $A(r,e,n,h){const T=NA({type:"FeatureCollection",features:r},{generateId:!0,indexMaxZoom:e,maxZoom:e,buffer:0,tolerance:0,extent:4096}).getTile(e,n,h);return T?qA.fromGeojsonVt({v:T}):(console.log("No tile found for coordinates:",{z:e,x:n,y:h}),new Uint8Array)}const HA=r=>{if(r>=15)return 0;const e=.001,_=(0-e)/(15-0),T=e,S=_*r+T;return Number(S.toFixed(6))},YA=r=>{const{zxy:e,selectedTable:n,selectedColumns:h}=r,_=h.length>0?h.join(", "):"1 as dummy",T=HA(e.z);return console.log(`z: ${e.z}, simplify level: ${T}`),`
        WITH filtered AS (
            -- 
            SELECT 
                geom,
                ${_}
            FROM ${n}
            WHERE ST_Intersects(
                geom,
                -- bbox,
                ST_MakeEnvelope(?, ?, ?, ?)
            )
        )
        SELECT 
            ST_AsGeoJSON(
                ST_Simplify(geom, ${T})
            ) AS geojson,
            ${_}
        FROM filtered
    `},XA=({db:r,selectedTable:e,selectedColumns:n})=>{const[h,_]=Je.useState(null),[T,S]=Je.useState(!0),[u,k]=Je.useState(5),B=Je.useRef(null),q=Je.useRef(null),oe=Je.useRef(new Map),ne=K=>{const le=parseInt(K.target.value,10);k(le)};return Je.useEffect(()=>{const K=new Date;if(console.log(` 0 ${K.toISOString()} start `),console.log(""),r)_(null);else{console.error("DuckDB is not initialized");return}(async()=>{try{if(q.current=await r.connect(),!q.current){console.error("Failed to connect to DuckDB"),_("DuckDB");return}Pv.addProtocol("duckdb-vector",async tt=>{console.log("Protocol handler called with URL:",tt.url);const Ke=EA(tt.url);if(!Ke)throw new Error("invalid tile url: "+tt.url);const ht=`${Ke.z}/${Ke.x}/${Ke.y}`,bt=new Date;if(console.log(` ${ht} 1 ${bt.toISOString()} start addProtocol`),oe.current.has(ht))return console.log(` ${ht} 2 using cached tile`),{data:oe.current.get(ht)};console.log(`Processing tile: z: ${Ke.z}, x: ${Ke.x}, y: ${Ke.y}`);try{if(!q.current)throw new Error("Database connection is not available");const{minLng:It,minLat:wt,maxLng:zt,maxLat:Pt}=MA(Ke.z,Ke.x,Ke.y);if(console.log(`Tile bounds: minLng=${It}, maxLng=${zt}, minLat=${wt}, maxLat=${Pt}`),!e)return console.log("No table selected"),{data:new Uint8Array};const ut=YA({zxy:Ke,selectedTable:e,selectedColumns:n});console.log("query: "+ut);const Mt=new Date;console.log("Executing query:",ut),console.log(` ${ht} 2 ${Mt.toISOString()} start duckdb query`);const bi=await(await q.current.prepare(ut)).query(It,wt,zt,Pt),te=new Date,be=te.getTime()-Mt.getTime();if(console.log(`Query returned ${bi.numRows} rows`),console.log(` ${ht} 3 ${te.toISOString()} end duckdb query, elapsed: ${be}ms ${bi.numRows} rows`),bi.numRows===0)return console.log(` ${ht} 3 No data found for this tile`),console.log("cache io set key:",ht),oe.current.set(ht,new Uint8Array),{data:new Uint8Array};const Fe=bi.toArray(),xt=new Date;console.log(` ${ht} 4 ${xt.toISOString()} start feature`);const Ae=Fe.map(zi=>{try{if(!zi.geojson)return console.warn("Empty geojson for row:",zi),null;const Fn=JSON.parse(zi.geojson),Is={};return n.forEach(qn=>{qn in zi&&(Is[qn]=zi[qn])}),{type:"Feature",geometry:Fn,properties:Is}}catch(Fn){return console.error("Error parsing GeoJSON:",Fn),null}}).filter(zi=>zi!==null),st=new Date,Ct=st.getTime()-xt.getTime();if(console.log(` ${ht} 5 ${st.toISOString()} end feature, elapsed: ${Ct}ms`),Ae.length===0)return console.log(` ${ht} 6 No valid features found`),console.log("cache io set key:",ht),oe.current.set(ht,new Uint8Array),{data:new Uint8Array};const yi=new Date;console.log(` ${ht} 6 ${yi.toISOString()} start vector`);const xe=$A(Ae,Ke.z,Ke.x,Ke.y),lt=new Date,Dt=lt.getTime()-yi.getTime();console.log(` ${ht} 7 ${lt.toISOString()} end  vector, elapsed: ${Dt}ms`),console.log("Vector tile generated, size:",xe.length);const vt=new Uint8Array(xe.length);vt.set(xe),console.log("cache io set key:",ht);const Zt=new Uint8Array(vt.length);Zt.set(vt),oe.current.set(ht,Zt);const ti=new Uint8Array(vt.length);ti.set(vt);const Jt=new Date,ar=Jt.getTime()-bt.getTime();return console.log(` ${ht} 8 ${Jt.toISOString()} end addProtocol, total elapsed: ${ar}ms`),{data:ti}}catch(It){return console.error("Error processing tile:",It),{data:new Uint8Array}}});const Ge=new Pv.Map({container:"map",zoom:u,center:[139.7482,35.6591],style:{version:8,glyphs:"https://fonts.openmaptiles.org/{fontstack}/{range}.pbf",sources:{osm:{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],maxzoom:19,tileSize:256,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},"duckdb-vector":{type:"vector",tiles:["duckdb-vector://{z}/{x}/{y}.pbf"],minzoom:0,maxzoom:24}},layers:[{id:"osm-layer",source:"osm",type:"raster"},{id:"duckdb-polygons",source:"duckdb-vector","source-layer":"v",type:"fill",paint:{"fill-color":"#ff6600","fill-opacity":.5,"fill-outline-color":"#ff6600"},filter:["==","$type","Polygon"],minzoom:0,maxzoom:24},{id:"duckdb-lines",source:"duckdb-vector","source-layer":"v",type:"line",paint:{"line-color":"#ff6600","line-width":2,"line-opacity":.8},filter:["==","$type","LineString"],minzoom:0,maxzoom:24},{id:"duckdb-points",source:"duckdb-vector","source-layer":"v",type:"circle",paint:{"circle-radius":6,"circle-color":"#ff0000","circle-stroke-width":1,"circle-stroke-color":"#ffffff"},filter:["==","$type","Point"],minzoom:0,maxzoom:24}]}});return B.current=Ge,Ge.on("load",()=>{const tt=new Date,Ke=tt.getTime()-K.getTime();console.log(` 9 ${tt.toISOString()} end , total elapsed: ${Ke}ms`),console.log(""),S(!1);const ht=new Pv.Popup({closeButton:!0,closeOnClick:!0,offset:25}),bt=zt=>{var Fe;if(!((Fe=zt.features)!=null&&Fe[0]))return;const Pt=zt.features[0],ut=Pt.geometry,Mt=Pt.properties,Ri=zt.lngLat;let bi="";if(ut.type==="Point"){const xt=ut;bi=`
                                <p>: ${xt.coordinates[1].toFixed(6)}</p>
                                <p>: ${xt.coordinates[0].toFixed(6)}</p>
                            `}else if(ut.type==="LineString"){const xt=ut;bi=`
                                <p>:</p>
                                <p>: ${Ri.lat.toFixed(6)}</p>
                                <p>: ${Ri.lng.toFixed(6)}</p>
                                <p>: ${xt.coordinates.length}</p>
                            `}else if(ut.type==="Polygon"){const xt=ut,Ae=xt.coordinates.reduce((st,Ct)=>st+Ct.length,0);bi=`
                                <p>:</p>
                                <p>: ${Ri.lat.toFixed(6)}</p>
                                <p>: ${Ri.lng.toFixed(6)}</p>
                                <p>: ${xt.coordinates.length}</p>
                                <p>: ${Ae}</p>
                            `}let te="";n.length>0&&(te=`
                                <div style="margin-top: 10px;">
                                    <h4></h4>
                                    ${n.map(xt=>{const Ae=Mt==null?void 0:Mt[xt];return`<p>${xt}: ${Ae!==void 0?Ae:"N/A"}</p>`}).join("")}
                                </div>
                            `);const be=`
                            <div style="padding: 10px;">
                                <h3>${ut.type} </h3>
                                ${bi}
                                ${te}
                            </div>
                        `;ht.setLngLat(Ri).setHTML(be).addTo(Ge)};Ge.on("click","duckdb-points",bt),Ge.on("click","duckdb-lines",bt),Ge.on("click","duckdb-polygons",bt);const It=()=>{Ge.getCanvas().style.cursor="pointer"},wt=()=>{Ge.getCanvas().style.cursor=""};Ge.on("mouseenter","duckdb-points",It),Ge.on("mouseenter","duckdb-lines",It),Ge.on("mouseenter","duckdb-polygons",It),Ge.on("mouseleave","duckdb-points",wt),Ge.on("mouseleave","duckdb-lines",wt),Ge.on("mouseleave","duckdb-polygons",wt)}),()=>{Ge&&Ge.remove(),q.current&&q.current.close()}}catch(Ge){console.error("Error initializing map:",Ge),_(`: ${Ge instanceof Error?Ge.message:String(Ge)}`),S(!1)}})()},[r,e,n,u]),Tt.jsxs("div",{style:{position:"relative",width:"100%",height:"100vh"},children:[Tt.jsx("div",{id:"map",style:{height:"90%",aspectRatio:"1/1",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}}),Tt.jsx("div",{style:{position:"absolute",top:"10px",right:"10px",zIndex:1,background:"white",padding:"5px",borderRadius:"5px",boxShadow:"0 0 10px rgba(0,0,0,0.1)"},children:Tt.jsx("select",{value:u,onChange:ne,style:{padding:"5px",borderRadius:"4px",border:"1px solid #ccc"},children:Array.from({length:31},(K,le)=>Tt.jsxs("option",{value:le,children:[" ",le]},le))})}),T&&Tt.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(255, 255, 255, 0.8)",padding:"10px",borderRadius:"5px"},children:"..."}),h&&Tt.jsxs("div",{style:{position:"absolute",top:"10px",left:"10px",background:"rgba(255, 0, 0, 0.7)",color:"white",padding:"10px",borderRadius:"5px",maxWidth:"80%"},children:[": ",h]})]})},KA=({db:r,onTableCreated:e})=>{const[n,h]=Je.useState(""),[_,T]=Je.useState(!1),[S,u]=Je.useState(null),[k,B]=Je.useState(!1),q=ne=>{h(ne.target.value)},oe=async()=>{if(!r||!n.trim())return;T(!0),document.body.classList.add("creating-table");let ne=null;try{ne=await r.connect(),await ne.query("LOAD spatial;");let le=(n.split("/").pop()||"remote_file").split(".")[0].replace(/[^a-zA-Z0-9_]/g,"_");/^\d/.test(le)&&(le=`t_${le}`);const tt=n.toLowerCase().endsWith(".parquet")?`CREATE TABLE ${le} AS SELECT * FROM '${n}'`:`CREATE TABLE ${le} AS SELECT * FROM st_read('${n}')`;await ne.query(tt),await ne.query(`CREATE INDEX ${le}_idx ON ${le} USING RTREE (geom);`),await ne.query("CHECKPOINT;"),console.log("Table created and checkpoint executed:",le),u(null),h(""),e==null||e()}catch(K){console.error("Query error:",K),u(K instanceof Error?K.message:"Unknown error occurred")}finally{ne&&await ne.close(),T(!1),document.body.classList.remove("creating-table")}};return Tt.jsxs("div",{className:"remote-file",children:[Tt.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[Tt.jsx("h3",{style:{margin:0},children:"Remote File"}),Tt.jsx("button",{onClick:()=>B(!k),disabled:!r,children:k?"":""})]}),k&&Tt.jsxs("div",{style:{backgroundColor:"#f5f5f5",padding:"10px",borderRadius:"4px",display:"flex",flexDirection:"column",gap:"10px"},children:[Tt.jsxs("div",{className:"file-upload",children:[Tt.jsx("input",{type:"url",value:n,onChange:q,placeholder:"Enter file URL (.parquet, .geojson, .shp)",style:{flex:1,padding:"0.5em"}}),Tt.jsx("button",{onClick:oe,disabled:!r||!n.trim()||_,children:_?"...":"Create Table from URL"})]}),_&&Tt.jsx("div",{style:{color:"#0066cc",marginLeft:"2px"},children:"..."}),S&&Tt.jsxs("div",{style:{color:"red"},children:["Error: ",S]})]})]})},WA=({db:r,selectedTable:e,onTableSelect:n,selectedColumns:h,onColumnSelect:_,onTableCreated:T})=>{const[S,u]=Je.useState(!0),[k,B]=Je.useState([]),[q,oe]=Je.useState({}),[ne,K]=Je.useState({}),[le,Ge]=Je.useState(null),[tt,Ke]=Je.useState(null),ht=async ut=>{if(r)try{const Mt=await r.connect(),bi=(await Mt.query(`DESCRIBE ${ut};`)).toArray().map(te=>({name:te.column_name,type:te.column_type}));oe(te=>({...te,[ut]:bi})),await Mt.close()}catch(Mt){console.error("Error fetching table columns:",Mt)}},bt=async()=>{var ut;if(r)try{const Mt=await r.connect(),Ri=await Mt.query("SHOW TABLES;"),bi=[];for(let be=0;be<Ri.numRows;be++)bi.push((ut=Ri.getChildAt(0))==null?void 0:ut.get(be));const te=await Promise.all(bi.map(async be=>{var xt;const Fe=await Mt.query(`SELECT COUNT(*) as count FROM ${be}`);return{name:be,count:(xt=Fe.getChildAt(0))==null?void 0:xt.get(0)}}));B(te),await Mt.close();for(const be of te)await ht(be.name)}catch(Mt){console.error("Error fetching tables:",Mt)}};Je.useEffect(()=>{T&&T(),bt()},[r]);const It=ut=>{K(Mt=>({...Mt,[ut]:!Mt[ut]}))},wt=(ut,Mt)=>{const Ri=h[ut]||[],bi=Ri.includes(Mt)?Ri.filter(te=>te!==Mt):[...Ri,Mt];_(ut,bi)},zt=async ut=>{if(r)try{const Mt=await r.connect(),bi=(await Mt.query(`
                SELECT 
                    ST_AsGeoJSON(geom) as geom_json,
                    * EXCLUDE (geom)
                FROM ${ut};
            `)).toArray().map(te=>{const be={...te};return be.geom_json&&(be.geom=JSON.parse(be.geom_json),delete be.geom_json),be});Ge(bi),Ke(null),await Mt.close()}catch(Mt){console.error("Error fetching table data:",Mt),Ke(Mt instanceof Error?Mt.message:"Unknown error occurred"),Ge(null)}},Pt=async ut=>{if(r&&window.confirm(` "${ut}" `))try{const Mt=await r.connect();await Mt.query(`DROP TABLE ${ut};`),await Mt.close(),console.log("Table deleted:",ut),bt()}catch(Mt){console.error("Error deleting table:",Mt),alert("")}};return Tt.jsxs("div",{children:[Tt.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px"},children:[Tt.jsx("h3",{style:{margin:0},children:""}),Tt.jsx("button",{onClick:()=>u(!S),disabled:!r,children:S?"":""})]}),S&&Tt.jsxs("div",{className:"table-list",children:[Tt.jsx("ul",{children:k.map(ut=>Tt.jsxs("li",{className:"table-item",children:[Tt.jsxs("div",{className:"table-name-container",children:[Tt.jsx("input",{type:"radio",name:"table-select",id:`table-${ut.name}`,checked:e===ut.name,onChange:()=>n(ut.name)}),Tt.jsxs("label",{htmlFor:`table-${ut.name}`,children:[Tt.jsx("span",{className:"table-name",children:ut.name}),Tt.jsxs("span",{className:"table-count",children:["(",ut.count.toLocaleString(),")"]})]}),Tt.jsx("button",{className:"column-button",onClick:Mt=>{Mt.stopPropagation(),It(ut.name)},children:""}),Tt.jsxs("div",{className:"table-buttons",children:[Tt.jsx("button",{onClick:()=>zt(ut.name),children:""}),Tt.jsx("button",{onClick:()=>Pt(ut.name),children:""})]})]}),q[ut.name]&&ne[ut.name]&&Tt.jsx("div",{className:"table-columns",children:Tt.jsxs("table",{children:[Tt.jsx("thead",{children:Tt.jsxs("tr",{children:[Tt.jsx("th",{children:""}),Tt.jsx("th",{children:""}),Tt.jsx("th",{children:""})]})}),Tt.jsx("tbody",{children:q[ut.name].map(Mt=>Tt.jsxs("tr",{children:[Tt.jsx("td",{children:Tt.jsx("input",{type:"checkbox",checked:(h[ut.name]||[]).includes(Mt.name),onChange:()=>wt(ut.name,Mt.name)})}),Tt.jsx("td",{children:Mt.name}),Tt.jsx("td",{children:Mt.type})]},Mt.name))})]})})]},ut.name))}),tt&&Tt.jsx("div",{className:"query-error",children:tt}),le&&Tt.jsx("div",{className:"query-result",children:Tt.jsxs("table",{children:[Tt.jsx("thead",{children:Tt.jsx("tr",{children:Object.keys(le[0]).map(ut=>Tt.jsx("th",{children:ut},ut))})}),Tt.jsx("tbody",{children:le.map((ut,Mt)=>Tt.jsx("tr",{children:Object.entries(ut).map(([Ri,bi])=>Tt.jsx("td",{children:Ri==="geom"?Tt.jsx("pre",{children:JSON.stringify(bi,null,2)}):String(bi)},Ri))},Mt))})]})})]})]})};function Ti(r,e,n,h){function _(T){return T instanceof n?T:new n(function(S){S(T)})}return new(n||(n=Promise))(function(T,S){function u(q){try{B(h.next(q))}catch(oe){S(oe)}}function k(q){try{B(h.throw(q))}catch(oe){S(oe)}}function B(q){q.done?T(q.value):_(q.value).then(u,k)}B((h=h.apply(r,e||[])).next())})}function mx(r){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&r[e],h=0;if(n)return n.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&h>=r.length&&(r=void 0),{value:r&&r[h++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ni(r){return this instanceof Ni?(this.v=r,this):new Ni(r)}function iu(r,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var h=n.apply(r,e||[]),_,T=[];return _=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",S),_[Symbol.asyncIterator]=function(){return this},_;function S(K){return function(le){return Promise.resolve(le).then(K,oe)}}function u(K,le){h[K]&&(_[K]=function(Ge){return new Promise(function(tt,Ke){T.push([K,Ge,tt,Ke])>1||k(K,Ge)})},le&&(_[K]=le(_[K])))}function k(K,le){try{B(h[K](le))}catch(Ge){ne(T[0][3],Ge)}}function B(K){K.value instanceof Ni?Promise.resolve(K.value.v).then(q,oe):ne(T[0][2],K)}function q(K){k("next",K)}function oe(K){k("throw",K)}function ne(K,le){K(le),T.shift(),T.length&&k(T[0][0],T[0][1])}}function ry(r){var e,n;return e={},h("next"),h("throw",function(_){throw _}),h("return"),e[Symbol.iterator]=function(){return this},e;function h(_,T){e[_]=r[_]?function(S){return(n=!n)?{value:Ni(r[_](S)),done:!1}:T?T(S):S}:T}}function Ff(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],n;return e?e.call(r):(r=typeof mx=="function"?mx(r):r[Symbol.iterator](),n={},h("next"),h("throw"),h("return"),n[Symbol.asyncIterator]=function(){return this},n);function h(T){n[T]=r[T]&&function(S){return new Promise(function(u,k){S=r[T](S),_(u,k,S.done,S.value)})}}function _(T,S,u,k){Promise.resolve(k).then(function(B){T({value:B,done:u})},S)}}const QA=new TextDecoder("utf-8"),v0=r=>QA.decode(r),JA=new TextEncoder,q0=r=>JA.encode(r),eI=r=>typeof r=="number",H1=r=>typeof r=="boolean",ua=r=>typeof r=="function",to=r=>r!=null&&Object(r)===r,Uf=r=>to(r)&&ua(r.then),r_=r=>to(r)&&ua(r[Symbol.iterator]),wm=r=>to(r)&&ua(r[Symbol.asyncIterator]),b0=r=>to(r)&&to(r.schema),Y1=r=>to(r)&&"done"in r&&"value"in r,X1=r=>to(r)&&ua(r.stat)&&eI(r.fd),K1=r=>to(r)&&$0(r.body),lv=r=>"_getDOMStream"in r&&"_getNodeStream"in r,tI=r=>to(r)&&ua(r.abort)&&ua(r.getWriter)&&!lv(r),$0=r=>to(r)&&ua(r.cancel)&&ua(r.getReader)&&!lv(r),iI=r=>to(r)&&ua(r.end)&&ua(r.write)&&H1(r.writable)&&!lv(r),W1=r=>to(r)&&ua(r.read)&&ua(r.pipe)&&H1(r.readable)&&!lv(r),nI=r=>to(r)&&ua(r.clear)&&ua(r.bytes)&&ua(r.position)&&ua(r.setPosition)&&ua(r.capacity)&&ua(r.getBufferIdentifier)&&ua(r.createLong),H0=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:ArrayBuffer;function rI(r){const e=r[0]?[r[0]]:[];let n,h,_,T;for(let S,u,k=0,B=0,q=r.length;++k<q;){if(S=e[B],u=r[k],!S||!u||S.buffer!==u.buffer||u.byteOffset<S.byteOffset){u&&(e[++B]=u);continue}if({byteOffset:n,byteLength:_}=S,{byteOffset:h,byteLength:T}=u,n+_<h||h+T<n){u&&(e[++B]=u);continue}e[B]=new Uint8Array(S.buffer,n,h-n+T)}return e}function gx(r,e,n=0,h=e.byteLength){const _=r.byteLength,T=new Uint8Array(r.buffer,r.byteOffset,_),S=new Uint8Array(e.buffer,e.byteOffset,Math.min(h,_));return T.set(S,n),r}function su(r,e){const n=rI(r),h=n.reduce((q,oe)=>q+oe.byteLength,0);let _,T,S,u=0,k=-1;const B=Math.min(e||Number.POSITIVE_INFINITY,h);for(const q=n.length;++k<q;){if(_=n[k],T=_.subarray(0,Math.min(_.length,B-u)),B<=u+T.length){T.length<_.length?n[k]=_.subarray(T.length):T.length===_.length&&k++,S?gx(S,T,u):S=T;break}gx(S||(S=new Uint8Array(B)),T,u),u+=T.length}return[S||new Uint8Array(0),n.slice(k),h-(S?S.byteLength:0)]}function Bn(r,e){let n=Y1(e)?e.value:e;return n instanceof r?r===Uint8Array?new r(n.buffer,n.byteOffset,n.byteLength):n:n?(typeof n=="string"&&(n=q0(n)),n instanceof ArrayBuffer?new r(n):n instanceof H0?new r(n):nI(n)?Bn(r,n.bytes()):ArrayBuffer.isView(n)?n.byteLength<=0?new r(0):new r(n.buffer,n.byteOffset,n.byteLength/r.BYTES_PER_ELEMENT):r.from(n)):new r(0)}const Ag=r=>Bn(Int32Array,r),_x=r=>Bn(BigInt64Array,r),Qi=r=>Bn(Uint8Array,r),x0=r=>(r.next(),r);function*aI(r,e){const n=function*(_){yield _},h=typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof H0?n(e):r_(e)?e:n(e);return yield*x0(function*(_){let T=null;do T=_.next(yield Bn(r,T));while(!T.done)}(h[Symbol.iterator]())),new r}const sI=r=>aI(Uint8Array,r);function Q1(r,e){return iu(this,arguments,function*(){if(Uf(e))return yield Ni(yield Ni(yield*ry(Ff(Q1(r,yield Ni(e))))));const h=function(S){return iu(this,arguments,function*(){yield yield Ni(yield Ni(S))})},_=function(S){return iu(this,arguments,function*(){yield Ni(yield*ry(Ff(x0(function*(u){let k=null;do k=u.next(yield k==null?void 0:k.value);while(!k.done)}(S[Symbol.iterator]())))))})},T=typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof H0?h(e):r_(e)?_(e):wm(e)?e:h(e);return yield Ni(yield*ry(Ff(x0(function(S){return iu(this,arguments,function*(){let u=null;do u=yield Ni(S.next(yield yield Ni(Bn(r,u))));while(!u.done)})}(T[Symbol.asyncIterator]()))))),yield Ni(new r)})}const oI=r=>Q1(Uint8Array,r);function J1(r,e,n){if(r!==0){n=n.slice(0,e);for(let h=-1,_=n.length;++h<_;)n[h]+=r}return n.subarray(0,e)}function lI(r,e){let n=0;const h=r.length;if(h!==e.length)return!1;if(h>0)do if(r[n]!==e[n])return!1;while(++n<h);return!0}const hl={fromIterable(r){return W_(cI(r))},fromAsyncIterable(r){return W_(uI(r))},fromDOMStream(r){return W_(hI(r))},fromNodeStream(r){return W_(fI(r))},toDOMStream(r,e){throw new Error('"toDOMStream" not available in this environment')},toNodeStream(r,e){throw new Error('"toNodeStream" not available in this environment')}},W_=r=>(r.next(),r);function*cI(r){let e,n=!1,h=[],_,T,S,u=0;function k(){return T==="peek"?su(h,S)[0]:([_,h,u]=su(h,S),_)}({cmd:T,size:S}=(yield null)||{cmd:"read",size:0});const B=sI(r)[Symbol.iterator]();try{do if({done:e,value:_}=Number.isNaN(S-u)?B.next():B.next(S-u),!e&&_.byteLength>0&&(h.push(_),u+=_.byteLength),e||S<=u)do({cmd:T,size:S}=yield k());while(S<u);while(!e)}catch(q){(n=!0)&&typeof B.throw=="function"&&B.throw(q)}finally{n===!1&&typeof B.return=="function"&&B.return(null)}return null}function uI(r){return iu(this,arguments,function*(){let n,h=!1,_=[],T,S,u,k=0;function B(){return S==="peek"?su(_,u)[0]:([T,_,k]=su(_,u),T)}({cmd:S,size:u}=(yield yield Ni(null))||{cmd:"read",size:0});const q=oI(r)[Symbol.asyncIterator]();try{do if({done:n,value:T}=Number.isNaN(u-k)?yield Ni(q.next()):yield Ni(q.next(u-k)),!n&&T.byteLength>0&&(_.push(T),k+=T.byteLength),n||u<=k)do({cmd:S,size:u}=yield yield Ni(B()));while(u<k);while(!n)}catch(oe){(h=!0)&&typeof q.throw=="function"&&(yield Ni(q.throw(oe)))}finally{h===!1&&typeof q.return=="function"&&(yield Ni(q.return(new Uint8Array(0))))}return yield Ni(null)})}function hI(r){return iu(this,arguments,function*(){let n=!1,h=!1,_=[],T,S,u,k=0;function B(){return S==="peek"?su(_,u)[0]:([T,_,k]=su(_,u),T)}({cmd:S,size:u}=(yield yield Ni(null))||{cmd:"read",size:0});const q=new dI(r);try{do if({done:n,value:T}=Number.isNaN(u-k)?yield Ni(q.read()):yield Ni(q.read(u-k)),!n&&T.byteLength>0&&(_.push(Qi(T)),k+=T.byteLength),n||u<=k)do({cmd:S,size:u}=yield yield Ni(B()));while(u<k);while(!n)}catch(oe){(h=!0)&&(yield Ni(q.cancel(oe)))}finally{h===!1?yield Ni(q.cancel()):r.locked&&q.releaseLock()}return yield Ni(null)})}class dI{constructor(e){this.source=e,this.reader=null,this.reader=this.source.getReader(),this.reader.closed.catch(()=>{})}get closed(){return this.reader?this.reader.closed.catch(()=>{}):Promise.resolve()}releaseLock(){this.reader&&this.reader.releaseLock(),this.reader=null}cancel(e){return Ti(this,void 0,void 0,function*(){const{reader:n,source:h}=this;n&&(yield n.cancel(e).catch(()=>{})),h&&h.locked&&this.releaseLock()})}read(e){return Ti(this,void 0,void 0,function*(){if(e===0)return{done:this.reader==null,value:new Uint8Array(0)};const n=yield this.reader.read();return!n.done&&(n.value=Qi(n)),n})}}const Gv=(r,e)=>{const n=_=>h([e,_]);let h;return[e,n,new Promise(_=>(h=_)&&r.once(e,n))]};function fI(r){return iu(this,arguments,function*(){const n=[];let h="error",_=!1,T=null,S,u,k=0,B=[],q;function oe(){return S==="peek"?su(B,u)[0]:([q,B,k]=su(B,u),q)}if({cmd:S,size:u}=(yield yield Ni(null))||{cmd:"read",size:0},r.isTTY)return yield yield Ni(new Uint8Array(0)),yield Ni(null);try{n[0]=Gv(r,"end"),n[1]=Gv(r,"error");do{if(n[2]=Gv(r,"readable"),[h,T]=yield Ni(Promise.race(n.map(K=>K[2]))),h==="error")break;if((_=h==="end")||(Number.isFinite(u-k)?(q=Qi(r.read(u-k)),q.byteLength<u-k&&(q=Qi(r.read()))):q=Qi(r.read()),q.byteLength>0&&(B.push(q),k+=q.byteLength)),_||u<=k)do({cmd:S,size:u}=yield yield Ni(oe()));while(u<k)}while(!_)}finally{yield Ni(ne(n,h==="error"?T:null))}return yield Ni(null);function ne(K,le){return q=B=null,new Promise((Ge,tt)=>{for(const[Ke,ht]of K)r.off(Ke,ht);try{const Ke=r.destroy;Ke&&Ke.call(r,le),le=void 0}catch(Ke){le=Ke||le}finally{le!=null?tt(le):Ge()}})}})}var Gr;(function(r){r[r.V1=0]="V1",r[r.V2=1]="V2",r[r.V3=2]="V3",r[r.V4=3]="V4",r[r.V5=4]="V5"})(Gr||(Gr={}));var rs;(function(r){r[r.Sparse=0]="Sparse",r[r.Dense=1]="Dense"})(rs||(rs={}));var is;(function(r){r[r.HALF=0]="HALF",r[r.SINGLE=1]="SINGLE",r[r.DOUBLE=2]="DOUBLE"})(is||(is={}));var ml;(function(r){r[r.DAY=0]="DAY",r[r.MILLISECOND=1]="MILLISECOND"})(ml||(ml={}));var di;(function(r){r[r.SECOND=0]="SECOND",r[r.MILLISECOND=1]="MILLISECOND",r[r.MICROSECOND=2]="MICROSECOND",r[r.NANOSECOND=3]="NANOSECOND"})(di||(di={}));var ou;(function(r){r[r.YEAR_MONTH=0]="YEAR_MONTH",r[r.DAY_TIME=1]="DAY_TIME",r[r.MONTH_DAY_NANO=2]="MONTH_DAY_NANO"})(ou||(ou={}));const qv=2,Jc=4,fh=4,An=4,Md=new Int32Array(2),yx=new Float32Array(Md.buffer),vx=new Float64Array(Md.buffer),Q_=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var w0;(function(r){r[r.UTF8_BYTES=1]="UTF8_BYTES",r[r.UTF16_STRING=2]="UTF16_STRING"})(w0||(w0={}));let mm=class ew{constructor(e){this.bytes_=e,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(e){return new ew(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return BigInt.asIntN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readUint64(e){return BigInt.asUintN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readFloat32(e){return Md[0]=this.readInt32(e),yx[0]}readFloat64(e){return Md[Q_?0:1]=this.readInt32(e),Md[Q_?1:0]=this.readInt32(e+4),vx[0]}writeInt8(e,n){this.bytes_[e]=n}writeUint8(e,n){this.bytes_[e]=n}writeInt16(e,n){this.bytes_[e]=n,this.bytes_[e+1]=n>>8}writeUint16(e,n){this.bytes_[e]=n,this.bytes_[e+1]=n>>8}writeInt32(e,n){this.bytes_[e]=n,this.bytes_[e+1]=n>>8,this.bytes_[e+2]=n>>16,this.bytes_[e+3]=n>>24}writeUint32(e,n){this.bytes_[e]=n,this.bytes_[e+1]=n>>8,this.bytes_[e+2]=n>>16,this.bytes_[e+3]=n>>24}writeInt64(e,n){this.writeInt32(e,Number(BigInt.asIntN(32,n))),this.writeInt32(e+4,Number(BigInt.asIntN(32,n>>BigInt(32))))}writeUint64(e,n){this.writeUint32(e,Number(BigInt.asUintN(32,n))),this.writeUint32(e+4,Number(BigInt.asUintN(32,n>>BigInt(32))))}writeFloat32(e,n){yx[0]=n,this.writeInt32(e,Md[0])}writeFloat64(e,n){vx[0]=n,this.writeInt32(e,Md[Q_?0:1]),this.writeInt32(e+4,Md[Q_?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+Jc+fh)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let n=0;n<fh;n++)e+=String.fromCharCode(this.readInt8(this.position_+Jc+n));return e}__offset(e,n){const h=e-this.readInt32(e);return n<this.readInt16(h)?this.readInt16(h+n):0}__union(e,n){return e.bb_pos=n+this.readInt32(n),e.bb=this,e}__string(e,n){e+=this.readInt32(e);const h=this.readInt32(e);e+=Jc;const _=this.bytes_.subarray(e,e+h);return n===w0.UTF8_BYTES?_:this.text_decoder_.decode(_)}__union_with_string(e,n){return typeof e=="string"?this.__string(n):this.__union(e,n)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+Jc}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=fh)throw new Error("FlatBuffers: file identifier must be length "+fh);for(let n=0;n<fh;n++)if(e.charCodeAt(n)!=this.readInt8(this.position()+Jc+n))return!1;return!0}createScalarList(e,n){const h=[];for(let _=0;_<n;++_){const T=e(_);T!==null&&h.push(T)}return h}createObjList(e,n){const h=[];for(let _=0;_<n;++_){const T=e(_);T!==null&&h.push(T.unpack())}return h}},tw=class iw{constructor(e){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,this.text_encoder=new TextEncoder;let n;e?n=e:n=1024,this.bb=mm.allocate(n),this.space=n}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(e){this.force_defaults=e}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(e,n){e>this.minalign&&(this.minalign=e);const h=~(this.bb.capacity()-this.space+n)+1&e-1;for(;this.space<h+e+n;){const _=this.bb.capacity();this.bb=iw.growByteBuffer(this.bb),this.space+=this.bb.capacity()-_}this.pad(h)}pad(e){for(let n=0;n<e;n++)this.bb.writeInt8(--this.space,0)}writeInt8(e){this.bb.writeInt8(this.space-=1,e)}writeInt16(e){this.bb.writeInt16(this.space-=2,e)}writeInt32(e){this.bb.writeInt32(this.space-=4,e)}writeInt64(e){this.bb.writeInt64(this.space-=8,e)}writeFloat32(e){this.bb.writeFloat32(this.space-=4,e)}writeFloat64(e){this.bb.writeFloat64(this.space-=8,e)}addInt8(e){this.prep(1,0),this.writeInt8(e)}addInt16(e){this.prep(2,0),this.writeInt16(e)}addInt32(e){this.prep(4,0),this.writeInt32(e)}addInt64(e){this.prep(8,0),this.writeInt64(e)}addFloat32(e){this.prep(4,0),this.writeFloat32(e)}addFloat64(e){this.prep(8,0),this.writeFloat64(e)}addFieldInt8(e,n,h){(this.force_defaults||n!=h)&&(this.addInt8(n),this.slot(e))}addFieldInt16(e,n,h){(this.force_defaults||n!=h)&&(this.addInt16(n),this.slot(e))}addFieldInt32(e,n,h){(this.force_defaults||n!=h)&&(this.addInt32(n),this.slot(e))}addFieldInt64(e,n,h){(this.force_defaults||n!==h)&&(this.addInt64(n),this.slot(e))}addFieldFloat32(e,n,h){(this.force_defaults||n!=h)&&(this.addFloat32(n),this.slot(e))}addFieldFloat64(e,n,h){(this.force_defaults||n!=h)&&(this.addFloat64(n),this.slot(e))}addFieldOffset(e,n,h){(this.force_defaults||n!=h)&&(this.addOffset(n),this.slot(e))}addFieldStruct(e,n,h){n!=h&&(this.nested(n),this.slot(e))}nested(e){if(e!=this.offset())throw new TypeError("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new TypeError("FlatBuffers: object serialization must not be nested.")}slot(e){this.vtable!==null&&(this.vtable[e]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(e){const n=e.capacity();if(n&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const h=n<<1,_=mm.allocate(h);return _.setPosition(h-n),_.bytes().set(e.bytes(),h-n),_}addOffset(e){this.prep(Jc,0),this.writeInt32(this.offset()-e+Jc)}startObject(e){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=e;for(let n=0;n<e;n++)this.vtable[n]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const e=this.offset();let n=this.vtable_in_use-1;for(;n>=0&&this.vtable[n]==0;n--);const h=n+1;for(;n>=0;n--)this.addInt16(this.vtable[n]!=0?e-this.vtable[n]:0);const _=2;this.addInt16(e-this.object_start);const T=(h+_)*qv;this.addInt16(T);let S=0;const u=this.space;e:for(n=0;n<this.vtables.length;n++){const k=this.bb.capacity()-this.vtables[n];if(T==this.bb.readInt16(k)){for(let B=qv;B<T;B+=qv)if(this.bb.readInt16(u+B)!=this.bb.readInt16(k+B))continue e;S=this.vtables[n];break}}return S?(this.space=this.bb.capacity()-e,this.bb.writeInt32(this.space,S-e)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-e,this.offset()-e)),this.isNested=!1,e}finish(e,n,h){const _=h?An:0;if(n){const T=n;if(this.prep(this.minalign,Jc+fh+_),T.length!=fh)throw new TypeError("FlatBuffers: file identifier must be length "+fh);for(let S=fh-1;S>=0;S--)this.writeInt8(T.charCodeAt(S))}this.prep(this.minalign,Jc+_),this.addOffset(e),_&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(e,n){this.finish(e,n,!0)}requiredField(e,n){const h=this.bb.capacity()-e,_=h-this.bb.readInt32(h);if(!(n<this.bb.readInt16(_)&&this.bb.readInt16(_+n)!=0))throw new TypeError("FlatBuffers: field "+n+" must be set")}startVector(e,n,h){this.notNested(),this.vector_num_elems=n,this.prep(Jc,e*n),this.prep(h,e*n)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(e){if(!e)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(e))return this.string_maps.get(e);const n=this.createString(e);return this.string_maps.set(e,n),n}createString(e){if(e==null)return 0;let n;return e instanceof Uint8Array?n=e:n=this.text_encoder.encode(e),this.addInt8(0),this.startVector(1,n.length,1),this.bb.setPosition(this.space-=n.length),this.bb.bytes().set(n,this.space),this.endVector()}createByteVector(e){return e==null?0:(this.startVector(1,e.length,1),this.bb.setPosition(this.space-=e.length),this.bb.bytes().set(e,this.space),this.endVector())}createObjectOffset(e){return e===null?0:typeof e=="string"?this.createString(e):e.pack(this)}createObjectOffsetList(e){const n=[];for(let h=0;h<e.length;++h){const _=e[h];if(_!==null)n.push(this.createObjectOffset(_));else throw new TypeError("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return n}createStructOffsetList(e,n){return n(this,e.length),this.createObjectOffsetList(e.slice().reverse()),this.endVector()}};var Ey;(function(r){r[r.BUFFER=0]="BUFFER"})(Ey||(Ey={}));var My;(function(r){r[r.LZ4_FRAME=0]="LZ4_FRAME",r[r.ZSTD=1]="ZSTD"})(My||(My={}));class Ad{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsBodyCompression(e,n){return(n||new Ad).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsBodyCompression(e,n){return e.setPosition(e.position()+An),(n||new Ad).__init(e.readInt32(e.position())+e.position(),e)}codec(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt8(this.bb_pos+e):My.LZ4_FRAME}method(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt8(this.bb_pos+e):Ey.BUFFER}static startBodyCompression(e){e.startObject(2)}static addCodec(e,n){e.addFieldInt8(0,n,My.LZ4_FRAME)}static addMethod(e,n){e.addFieldInt8(1,n,Ey.BUFFER)}static endBodyCompression(e){return e.endObject()}static createBodyCompression(e,n,h){return Ad.startBodyCompression(e),Ad.addCodec(e,n),Ad.addMethod(e,h),Ad.endBodyCompression(e)}}let nw=class{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}offset(){return this.bb.readInt64(this.bb_pos)}length(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createBuffer(e,n,h){return e.prep(8,16),e.writeInt64(BigInt(h??0)),e.writeInt64(BigInt(n??0)),e.offset()}},rw=class{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}length(){return this.bb.readInt64(this.bb_pos)}nullCount(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createFieldNode(e,n,h){return e.prep(8,16),e.writeInt64(BigInt(h??0)),e.writeInt64(BigInt(n??0)),e.offset()}},ch=class S0{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsRecordBatch(e,n){return(n||new S0).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsRecordBatch(e,n){return e.setPosition(e.position()+An),(n||new S0).__init(e.readInt32(e.position())+e.position(),e)}length(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}nodes(e,n){const h=this.bb.__offset(this.bb_pos,6);return h?(n||new rw).__init(this.bb.__vector(this.bb_pos+h)+e*16,this.bb):null}nodesLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}buffers(e,n){const h=this.bb.__offset(this.bb_pos,8);return h?(n||new nw).__init(this.bb.__vector(this.bb_pos+h)+e*16,this.bb):null}buffersLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}compression(e){const n=this.bb.__offset(this.bb_pos,10);return n?(e||new Ad).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}static startRecordBatch(e){e.startObject(4)}static addLength(e,n){e.addFieldInt64(0,n,BigInt("0"))}static addNodes(e,n){e.addFieldOffset(1,n,0)}static startNodesVector(e,n){e.startVector(16,n,8)}static addBuffers(e,n){e.addFieldOffset(2,n,0)}static startBuffersVector(e,n){e.startVector(16,n,8)}static addCompression(e,n){e.addFieldOffset(3,n,0)}static endRecordBatch(e){return e.endObject()}},Yp=class T0{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsDictionaryBatch(e,n){return(n||new T0).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDictionaryBatch(e,n){return e.setPosition(e.position()+An),(n||new T0).__init(e.readInt32(e.position())+e.position(),e)}id(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}data(e){const n=this.bb.__offset(this.bb_pos,6);return n?(e||new ch).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}isDelta(){const e=this.bb.__offset(this.bb_pos,8);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startDictionaryBatch(e){e.startObject(3)}static addId(e,n){e.addFieldInt64(0,n,BigInt("0"))}static addData(e,n){e.addFieldOffset(1,n,0)}static addIsDelta(e,n){e.addFieldInt8(2,+n,0)}static endDictionaryBatch(e){return e.endObject()}};var gm;(function(r){r[r.Little=0]="Little",r[r.Big=1]="Big"})(gm||(gm={}));var Ay;(function(r){r[r.DenseArray=0]="DenseArray"})(Ay||(Ay={}));class Do{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsInt(e,n){return(n||new Do).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsInt(e,n){return e.setPosition(e.position()+An),(n||new Do).__init(e.readInt32(e.position())+e.position(),e)}bitWidth(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}isSigned(){const e=this.bb.__offset(this.bb_pos,6);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startInt(e){e.startObject(2)}static addBitWidth(e,n){e.addFieldInt32(0,n,0)}static addIsSigned(e,n){e.addFieldInt8(1,+n,0)}static endInt(e){return e.endObject()}static createInt(e,n,h){return Do.startInt(e),Do.addBitWidth(e,n),Do.addIsSigned(e,h),Do.endInt(e)}}class ph{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsDictionaryEncoding(e,n){return(n||new ph).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDictionaryEncoding(e,n){return e.setPosition(e.position()+An),(n||new ph).__init(e.readInt32(e.position())+e.position(),e)}id(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}indexType(e){const n=this.bb.__offset(this.bb_pos,6);return n?(e||new Do).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}isOrdered(){const e=this.bb.__offset(this.bb_pos,8);return e?!!this.bb.readInt8(this.bb_pos+e):!1}dictionaryKind(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readInt16(this.bb_pos+e):Ay.DenseArray}static startDictionaryEncoding(e){e.startObject(4)}static addId(e,n){e.addFieldInt64(0,n,BigInt("0"))}static addIndexType(e,n){e.addFieldOffset(1,n,0)}static addIsOrdered(e,n){e.addFieldInt8(2,+n,0)}static addDictionaryKind(e,n){e.addFieldInt16(3,n,Ay.DenseArray)}static endDictionaryEncoding(e){return e.endObject()}}class ha{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsKeyValue(e,n){return(n||new ha).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsKeyValue(e,n){return e.setPosition(e.position()+An),(n||new ha).__init(e.readInt32(e.position())+e.position(),e)}key(e){const n=this.bb.__offset(this.bb_pos,4);return n?this.bb.__string(this.bb_pos+n,e):null}value(e){const n=this.bb.__offset(this.bb_pos,6);return n?this.bb.__string(this.bb_pos+n,e):null}static startKeyValue(e){e.startObject(2)}static addKey(e,n){e.addFieldOffset(0,n,0)}static addValue(e,n){e.addFieldOffset(1,n,0)}static endKeyValue(e){return e.endObject()}static createKeyValue(e,n,h){return ha.startKeyValue(e),ha.addKey(e,n),ha.addValue(e,h),ha.endKeyValue(e)}}let bx=class Cg{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsBinary(e,n){return(n||new Cg).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsBinary(e,n){return e.setPosition(e.position()+An),(n||new Cg).__init(e.readInt32(e.position())+e.position(),e)}static startBinary(e){e.startObject(0)}static endBinary(e){return e.endObject()}static createBinary(e){return Cg.startBinary(e),Cg.endBinary(e)}},xx=class Dg{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsBool(e,n){return(n||new Dg).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsBool(e,n){return e.setPosition(e.position()+An),(n||new Dg).__init(e.readInt32(e.position())+e.position(),e)}static startBool(e){e.startObject(0)}static endBool(e){return e.endObject()}static createBool(e){return Dg.startBool(e),Dg.endBool(e)}},ay=class Xp{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsDate(e,n){return(n||new Xp).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDate(e,n){return e.setPosition(e.position()+An),(n||new Xp).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):ml.MILLISECOND}static startDate(e){e.startObject(1)}static addUnit(e,n){e.addFieldInt16(0,n,ml.MILLISECOND)}static endDate(e){return e.endObject()}static createDate(e,n){return Xp.startDate(e),Xp.addUnit(e,n),Xp.endDate(e)}},Kp=class Td{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsDecimal(e,n){return(n||new Td).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDecimal(e,n){return e.setPosition(e.position()+An),(n||new Td).__init(e.readInt32(e.position())+e.position(),e)}precision(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}scale(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):0}bitWidth(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readInt32(this.bb_pos+e):128}static startDecimal(e){e.startObject(3)}static addPrecision(e,n){e.addFieldInt32(0,n,0)}static addScale(e,n){e.addFieldInt32(1,n,0)}static addBitWidth(e,n){e.addFieldInt32(2,n,128)}static endDecimal(e){return e.endObject()}static createDecimal(e,n,h,_){return Td.startDecimal(e),Td.addPrecision(e,n),Td.addScale(e,h),Td.addBitWidth(e,_),Td.endDecimal(e)}},sy=class Wp{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsDuration(e,n){return(n||new Wp).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDuration(e,n){return e.setPosition(e.position()+An),(n||new Wp).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):di.MILLISECOND}static startDuration(e){e.startObject(1)}static addUnit(e,n){e.addFieldInt16(0,n,di.MILLISECOND)}static endDuration(e){return e.endObject()}static createDuration(e,n){return Wp.startDuration(e),Wp.addUnit(e,n),Wp.endDuration(e)}},oy=class Qp{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsFixedSizeBinary(e,n){return(n||new Qp).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFixedSizeBinary(e,n){return e.setPosition(e.position()+An),(n||new Qp).__init(e.readInt32(e.position())+e.position(),e)}byteWidth(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}static startFixedSizeBinary(e){e.startObject(1)}static addByteWidth(e,n){e.addFieldInt32(0,n,0)}static endFixedSizeBinary(e){return e.endObject()}static createFixedSizeBinary(e,n){return Qp.startFixedSizeBinary(e),Qp.addByteWidth(e,n),Qp.endFixedSizeBinary(e)}},ly=class Jp{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsFixedSizeList(e,n){return(n||new Jp).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFixedSizeList(e,n){return e.setPosition(e.position()+An),(n||new Jp).__init(e.readInt32(e.position())+e.position(),e)}listSize(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}static startFixedSizeList(e){e.startObject(1)}static addListSize(e,n){e.addFieldInt32(0,n,0)}static endFixedSizeList(e){return e.endObject()}static createFixedSizeList(e,n){return Jp.startFixedSizeList(e),Jp.addListSize(e,n),Jp.endFixedSizeList(e)}};class eu{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsFloatingPoint(e,n){return(n||new eu).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFloatingPoint(e,n){return e.setPosition(e.position()+An),(n||new eu).__init(e.readInt32(e.position())+e.position(),e)}precision(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):is.HALF}static startFloatingPoint(e){e.startObject(1)}static addPrecision(e,n){e.addFieldInt16(0,n,is.HALF)}static endFloatingPoint(e){return e.endObject()}static createFloatingPoint(e,n){return eu.startFloatingPoint(e),eu.addPrecision(e,n),eu.endFloatingPoint(e)}}class tu{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsInterval(e,n){return(n||new tu).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsInterval(e,n){return e.setPosition(e.position()+An),(n||new tu).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):ou.YEAR_MONTH}static startInterval(e){e.startObject(1)}static addUnit(e,n){e.addFieldInt16(0,n,ou.YEAR_MONTH)}static endInterval(e){return e.endObject()}static createInterval(e,n){return tu.startInterval(e),tu.addUnit(e,n),tu.endInterval(e)}}let wx=class Rg{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsLargeBinary(e,n){return(n||new Rg).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsLargeBinary(e,n){return e.setPosition(e.position()+An),(n||new Rg).__init(e.readInt32(e.position())+e.position(),e)}static startLargeBinary(e){e.startObject(0)}static endLargeBinary(e){return e.endObject()}static createLargeBinary(e){return Rg.startLargeBinary(e),Rg.endLargeBinary(e)}},Sx=class Pg{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsLargeUtf8(e,n){return(n||new Pg).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsLargeUtf8(e,n){return e.setPosition(e.position()+An),(n||new Pg).__init(e.readInt32(e.position())+e.position(),e)}static startLargeUtf8(e){e.startObject(0)}static endLargeUtf8(e){return e.endObject()}static createLargeUtf8(e){return Pg.startLargeUtf8(e),Pg.endLargeUtf8(e)}},Tx=class zg{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsList(e,n){return(n||new zg).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsList(e,n){return e.setPosition(e.position()+An),(n||new zg).__init(e.readInt32(e.position())+e.position(),e)}static startList(e){e.startObject(0)}static endList(e){return e.endObject()}static createList(e){return zg.startList(e),zg.endList(e)}},cy=class em{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsMap(e,n){return(n||new em).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsMap(e,n){return e.setPosition(e.position()+An),(n||new em).__init(e.readInt32(e.position())+e.position(),e)}keysSorted(){const e=this.bb.__offset(this.bb_pos,4);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startMap(e){e.startObject(1)}static addKeysSorted(e,n){e.addFieldInt8(0,+n,0)}static endMap(e){return e.endObject()}static createMap(e,n){return em.startMap(e),em.addKeysSorted(e,n),em.endMap(e)}},Ex=class kg{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsNull(e,n){return(n||new kg).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsNull(e,n){return e.setPosition(e.position()+An),(n||new kg).__init(e.readInt32(e.position())+e.position(),e)}static startNull(e){e.startObject(0)}static endNull(e){return e.endObject()}static createNull(e){return kg.startNull(e),kg.endNull(e)}};class Lf{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsStruct_(e,n){return(n||new Lf).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsStruct_(e,n){return e.setPosition(e.position()+An),(n||new Lf).__init(e.readInt32(e.position())+e.position(),e)}static startStruct_(e){e.startObject(0)}static endStruct_(e){return e.endObject()}static createStruct_(e){return Lf.startStruct_(e),Lf.endStruct_(e)}}class dl{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsTime(e,n){return(n||new dl).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsTime(e,n){return e.setPosition(e.position()+An),(n||new dl).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):di.MILLISECOND}bitWidth(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):32}static startTime(e){e.startObject(2)}static addUnit(e,n){e.addFieldInt16(0,n,di.MILLISECOND)}static addBitWidth(e,n){e.addFieldInt32(1,n,32)}static endTime(e){return e.endObject()}static createTime(e,n,h){return dl.startTime(e),dl.addUnit(e,n),dl.addBitWidth(e,h),dl.endTime(e)}}class fl{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsTimestamp(e,n){return(n||new fl).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsTimestamp(e,n){return e.setPosition(e.position()+An),(n||new fl).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):di.SECOND}timezone(e){const n=this.bb.__offset(this.bb_pos,6);return n?this.bb.__string(this.bb_pos+n,e):null}static startTimestamp(e){e.startObject(2)}static addUnit(e,n){e.addFieldInt16(0,n,di.SECOND)}static addTimezone(e,n){e.addFieldOffset(1,n,0)}static endTimestamp(e){return e.endObject()}static createTimestamp(e,n,h){return fl.startTimestamp(e),fl.addUnit(e,n),fl.addTimezone(e,h),fl.endTimestamp(e)}}class Js{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsUnion(e,n){return(n||new Js).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsUnion(e,n){return e.setPosition(e.position()+An),(n||new Js).__init(e.readInt32(e.position())+e.position(),e)}mode(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):rs.Sparse}typeIds(e){const n=this.bb.__offset(this.bb_pos,6);return n?this.bb.readInt32(this.bb.__vector(this.bb_pos+n)+e*4):0}typeIdsLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}typeIdsArray(){const e=this.bb.__offset(this.bb_pos,6);return e?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}static startUnion(e){e.startObject(2)}static addMode(e,n){e.addFieldInt16(0,n,rs.Sparse)}static addTypeIds(e,n){e.addFieldOffset(1,n,0)}static createTypeIdsVector(e,n){e.startVector(4,n.length,4);for(let h=n.length-1;h>=0;h--)e.addInt32(n[h]);return e.endVector()}static startTypeIdsVector(e,n){e.startVector(4,n,4)}static endUnion(e){return e.endObject()}static createUnion(e,n,h){return Js.startUnion(e),Js.addMode(e,n),Js.addTypeIds(e,h),Js.endUnion(e)}}let Mx=class Og{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsUtf8(e,n){return(n||new Og).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsUtf8(e,n){return e.setPosition(e.position()+An),(n||new Og).__init(e.readInt32(e.position())+e.position(),e)}static startUtf8(e){e.startObject(0)}static endUtf8(e){return e.endObject()}static createUtf8(e){return Og.startUtf8(e),Og.endUtf8(e)}};var rr;(function(r){r[r.NONE=0]="NONE",r[r.Null=1]="Null",r[r.Int=2]="Int",r[r.FloatingPoint=3]="FloatingPoint",r[r.Binary=4]="Binary",r[r.Utf8=5]="Utf8",r[r.Bool=6]="Bool",r[r.Decimal=7]="Decimal",r[r.Date=8]="Date",r[r.Time=9]="Time",r[r.Timestamp=10]="Timestamp",r[r.Interval=11]="Interval",r[r.List=12]="List",r[r.Struct_=13]="Struct_",r[r.Union=14]="Union",r[r.FixedSizeBinary=15]="FixedSizeBinary",r[r.FixedSizeList=16]="FixedSizeList",r[r.Map=17]="Map",r[r.Duration=18]="Duration",r[r.LargeBinary=19]="LargeBinary",r[r.LargeUtf8=20]="LargeUtf8",r[r.LargeList=21]="LargeList",r[r.RunEndEncoded=22]="RunEndEncoded"})(rr||(rr={}));let ul=class uy{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsField(e,n){return(n||new uy).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsField(e,n){return e.setPosition(e.position()+An),(n||new uy).__init(e.readInt32(e.position())+e.position(),e)}name(e){const n=this.bb.__offset(this.bb_pos,4);return n?this.bb.__string(this.bb_pos+n,e):null}nullable(){const e=this.bb.__offset(this.bb_pos,6);return e?!!this.bb.readInt8(this.bb_pos+e):!1}typeType(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint8(this.bb_pos+e):rr.NONE}type(e){const n=this.bb.__offset(this.bb_pos,10);return n?this.bb.__union(e,this.bb_pos+n):null}dictionary(e){const n=this.bb.__offset(this.bb_pos,12);return n?(e||new ph).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}children(e,n){const h=this.bb.__offset(this.bb_pos,14);return h?(n||new uy).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+h)+e*4),this.bb):null}childrenLength(){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}customMetadata(e,n){const h=this.bb.__offset(this.bb_pos,16);return h?(n||new ha).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+h)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,16);return e?this.bb.__vector_len(this.bb_pos+e):0}static startField(e){e.startObject(7)}static addName(e,n){e.addFieldOffset(0,n,0)}static addNullable(e,n){e.addFieldInt8(1,+n,0)}static addTypeType(e,n){e.addFieldInt8(2,n,rr.NONE)}static addType(e,n){e.addFieldOffset(3,n,0)}static addDictionary(e,n){e.addFieldOffset(4,n,0)}static addChildren(e,n){e.addFieldOffset(5,n,0)}static createChildrenVector(e,n){e.startVector(4,n.length,4);for(let h=n.length-1;h>=0;h--)e.addOffset(n[h]);return e.endVector()}static startChildrenVector(e,n){e.startVector(4,n,4)}static addCustomMetadata(e,n){e.addFieldOffset(6,n,0)}static createCustomMetadataVector(e,n){e.startVector(4,n.length,4);for(let h=n.length-1;h>=0;h--)e.addOffset(n[h]);return e.endVector()}static startCustomMetadataVector(e,n){e.startVector(4,n,4)}static endField(e){return e.endObject()}},Wc=class lh{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsSchema(e,n){return(n||new lh).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSchema(e,n){return e.setPosition(e.position()+An),(n||new lh).__init(e.readInt32(e.position())+e.position(),e)}endianness(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):gm.Little}fields(e,n){const h=this.bb.__offset(this.bb_pos,6);return h?(n||new ul).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+h)+e*4),this.bb):null}fieldsLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}customMetadata(e,n){const h=this.bb.__offset(this.bb_pos,8);return h?(n||new ha).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+h)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}features(e){const n=this.bb.__offset(this.bb_pos,10);return n?this.bb.readInt64(this.bb.__vector(this.bb_pos+n)+e*8):BigInt(0)}featuresLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}static startSchema(e){e.startObject(4)}static addEndianness(e,n){e.addFieldInt16(0,n,gm.Little)}static addFields(e,n){e.addFieldOffset(1,n,0)}static createFieldsVector(e,n){e.startVector(4,n.length,4);for(let h=n.length-1;h>=0;h--)e.addOffset(n[h]);return e.endVector()}static startFieldsVector(e,n){e.startVector(4,n,4)}static addCustomMetadata(e,n){e.addFieldOffset(2,n,0)}static createCustomMetadataVector(e,n){e.startVector(4,n.length,4);for(let h=n.length-1;h>=0;h--)e.addOffset(n[h]);return e.endVector()}static startCustomMetadataVector(e,n){e.startVector(4,n,4)}static addFeatures(e,n){e.addFieldOffset(3,n,0)}static createFeaturesVector(e,n){e.startVector(8,n.length,8);for(let h=n.length-1;h>=0;h--)e.addInt64(n[h]);return e.endVector()}static startFeaturesVector(e,n){e.startVector(8,n,8)}static endSchema(e){return e.endObject()}static finishSchemaBuffer(e,n){e.finish(n)}static finishSizePrefixedSchemaBuffer(e,n){e.finish(n,void 0,!0)}static createSchema(e,n,h,_,T){return lh.startSchema(e),lh.addEndianness(e,n),lh.addFields(e,h),lh.addCustomMetadata(e,_),lh.addFeatures(e,T),lh.endSchema(e)}};var dn;(function(r){r[r.NONE=0]="NONE",r[r.Schema=1]="Schema",r[r.DictionaryBatch=2]="DictionaryBatch",r[r.RecordBatch=3]="RecordBatch",r[r.Tensor=4]="Tensor",r[r.SparseTensor=5]="SparseTensor"})(dn||(dn={}));var Te;(function(r){r[r.NONE=0]="NONE",r[r.Null=1]="Null",r[r.Int=2]="Int",r[r.Float=3]="Float",r[r.Binary=4]="Binary",r[r.Utf8=5]="Utf8",r[r.Bool=6]="Bool",r[r.Decimal=7]="Decimal",r[r.Date=8]="Date",r[r.Time=9]="Time",r[r.Timestamp=10]="Timestamp",r[r.Interval=11]="Interval",r[r.List=12]="List",r[r.Struct=13]="Struct",r[r.Union=14]="Union",r[r.FixedSizeBinary=15]="FixedSizeBinary",r[r.FixedSizeList=16]="FixedSizeList",r[r.Map=17]="Map",r[r.Duration=18]="Duration",r[r.LargeBinary=19]="LargeBinary",r[r.LargeUtf8=20]="LargeUtf8",r[r.Dictionary=-1]="Dictionary",r[r.Int8=-2]="Int8",r[r.Int16=-3]="Int16",r[r.Int32=-4]="Int32",r[r.Int64=-5]="Int64",r[r.Uint8=-6]="Uint8",r[r.Uint16=-7]="Uint16",r[r.Uint32=-8]="Uint32",r[r.Uint64=-9]="Uint64",r[r.Float16=-10]="Float16",r[r.Float32=-11]="Float32",r[r.Float64=-12]="Float64",r[r.DateDay=-13]="DateDay",r[r.DateMillisecond=-14]="DateMillisecond",r[r.TimestampSecond=-15]="TimestampSecond",r[r.TimestampMillisecond=-16]="TimestampMillisecond",r[r.TimestampMicrosecond=-17]="TimestampMicrosecond",r[r.TimestampNanosecond=-18]="TimestampNanosecond",r[r.TimeSecond=-19]="TimeSecond",r[r.TimeMillisecond=-20]="TimeMillisecond",r[r.TimeMicrosecond=-21]="TimeMicrosecond",r[r.TimeNanosecond=-22]="TimeNanosecond",r[r.DenseUnion=-23]="DenseUnion",r[r.SparseUnion=-24]="SparseUnion",r[r.IntervalDayTime=-25]="IntervalDayTime",r[r.IntervalYearMonth=-26]="IntervalYearMonth",r[r.DurationSecond=-27]="DurationSecond",r[r.DurationMillisecond=-28]="DurationMillisecond",r[r.DurationMicrosecond=-29]="DurationMicrosecond",r[r.DurationNanosecond=-30]="DurationNanosecond"})(Te||(Te={}));var uh;(function(r){r[r.OFFSET=0]="OFFSET",r[r.DATA=1]="DATA",r[r.VALIDITY=2]="VALIDITY",r[r.TYPE=3]="TYPE"})(uh||(uh={}));const pI=void 0;function Kg(r){if(r===null)return"null";if(r===pI)return"undefined";switch(typeof r){case"number":return`${r}`;case"bigint":return`${r}`;case"string":return`"${r}"`}return typeof r[Symbol.toPrimitive]=="function"?r[Symbol.toPrimitive]("string"):ArrayBuffer.isView(r)?r instanceof BigInt64Array||r instanceof BigUint64Array?`[${[...r].map(e=>Kg(e))}]`:`[${r}]`:ArrayBuffer.isView(r)?`[${r}]`:JSON.stringify(r,(e,n)=>typeof n=="bigint"?`${n}`:n)}function Kn(r){if(typeof r=="bigint"&&(r<Number.MIN_SAFE_INTEGER||r>Number.MAX_SAFE_INTEGER))throw new TypeError(`${r} is not safe to convert to a number.`);return Number(r)}function aw(r,e){return Kn(r/e)+Kn(r%e)/Kn(e)}const mI=Symbol.for("isArrowBigNum");function yc(r,...e){return e.length===0?Object.setPrototypeOf(Bn(this.TypedArray,r),this.constructor.prototype):Object.setPrototypeOf(new this.TypedArray(r,...e),this.constructor.prototype)}yc.prototype[mI]=!0;yc.prototype.toJSON=function(){return`"${Qg(this)}"`};yc.prototype.valueOf=function(r){return sw(this,r)};yc.prototype.toString=function(){return Qg(this)};yc.prototype[Symbol.toPrimitive]=function(r="default"){switch(r){case"number":return sw(this);case"string":return Qg(this);case"default":return yI(this)}return Qg(this)};function sm(...r){return yc.apply(this,r)}function om(...r){return yc.apply(this,r)}function Wg(...r){return yc.apply(this,r)}Object.setPrototypeOf(sm.prototype,Object.create(Int32Array.prototype));Object.setPrototypeOf(om.prototype,Object.create(Uint32Array.prototype));Object.setPrototypeOf(Wg.prototype,Object.create(Uint32Array.prototype));Object.assign(sm.prototype,yc.prototype,{constructor:sm,signed:!0,TypedArray:Int32Array,BigIntArray:BigInt64Array});Object.assign(om.prototype,yc.prototype,{constructor:om,signed:!1,TypedArray:Uint32Array,BigIntArray:BigUint64Array});Object.assign(Wg.prototype,yc.prototype,{constructor:Wg,signed:!0,TypedArray:Uint32Array,BigIntArray:BigUint64Array});const gI=BigInt(4294967296)*BigInt(4294967296),_I=gI-BigInt(1);function sw(r,e){const{buffer:n,byteOffset:h,byteLength:_,signed:T}=r,S=new BigUint64Array(n,h,_/8),u=T&&S.at(-1)&BigInt(1)<<BigInt(63);let k=BigInt(0),B=0;if(u){for(const q of S)k|=(q^_I)*(BigInt(1)<<BigInt(64*B++));k*=BigInt(-1),k-=BigInt(1)}else for(const q of S)k|=q*(BigInt(1)<<BigInt(64*B++));if(typeof e=="number"){const q=BigInt(Math.pow(10,e)),oe=k/q,ne=k%q;return Kn(oe)+Kn(ne)/Kn(q)}return Kn(k)}function Qg(r){if(r.byteLength===8)return`${new r.BigIntArray(r.buffer,r.byteOffset,1)[0]}`;if(!r.signed)return $v(r);let e=new Uint16Array(r.buffer,r.byteOffset,r.byteLength/2);if(new Int16Array([e.at(-1)])[0]>=0)return $v(r);e=e.slice();let h=1;for(let T=0;T<e.length;T++){const S=e[T],u=~S+h;e[T]=u,h&=S===0?1:0}return`-${$v(e)}`}function yI(r){return r.byteLength===8?new r.BigIntArray(r.buffer,r.byteOffset,1)[0]:Qg(r)}function $v(r){let e="";const n=new Uint32Array(2);let h=new Uint16Array(r.buffer,r.byteOffset,r.byteLength/2);const _=new Uint32Array((h=new Uint16Array(h).reverse()).buffer);let T=-1;const S=h.length-1;do{for(n[0]=h[T=0];T<S;)h[T++]=n[1]=n[0]/10,n[0]=(n[0]-n[1]*10<<16)+h[T];h[T]=n[1]=n[0]/10,n[0]=n[0]-n[1]*10,e=`${n[0]}${e}`}while(_[0]||_[1]||_[2]||_[3]);return e??"0"}class Y0{static new(e,n){switch(n){case!0:return new sm(e);case!1:return new om(e)}switch(e.constructor){case Int8Array:case Int16Array:case Int32Array:case BigInt64Array:return new sm(e)}return e.byteLength===16?new Wg(e):new om(e)}static signed(e){return new sm(e)}static unsigned(e){return new om(e)}static decimal(e){return new Wg(e)}constructor(e,n){return Y0.new(e,n)}}var ow,lw,cw,uw,hw,dw,fw,pw,mw,gw,_w,yw,vw,bw,xw,ww,Sw,Tw,Ew,Mw,Aw,Iw;class Qt{static isNull(e){return(e==null?void 0:e.typeId)===Te.Null}static isInt(e){return(e==null?void 0:e.typeId)===Te.Int}static isFloat(e){return(e==null?void 0:e.typeId)===Te.Float}static isBinary(e){return(e==null?void 0:e.typeId)===Te.Binary}static isLargeBinary(e){return(e==null?void 0:e.typeId)===Te.LargeBinary}static isUtf8(e){return(e==null?void 0:e.typeId)===Te.Utf8}static isLargeUtf8(e){return(e==null?void 0:e.typeId)===Te.LargeUtf8}static isBool(e){return(e==null?void 0:e.typeId)===Te.Bool}static isDecimal(e){return(e==null?void 0:e.typeId)===Te.Decimal}static isDate(e){return(e==null?void 0:e.typeId)===Te.Date}static isTime(e){return(e==null?void 0:e.typeId)===Te.Time}static isTimestamp(e){return(e==null?void 0:e.typeId)===Te.Timestamp}static isInterval(e){return(e==null?void 0:e.typeId)===Te.Interval}static isDuration(e){return(e==null?void 0:e.typeId)===Te.Duration}static isList(e){return(e==null?void 0:e.typeId)===Te.List}static isStruct(e){return(e==null?void 0:e.typeId)===Te.Struct}static isUnion(e){return(e==null?void 0:e.typeId)===Te.Union}static isFixedSizeBinary(e){return(e==null?void 0:e.typeId)===Te.FixedSizeBinary}static isFixedSizeList(e){return(e==null?void 0:e.typeId)===Te.FixedSizeList}static isMap(e){return(e==null?void 0:e.typeId)===Te.Map}static isDictionary(e){return(e==null?void 0:e.typeId)===Te.Dictionary}static isDenseUnion(e){return Qt.isUnion(e)&&e.mode===rs.Dense}static isSparseUnion(e){return Qt.isUnion(e)&&e.mode===rs.Sparse}constructor(e){this.typeId=e}}ow=Symbol.toStringTag;Qt[ow]=(r=>(r.children=null,r.ArrayType=Array,r.OffsetArrayType=Int32Array,r[Symbol.toStringTag]="DataType"))(Qt.prototype);class Dd extends Qt{constructor(){super(Te.Null)}toString(){return"Null"}}lw=Symbol.toStringTag;Dd[lw]=(r=>r[Symbol.toStringTag]="Null")(Dd.prototype);class jf extends Qt{constructor(e,n){super(Te.Int),this.isSigned=e,this.bitWidth=n}get ArrayType(){switch(this.bitWidth){case 8:return this.isSigned?Int8Array:Uint8Array;case 16:return this.isSigned?Int16Array:Uint16Array;case 32:return this.isSigned?Int32Array:Uint32Array;case 64:return this.isSigned?BigInt64Array:BigUint64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`${this.isSigned?"I":"Ui"}nt${this.bitWidth}`}}cw=Symbol.toStringTag;jf[cw]=(r=>(r.isSigned=null,r.bitWidth=null,r[Symbol.toStringTag]="Int"))(jf.prototype);class Jg extends jf{constructor(){super(!0,32)}get ArrayType(){return Int32Array}}Object.defineProperty(Jg.prototype,"ArrayType",{value:Int32Array});class Iy extends Qt{constructor(e){super(Te.Float),this.precision=e}get ArrayType(){switch(this.precision){case is.HALF:return Uint16Array;case is.SINGLE:return Float32Array;case is.DOUBLE:return Float64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`Float${this.precision<<5||16}`}}uw=Symbol.toStringTag;Iy[uw]=(r=>(r.precision=null,r[Symbol.toStringTag]="Float"))(Iy.prototype);class Cy extends Qt{constructor(){super(Te.Binary)}toString(){return"Binary"}}hw=Symbol.toStringTag;Cy[hw]=(r=>(r.ArrayType=Uint8Array,r[Symbol.toStringTag]="Binary"))(Cy.prototype);class Dy extends Qt{constructor(){super(Te.LargeBinary)}toString(){return"LargeBinary"}}dw=Symbol.toStringTag;Dy[dw]=(r=>(r.ArrayType=Uint8Array,r.OffsetArrayType=BigInt64Array,r[Symbol.toStringTag]="LargeBinary"))(Dy.prototype);class Ry extends Qt{constructor(){super(Te.Utf8)}toString(){return"Utf8"}}fw=Symbol.toStringTag;Ry[fw]=(r=>(r.ArrayType=Uint8Array,r[Symbol.toStringTag]="Utf8"))(Ry.prototype);class Py extends Qt{constructor(){super(Te.LargeUtf8)}toString(){return"LargeUtf8"}}pw=Symbol.toStringTag;Py[pw]=(r=>(r.ArrayType=Uint8Array,r.OffsetArrayType=BigInt64Array,r[Symbol.toStringTag]="LargeUtf8"))(Py.prototype);class zy extends Qt{constructor(){super(Te.Bool)}toString(){return"Bool"}}mw=Symbol.toStringTag;zy[mw]=(r=>(r.ArrayType=Uint8Array,r[Symbol.toStringTag]="Bool"))(zy.prototype);class ky extends Qt{constructor(e,n,h=128){super(Te.Decimal),this.scale=e,this.precision=n,this.bitWidth=h}toString(){return`Decimal[${this.precision}e${this.scale>0?"+":""}${this.scale}]`}}gw=Symbol.toStringTag;ky[gw]=(r=>(r.scale=null,r.precision=null,r.ArrayType=Uint32Array,r[Symbol.toStringTag]="Decimal"))(ky.prototype);class Oy extends Qt{constructor(e){super(Te.Date),this.unit=e}toString(){return`Date${(this.unit+1)*32}<${ml[this.unit]}>`}get ArrayType(){return this.unit===ml.DAY?Int32Array:BigInt64Array}}_w=Symbol.toStringTag;Oy[_w]=(r=>(r.unit=null,r[Symbol.toStringTag]="Date"))(Oy.prototype);class By extends Qt{constructor(e,n){super(Te.Time),this.unit=e,this.bitWidth=n}toString(){return`Time${this.bitWidth}<${di[this.unit]}>`}get ArrayType(){switch(this.bitWidth){case 32:return Int32Array;case 64:return BigInt64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}}yw=Symbol.toStringTag;By[yw]=(r=>(r.unit=null,r.bitWidth=null,r[Symbol.toStringTag]="Time"))(By.prototype);class Ly extends Qt{constructor(e,n){super(Te.Timestamp),this.unit=e,this.timezone=n}toString(){return`Timestamp<${di[this.unit]}${this.timezone?`, ${this.timezone}`:""}>`}}vw=Symbol.toStringTag;Ly[vw]=(r=>(r.unit=null,r.timezone=null,r.ArrayType=BigInt64Array,r[Symbol.toStringTag]="Timestamp"))(Ly.prototype);class Fy extends Qt{constructor(e){super(Te.Interval),this.unit=e}toString(){return`Interval<${ou[this.unit]}>`}}bw=Symbol.toStringTag;Fy[bw]=(r=>(r.unit=null,r.ArrayType=Int32Array,r[Symbol.toStringTag]="Interval"))(Fy.prototype);class Ny extends Qt{constructor(e){super(Te.Duration),this.unit=e}toString(){return`Duration<${di[this.unit]}>`}}xw=Symbol.toStringTag;Ny[xw]=(r=>(r.unit=null,r.ArrayType=BigInt64Array,r[Symbol.toStringTag]="Duration"))(Ny.prototype);class Uy extends Qt{constructor(e){super(Te.List),this.children=[e]}toString(){return`List<${this.valueType}>`}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}}ww=Symbol.toStringTag;Uy[ww]=(r=>(r.children=null,r[Symbol.toStringTag]="List"))(Uy.prototype);class Ts extends Qt{constructor(e){super(Te.Struct),this.children=e}toString(){return`Struct<{${this.children.map(e=>`${e.name}:${e.type}`).join(", ")}}>`}}Sw=Symbol.toStringTag;Ts[Sw]=(r=>(r.children=null,r[Symbol.toStringTag]="Struct"))(Ts.prototype);class jy extends Qt{constructor(e,n,h){super(Te.Union),this.mode=e,this.children=h,this.typeIds=n=Int32Array.from(n),this.typeIdToChildIndex=n.reduce((_,T,S)=>(_[T]=S)&&_||_,Object.create(null))}toString(){return`${this[Symbol.toStringTag]}<${this.children.map(e=>`${e.type}`).join(" | ")}>`}}Tw=Symbol.toStringTag;jy[Tw]=(r=>(r.mode=null,r.typeIds=null,r.children=null,r.typeIdToChildIndex=null,r.ArrayType=Int8Array,r[Symbol.toStringTag]="Union"))(jy.prototype);class Vy extends Qt{constructor(e){super(Te.FixedSizeBinary),this.byteWidth=e}toString(){return`FixedSizeBinary[${this.byteWidth}]`}}Ew=Symbol.toStringTag;Vy[Ew]=(r=>(r.byteWidth=null,r.ArrayType=Uint8Array,r[Symbol.toStringTag]="FixedSizeBinary"))(Vy.prototype);class Zy extends Qt{constructor(e,n){super(Te.FixedSizeList),this.listSize=e,this.children=[n]}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}toString(){return`FixedSizeList[${this.listSize}]<${this.valueType}>`}}Mw=Symbol.toStringTag;Zy[Mw]=(r=>(r.children=null,r.listSize=null,r[Symbol.toStringTag]="FixedSizeList"))(Zy.prototype);class Gy extends Qt{constructor(e,n=!1){var h,_,T;if(super(Te.Map),this.children=[e],this.keysSorted=n,e&&(e.name="entries",!((h=e==null?void 0:e.type)===null||h===void 0)&&h.children)){const S=(_=e==null?void 0:e.type)===null||_===void 0?void 0:_.children[0];S&&(S.name="key");const u=(T=e==null?void 0:e.type)===null||T===void 0?void 0:T.children[1];u&&(u.name="value")}}get keyType(){return this.children[0].type.children[0].type}get valueType(){return this.children[0].type.children[1].type}get childType(){return this.children[0].type}toString(){return`Map<{${this.children[0].type.children.map(e=>`${e.name}:${e.type}`).join(", ")}}>`}}Aw=Symbol.toStringTag;Gy[Aw]=(r=>(r.children=null,r.keysSorted=null,r[Symbol.toStringTag]="Map_"))(Gy.prototype);const vI=(r=>()=>++r)(-1);class _m extends Qt{constructor(e,n,h,_){super(Te.Dictionary),this.indices=n,this.dictionary=e,this.isOrdered=_||!1,this.id=h==null?vI():Kn(h)}get children(){return this.dictionary.children}get valueType(){return this.dictionary}get ArrayType(){return this.dictionary.ArrayType}toString(){return`Dictionary<${this.indices}, ${this.dictionary}>`}}Iw=Symbol.toStringTag;_m[Iw]=(r=>(r.id=null,r.indices=null,r.isOrdered=null,r.dictionary=null,r[Symbol.toStringTag]="Dictionary"))(_m.prototype);function hh(r){const e=r;switch(r.typeId){case Te.Decimal:return r.bitWidth/32;case Te.Interval:return 1+e.unit;case Te.FixedSizeList:return e.listSize;case Te.FixedSizeBinary:return e.byteWidth;default:return 1}}class Gi{visitMany(e,...n){return e.map((h,_)=>this.visit(h,...n.map(T=>T[_])))}visit(...e){return this.getVisitFn(e[0],!1).apply(this,e)}getVisitFn(e,n=!0){return bI(this,e,n)}getVisitFnByTypeId(e,n=!0){return tm(this,e,n)}visitNull(e,...n){return null}visitBool(e,...n){return null}visitInt(e,...n){return null}visitFloat(e,...n){return null}visitUtf8(e,...n){return null}visitLargeUtf8(e,...n){return null}visitBinary(e,...n){return null}visitLargeBinary(e,...n){return null}visitFixedSizeBinary(e,...n){return null}visitDate(e,...n){return null}visitTimestamp(e,...n){return null}visitTime(e,...n){return null}visitDecimal(e,...n){return null}visitList(e,...n){return null}visitStruct(e,...n){return null}visitUnion(e,...n){return null}visitDictionary(e,...n){return null}visitInterval(e,...n){return null}visitDuration(e,...n){return null}visitFixedSizeList(e,...n){return null}visitMap(e,...n){return null}}function bI(r,e,n=!0){return typeof e=="number"?tm(r,e,n):typeof e=="string"&&e in Te?tm(r,Te[e],n):e&&e instanceof Qt?tm(r,Ax(e),n):e!=null&&e.type&&e.type instanceof Qt?tm(r,Ax(e.type),n):tm(r,Te.NONE,n)}function tm(r,e,n=!0){let h=null;switch(e){case Te.Null:h=r.visitNull;break;case Te.Bool:h=r.visitBool;break;case Te.Int:h=r.visitInt;break;case Te.Int8:h=r.visitInt8||r.visitInt;break;case Te.Int16:h=r.visitInt16||r.visitInt;break;case Te.Int32:h=r.visitInt32||r.visitInt;break;case Te.Int64:h=r.visitInt64||r.visitInt;break;case Te.Uint8:h=r.visitUint8||r.visitInt;break;case Te.Uint16:h=r.visitUint16||r.visitInt;break;case Te.Uint32:h=r.visitUint32||r.visitInt;break;case Te.Uint64:h=r.visitUint64||r.visitInt;break;case Te.Float:h=r.visitFloat;break;case Te.Float16:h=r.visitFloat16||r.visitFloat;break;case Te.Float32:h=r.visitFloat32||r.visitFloat;break;case Te.Float64:h=r.visitFloat64||r.visitFloat;break;case Te.Utf8:h=r.visitUtf8;break;case Te.LargeUtf8:h=r.visitLargeUtf8;break;case Te.Binary:h=r.visitBinary;break;case Te.LargeBinary:h=r.visitLargeBinary;break;case Te.FixedSizeBinary:h=r.visitFixedSizeBinary;break;case Te.Date:h=r.visitDate;break;case Te.DateDay:h=r.visitDateDay||r.visitDate;break;case Te.DateMillisecond:h=r.visitDateMillisecond||r.visitDate;break;case Te.Timestamp:h=r.visitTimestamp;break;case Te.TimestampSecond:h=r.visitTimestampSecond||r.visitTimestamp;break;case Te.TimestampMillisecond:h=r.visitTimestampMillisecond||r.visitTimestamp;break;case Te.TimestampMicrosecond:h=r.visitTimestampMicrosecond||r.visitTimestamp;break;case Te.TimestampNanosecond:h=r.visitTimestampNanosecond||r.visitTimestamp;break;case Te.Time:h=r.visitTime;break;case Te.TimeSecond:h=r.visitTimeSecond||r.visitTime;break;case Te.TimeMillisecond:h=r.visitTimeMillisecond||r.visitTime;break;case Te.TimeMicrosecond:h=r.visitTimeMicrosecond||r.visitTime;break;case Te.TimeNanosecond:h=r.visitTimeNanosecond||r.visitTime;break;case Te.Decimal:h=r.visitDecimal;break;case Te.List:h=r.visitList;break;case Te.Struct:h=r.visitStruct;break;case Te.Union:h=r.visitUnion;break;case Te.DenseUnion:h=r.visitDenseUnion||r.visitUnion;break;case Te.SparseUnion:h=r.visitSparseUnion||r.visitUnion;break;case Te.Dictionary:h=r.visitDictionary;break;case Te.Interval:h=r.visitInterval;break;case Te.IntervalDayTime:h=r.visitIntervalDayTime||r.visitInterval;break;case Te.IntervalYearMonth:h=r.visitIntervalYearMonth||r.visitInterval;break;case Te.Duration:h=r.visitDuration;break;case Te.DurationSecond:h=r.visitDurationSecond||r.visitDuration;break;case Te.DurationMillisecond:h=r.visitDurationMillisecond||r.visitDuration;break;case Te.DurationMicrosecond:h=r.visitDurationMicrosecond||r.visitDuration;break;case Te.DurationNanosecond:h=r.visitDurationNanosecond||r.visitDuration;break;case Te.FixedSizeList:h=r.visitFixedSizeList;break;case Te.Map:h=r.visitMap;break}if(typeof h=="function")return h;if(!n)return()=>null;throw new Error(`Unrecognized type '${Te[e]}'`)}function Ax(r){switch(r.typeId){case Te.Null:return Te.Null;case Te.Int:{const{bitWidth:e,isSigned:n}=r;switch(e){case 8:return n?Te.Int8:Te.Uint8;case 16:return n?Te.Int16:Te.Uint16;case 32:return n?Te.Int32:Te.Uint32;case 64:return n?Te.Int64:Te.Uint64}return Te.Int}case Te.Float:switch(r.precision){case is.HALF:return Te.Float16;case is.SINGLE:return Te.Float32;case is.DOUBLE:return Te.Float64}return Te.Float;case Te.Binary:return Te.Binary;case Te.LargeBinary:return Te.LargeBinary;case Te.Utf8:return Te.Utf8;case Te.LargeUtf8:return Te.LargeUtf8;case Te.Bool:return Te.Bool;case Te.Decimal:return Te.Decimal;case Te.Time:switch(r.unit){case di.SECOND:return Te.TimeSecond;case di.MILLISECOND:return Te.TimeMillisecond;case di.MICROSECOND:return Te.TimeMicrosecond;case di.NANOSECOND:return Te.TimeNanosecond}return Te.Time;case Te.Timestamp:switch(r.unit){case di.SECOND:return Te.TimestampSecond;case di.MILLISECOND:return Te.TimestampMillisecond;case di.MICROSECOND:return Te.TimestampMicrosecond;case di.NANOSECOND:return Te.TimestampNanosecond}return Te.Timestamp;case Te.Date:switch(r.unit){case ml.DAY:return Te.DateDay;case ml.MILLISECOND:return Te.DateMillisecond}return Te.Date;case Te.Interval:switch(r.unit){case ou.DAY_TIME:return Te.IntervalDayTime;case ou.YEAR_MONTH:return Te.IntervalYearMonth}return Te.Interval;case Te.Duration:switch(r.unit){case di.SECOND:return Te.DurationSecond;case di.MILLISECOND:return Te.DurationMillisecond;case di.MICROSECOND:return Te.DurationMicrosecond;case di.NANOSECOND:return Te.DurationNanosecond}return Te.Duration;case Te.Map:return Te.Map;case Te.List:return Te.List;case Te.Struct:return Te.Struct;case Te.Union:switch(r.mode){case rs.Dense:return Te.DenseUnion;case rs.Sparse:return Te.SparseUnion}return Te.Union;case Te.FixedSizeBinary:return Te.FixedSizeBinary;case Te.FixedSizeList:return Te.FixedSizeList;case Te.Dictionary:return Te.Dictionary}throw new Error(`Unrecognized type '${Te[r.typeId]}'`)}Gi.prototype.visitInt8=null;Gi.prototype.visitInt16=null;Gi.prototype.visitInt32=null;Gi.prototype.visitInt64=null;Gi.prototype.visitUint8=null;Gi.prototype.visitUint16=null;Gi.prototype.visitUint32=null;Gi.prototype.visitUint64=null;Gi.prototype.visitFloat16=null;Gi.prototype.visitFloat32=null;Gi.prototype.visitFloat64=null;Gi.prototype.visitDateDay=null;Gi.prototype.visitDateMillisecond=null;Gi.prototype.visitTimestampSecond=null;Gi.prototype.visitTimestampMillisecond=null;Gi.prototype.visitTimestampMicrosecond=null;Gi.prototype.visitTimestampNanosecond=null;Gi.prototype.visitTimeSecond=null;Gi.prototype.visitTimeMillisecond=null;Gi.prototype.visitTimeMicrosecond=null;Gi.prototype.visitTimeNanosecond=null;Gi.prototype.visitDenseUnion=null;Gi.prototype.visitSparseUnion=null;Gi.prototype.visitIntervalDayTime=null;Gi.prototype.visitIntervalYearMonth=null;Gi.prototype.visitDuration=null;Gi.prototype.visitDurationSecond=null;Gi.prototype.visitDurationMillisecond=null;Gi.prototype.visitDurationMicrosecond=null;Gi.prototype.visitDurationNanosecond=null;const Cw=new Float64Array(1),$p=new Uint32Array(Cw.buffer);function Dw(r){const e=(r&31744)>>10,n=(r&1023)/1024,h=Math.pow(-1,(r&32768)>>15);switch(e){case 31:return h*(n?Number.NaN:1/0);case 0:return h*(n?6103515625e-14*n:0)}return h*Math.pow(2,e-15)*(1+n)}function xI(r){if(r!==r)return 32256;Cw[0]=r;const e=($p[1]&2147483648)>>16&65535;let n=$p[1]&2146435072,h=0;return n>=1089470464?$p[0]>0?n=31744:(n=(n&2080374784)>>16,h=($p[1]&1048575)>>10):n<=1056964608?(h=1048576+($p[1]&1048575),h=1048576+(h<<(n>>20)-998)>>21,n=0):(n=n-1056964608>>10,h=($p[1]&1048575)+512>>10),e|n|h&65535}class fi extends Gi{}function _i(r){return(e,n,h)=>{if(e.setValid(n,h!=null))return r(e,n,h)}}const wI=(r,e,n)=>{r[e]=Math.floor(n/864e5)},Rw=(r,e,n,h)=>{if(n+1<e.length){const _=Kn(e[n]),T=Kn(e[n+1]);r.set(h.subarray(0,T-_),_)}},SI=({offset:r,values:e},n,h)=>{const _=r+n;h?e[_>>3]|=1<<_%8:e[_>>3]&=~(1<<_%8)},xh=({values:r},e,n)=>{r[e]=n},X0=({values:r},e,n)=>{r[e]=n},Pw=({values:r},e,n)=>{r[e]=xI(n)},TI=(r,e,n)=>{switch(r.type.precision){case is.HALF:return Pw(r,e,n);case is.SINGLE:case is.DOUBLE:return X0(r,e,n)}},zw=({values:r},e,n)=>{wI(r,e,n.valueOf())},kw=({values:r},e,n)=>{r[e]=BigInt(n)},EI=({stride:r,values:e},n,h)=>{e.set(h.subarray(0,r),r*n)},Ow=({values:r,valueOffsets:e},n,h)=>Rw(r,e,n,h),Bw=({values:r,valueOffsets:e},n,h)=>Rw(r,e,n,q0(h)),MI=(r,e,n)=>{r.type.unit===ml.DAY?zw(r,e,n):kw(r,e,n)},Lw=({values:r},e,n)=>{r[e]=BigInt(n/1e3)},Fw=({values:r},e,n)=>{r[e]=BigInt(n)},Nw=({values:r},e,n)=>{r[e]=BigInt(n*1e3)},Uw=({values:r},e,n)=>{r[e]=BigInt(n*1e6)},AI=(r,e,n)=>{switch(r.type.unit){case di.SECOND:return Lw(r,e,n);case di.MILLISECOND:return Fw(r,e,n);case di.MICROSECOND:return Nw(r,e,n);case di.NANOSECOND:return Uw(r,e,n)}},jw=({values:r},e,n)=>{r[e]=n},Vw=({values:r},e,n)=>{r[e]=n},Zw=({values:r},e,n)=>{r[e]=n},Gw=({values:r},e,n)=>{r[e]=n},II=(r,e,n)=>{switch(r.type.unit){case di.SECOND:return jw(r,e,n);case di.MILLISECOND:return Vw(r,e,n);case di.MICROSECOND:return Zw(r,e,n);case di.NANOSECOND:return Gw(r,e,n)}},CI=({values:r,stride:e},n,h)=>{r.set(h.subarray(0,e),e*n)},DI=(r,e,n)=>{const h=r.children[0],_=r.valueOffsets,T=gl.getVisitFn(h);if(Array.isArray(n))for(let S=-1,u=_[e],k=_[e+1];u<k;)T(h,u++,n[++S]);else for(let S=-1,u=_[e],k=_[e+1];u<k;)T(h,u++,n.get(++S))},RI=(r,e,n)=>{const h=r.children[0],{valueOffsets:_}=r,T=gl.getVisitFn(h);let{[e]:S,[e+1]:u}=_;const k=n instanceof Map?n.entries():Object.entries(n);for(const B of k)if(T(h,S,B),++S>=u)break},PI=(r,e)=>(n,h,_,T)=>h&&n(h,r,e[T]),zI=(r,e)=>(n,h,_,T)=>h&&n(h,r,e.get(T)),kI=(r,e)=>(n,h,_,T)=>h&&n(h,r,e.get(_.name)),OI=(r,e)=>(n,h,_,T)=>h&&n(h,r,e[_.name]),BI=(r,e,n)=>{const h=r.type.children.map(T=>gl.getVisitFn(T.type)),_=n instanceof Map?kI(e,n):n instanceof En?zI(e,n):Array.isArray(n)?PI(e,n):OI(e,n);r.type.children.forEach((T,S)=>_(h[S],r.children[S],T,S))},LI=(r,e,n)=>{r.type.mode===rs.Dense?qw(r,e,n):$w(r,e,n)},qw=(r,e,n)=>{const h=r.type.typeIdToChildIndex[r.typeIds[e]],_=r.children[h];gl.visit(_,r.valueOffsets[e],n)},$w=(r,e,n)=>{const h=r.type.typeIdToChildIndex[r.typeIds[e]],_=r.children[h];gl.visit(_,e,n)},FI=(r,e,n)=>{var h;(h=r.dictionary)===null||h===void 0||h.set(r.values[e],n)},NI=(r,e,n)=>{r.type.unit===ou.DAY_TIME?Hw(r,e,n):Yw(r,e,n)},Hw=({values:r},e,n)=>{r.set(n.subarray(0,2),2*e)},Yw=({values:r},e,n)=>{r[e]=n[0]*12+n[1]%12},Xw=({values:r},e,n)=>{r[e]=n},Kw=({values:r},e,n)=>{r[e]=n},Ww=({values:r},e,n)=>{r[e]=n},Qw=({values:r},e,n)=>{r[e]=n},UI=(r,e,n)=>{switch(r.type.unit){case di.SECOND:return Xw(r,e,n);case di.MILLISECOND:return Kw(r,e,n);case di.MICROSECOND:return Ww(r,e,n);case di.NANOSECOND:return Qw(r,e,n)}},jI=(r,e,n)=>{const{stride:h}=r,_=r.children[0],T=gl.getVisitFn(_);if(Array.isArray(n))for(let S=-1,u=e*h;++S<h;)T(_,u+S,n[S]);else for(let S=-1,u=e*h;++S<h;)T(_,u+S,n.get(S))};fi.prototype.visitBool=_i(SI);fi.prototype.visitInt=_i(xh);fi.prototype.visitInt8=_i(xh);fi.prototype.visitInt16=_i(xh);fi.prototype.visitInt32=_i(xh);fi.prototype.visitInt64=_i(xh);fi.prototype.visitUint8=_i(xh);fi.prototype.visitUint16=_i(xh);fi.prototype.visitUint32=_i(xh);fi.prototype.visitUint64=_i(xh);fi.prototype.visitFloat=_i(TI);fi.prototype.visitFloat16=_i(Pw);fi.prototype.visitFloat32=_i(X0);fi.prototype.visitFloat64=_i(X0);fi.prototype.visitUtf8=_i(Bw);fi.prototype.visitLargeUtf8=_i(Bw);fi.prototype.visitBinary=_i(Ow);fi.prototype.visitLargeBinary=_i(Ow);fi.prototype.visitFixedSizeBinary=_i(EI);fi.prototype.visitDate=_i(MI);fi.prototype.visitDateDay=_i(zw);fi.prototype.visitDateMillisecond=_i(kw);fi.prototype.visitTimestamp=_i(AI);fi.prototype.visitTimestampSecond=_i(Lw);fi.prototype.visitTimestampMillisecond=_i(Fw);fi.prototype.visitTimestampMicrosecond=_i(Nw);fi.prototype.visitTimestampNanosecond=_i(Uw);fi.prototype.visitTime=_i(II);fi.prototype.visitTimeSecond=_i(jw);fi.prototype.visitTimeMillisecond=_i(Vw);fi.prototype.visitTimeMicrosecond=_i(Zw);fi.prototype.visitTimeNanosecond=_i(Gw);fi.prototype.visitDecimal=_i(CI);fi.prototype.visitList=_i(DI);fi.prototype.visitStruct=_i(BI);fi.prototype.visitUnion=_i(LI);fi.prototype.visitDenseUnion=_i(qw);fi.prototype.visitSparseUnion=_i($w);fi.prototype.visitDictionary=_i(FI);fi.prototype.visitInterval=_i(NI);fi.prototype.visitIntervalDayTime=_i(Hw);fi.prototype.visitIntervalYearMonth=_i(Yw);fi.prototype.visitDuration=_i(UI);fi.prototype.visitDurationSecond=_i(Xw);fi.prototype.visitDurationMillisecond=_i(Kw);fi.prototype.visitDurationMicrosecond=_i(Ww);fi.prototype.visitDurationNanosecond=_i(Qw);fi.prototype.visitFixedSizeList=_i(jI);fi.prototype.visitMap=_i(RI);const gl=new fi,mc=Symbol.for("parent"),lm=Symbol.for("rowIndex");class K0{constructor(e,n){return this[mc]=e,this[lm]=n,new Proxy(this,new ZI)}toArray(){return Object.values(this.toJSON())}toJSON(){const e=this[lm],n=this[mc],h=n.type.children,_={};for(let T=-1,S=h.length;++T<S;)_[h[T].name]=io.visit(n.children[T],e);return _}toString(){return`{${[...this].map(([e,n])=>`${Kg(e)}: ${Kg(n)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}[Symbol.iterator](){return new VI(this[mc],this[lm])}}class VI{constructor(e,n){this.childIndex=0,this.children=e.children,this.rowIndex=n,this.childFields=e.type.children,this.numChildren=this.childFields.length}[Symbol.iterator](){return this}next(){const e=this.childIndex;return e<this.numChildren?(this.childIndex=e+1,{done:!1,value:[this.childFields[e].name,io.visit(this.children[e],this.rowIndex)]}):{done:!0,value:null}}}Object.defineProperties(K0.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[mc]:{writable:!0,enumerable:!1,configurable:!1,value:null},[lm]:{writable:!0,enumerable:!1,configurable:!1,value:-1}});class ZI{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(e){return e[mc].type.children.map(n=>n.name)}has(e,n){return e[mc].type.children.findIndex(h=>h.name===n)!==-1}getOwnPropertyDescriptor(e,n){if(e[mc].type.children.findIndex(h=>h.name===n)!==-1)return{writable:!0,enumerable:!0,configurable:!0}}get(e,n){if(Reflect.has(e,n))return e[n];const h=e[mc].type.children.findIndex(_=>_.name===n);if(h!==-1){const _=io.visit(e[mc].children[h],e[lm]);return Reflect.set(e,n,_),_}}set(e,n,h){const _=e[mc].type.children.findIndex(T=>T.name===n);return _!==-1?(gl.visit(e[mc].children[_],e[lm],h),Reflect.set(e,n,h)):Reflect.has(e,n)||typeof n=="symbol"?Reflect.set(e,n,h):!1}}class si extends Gi{}function pi(r){return(e,n)=>e.getValid(n)?r(e,n):null}const GI=(r,e)=>864e5*r[e],qI=(r,e)=>null,Jw=(r,e,n)=>{if(n+1>=e.length)return null;const h=Kn(e[n]),_=Kn(e[n+1]);return r.subarray(h,_)},$I=({offset:r,values:e},n)=>{const h=r+n;return(e[h>>3]&1<<h%8)!==0},eS=({values:r},e)=>GI(r,e),tS=({values:r},e)=>Kn(r[e]),Od=({stride:r,values:e},n)=>e[r*n],HI=({stride:r,values:e},n)=>Dw(e[r*n]),iS=({values:r},e)=>r[e],YI=({stride:r,values:e},n)=>e.subarray(r*n,r*(n+1)),nS=({values:r,valueOffsets:e},n)=>Jw(r,e,n),rS=({values:r,valueOffsets:e},n)=>{const h=Jw(r,e,n);return h!==null?v0(h):null},XI=({values:r},e)=>r[e],KI=({type:r,values:e},n)=>r.precision!==is.HALF?e[n]:Dw(e[n]),WI=(r,e)=>r.type.unit===ml.DAY?eS(r,e):tS(r,e),aS=({values:r},e)=>1e3*Kn(r[e]),sS=({values:r},e)=>Kn(r[e]),oS=({values:r},e)=>aw(r[e],BigInt(1e3)),lS=({values:r},e)=>aw(r[e],BigInt(1e6)),QI=(r,e)=>{switch(r.type.unit){case di.SECOND:return aS(r,e);case di.MILLISECOND:return sS(r,e);case di.MICROSECOND:return oS(r,e);case di.NANOSECOND:return lS(r,e)}},cS=({values:r},e)=>r[e],uS=({values:r},e)=>r[e],hS=({values:r},e)=>r[e],dS=({values:r},e)=>r[e],JI=(r,e)=>{switch(r.type.unit){case di.SECOND:return cS(r,e);case di.MILLISECOND:return uS(r,e);case di.MICROSECOND:return hS(r,e);case di.NANOSECOND:return dS(r,e)}},eC=({values:r,stride:e},n)=>Y0.decimal(r.subarray(e*n,e*(n+1))),tC=(r,e)=>{const{valueOffsets:n,stride:h,children:_}=r,{[e*h]:T,[e*h+1]:S}=n,k=_[0].slice(T,S-T);return new En([k])},iC=(r,e)=>{const{valueOffsets:n,children:h}=r,{[e]:_,[e+1]:T}=n,S=h[0];return new W0(S.slice(_,T-_))},nC=(r,e)=>new K0(r,e),rC=(r,e)=>r.type.mode===rs.Dense?fS(r,e):pS(r,e),fS=(r,e)=>{const n=r.type.typeIdToChildIndex[r.typeIds[e]],h=r.children[n];return io.visit(h,r.valueOffsets[e])},pS=(r,e)=>{const n=r.type.typeIdToChildIndex[r.typeIds[e]],h=r.children[n];return io.visit(h,e)},aC=(r,e)=>{var n;return(n=r.dictionary)===null||n===void 0?void 0:n.get(r.values[e])},sC=(r,e)=>r.type.unit===ou.DAY_TIME?mS(r,e):gS(r,e),mS=({values:r},e)=>r.subarray(2*e,2*(e+1)),gS=({values:r},e)=>{const n=r[e],h=new Int32Array(2);return h[0]=Math.trunc(n/12),h[1]=Math.trunc(n%12),h},_S=({values:r},e)=>r[e],yS=({values:r},e)=>r[e],vS=({values:r},e)=>r[e],bS=({values:r},e)=>r[e],oC=(r,e)=>{switch(r.type.unit){case di.SECOND:return _S(r,e);case di.MILLISECOND:return yS(r,e);case di.MICROSECOND:return vS(r,e);case di.NANOSECOND:return bS(r,e)}},lC=(r,e)=>{const{stride:n,children:h}=r,T=h[0].slice(e*n,n);return new En([T])};si.prototype.visitNull=pi(qI);si.prototype.visitBool=pi($I);si.prototype.visitInt=pi(XI);si.prototype.visitInt8=pi(Od);si.prototype.visitInt16=pi(Od);si.prototype.visitInt32=pi(Od);si.prototype.visitInt64=pi(iS);si.prototype.visitUint8=pi(Od);si.prototype.visitUint16=pi(Od);si.prototype.visitUint32=pi(Od);si.prototype.visitUint64=pi(iS);si.prototype.visitFloat=pi(KI);si.prototype.visitFloat16=pi(HI);si.prototype.visitFloat32=pi(Od);si.prototype.visitFloat64=pi(Od);si.prototype.visitUtf8=pi(rS);si.prototype.visitLargeUtf8=pi(rS);si.prototype.visitBinary=pi(nS);si.prototype.visitLargeBinary=pi(nS);si.prototype.visitFixedSizeBinary=pi(YI);si.prototype.visitDate=pi(WI);si.prototype.visitDateDay=pi(eS);si.prototype.visitDateMillisecond=pi(tS);si.prototype.visitTimestamp=pi(QI);si.prototype.visitTimestampSecond=pi(aS);si.prototype.visitTimestampMillisecond=pi(sS);si.prototype.visitTimestampMicrosecond=pi(oS);si.prototype.visitTimestampNanosecond=pi(lS);si.prototype.visitTime=pi(JI);si.prototype.visitTimeSecond=pi(cS);si.prototype.visitTimeMillisecond=pi(uS);si.prototype.visitTimeMicrosecond=pi(hS);si.prototype.visitTimeNanosecond=pi(dS);si.prototype.visitDecimal=pi(eC);si.prototype.visitList=pi(tC);si.prototype.visitStruct=pi(nC);si.prototype.visitUnion=pi(rC);si.prototype.visitDenseUnion=pi(fS);si.prototype.visitSparseUnion=pi(pS);si.prototype.visitDictionary=pi(aC);si.prototype.visitInterval=pi(sC);si.prototype.visitIntervalDayTime=pi(mS);si.prototype.visitIntervalYearMonth=pi(gS);si.prototype.visitDuration=pi(oC);si.prototype.visitDurationSecond=pi(_S);si.prototype.visitDurationMillisecond=pi(yS);si.prototype.visitDurationMicrosecond=pi(vS);si.prototype.visitDurationNanosecond=pi(bS);si.prototype.visitFixedSizeList=pi(lC);si.prototype.visitMap=pi(iC);const io=new si,im=Symbol.for("keys"),cm=Symbol.for("vals"),nm=Symbol.for("kKeysAsStrings"),E0=Symbol.for("_kKeysAsStrings");class W0{constructor(e){return this[im]=new En([e.children[0]]).memoize(),this[cm]=e.children[1],new Proxy(this,new uC)}get[nm](){return this[E0]||(this[E0]=Array.from(this[im].toArray(),String))}[Symbol.iterator](){return new cC(this[im],this[cm])}get size(){return this[im].length}toArray(){return Object.values(this.toJSON())}toJSON(){const e=this[im],n=this[cm],h={};for(let _=-1,T=e.length;++_<T;)h[e.get(_)]=io.visit(n,_);return h}toString(){return`{${[...this].map(([e,n])=>`${Kg(e)}: ${Kg(n)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}}class cC{constructor(e,n){this.keys=e,this.vals=n,this.keyIndex=0,this.numKeys=e.length}[Symbol.iterator](){return this}next(){const e=this.keyIndex;return e===this.numKeys?{done:!0,value:null}:(this.keyIndex++,{done:!1,value:[this.keys.get(e),io.visit(this.vals,e)]})}}class uC{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(e){return e[nm]}has(e,n){return e[nm].includes(n)}getOwnPropertyDescriptor(e,n){if(e[nm].indexOf(n)!==-1)return{writable:!0,enumerable:!0,configurable:!0}}get(e,n){if(Reflect.has(e,n))return e[n];const h=e[nm].indexOf(n);if(h!==-1){const _=io.visit(Reflect.get(e,cm),h);return Reflect.set(e,n,_),_}}set(e,n,h){const _=e[nm].indexOf(n);return _!==-1?(gl.visit(Reflect.get(e,cm),_,h),Reflect.set(e,n,h)):Reflect.has(e,n)?Reflect.set(e,n,h):!1}}Object.defineProperties(W0.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[im]:{writable:!0,enumerable:!1,configurable:!1,value:null},[cm]:{writable:!0,enumerable:!1,configurable:!1,value:null},[E0]:{writable:!0,enumerable:!1,configurable:!1,value:null}});let Ix;function xS(r,e,n,h){const{length:_=0}=r;let T=typeof e!="number"?0:e,S=typeof n!="number"?_:n;return T<0&&(T=(T%_+_)%_),S<0&&(S=(S%_+_)%_),S<T&&(Ix=T,T=S,S=Ix),S>_&&(S=_),h?h(r,T,S):[T,S]}const Q0=(r,e)=>r<0?e+r:r,Cx=r=>r!==r;function Sm(r){if(typeof r!=="object"||r===null)return Cx(r)?Cx:n=>n===r;if(r instanceof Date){const n=r.valueOf();return h=>h instanceof Date?h.valueOf()===n:!1}return ArrayBuffer.isView(r)?n=>n?lI(r,n):!1:r instanceof Map?dC(r):Array.isArray(r)?hC(r):r instanceof En?fC(r):pC(r,!0)}function hC(r){const e=[];for(let n=-1,h=r.length;++n<h;)e[n]=Sm(r[n]);return cv(e)}function dC(r){let e=-1;const n=[];for(const h of r.values())n[++e]=Sm(h);return cv(n)}function fC(r){const e=[];for(let n=-1,h=r.length;++n<h;)e[n]=Sm(r.get(n));return cv(e)}function pC(r,e=!1){const n=Object.keys(r);if(!e&&n.length===0)return()=>!1;const h=[];for(let _=-1,T=n.length;++_<T;)h[_]=Sm(r[n[_]]);return cv(h,n)}function cv(r,e){return n=>{if(!n||typeof n!="object")return!1;switch(n.constructor){case Array:return mC(r,n);case Map:return Dx(r,n,n.keys());case W0:case K0:case Object:case void 0:return Dx(r,n,e||Object.keys(n))}return n instanceof En?gC(r,n):!1}}function mC(r,e){const n=r.length;if(e.length!==n)return!1;for(let h=-1;++h<n;)if(!r[h](e[h]))return!1;return!0}function gC(r,e){const n=r.length;if(e.length!==n)return!1;for(let h=-1;++h<n;)if(!r[h](e.get(h)))return!1;return!0}function Dx(r,e,n){const h=n[Symbol.iterator](),_=e instanceof Map?e.keys():Object.keys(e)[Symbol.iterator](),T=e instanceof Map?e.values():Object.values(e)[Symbol.iterator]();let S=0;const u=r.length;let k=T.next(),B=h.next(),q=_.next();for(;S<u&&!B.done&&!q.done&&!k.done&&!(B.value!==q.value||!r[S](k.value));++S,B=h.next(),q=_.next(),k=T.next());return S===u&&B.done&&q.done&&k.done?!0:(h.return&&h.return(),_.return&&_.return(),T.return&&T.return(),!1)}function wS(r,e,n,h){return(n&1<<h)!==0}function _C(r,e,n,h){return(n&1<<h)>>h}function qy(r,e,n){const h=n.byteLength+7&-8;if(r>0||n.byteLength<h){const _=new Uint8Array(h);return _.set(r%8===0?n.subarray(r>>3):$y(new J0(n,r,e,null,wS)).subarray(0,h)),_}return n}function $y(r){const e=[];let n=0,h=0,_=0;for(const S of r)S&&(_|=1<<h),++h===8&&(e[n++]=_,_=h=0);(n===0||h>0)&&(e[n++]=_);const T=new Uint8Array(e.length+7&-8);return T.set(e),T}class J0{constructor(e,n,h,_,T){this.bytes=e,this.length=h,this.context=_,this.get=T,this.bit=n%8,this.byteIndex=n>>3,this.byte=e[this.byteIndex++],this.index=0}next(){return this.index<this.length?(this.bit===8&&(this.bit=0,this.byte=this.bytes[this.byteIndex++]),{value:this.get(this.context,this.index++,this.byte,this.bit++)}):{done:!0,value:null}}[Symbol.iterator](){return this}}function M0(r,e,n){if(n-e<=0)return 0;if(n-e<8){let T=0;for(const S of new J0(r,e,n-e,r,_C))T+=S;return T}const h=n>>3<<3,_=e+(e%8===0?0:8-e%8);return M0(r,e,_)+M0(r,h,n)+yC(r,_>>3,h-_>>3)}function yC(r,e,n){let h=0,_=Math.trunc(e);const T=new DataView(r.buffer,r.byteOffset,r.byteLength),S=n===void 0?r.byteLength:_+n;for(;S-_>=4;)h+=Hv(T.getUint32(_)),_+=4;for(;S-_>=2;)h+=Hv(T.getUint16(_)),_+=2;for(;S-_>=1;)h+=Hv(T.getUint8(_)),_+=1;return h}function Hv(r){let e=Math.trunc(r);return e=e-(e>>>1&1431655765),e=(e&858993459)+(e>>>2&858993459),(e+(e>>>4)&252645135)*16843009>>>24}const vC=-1;class kn{get typeId(){return this.type.typeId}get ArrayType(){return this.type.ArrayType}get buffers(){return[this.valueOffsets,this.values,this.nullBitmap,this.typeIds]}get nullable(){if(this._nullCount!==0){const{type:e}=this;return Qt.isSparseUnion(e)?this.children.some(n=>n.nullable):Qt.isDenseUnion(e)?this.children.some(n=>n.nullable):this.nullBitmap&&this.nullBitmap.byteLength>0}return!0}get byteLength(){let e=0;const{valueOffsets:n,values:h,nullBitmap:_,typeIds:T}=this;return n&&(e+=n.byteLength),h&&(e+=h.byteLength),_&&(e+=_.byteLength),T&&(e+=T.byteLength),this.children.reduce((S,u)=>S+u.byteLength,e)}get nullCount(){if(Qt.isUnion(this.type))return this.children.reduce((h,_)=>h+_.nullCount,0);let e=this._nullCount,n;return e<=vC&&(n=this.nullBitmap)&&(this._nullCount=e=n.length===0?0:this.length-M0(n,this.offset,this.offset+this.length)),e}constructor(e,n,h,_,T,S=[],u){this.type=e,this.children=S,this.dictionary=u,this.offset=Math.floor(Math.max(n||0,0)),this.length=Math.floor(Math.max(h||0,0)),this._nullCount=Math.floor(Math.max(_||0,-1));let k;T instanceof kn?(this.stride=T.stride,this.values=T.values,this.typeIds=T.typeIds,this.nullBitmap=T.nullBitmap,this.valueOffsets=T.valueOffsets):(this.stride=hh(e),T&&((k=T[0])&&(this.valueOffsets=k),(k=T[1])&&(this.values=k),(k=T[2])&&(this.nullBitmap=k),(k=T[3])&&(this.typeIds=k)))}getValid(e){const{type:n}=this;if(Qt.isUnion(n)){const h=n,_=this.children[h.typeIdToChildIndex[this.typeIds[e]]],T=h.mode===rs.Dense?this.valueOffsets[e]:e;return _.getValid(T)}if(this.nullable&&this.nullCount>0){const h=this.offset+e;return(this.nullBitmap[h>>3]&1<<h%8)!==0}return!0}setValid(e,n){let h;const{type:_}=this;if(Qt.isUnion(_)){const T=_,S=this.children[T.typeIdToChildIndex[this.typeIds[e]]],u=T.mode===rs.Dense?this.valueOffsets[e]:e;h=S.getValid(u),S.setValid(u,n)}else{let{nullBitmap:T}=this;const{offset:S,length:u}=this,k=S+e,B=1<<k%8,q=k>>3;(!T||T.byteLength<=q)&&(T=new Uint8Array((S+u+63&-64)>>3).fill(255),this.nullCount>0?(T.set(qy(S,u,this.nullBitmap),0),Object.assign(this,{nullBitmap:T})):Object.assign(this,{nullBitmap:T,_nullCount:0}));const oe=T[q];h=(oe&B)!==0,T[q]=n?oe|B:oe&~B}return h!==!!n&&(this._nullCount=this.nullCount+(n?-1:1)),n}clone(e=this.type,n=this.offset,h=this.length,_=this._nullCount,T=this,S=this.children){return new kn(e,n,h,_,T,S,this.dictionary)}slice(e,n){const{stride:h,typeId:_,children:T}=this,S=+(this._nullCount===0)-1,u=_===16?h:1,k=this._sliceBuffers(e,n,h,_);return this.clone(this.type,this.offset+e,n,S,k,T.length===0||this.valueOffsets?T:this._sliceChildren(T,u*e,u*n))}_changeLengthAndBackfillNullBitmap(e){if(this.typeId===Te.Null)return this.clone(this.type,0,e,0);const{length:n,nullCount:h}=this,_=new Uint8Array((e+63&-64)>>3).fill(255,0,n>>3);_[n>>3]=(1<<n-(n&-8))-1,h>0&&_.set(qy(this.offset,n,this.nullBitmap),0);const T=this.buffers;return T[uh.VALIDITY]=_,this.clone(this.type,0,e,h+(e-n),T)}_sliceBuffers(e,n,h,_){let T;const{buffers:S}=this;return(T=S[uh.TYPE])&&(S[uh.TYPE]=T.subarray(e,e+n)),(T=S[uh.OFFSET])&&(S[uh.OFFSET]=T.subarray(e,e+n+1))||(T=S[uh.DATA])&&(S[uh.DATA]=_===6?T:T.subarray(h*e,h*(e+n))),S}_sliceChildren(e,n,h){return e.map(_=>_.slice(n,h))}}kn.prototype.children=Object.freeze([]);class Lg extends Gi{visit(e){return this.getVisitFn(e.type).call(this,e)}visitNull(e){const{["type"]:n,["offset"]:h=0,["length"]:_=0}=e;return new kn(n,h,_,_)}visitBool(e){const{["type"]:n,["offset"]:h=0}=e,_=Qi(e.nullBitmap),T=Bn(n.ArrayType,e.data),{["length"]:S=T.length>>3,["nullCount"]:u=e.nullBitmap?-1:0}=e;return new kn(n,h,S,u,[void 0,T,_])}visitInt(e){const{["type"]:n,["offset"]:h=0}=e,_=Qi(e.nullBitmap),T=Bn(n.ArrayType,e.data),{["length"]:S=T.length,["nullCount"]:u=e.nullBitmap?-1:0}=e;return new kn(n,h,S,u,[void 0,T,_])}visitFloat(e){const{["type"]:n,["offset"]:h=0}=e,_=Qi(e.nullBitmap),T=Bn(n.ArrayType,e.data),{["length"]:S=T.length,["nullCount"]:u=e.nullBitmap?-1:0}=e;return new kn(n,h,S,u,[void 0,T,_])}visitUtf8(e){const{["type"]:n,["offset"]:h=0}=e,_=Qi(e.data),T=Qi(e.nullBitmap),S=Ag(e.valueOffsets),{["length"]:u=S.length-1,["nullCount"]:k=e.nullBitmap?-1:0}=e;return new kn(n,h,u,k,[S,_,T])}visitLargeUtf8(e){const{["type"]:n,["offset"]:h=0}=e,_=Qi(e.data),T=Qi(e.nullBitmap),S=_x(e.valueOffsets),{["length"]:u=S.length-1,["nullCount"]:k=e.nullBitmap?-1:0}=e;return new kn(n,h,u,k,[S,_,T])}visitBinary(e){const{["type"]:n,["offset"]:h=0}=e,_=Qi(e.data),T=Qi(e.nullBitmap),S=Ag(e.valueOffsets),{["length"]:u=S.length-1,["nullCount"]:k=e.nullBitmap?-1:0}=e;return new kn(n,h,u,k,[S,_,T])}visitLargeBinary(e){const{["type"]:n,["offset"]:h=0}=e,_=Qi(e.data),T=Qi(e.nullBitmap),S=_x(e.valueOffsets),{["length"]:u=S.length-1,["nullCount"]:k=e.nullBitmap?-1:0}=e;return new kn(n,h,u,k,[S,_,T])}visitFixedSizeBinary(e){const{["type"]:n,["offset"]:h=0}=e,_=Qi(e.nullBitmap),T=Bn(n.ArrayType,e.data),{["length"]:S=T.length/hh(n),["nullCount"]:u=e.nullBitmap?-1:0}=e;return new kn(n,h,S,u,[void 0,T,_])}visitDate(e){const{["type"]:n,["offset"]:h=0}=e,_=Qi(e.nullBitmap),T=Bn(n.ArrayType,e.data),{["length"]:S=T.length/hh(n),["nullCount"]:u=e.nullBitmap?-1:0}=e;return new kn(n,h,S,u,[void 0,T,_])}visitTimestamp(e){const{["type"]:n,["offset"]:h=0}=e,_=Qi(e.nullBitmap),T=Bn(n.ArrayType,e.data),{["length"]:S=T.length/hh(n),["nullCount"]:u=e.nullBitmap?-1:0}=e;return new kn(n,h,S,u,[void 0,T,_])}visitTime(e){const{["type"]:n,["offset"]:h=0}=e,_=Qi(e.nullBitmap),T=Bn(n.ArrayType,e.data),{["length"]:S=T.length/hh(n),["nullCount"]:u=e.nullBitmap?-1:0}=e;return new kn(n,h,S,u,[void 0,T,_])}visitDecimal(e){const{["type"]:n,["offset"]:h=0}=e,_=Qi(e.nullBitmap),T=Bn(n.ArrayType,e.data),{["length"]:S=T.length/hh(n),["nullCount"]:u=e.nullBitmap?-1:0}=e;return new kn(n,h,S,u,[void 0,T,_])}visitList(e){const{["type"]:n,["offset"]:h=0,["child"]:_}=e,T=Qi(e.nullBitmap),S=Ag(e.valueOffsets),{["length"]:u=S.length-1,["nullCount"]:k=e.nullBitmap?-1:0}=e;return new kn(n,h,u,k,[S,void 0,T],[_])}visitStruct(e){const{["type"]:n,["offset"]:h=0,["children"]:_=[]}=e,T=Qi(e.nullBitmap),{length:S=_.reduce((k,{length:B})=>Math.max(k,B),0),nullCount:u=e.nullBitmap?-1:0}=e;return new kn(n,h,S,u,[void 0,void 0,T],_)}visitUnion(e){const{["type"]:n,["offset"]:h=0,["children"]:_=[]}=e,T=Bn(n.ArrayType,e.typeIds),{["length"]:S=T.length,["nullCount"]:u=-1}=e;if(Qt.isSparseUnion(n))return new kn(n,h,S,u,[void 0,void 0,void 0,T],_);const k=Ag(e.valueOffsets);return new kn(n,h,S,u,[k,void 0,void 0,T],_)}visitDictionary(e){const{["type"]:n,["offset"]:h=0}=e,_=Qi(e.nullBitmap),T=Bn(n.indices.ArrayType,e.data),{["dictionary"]:S=new En([new Lg().visit({type:n.dictionary})])}=e,{["length"]:u=T.length,["nullCount"]:k=e.nullBitmap?-1:0}=e;return new kn(n,h,u,k,[void 0,T,_],[],S)}visitInterval(e){const{["type"]:n,["offset"]:h=0}=e,_=Qi(e.nullBitmap),T=Bn(n.ArrayType,e.data),{["length"]:S=T.length/hh(n),["nullCount"]:u=e.nullBitmap?-1:0}=e;return new kn(n,h,S,u,[void 0,T,_])}visitDuration(e){const{["type"]:n,["offset"]:h=0}=e,_=Qi(e.nullBitmap),T=Bn(n.ArrayType,e.data),{["length"]:S=T.length,["nullCount"]:u=e.nullBitmap?-1:0}=e;return new kn(n,h,S,u,[void 0,T,_])}visitFixedSizeList(e){const{["type"]:n,["offset"]:h=0,["child"]:_=new Lg().visit({type:n.valueType})}=e,T=Qi(e.nullBitmap),{["length"]:S=_.length/hh(n),["nullCount"]:u=e.nullBitmap?-1:0}=e;return new kn(n,h,S,u,[void 0,void 0,T],[_])}visitMap(e){const{["type"]:n,["offset"]:h=0,["child"]:_=new Lg().visit({type:n.childType})}=e,T=Qi(e.nullBitmap),S=Ag(e.valueOffsets),{["length"]:u=S.length-1,["nullCount"]:k=e.nullBitmap?-1:0}=e;return new kn(n,h,u,k,[S,void 0,T],[_])}}const bC=new Lg;function Hi(r){return bC.visit(r)}class Rx{constructor(e=0,n){this.numChunks=e,this.getChunkIterator=n,this.chunkIndex=0,this.chunkIterator=this.getChunkIterator(0)}next(){for(;this.chunkIndex<this.numChunks;){const e=this.chunkIterator.next();if(!e.done)return e;++this.chunkIndex<this.numChunks&&(this.chunkIterator=this.getChunkIterator(this.chunkIndex))}return{done:!0,value:null}}[Symbol.iterator](){return this}}function xC(r){return r.some(e=>e.nullable)}function SS(r){return r.reduce((e,n)=>e+n.nullCount,0)}function TS(r){return r.reduce((e,n,h)=>(e[h+1]=e[h]+n.length,e),new Uint32Array(r.length+1))}function ES(r,e,n,h){const _=[];for(let T=-1,S=r.length;++T<S;){const u=r[T],k=e[T],{length:B}=u;if(k>=h)break;if(n>=k+B)continue;if(k>=n&&k+B<=h){_.push(u);continue}const q=Math.max(0,n-k),oe=Math.min(h-k,B);_.push(u.slice(q,oe-q))}return _.length===0&&_.push(r[0].slice(0,0)),_}function eb(r,e,n,h){let _=0,T=0,S=e.length-1;do{if(_>=S-1)return n<e[S]?h(r,_,n-e[_]):null;T=_+Math.trunc((S-_)*.5),n<e[T]?S=T:_=T}while(_<S)}function tb(r,e){return r.getValid(e)}function Hy(r){function e(n,h,_){return r(n[h],_)}return function(n){const h=this.data;return eb(h,this._offsets,n,e)}}function MS(r){let e;function n(h,_,T){return r(h[_],T,e)}return function(h,_){const T=this.data;e=_;const S=eb(T,this._offsets,h,n);return e=void 0,S}}function AS(r){let e;function n(h,_,T){let S=T,u=0,k=0;for(let B=_-1,q=h.length;++B<q;){const oe=h[B];if(~(u=r(oe,e,S)))return k+u;S=0,k+=oe.length}return-1}return function(h,_){e=h;const T=this.data,S=typeof _!="number"?n(T,0,0):eb(T,this._offsets,_,n);return e=void 0,S}}class oi extends Gi{}function wC(r,e){return e===null&&r.length>0?0:-1}function SC(r,e){const{nullBitmap:n}=r;if(!n||r.nullCount<=0)return-1;let h=0;for(const _ of new J0(n,r.offset+(e||0),r.length,n,wS)){if(!_)return h;++h}return-1}function xi(r,e,n){if(e===void 0)return-1;if(e===null)switch(r.typeId){case Te.Union:break;case Te.Dictionary:break;default:return SC(r,n)}const h=io.getVisitFn(r),_=Sm(e);for(let T=(n||0)-1,S=r.length;++T<S;)if(_(h(r,T)))return T;return-1}function IS(r,e,n){const h=io.getVisitFn(r),_=Sm(e);for(let T=(n||0)-1,S=r.length;++T<S;)if(_(h(r,T)))return T;return-1}oi.prototype.visitNull=wC;oi.prototype.visitBool=xi;oi.prototype.visitInt=xi;oi.prototype.visitInt8=xi;oi.prototype.visitInt16=xi;oi.prototype.visitInt32=xi;oi.prototype.visitInt64=xi;oi.prototype.visitUint8=xi;oi.prototype.visitUint16=xi;oi.prototype.visitUint32=xi;oi.prototype.visitUint64=xi;oi.prototype.visitFloat=xi;oi.prototype.visitFloat16=xi;oi.prototype.visitFloat32=xi;oi.prototype.visitFloat64=xi;oi.prototype.visitUtf8=xi;oi.prototype.visitLargeUtf8=xi;oi.prototype.visitBinary=xi;oi.prototype.visitLargeBinary=xi;oi.prototype.visitFixedSizeBinary=xi;oi.prototype.visitDate=xi;oi.prototype.visitDateDay=xi;oi.prototype.visitDateMillisecond=xi;oi.prototype.visitTimestamp=xi;oi.prototype.visitTimestampSecond=xi;oi.prototype.visitTimestampMillisecond=xi;oi.prototype.visitTimestampMicrosecond=xi;oi.prototype.visitTimestampNanosecond=xi;oi.prototype.visitTime=xi;oi.prototype.visitTimeSecond=xi;oi.prototype.visitTimeMillisecond=xi;oi.prototype.visitTimeMicrosecond=xi;oi.prototype.visitTimeNanosecond=xi;oi.prototype.visitDecimal=xi;oi.prototype.visitList=xi;oi.prototype.visitStruct=xi;oi.prototype.visitUnion=xi;oi.prototype.visitDenseUnion=IS;oi.prototype.visitSparseUnion=IS;oi.prototype.visitDictionary=xi;oi.prototype.visitInterval=xi;oi.prototype.visitIntervalDayTime=xi;oi.prototype.visitIntervalYearMonth=xi;oi.prototype.visitDuration=xi;oi.prototype.visitDurationSecond=xi;oi.prototype.visitDurationMillisecond=xi;oi.prototype.visitDurationMicrosecond=xi;oi.prototype.visitDurationNanosecond=xi;oi.prototype.visitFixedSizeList=xi;oi.prototype.visitMap=xi;const Yy=new oi;class li extends Gi{}function mi(r){const{type:e}=r;if(r.nullCount===0&&r.stride===1&&(Qt.isInt(e)&&e.bitWidth!==64||Qt.isTime(e)&&e.bitWidth!==64||Qt.isFloat(e)&&e.precision!==is.HALF))return new Rx(r.data.length,h=>{const _=r.data[h];return _.values.subarray(0,_.length)[Symbol.iterator]()});let n=0;return new Rx(r.data.length,h=>{const T=r.data[h].length,S=r.slice(n,n+T);return n+=T,new TC(S)})}class TC{constructor(e){this.vector=e,this.index=0}next(){return this.index<this.vector.length?{value:this.vector.get(this.index++)}:{done:!0,value:null}}[Symbol.iterator](){return this}}li.prototype.visitNull=mi;li.prototype.visitBool=mi;li.prototype.visitInt=mi;li.prototype.visitInt8=mi;li.prototype.visitInt16=mi;li.prototype.visitInt32=mi;li.prototype.visitInt64=mi;li.prototype.visitUint8=mi;li.prototype.visitUint16=mi;li.prototype.visitUint32=mi;li.prototype.visitUint64=mi;li.prototype.visitFloat=mi;li.prototype.visitFloat16=mi;li.prototype.visitFloat32=mi;li.prototype.visitFloat64=mi;li.prototype.visitUtf8=mi;li.prototype.visitLargeUtf8=mi;li.prototype.visitBinary=mi;li.prototype.visitLargeBinary=mi;li.prototype.visitFixedSizeBinary=mi;li.prototype.visitDate=mi;li.prototype.visitDateDay=mi;li.prototype.visitDateMillisecond=mi;li.prototype.visitTimestamp=mi;li.prototype.visitTimestampSecond=mi;li.prototype.visitTimestampMillisecond=mi;li.prototype.visitTimestampMicrosecond=mi;li.prototype.visitTimestampNanosecond=mi;li.prototype.visitTime=mi;li.prototype.visitTimeSecond=mi;li.prototype.visitTimeMillisecond=mi;li.prototype.visitTimeMicrosecond=mi;li.prototype.visitTimeNanosecond=mi;li.prototype.visitDecimal=mi;li.prototype.visitList=mi;li.prototype.visitStruct=mi;li.prototype.visitUnion=mi;li.prototype.visitDenseUnion=mi;li.prototype.visitSparseUnion=mi;li.prototype.visitDictionary=mi;li.prototype.visitInterval=mi;li.prototype.visitIntervalDayTime=mi;li.prototype.visitIntervalYearMonth=mi;li.prototype.visitDuration=mi;li.prototype.visitDurationSecond=mi;li.prototype.visitDurationMillisecond=mi;li.prototype.visitDurationMicrosecond=mi;li.prototype.visitDurationNanosecond=mi;li.prototype.visitFixedSizeList=mi;li.prototype.visitMap=mi;const ib=new li;var CS;const DS={},RS={};class En{constructor(e){var n,h,_;const T=e[0]instanceof En?e.flatMap(u=>u.data):e;if(T.length===0||T.some(u=>!(u instanceof kn)))throw new TypeError("Vector constructor expects an Array of Data instances.");const S=(n=T[0])===null||n===void 0?void 0:n.type;switch(T.length){case 0:this._offsets=[0];break;case 1:{const{get:u,set:k,indexOf:B}=DS[S.typeId],q=T[0];this.isValid=oe=>tb(q,oe),this.get=oe=>u(q,oe),this.set=(oe,ne)=>k(q,oe,ne),this.indexOf=oe=>B(q,oe),this._offsets=[0,q.length];break}default:Object.setPrototypeOf(this,RS[S.typeId]),this._offsets=TS(T);break}this.data=T,this.type=S,this.stride=hh(S),this.numChildren=(_=(h=S.children)===null||h===void 0?void 0:h.length)!==null&&_!==void 0?_:0,this.length=this._offsets.at(-1)}get byteLength(){return this.data.reduce((e,n)=>e+n.byteLength,0)}get nullable(){return xC(this.data)}get nullCount(){return SS(this.data)}get ArrayType(){return this.type.ArrayType}get[Symbol.toStringTag](){return`${this.VectorName}<${this.type[Symbol.toStringTag]}>`}get VectorName(){return`${Te[this.type.typeId]}Vector`}isValid(e){return!1}get(e){return null}at(e){return this.get(Q0(e,this.length))}set(e,n){}indexOf(e,n){return-1}includes(e,n){return this.indexOf(e,n)>-1}[Symbol.iterator](){return ib.visit(this)}concat(...e){return new En(this.data.concat(e.flatMap(n=>n.data).flat(Number.POSITIVE_INFINITY)))}slice(e,n){return new En(xS(this,e,n,({data:h,_offsets:_},T,S)=>ES(h,_,T,S)))}toJSON(){return[...this]}toArray(){const{type:e,data:n,length:h,stride:_,ArrayType:T}=this;switch(e.typeId){case Te.Int:case Te.Float:case Te.Decimal:case Te.Time:case Te.Timestamp:switch(n.length){case 0:return new T;case 1:return n[0].values.subarray(0,h*_);default:return n.reduce((S,{values:u,length:k})=>(S.array.set(u.subarray(0,k*_),S.offset),S.offset+=k*_,S),{array:new T(h*_),offset:0}).array}}return[...this]}toString(){return`[${[...this].join(",")}]`}getChild(e){var n;return this.getChildAt((n=this.type.children)===null||n===void 0?void 0:n.findIndex(h=>h.name===e))}getChildAt(e){return e>-1&&e<this.numChildren?new En(this.data.map(({children:n})=>n[e])):null}get isMemoized(){return Qt.isDictionary(this.type)?this.data[0].dictionary.isMemoized:!1}memoize(){if(Qt.isDictionary(this.type)){const e=new Xy(this.data[0].dictionary),n=this.data.map(h=>{const _=h.clone();return _.dictionary=e,_});return new En(n)}return new Xy(this)}unmemoize(){if(Qt.isDictionary(this.type)&&this.isMemoized){const e=this.data[0].dictionary.unmemoize(),n=this.data.map(h=>{const _=h.clone();return _.dictionary=e,_});return new En(n)}return this}}CS=Symbol.toStringTag;En[CS]=(r=>{r.type=Qt.prototype,r.data=[],r.length=0,r.stride=1,r.numChildren=0,r._offsets=new Uint32Array([0]),r[Symbol.isConcatSpreadable]=!0;const e=Object.keys(Te).map(n=>Te[n]).filter(n=>typeof n=="number"&&n!==Te.NONE);for(const n of e){const h=io.getVisitFnByTypeId(n),_=gl.getVisitFnByTypeId(n),T=Yy.getVisitFnByTypeId(n);DS[n]={get:h,set:_,indexOf:T},RS[n]=Object.create(r,{isValid:{value:Hy(tb)},get:{value:Hy(io.getVisitFnByTypeId(n))},set:{value:MS(gl.getVisitFnByTypeId(n))},indexOf:{value:AS(Yy.getVisitFnByTypeId(n))}})}return"Vector"})(En.prototype);class Xy extends En{constructor(e){super(e.data);const n=this.get,h=this.set,_=this.slice,T=new Array(this.length);Object.defineProperty(this,"get",{value(S){const u=T[S];if(u!==void 0)return u;const k=n.call(this,S);return T[S]=k,k}}),Object.defineProperty(this,"set",{value(S,u){h.call(this,S,u),T[S]=u}}),Object.defineProperty(this,"slice",{value:(S,u)=>new Xy(_.call(this,S,u))}),Object.defineProperty(this,"isMemoized",{value:!0}),Object.defineProperty(this,"unmemoize",{value:()=>new En(this.data)}),Object.defineProperty(this,"memoize",{value:()=>this})}}class A0{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}offset(){return this.bb.readInt64(this.bb_pos)}metaDataLength(){return this.bb.readInt32(this.bb_pos+8)}bodyLength(){return this.bb.readInt64(this.bb_pos+16)}static sizeOf(){return 24}static createBlock(e,n,h,_){return e.prep(8,24),e.writeInt64(BigInt(_??0)),e.pad(4),e.writeInt32(h),e.writeInt64(BigInt(n??0)),e.offset()}}class Co{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsFooter(e,n){return(n||new Co).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFooter(e,n){return e.setPosition(e.position()+An),(n||new Co).__init(e.readInt32(e.position())+e.position(),e)}version(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Gr.V1}schema(e){const n=this.bb.__offset(this.bb_pos,6);return n?(e||new Wc).__init(this.bb.__indirect(this.bb_pos+n),this.bb):null}dictionaries(e,n){const h=this.bb.__offset(this.bb_pos,8);return h?(n||new A0).__init(this.bb.__vector(this.bb_pos+h)+e*24,this.bb):null}dictionariesLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}recordBatches(e,n){const h=this.bb.__offset(this.bb_pos,10);return h?(n||new A0).__init(this.bb.__vector(this.bb_pos+h)+e*24,this.bb):null}recordBatchesLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}customMetadata(e,n){const h=this.bb.__offset(this.bb_pos,12);return h?(n||new ha).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+h)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}static startFooter(e){e.startObject(5)}static addVersion(e,n){e.addFieldInt16(0,n,Gr.V1)}static addSchema(e,n){e.addFieldOffset(1,n,0)}static addDictionaries(e,n){e.addFieldOffset(2,n,0)}static startDictionariesVector(e,n){e.startVector(24,n,8)}static addRecordBatches(e,n){e.addFieldOffset(3,n,0)}static startRecordBatchesVector(e,n){e.startVector(24,n,8)}static addCustomMetadata(e,n){e.addFieldOffset(4,n,0)}static createCustomMetadataVector(e,n){e.startVector(4,n.length,4);for(let h=n.length-1;h>=0;h--)e.addOffset(n[h]);return e.endVector()}static startCustomMetadataVector(e,n){e.startVector(4,n,4)}static endFooter(e){return e.endObject()}static finishFooterBuffer(e,n){e.finish(n)}static finishSizePrefixedFooterBuffer(e,n){e.finish(n,void 0,!0)}}class Mn{constructor(e=[],n,h,_=Gr.V5){this.fields=e||[],this.metadata=n||new Map,h||(h=I0(this.fields)),this.dictionaries=h,this.metadataVersion=_}get[Symbol.toStringTag](){return"Schema"}get names(){return this.fields.map(e=>e.name)}toString(){return`Schema<{ ${this.fields.map((e,n)=>`${n}: ${e}`).join(", ")} }>`}select(e){const n=new Set(e),h=this.fields.filter(_=>n.has(_.name));return new Mn(h,this.metadata)}selectAt(e){const n=e.map(h=>this.fields[h]).filter(Boolean);return new Mn(n,this.metadata)}assign(...e){const n=e[0]instanceof Mn?e[0]:Array.isArray(e[0])?new Mn(e[0]):new Mn(e),h=[...this.fields],_=J_(J_(new Map,this.metadata),n.metadata),T=n.fields.filter(u=>{const k=h.findIndex(B=>B.name===u.name);return~k?(h[k]=u.clone({metadata:J_(J_(new Map,h[k].metadata),u.metadata)}))&&!1:!0}),S=I0(T,new Map);return new Mn([...h,...T],_,new Map([...this.dictionaries,...S]))}}Mn.prototype.fields=null;Mn.prototype.metadata=null;Mn.prototype.dictionaries=null;class hr{static new(...e){let[n,h,_,T]=e;return e[0]&&typeof e[0]=="object"&&({name:n}=e[0],h===void 0&&(h=e[0].type),_===void 0&&(_=e[0].nullable),T===void 0&&(T=e[0].metadata)),new hr(`${n}`,h,_,T)}constructor(e,n,h=!1,_){this.name=e,this.type=n,this.nullable=h,this.metadata=_||new Map}get typeId(){return this.type.typeId}get[Symbol.toStringTag](){return"Field"}toString(){return`${this.name}: ${this.type}`}clone(...e){let[n,h,_,T]=e;return!e[0]||typeof e[0]!="object"?[n=this.name,h=this.type,_=this.nullable,T=this.metadata]=e:{name:n=this.name,type:h=this.type,nullable:_=this.nullable,metadata:T=this.metadata}=e[0],hr.new(n,h,_,T)}}hr.prototype.type=null;hr.prototype.name=null;hr.prototype.nullable=null;hr.prototype.metadata=null;function J_(r,e){return new Map([...r||new Map,...e||new Map])}function I0(r,e=new Map){for(let n=-1,h=r.length;++n<h;){const T=r[n].type;if(Qt.isDictionary(T)){if(!e.has(T.id))e.set(T.id,T.dictionary);else if(e.get(T.id)!==T.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}T.children&&T.children.length>0&&I0(T.children,e)}return e}var EC=tw,MC=mm;class e_{static decode(e){e=new MC(Qi(e));const n=Co.getRootAsFooter(e),h=Mn.decode(n.schema(),new Map,n.version());return new AC(h,n)}static encode(e){const n=new EC,h=Mn.encode(n,e.schema);Co.startRecordBatchesVector(n,e.numRecordBatches);for(const S of[...e.recordBatches()].slice().reverse())Rd.encode(n,S);const _=n.endVector();Co.startDictionariesVector(n,e.numDictionaries);for(const S of[...e.dictionaryBatches()].slice().reverse())Rd.encode(n,S);const T=n.endVector();return Co.startFooter(n),Co.addSchema(n,h),Co.addVersion(n,Gr.V5),Co.addRecordBatches(n,_),Co.addDictionaries(n,T),Co.finishFooterBuffer(n,Co.endFooter(n)),n.asUint8Array()}get numRecordBatches(){return this._recordBatches.length}get numDictionaries(){return this._dictionaryBatches.length}constructor(e,n=Gr.V5,h,_){this.schema=e,this.version=n,h&&(this._recordBatches=h),_&&(this._dictionaryBatches=_)}*recordBatches(){for(let e,n=-1,h=this.numRecordBatches;++n<h;)(e=this.getRecordBatch(n))&&(yield e)}*dictionaryBatches(){for(let e,n=-1,h=this.numDictionaries;++n<h;)(e=this.getDictionaryBatch(n))&&(yield e)}getRecordBatch(e){return e>=0&&e<this.numRecordBatches&&this._recordBatches[e]||null}getDictionaryBatch(e){return e>=0&&e<this.numDictionaries&&this._dictionaryBatches[e]||null}}class AC extends e_{get numRecordBatches(){return this._footer.recordBatchesLength()}get numDictionaries(){return this._footer.dictionariesLength()}constructor(e,n){super(e,n.version()),this._footer=n}getRecordBatch(e){if(e>=0&&e<this.numRecordBatches){const n=this._footer.recordBatches(e);if(n)return Rd.decode(n)}return null}getDictionaryBatch(e){if(e>=0&&e<this.numDictionaries){const n=this._footer.dictionaries(e);if(n)return Rd.decode(n)}return null}}class Rd{static decode(e){return new Rd(e.metaDataLength(),e.bodyLength(),e.offset())}static encode(e,n){const{metaDataLength:h}=n,_=BigInt(n.offset),T=BigInt(n.bodyLength);return A0.createBlock(e,_,h,T)}constructor(e,n,h){this.metaDataLength=e,this.offset=Kn(h),this.bodyLength=Kn(n)}}const Mr=Object.freeze({done:!0,value:void 0});class Px{constructor(e){this._json=e}get schema(){return this._json.schema}get batches(){return this._json.batches||[]}get dictionaries(){return this._json.dictionaries||[]}}class nb{tee(){return this._getDOMStream().tee()}pipe(e,n){return this._getNodeStream().pipe(e,n)}pipeTo(e,n){return this._getDOMStream().pipeTo(e,n)}pipeThrough(e,n){return this._getDOMStream().pipeThrough(e,n)}_getDOMStream(){return this._DOMStream||(this._DOMStream=this.toDOMStream())}_getNodeStream(){return this._nodeStream||(this._nodeStream=this.toNodeStream())}}class IC extends nb{constructor(){super(),this._values=[],this.resolvers=[],this._closedPromise=new Promise(e=>this._closedPromiseResolve=e)}get closed(){return this._closedPromise}cancel(e){return Ti(this,void 0,void 0,function*(){yield this.return(e)})}write(e){this._ensureOpen()&&(this.resolvers.length<=0?this._values.push(e):this.resolvers.shift().resolve({done:!1,value:e}))}abort(e){this._closedPromiseResolve&&(this.resolvers.length<=0?this._error={error:e}:this.resolvers.shift().reject({done:!0,value:e}))}close(){if(this._closedPromiseResolve){const{resolvers:e}=this;for(;e.length>0;)e.shift().resolve(Mr);this._closedPromiseResolve(),this._closedPromiseResolve=void 0}}[Symbol.asyncIterator](){return this}toDOMStream(e){return hl.toDOMStream(this._closedPromiseResolve||this._error?this:this._values,e)}toNodeStream(e){return hl.toNodeStream(this._closedPromiseResolve||this._error?this:this._values,e)}throw(e){return Ti(this,void 0,void 0,function*(){return yield this.abort(e),Mr})}return(e){return Ti(this,void 0,void 0,function*(){return yield this.close(),Mr})}read(e){return Ti(this,void 0,void 0,function*(){return(yield this.next(e,"read")).value})}peek(e){return Ti(this,void 0,void 0,function*(){return(yield this.next(e,"peek")).value})}next(...e){return this._values.length>0?Promise.resolve({done:!1,value:this._values.shift()}):this._error?Promise.reject({done:!0,value:this._error.error}):this._closedPromiseResolve?new Promise((n,h)=>{this.resolvers.push({resolve:n,reject:h})}):Promise.resolve(Mr)}_ensureOpen(){if(this._closedPromiseResolve)return!0;throw new Error("AsyncQueue is closed")}}class hy extends IC{write(e){if((e=Qi(e)).byteLength>0)return super.write(e)}toString(e=!1){return e?v0(this.toUint8Array(!0)):this.toUint8Array(!1).then(v0)}toUint8Array(e=!1){return e?su(this._values)[0]:Ti(this,void 0,void 0,function*(){var n,h,_,T;const S=[];let u=0;try{for(var k=!0,B=Ff(this),q;q=yield B.next(),n=q.done,!n;k=!0){T=q.value,k=!1;const oe=T;S.push(oe),u+=oe.byteLength}}catch(oe){h={error:oe}}finally{try{!k&&!n&&(_=B.return)&&(yield _.call(B))}finally{if(h)throw h.error}}return su(S,u)[0]})}}class Ky{constructor(e){e&&(this.source=new CC(hl.fromIterable(e)))}[Symbol.iterator](){return this}next(e){return this.source.next(e)}throw(e){return this.source.throw(e)}return(e){return this.source.return(e)}peek(e){return this.source.peek(e)}read(e){return this.source.read(e)}}class ym{constructor(e){e instanceof ym?this.source=e.source:e instanceof hy?this.source=new Of(hl.fromAsyncIterable(e)):W1(e)?this.source=new Of(hl.fromNodeStream(e)):$0(e)?this.source=new Of(hl.fromDOMStream(e)):K1(e)?this.source=new Of(hl.fromDOMStream(e.body)):r_(e)?this.source=new Of(hl.fromIterable(e)):Uf(e)?this.source=new Of(hl.fromAsyncIterable(e)):wm(e)&&(this.source=new Of(hl.fromAsyncIterable(e)))}[Symbol.asyncIterator](){return this}next(e){return this.source.next(e)}throw(e){return this.source.throw(e)}return(e){return this.source.return(e)}get closed(){return this.source.closed}cancel(e){return this.source.cancel(e)}peek(e){return this.source.peek(e)}read(e){return this.source.read(e)}}class CC{constructor(e){this.source=e}cancel(e){this.return(e)}peek(e){return this.next(e,"peek").value}read(e){return this.next(e,"read").value}next(e,n="read"){return this.source.next({cmd:n,size:e})}throw(e){return Object.create(this.source.throw&&this.source.throw(e)||Mr)}return(e){return Object.create(this.source.return&&this.source.return(e)||Mr)}}class Of{constructor(e){this.source=e,this._closedPromise=new Promise(n=>this._closedPromiseResolve=n)}cancel(e){return Ti(this,void 0,void 0,function*(){yield this.return(e)})}get closed(){return this._closedPromise}read(e){return Ti(this,void 0,void 0,function*(){return(yield this.next(e,"read")).value})}peek(e){return Ti(this,void 0,void 0,function*(){return(yield this.next(e,"peek")).value})}next(e){return Ti(this,arguments,void 0,function*(n,h="read"){return yield this.source.next({cmd:h,size:n})})}throw(e){return Ti(this,void 0,void 0,function*(){const n=this.source.throw&&(yield this.source.throw(e))||Mr;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(n)})}return(e){return Ti(this,void 0,void 0,function*(){const n=this.source.return&&(yield this.source.return(e))||Mr;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(n)})}}class zx extends Ky{constructor(e,n){super(),this.position=0,this.buffer=Qi(e),this.size=n===void 0?this.buffer.byteLength:n}readInt32(e){const{buffer:n,byteOffset:h}=this.readAt(e,4);return new DataView(n,h).getInt32(0,!0)}seek(e){return this.position=Math.min(e,this.size),e<this.size}read(e){const{buffer:n,size:h,position:_}=this;return n&&_<h?(typeof e!="number"&&(e=Number.POSITIVE_INFINITY),this.position=Math.min(h,_+Math.min(h-_,e)),n.subarray(_,this.position)):null}readAt(e,n){const h=this.buffer,_=Math.min(this.size,e+n);return h?h.subarray(e,_):new Uint8Array(n)}close(){this.buffer&&(this.buffer=null)}throw(e){return this.close(),{done:!0,value:e}}return(e){return this.close(),{done:!0,value:e}}}class Wy extends ym{constructor(e,n){super(),this.position=0,this._handle=e,typeof n=="number"?this.size=n:this._pending=Ti(this,void 0,void 0,function*(){this.size=(yield e.stat()).size,delete this._pending})}readInt32(e){return Ti(this,void 0,void 0,function*(){const{buffer:n,byteOffset:h}=yield this.readAt(e,4);return new DataView(n,h).getInt32(0,!0)})}seek(e){return Ti(this,void 0,void 0,function*(){return this._pending&&(yield this._pending),this.position=Math.min(e,this.size),e<this.size})}read(e){return Ti(this,void 0,void 0,function*(){this._pending&&(yield this._pending);const{_handle:n,size:h,position:_}=this;if(n&&_<h){typeof e!="number"&&(e=Number.POSITIVE_INFINITY);let T=_,S=0,u=0;const k=Math.min(h,T+Math.min(h-T,e)),B=new Uint8Array(Math.max(0,(this.position=k)-T));for(;(T+=u)<k&&(S+=u)<B.byteLength;)({bytesRead:u}=yield n.read(B,S,B.byteLength-S,T));return B}return null})}readAt(e,n){return Ti(this,void 0,void 0,function*(){this._pending&&(yield this._pending);const{_handle:h,size:_}=this;if(h&&e+n<_){const T=Math.min(_,e+n),S=new Uint8Array(T-e);return(yield h.read(S,0,n,e)).buffer}return new Uint8Array(n)})}close(){return Ti(this,void 0,void 0,function*(){const e=this._handle;this._handle=null,e&&(yield e.close())})}throw(e){return Ti(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:e}})}return(e){return Ti(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:e}})}}const DC=65536;function rm(r){return r<0&&(r=4294967295+r+1),`0x${r.toString(16)}`}const vm=8,rb=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8];class PS{constructor(e){this.buffer=e}high(){return this.buffer[1]}low(){return this.buffer[0]}_times(e){const n=new Uint32Array([this.buffer[1]>>>16,this.buffer[1]&65535,this.buffer[0]>>>16,this.buffer[0]&65535]),h=new Uint32Array([e.buffer[1]>>>16,e.buffer[1]&65535,e.buffer[0]>>>16,e.buffer[0]&65535]);let _=n[3]*h[3];this.buffer[0]=_&65535;let T=_>>>16;return _=n[2]*h[3],T+=_,_=n[3]*h[2]>>>0,T+=_,this.buffer[0]+=T<<16,this.buffer[1]=T>>>0<_?DC:0,this.buffer[1]+=T>>>16,this.buffer[1]+=n[1]*h[3]+n[2]*h[2]+n[3]*h[1],this.buffer[1]+=n[0]*h[3]+n[1]*h[2]+n[2]*h[1]+n[3]*h[0]<<16,this}_plus(e){const n=this.buffer[0]+e.buffer[0]>>>0;this.buffer[1]+=e.buffer[1],n<this.buffer[0]>>>0&&++this.buffer[1],this.buffer[0]=n}lessThan(e){return this.buffer[1]<e.buffer[1]||this.buffer[1]===e.buffer[1]&&this.buffer[0]<e.buffer[0]}equals(e){return this.buffer[1]===e.buffer[1]&&this.buffer[0]==e.buffer[0]}greaterThan(e){return e.lessThan(this)}hex(){return`${rm(this.buffer[1])} ${rm(this.buffer[0])}`}}class On extends PS{times(e){return this._times(e),this}plus(e){return this._plus(e),this}static from(e,n=new Uint32Array(2)){return On.fromString(typeof e=="string"?e:e.toString(),n)}static fromNumber(e,n=new Uint32Array(2)){return On.fromString(e.toString(),n)}static fromString(e,n=new Uint32Array(2)){const h=e.length,_=new On(n);for(let T=0;T<h;){const S=vm<h-T?vm:h-T,u=new On(new Uint32Array([Number.parseInt(e.slice(T,T+S),10),0])),k=new On(new Uint32Array([rb[S],0]));_.times(k),_.plus(u),T+=S}return _}static convertArray(e){const n=new Uint32Array(e.length*2);for(let h=-1,_=e.length;++h<_;)On.from(e[h],new Uint32Array(n.buffer,n.byteOffset+2*h*4,2));return n}static multiply(e,n){return new On(new Uint32Array(e.buffer)).times(n)}static add(e,n){return new On(new Uint32Array(e.buffer)).plus(n)}}class Qs extends PS{negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[0]==0&&++this.buffer[1],this}times(e){return this._times(e),this}plus(e){return this._plus(e),this}lessThan(e){const n=this.buffer[1]<<0,h=e.buffer[1]<<0;return n<h||n===h&&this.buffer[0]<e.buffer[0]}static from(e,n=new Uint32Array(2)){return Qs.fromString(typeof e=="string"?e:e.toString(),n)}static fromNumber(e,n=new Uint32Array(2)){return Qs.fromString(e.toString(),n)}static fromString(e,n=new Uint32Array(2)){const h=e.startsWith("-"),_=e.length,T=new Qs(n);for(let S=h?1:0;S<_;){const u=vm<_-S?vm:_-S,k=new Qs(new Uint32Array([Number.parseInt(e.slice(S,S+u),10),0])),B=new Qs(new Uint32Array([rb[u],0]));T.times(B),T.plus(k),S+=u}return h?T.negate():T}static convertArray(e){const n=new Uint32Array(e.length*2);for(let h=-1,_=e.length;++h<_;)Qs.from(e[h],new Uint32Array(n.buffer,n.byteOffset+2*h*4,2));return n}static multiply(e,n){return new Qs(new Uint32Array(e.buffer)).times(n)}static add(e,n){return new Qs(new Uint32Array(e.buffer)).plus(n)}}class Qc{constructor(e){this.buffer=e}high(){return new Qs(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2))}low(){return new Qs(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset,2))}negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[2]=~this.buffer[2],this.buffer[3]=~this.buffer[3],this.buffer[0]==0&&++this.buffer[1],this.buffer[1]==0&&++this.buffer[2],this.buffer[2]==0&&++this.buffer[3],this}times(e){const n=new On(new Uint32Array([this.buffer[3],0])),h=new On(new Uint32Array([this.buffer[2],0])),_=new On(new Uint32Array([this.buffer[1],0])),T=new On(new Uint32Array([this.buffer[0],0])),S=new On(new Uint32Array([e.buffer[3],0])),u=new On(new Uint32Array([e.buffer[2],0])),k=new On(new Uint32Array([e.buffer[1],0])),B=new On(new Uint32Array([e.buffer[0],0]));let q=On.multiply(T,B);this.buffer[0]=q.low();const oe=new On(new Uint32Array([q.high(),0]));return q=On.multiply(_,B),oe.plus(q),q=On.multiply(T,k),oe.plus(q),this.buffer[1]=oe.low(),this.buffer[3]=oe.lessThan(q)?1:0,this.buffer[2]=oe.high(),new On(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2)).plus(On.multiply(h,B)).plus(On.multiply(_,k)).plus(On.multiply(T,u)),this.buffer[3]+=On.multiply(n,B).plus(On.multiply(h,k)).plus(On.multiply(_,u)).plus(On.multiply(T,S)).low(),this}plus(e){const n=new Uint32Array(4);return n[3]=this.buffer[3]+e.buffer[3]>>>0,n[2]=this.buffer[2]+e.buffer[2]>>>0,n[1]=this.buffer[1]+e.buffer[1]>>>0,n[0]=this.buffer[0]+e.buffer[0]>>>0,n[0]<this.buffer[0]>>>0&&++n[1],n[1]<this.buffer[1]>>>0&&++n[2],n[2]<this.buffer[2]>>>0&&++n[3],this.buffer[3]=n[3],this.buffer[2]=n[2],this.buffer[1]=n[1],this.buffer[0]=n[0],this}hex(){return`${rm(this.buffer[3])} ${rm(this.buffer[2])} ${rm(this.buffer[1])} ${rm(this.buffer[0])}`}static multiply(e,n){return new Qc(new Uint32Array(e.buffer)).times(n)}static add(e,n){return new Qc(new Uint32Array(e.buffer)).plus(n)}static from(e,n=new Uint32Array(4)){return Qc.fromString(typeof e=="string"?e:e.toString(),n)}static fromNumber(e,n=new Uint32Array(4)){return Qc.fromString(e.toString(),n)}static fromString(e,n=new Uint32Array(4)){const h=e.startsWith("-"),_=e.length,T=new Qc(n);for(let S=h?1:0;S<_;){const u=vm<_-S?vm:_-S,k=new Qc(new Uint32Array([Number.parseInt(e.slice(S,S+u),10),0,0,0])),B=new Qc(new Uint32Array([rb[u],0,0,0]));T.times(B),T.plus(k),S+=u}return h?T.negate():T}static convertArray(e){const n=new Uint32Array(e.length*4);for(let h=-1,_=e.length;++h<_;)Qc.from(e[h],new Uint32Array(n.buffer,n.byteOffset+4*4*h,4));return n}}class zS extends Gi{constructor(e,n,h,_,T=Gr.V5){super(),this.nodesIndex=-1,this.buffersIndex=-1,this.bytes=e,this.nodes=n,this.buffers=h,this.dictionaries=_,this.metadataVersion=T}visit(e){return super.visit(e instanceof hr?e.type:e)}visitNull(e,{length:n}=this.nextFieldNode()){return Hi({type:e,length:n})}visitBool(e,{length:n,nullCount:h}=this.nextFieldNode()){return Hi({type:e,length:n,nullCount:h,nullBitmap:this.readNullBitmap(e,h),data:this.readData(e)})}visitInt(e,{length:n,nullCount:h}=this.nextFieldNode()){return Hi({type:e,length:n,nullCount:h,nullBitmap:this.readNullBitmap(e,h),data:this.readData(e)})}visitFloat(e,{length:n,nullCount:h}=this.nextFieldNode()){return Hi({type:e,length:n,nullCount:h,nullBitmap:this.readNullBitmap(e,h),data:this.readData(e)})}visitUtf8(e,{length:n,nullCount:h}=this.nextFieldNode()){return Hi({type:e,length:n,nullCount:h,nullBitmap:this.readNullBitmap(e,h),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitLargeUtf8(e,{length:n,nullCount:h}=this.nextFieldNode()){return Hi({type:e,length:n,nullCount:h,nullBitmap:this.readNullBitmap(e,h),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitBinary(e,{length:n,nullCount:h}=this.nextFieldNode()){return Hi({type:e,length:n,nullCount:h,nullBitmap:this.readNullBitmap(e,h),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitLargeBinary(e,{length:n,nullCount:h}=this.nextFieldNode()){return Hi({type:e,length:n,nullCount:h,nullBitmap:this.readNullBitmap(e,h),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitFixedSizeBinary(e,{length:n,nullCount:h}=this.nextFieldNode()){return Hi({type:e,length:n,nullCount:h,nullBitmap:this.readNullBitmap(e,h),data:this.readData(e)})}visitDate(e,{length:n,nullCount:h}=this.nextFieldNode()){return Hi({type:e,length:n,nullCount:h,nullBitmap:this.readNullBitmap(e,h),data:this.readData(e)})}visitTimestamp(e,{length:n,nullCount:h}=this.nextFieldNode()){return Hi({type:e,length:n,nullCount:h,nullBitmap:this.readNullBitmap(e,h),data:this.readData(e)})}visitTime(e,{length:n,nullCount:h}=this.nextFieldNode()){return Hi({type:e,length:n,nullCount:h,nullBitmap:this.readNullBitmap(e,h),data:this.readData(e)})}visitDecimal(e,{length:n,nullCount:h}=this.nextFieldNode()){return Hi({type:e,length:n,nullCount:h,nullBitmap:this.readNullBitmap(e,h),data:this.readData(e)})}visitList(e,{length:n,nullCount:h}=this.nextFieldNode()){return Hi({type:e,length:n,nullCount:h,nullBitmap:this.readNullBitmap(e,h),valueOffsets:this.readOffsets(e),child:this.visit(e.children[0])})}visitStruct(e,{length:n,nullCount:h}=this.nextFieldNode()){return Hi({type:e,length:n,nullCount:h,nullBitmap:this.readNullBitmap(e,h),children:this.visitMany(e.children)})}visitUnion(e,{length:n,nullCount:h}=this.nextFieldNode()){return this.metadataVersion<Gr.V5&&this.readNullBitmap(e,h),e.mode===rs.Sparse?this.visitSparseUnion(e,{length:n,nullCount:h}):this.visitDenseUnion(e,{length:n,nullCount:h})}visitDenseUnion(e,{length:n,nullCount:h}=this.nextFieldNode()){return Hi({type:e,length:n,nullCount:h,typeIds:this.readTypeIds(e),valueOffsets:this.readOffsets(e),children:this.visitMany(e.children)})}visitSparseUnion(e,{length:n,nullCount:h}=this.nextFieldNode()){return Hi({type:e,length:n,nullCount:h,typeIds:this.readTypeIds(e),children:this.visitMany(e.children)})}visitDictionary(e,{length:n,nullCount:h}=this.nextFieldNode()){return Hi({type:e,length:n,nullCount:h,nullBitmap:this.readNullBitmap(e,h),data:this.readData(e.indices),dictionary:this.readDictionary(e)})}visitInterval(e,{length:n,nullCount:h}=this.nextFieldNode()){return Hi({type:e,length:n,nullCount:h,nullBitmap:this.readNullBitmap(e,h),data:this.readData(e)})}visitDuration(e,{length:n,nullCount:h}=this.nextFieldNode()){return Hi({type:e,length:n,nullCount:h,nullBitmap:this.readNullBitmap(e,h),data:this.readData(e)})}visitFixedSizeList(e,{length:n,nullCount:h}=this.nextFieldNode()){return Hi({type:e,length:n,nullCount:h,nullBitmap:this.readNullBitmap(e,h),child:this.visit(e.children[0])})}visitMap(e,{length:n,nullCount:h}=this.nextFieldNode()){return Hi({type:e,length:n,nullCount:h,nullBitmap:this.readNullBitmap(e,h),valueOffsets:this.readOffsets(e),child:this.visit(e.children[0])})}nextFieldNode(){return this.nodes[++this.nodesIndex]}nextBufferRange(){return this.buffers[++this.buffersIndex]}readNullBitmap(e,n,h=this.nextBufferRange()){return n>0&&this.readData(e,h)||new Uint8Array(0)}readOffsets(e,n){return this.readData(e,n)}readTypeIds(e,n){return this.readData(e,n)}readData(e,{length:n,offset:h}=this.nextBufferRange()){return this.bytes.subarray(h,h+n)}readDictionary(e){return this.dictionaries.get(e.id)}}class RC extends zS{constructor(e,n,h,_,T){super(new Uint8Array(0),n,h,_,T),this.sources=e}readNullBitmap(e,n,{offset:h}=this.nextBufferRange()){return n<=0?new Uint8Array(0):$y(this.sources[h])}readOffsets(e,{offset:n}=this.nextBufferRange()){return Bn(Uint8Array,Bn(e.OffsetArrayType,this.sources[n]))}readTypeIds(e,{offset:n}=this.nextBufferRange()){return Bn(Uint8Array,Bn(e.ArrayType,this.sources[n]))}readData(e,{offset:n}=this.nextBufferRange()){const{sources:h}=this;return Qt.isTimestamp(e)||(Qt.isInt(e)||Qt.isTime(e))&&e.bitWidth===64||Qt.isDuration(e)||Qt.isDate(e)&&e.unit===ml.MILLISECOND?Bn(Uint8Array,Qs.convertArray(h[n])):Qt.isDecimal(e)?Bn(Uint8Array,Qc.convertArray(h[n])):Qt.isBinary(e)||Qt.isLargeBinary(e)||Qt.isFixedSizeBinary(e)?PC(h[n]):Qt.isBool(e)?$y(h[n]):Qt.isUtf8(e)||Qt.isLargeUtf8(e)?q0(h[n].join("")):Bn(Uint8Array,Bn(e.ArrayType,h[n].map(_=>+_)))}}function PC(r){const e=r.join(""),n=new Uint8Array(e.length/2);for(let h=0;h<e.length;h+=2)n[h>>1]=Number.parseInt(e.slice(h,h+2),16);return n}class ci extends Gi{compareSchemas(e,n){return e===n||n instanceof e.constructor&&this.compareManyFields(e.fields,n.fields)}compareManyFields(e,n){return e===n||Array.isArray(e)&&Array.isArray(n)&&e.length===n.length&&e.every((h,_)=>this.compareFields(h,n[_]))}compareFields(e,n){return e===n||n instanceof e.constructor&&e.name===n.name&&e.nullable===n.nullable&&this.visit(e.type,n.type)}}function As(r,e){return e instanceof r.constructor}function Gf(r,e){return r===e||As(r,e)}function wh(r,e){return r===e||As(r,e)&&r.bitWidth===e.bitWidth&&r.isSigned===e.isSigned}function uv(r,e){return r===e||As(r,e)&&r.precision===e.precision}function zC(r,e){return r===e||As(r,e)&&r.byteWidth===e.byteWidth}function ab(r,e){return r===e||As(r,e)&&r.unit===e.unit}function a_(r,e){return r===e||As(r,e)&&r.unit===e.unit&&r.timezone===e.timezone}function s_(r,e){return r===e||As(r,e)&&r.unit===e.unit&&r.bitWidth===e.bitWidth}function kC(r,e){return r===e||As(r,e)&&r.children.length===e.children.length&&Pd.compareManyFields(r.children,e.children)}function OC(r,e){return r===e||As(r,e)&&r.children.length===e.children.length&&Pd.compareManyFields(r.children,e.children)}function sb(r,e){return r===e||As(r,e)&&r.mode===e.mode&&r.typeIds.every((n,h)=>n===e.typeIds[h])&&Pd.compareManyFields(r.children,e.children)}function BC(r,e){return r===e||As(r,e)&&r.id===e.id&&r.isOrdered===e.isOrdered&&Pd.visit(r.indices,e.indices)&&Pd.visit(r.dictionary,e.dictionary)}function ob(r,e){return r===e||As(r,e)&&r.unit===e.unit}function o_(r,e){return r===e||As(r,e)&&r.unit===e.unit}function LC(r,e){return r===e||As(r,e)&&r.listSize===e.listSize&&r.children.length===e.children.length&&Pd.compareManyFields(r.children,e.children)}function FC(r,e){return r===e||As(r,e)&&r.keysSorted===e.keysSorted&&r.children.length===e.children.length&&Pd.compareManyFields(r.children,e.children)}ci.prototype.visitNull=Gf;ci.prototype.visitBool=Gf;ci.prototype.visitInt=wh;ci.prototype.visitInt8=wh;ci.prototype.visitInt16=wh;ci.prototype.visitInt32=wh;ci.prototype.visitInt64=wh;ci.prototype.visitUint8=wh;ci.prototype.visitUint16=wh;ci.prototype.visitUint32=wh;ci.prototype.visitUint64=wh;ci.prototype.visitFloat=uv;ci.prototype.visitFloat16=uv;ci.prototype.visitFloat32=uv;ci.prototype.visitFloat64=uv;ci.prototype.visitUtf8=Gf;ci.prototype.visitLargeUtf8=Gf;ci.prototype.visitBinary=Gf;ci.prototype.visitLargeBinary=Gf;ci.prototype.visitFixedSizeBinary=zC;ci.prototype.visitDate=ab;ci.prototype.visitDateDay=ab;ci.prototype.visitDateMillisecond=ab;ci.prototype.visitTimestamp=a_;ci.prototype.visitTimestampSecond=a_;ci.prototype.visitTimestampMillisecond=a_;ci.prototype.visitTimestampMicrosecond=a_;ci.prototype.visitTimestampNanosecond=a_;ci.prototype.visitTime=s_;ci.prototype.visitTimeSecond=s_;ci.prototype.visitTimeMillisecond=s_;ci.prototype.visitTimeMicrosecond=s_;ci.prototype.visitTimeNanosecond=s_;ci.prototype.visitDecimal=Gf;ci.prototype.visitList=kC;ci.prototype.visitStruct=OC;ci.prototype.visitUnion=sb;ci.prototype.visitDenseUnion=sb;ci.prototype.visitSparseUnion=sb;ci.prototype.visitDictionary=BC;ci.prototype.visitInterval=ob;ci.prototype.visitIntervalDayTime=ob;ci.prototype.visitIntervalYearMonth=ob;ci.prototype.visitDuration=o_;ci.prototype.visitDurationSecond=o_;ci.prototype.visitDurationMillisecond=o_;ci.prototype.visitDurationMicrosecond=o_;ci.prototype.visitDurationNanosecond=o_;ci.prototype.visitFixedSizeList=LC;ci.prototype.visitMap=FC;const Pd=new ci;function C0(r,e){return Pd.compareSchemas(r,e)}function Yv(r,e){return NC(r,e.map(n=>n.data.concat()))}function NC(r,e){const n=[...r.fields],h=[],_={numBatches:e.reduce((oe,ne)=>Math.max(oe,ne.length),0)};let T=0,S=0,u=-1;const k=e.length;let B,q=[];for(;_.numBatches-- >0;){for(S=Number.POSITIVE_INFINITY,u=-1;++u<k;)q[u]=B=e[u].shift(),S=Math.min(S,B?B.length:S);Number.isFinite(S)&&(q=UC(n,S,q,e,_),S>0&&(h[T++]=Hi({type:new Ts(n),length:S,nullCount:0,children:q.slice()})))}return[r=r.assign(n),h.map(oe=>new eo(r,oe))]}function UC(r,e,n,h,_){var T;const S=(e+63&-64)>>3;for(let u=-1,k=h.length;++u<k;){const B=n[u],q=B==null?void 0:B.length;if(q>=e)q===e?n[u]=B:(n[u]=B.slice(0,e),_.numBatches=Math.max(_.numBatches,h[u].unshift(B.slice(e,q-e))));else{const oe=r[u];r[u]=oe.clone({nullable:!0}),n[u]=(T=B==null?void 0:B._changeLengthAndBackfillNullBitmap(e))!==null&&T!==void 0?T:Hi({type:oe.type,length:e,nullCount:e,nullBitmap:new Uint8Array(S)})}}return n}var kS;class Ss{constructor(...e){var n,h;if(e.length===0)return this.batches=[],this.schema=new Mn([]),this._offsets=[0],this;let _,T;e[0]instanceof Mn&&(_=e.shift()),e.at(-1)instanceof Uint32Array&&(T=e.pop());const S=k=>{if(k){if(k instanceof eo)return[k];if(k instanceof Ss)return k.batches;if(k instanceof kn){if(k.type instanceof Ts)return[new eo(new Mn(k.type.children),k)]}else{if(Array.isArray(k))return k.flatMap(B=>S(B));if(typeof k[Symbol.iterator]=="function")return[...k].flatMap(B=>S(B));if(typeof k=="object"){const B=Object.keys(k),q=B.map(K=>new En([k[K]])),oe=_??new Mn(B.map((K,le)=>new hr(String(K),q[le].type,q[le].nullable))),[,ne]=Yv(oe,q);return ne.length===0?[new eo(k)]:ne}}}return[]},u=e.flatMap(k=>S(k));if(_=(h=_??((n=u[0])===null||n===void 0?void 0:n.schema))!==null&&h!==void 0?h:new Mn([]),!(_ instanceof Mn))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");for(const k of u){if(!(k instanceof eo))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");if(!C0(_,k.schema))throw new TypeError("Table and inner RecordBatch schemas must be equivalent.")}this.schema=_,this.batches=u,this._offsets=T??TS(this.data)}get data(){return this.batches.map(({data:e})=>e)}get numCols(){return this.schema.fields.length}get numRows(){return this.data.reduce((e,n)=>e+n.length,0)}get nullCount(){return this._nullCount===-1&&(this._nullCount=SS(this.data)),this._nullCount}isValid(e){return!1}get(e){return null}at(e){return this.get(Q0(e,this.numRows))}set(e,n){}indexOf(e,n){return-1}[Symbol.iterator](){return this.batches.length>0?ib.visit(new En(this.data)):new Array(0)[Symbol.iterator]()}toArray(){return[...this]}toString(){return`[
  ${this.toArray().join(`,
  `)}
]`}concat(...e){const n=this.schema,h=this.data.concat(e.flatMap(({data:_})=>_));return new Ss(n,h.map(_=>new eo(n,_)))}slice(e,n){const h=this.schema;[e,n]=xS({length:this.numRows},e,n);const _=ES(this.data,this._offsets,e,n);return new Ss(h,_.map(T=>new eo(h,T)))}getChild(e){return this.getChildAt(this.schema.fields.findIndex(n=>n.name===e))}getChildAt(e){if(e>-1&&e<this.schema.fields.length){const n=this.data.map(h=>h.children[e]);if(n.length===0){const{type:h}=this.schema.fields[e],_=Hi({type:h,length:0,nullCount:0});n.push(_._changeLengthAndBackfillNullBitmap(this.numRows))}return new En(n)}return null}setChild(e,n){var h;return this.setChildAt((h=this.schema.fields)===null||h===void 0?void 0:h.findIndex(_=>_.name===e),n)}setChildAt(e,n){let h=this.schema,_=[...this.batches];if(e>-1&&e<this.numCols){n||(n=new En([Hi({type:new Dd,length:this.numRows})]));const T=h.fields.slice(),S=T[e].clone({type:n.type}),u=this.schema.fields.map((k,B)=>this.getChildAt(B));[T[e],u[e]]=[S,n],[h,_]=Yv(h,u)}return new Ss(h,_)}select(e){const n=this.schema.fields.reduce((h,_,T)=>h.set(_.name,T),new Map);return this.selectAt(e.map(h=>n.get(h)).filter(h=>h>-1))}selectAt(e){const n=this.schema.selectAt(e),h=this.batches.map(_=>_.selectAt(e));return new Ss(n,h)}assign(e){const n=this.schema.fields,[h,_]=e.schema.fields.reduce((u,k,B)=>{const[q,oe]=u,ne=n.findIndex(K=>K.name===k.name);return~ne?oe[ne]=B:q.push(B),u},[[],[]]),T=this.schema.assign(e.schema),S=[...n.map((u,k)=>[k,_[k]]).map(([u,k])=>k===void 0?this.getChildAt(u):e.getChildAt(k)),...h.map(u=>e.getChildAt(u))].filter(Boolean);return new Ss(...Yv(T,S))}}kS=Symbol.toStringTag;Ss[kS]=(r=>(r.schema=null,r.batches=[],r._offsets=new Uint32Array([0]),r._nullCount=-1,r[Symbol.isConcatSpreadable]=!0,r.isValid=Hy(tb),r.get=Hy(io.getVisitFn(Te.Struct)),r.set=MS(gl.getVisitFn(Te.Struct)),r.indexOf=AS(Yy.getVisitFn(Te.Struct)),"Table"))(Ss.prototype);var OS;let eo=class Bg{constructor(...e){switch(e.length){case 2:{if([this.schema]=e,!(this.schema instanceof Mn))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");if([,this.data=Hi({nullCount:0,type:new Ts(this.schema.fields),children:this.schema.fields.map(n=>Hi({type:n.type,nullCount:0}))})]=e,!(this.data instanceof kn))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");[this.schema,this.data]=kx(this.schema,this.data.children);break}case 1:{const[n]=e,{fields:h,children:_,length:T}=Object.keys(n).reduce((k,B,q)=>(k.children[q]=n[B],k.length=Math.max(k.length,n[B].length),k.fields[q]=hr.new({name:B,type:n[B].type,nullable:!0}),k),{length:0,fields:new Array,children:new Array}),S=new Mn(h),u=Hi({type:new Ts(h),length:T,children:_,nullCount:0});[this.schema,this.data]=kx(S,u.children,T);break}default:throw new TypeError("RecordBatch constructor expects an Object mapping names to child Data, or a [Schema, Data] pair.")}}get dictionaries(){return this._dictionaries||(this._dictionaries=BS(this.schema.fields,this.data.children))}get numCols(){return this.schema.fields.length}get numRows(){return this.data.length}get nullCount(){return this.data.nullCount}isValid(e){return this.data.getValid(e)}get(e){return io.visit(this.data,e)}at(e){return this.get(Q0(e,this.numRows))}set(e,n){return gl.visit(this.data,e,n)}indexOf(e,n){return Yy.visit(this.data,e,n)}[Symbol.iterator](){return ib.visit(new En([this.data]))}toArray(){return[...this]}concat(...e){return new Ss(this.schema,[this,...e])}slice(e,n){const[h]=new En([this.data]).slice(e,n).data;return new Bg(this.schema,h)}getChild(e){var n;return this.getChildAt((n=this.schema.fields)===null||n===void 0?void 0:n.findIndex(h=>h.name===e))}getChildAt(e){return e>-1&&e<this.schema.fields.length?new En([this.data.children[e]]):null}setChild(e,n){var h;return this.setChildAt((h=this.schema.fields)===null||h===void 0?void 0:h.findIndex(_=>_.name===e),n)}setChildAt(e,n){let h=this.schema,_=this.data;if(e>-1&&e<this.numCols){n||(n=new En([Hi({type:new Dd,length:this.numRows})]));const T=h.fields.slice(),S=_.children.slice(),u=T[e].clone({type:n.type});[T[e],S[e]]=[u,n.data[0]],h=new Mn(T,new Map(this.schema.metadata)),_=Hi({type:new Ts(T),children:S})}return new Bg(h,_)}select(e){const n=this.schema.select(e),h=new Ts(n.fields),_=[];for(const T of e){const S=this.schema.fields.findIndex(u=>u.name===T);~S&&(_[S]=this.data.children[S])}return new Bg(n,Hi({type:h,length:this.numRows,children:_}))}selectAt(e){const n=this.schema.selectAt(e),h=e.map(T=>this.data.children[T]).filter(Boolean),_=Hi({type:new Ts(n.fields),length:this.numRows,children:h});return new Bg(n,_)}};OS=Symbol.toStringTag;eo[OS]=(r=>(r._nullCount=-1,r[Symbol.isConcatSpreadable]=!0,"RecordBatch"))(eo.prototype);function kx(r,e,n=e.reduce((h,_)=>Math.max(h,_.length),0)){var h;const _=[...r.fields],T=[...e],S=(n+63&-64)>>3;for(const[u,k]of r.fields.entries()){const B=e[u];(!B||B.length!==n)&&(_[u]=k.clone({nullable:!0}),T[u]=(h=B==null?void 0:B._changeLengthAndBackfillNullBitmap(n))!==null&&h!==void 0?h:Hi({type:k.type,length:n,nullCount:n,nullBitmap:new Uint8Array(S)}))}return[r.assign(_),Hi({type:new Ts(_),length:n,children:T})]}function BS(r,e,n=new Map){var h,_;if(((h=r==null?void 0:r.length)!==null&&h!==void 0?h:0)>0&&(r==null?void 0:r.length)===(e==null?void 0:e.length))for(let T=-1,S=r.length;++T<S;){const{type:u}=r[T],k=e[T];for(const B of[k,...((_=k==null?void 0:k.dictionary)===null||_===void 0?void 0:_.data)||[]])BS(u.children,B==null?void 0:B.children,n);if(Qt.isDictionary(u)){const{id:B}=u;if(!n.has(B))k!=null&&k.dictionary&&n.set(B,k.dictionary);else if(n.get(B)!==k.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}}return n}class lb extends eo{constructor(e){const n=e.fields.map(_=>Hi({type:_.type})),h=Hi({type:new Ts(e.fields),nullCount:0,children:n});super(e,h)}}let Sd=class Kc{constructor(){this.bb=null,this.bb_pos=0}__init(e,n){return this.bb_pos=e,this.bb=n,this}static getRootAsMessage(e,n){return(n||new Kc).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsMessage(e,n){return e.setPosition(e.position()+An),(n||new Kc).__init(e.readInt32(e.position())+e.position(),e)}version(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Gr.V1}headerType(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb_pos+e):dn.NONE}header(e){const n=this.bb.__offset(this.bb_pos,8);return n?this.bb.__union(e,this.bb_pos+n):null}bodyLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}customMetadata(e,n){const h=this.bb.__offset(this.bb_pos,12);return h?(n||new ha).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+h)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}static startMessage(e){e.startObject(5)}static addVersion(e,n){e.addFieldInt16(0,n,Gr.V1)}static addHeaderType(e,n){e.addFieldInt8(1,n,dn.NONE)}static addHeader(e,n){e.addFieldOffset(2,n,0)}static addBodyLength(e,n){e.addFieldInt64(3,n,BigInt("0"))}static addCustomMetadata(e,n){e.addFieldOffset(4,n,0)}static createCustomMetadataVector(e,n){e.startVector(4,n.length,4);for(let h=n.length-1;h>=0;h--)e.addOffset(n[h]);return e.endVector()}static startCustomMetadataVector(e,n){e.startVector(4,n,4)}static endMessage(e){return e.endObject()}static finishMessageBuffer(e,n){e.finish(n)}static finishSizePrefixedMessageBuffer(e,n){e.finish(n,void 0,!0)}static createMessage(e,n,h,_,T,S){return Kc.startMessage(e),Kc.addVersion(e,n),Kc.addHeaderType(e,h),Kc.addHeader(e,_),Kc.addBodyLength(e,T),Kc.addCustomMetadata(e,S),Kc.endMessage(e)}};class jC extends Gi{visit(e,n){return e==null||n==null?void 0:super.visit(e,n)}visitNull(e,n){return Ex.startNull(n),Ex.endNull(n)}visitInt(e,n){return Do.startInt(n),Do.addBitWidth(n,e.bitWidth),Do.addIsSigned(n,e.isSigned),Do.endInt(n)}visitFloat(e,n){return eu.startFloatingPoint(n),eu.addPrecision(n,e.precision),eu.endFloatingPoint(n)}visitBinary(e,n){return bx.startBinary(n),bx.endBinary(n)}visitLargeBinary(e,n){return wx.startLargeBinary(n),wx.endLargeBinary(n)}visitBool(e,n){return xx.startBool(n),xx.endBool(n)}visitUtf8(e,n){return Mx.startUtf8(n),Mx.endUtf8(n)}visitLargeUtf8(e,n){return Sx.startLargeUtf8(n),Sx.endLargeUtf8(n)}visitDecimal(e,n){return Kp.startDecimal(n),Kp.addScale(n,e.scale),Kp.addPrecision(n,e.precision),Kp.addBitWidth(n,e.bitWidth),Kp.endDecimal(n)}visitDate(e,n){return ay.startDate(n),ay.addUnit(n,e.unit),ay.endDate(n)}visitTime(e,n){return dl.startTime(n),dl.addUnit(n,e.unit),dl.addBitWidth(n,e.bitWidth),dl.endTime(n)}visitTimestamp(e,n){const h=e.timezone&&n.createString(e.timezone)||void 0;return fl.startTimestamp(n),fl.addUnit(n,e.unit),h!==void 0&&fl.addTimezone(n,h),fl.endTimestamp(n)}visitInterval(e,n){return tu.startInterval(n),tu.addUnit(n,e.unit),tu.endInterval(n)}visitDuration(e,n){return sy.startDuration(n),sy.addUnit(n,e.unit),sy.endDuration(n)}visitList(e,n){return Tx.startList(n),Tx.endList(n)}visitStruct(e,n){return Lf.startStruct_(n),Lf.endStruct_(n)}visitUnion(e,n){Js.startTypeIdsVector(n,e.typeIds.length);const h=Js.createTypeIdsVector(n,e.typeIds);return Js.startUnion(n),Js.addMode(n,e.mode),Js.addTypeIds(n,h),Js.endUnion(n)}visitDictionary(e,n){const h=this.visit(e.indices,n);return ph.startDictionaryEncoding(n),ph.addId(n,BigInt(e.id)),ph.addIsOrdered(n,e.isOrdered),h!==void 0&&ph.addIndexType(n,h),ph.endDictionaryEncoding(n)}visitFixedSizeBinary(e,n){return oy.startFixedSizeBinary(n),oy.addByteWidth(n,e.byteWidth),oy.endFixedSizeBinary(n)}visitFixedSizeList(e,n){return ly.startFixedSizeList(n),ly.addListSize(n,e.listSize),ly.endFixedSizeList(n)}visitMap(e,n){return cy.startMap(n),cy.addKeysSorted(n,e.keysSorted),cy.endMap(n)}}const Xv=new jC;function VC(r,e=new Map){return new Mn(GC(r,e),dy(r.metadata),e)}function LS(r){return new Ro(r.count,FS(r.columns),NS(r.columns))}function ZC(r){return new lu(LS(r.data),r.id,r.isDelta)}function GC(r,e){return(r.fields||[]).filter(Boolean).map(n=>hr.fromJSON(n,e))}function Ox(r,e){return(r.children||[]).filter(Boolean).map(n=>hr.fromJSON(n,e))}function FS(r){return(r||[]).reduce((e,n)=>[...e,new zd(n.count,qC(n.VALIDITY)),...FS(n.children)],[])}function NS(r,e=[]){for(let n=-1,h=(r||[]).length;++n<h;){const _=r[n];_.VALIDITY&&e.push(new nu(e.length,_.VALIDITY.length)),_.TYPE_ID&&e.push(new nu(e.length,_.TYPE_ID.length)),_.OFFSET&&e.push(new nu(e.length,_.OFFSET.length)),_.DATA&&e.push(new nu(e.length,_.DATA.length)),e=NS(_.children,e)}return e}function qC(r){return(r||[]).reduce((e,n)=>e+ +(n===0),0)}function $C(r,e){let n,h,_,T,S,u;return!e||!(T=r.dictionary)?(S=Lx(r,Ox(r,e)),_=new hr(r.name,S,r.nullable,dy(r.metadata))):e.has(n=T.id)?(h=(h=T.indexType)?Bx(h):new Jg,u=new _m(e.get(n),h,n,T.isOrdered),_=new hr(r.name,u,r.nullable,dy(r.metadata))):(h=(h=T.indexType)?Bx(h):new Jg,e.set(n,S=Lx(r,Ox(r,e))),u=new _m(S,h,n,T.isOrdered),_=new hr(r.name,u,r.nullable,dy(r.metadata))),_||null}function dy(r=[]){return new Map(r.map(({key:e,value:n})=>[e,n]))}function Bx(r){return new jf(r.isSigned,r.bitWidth)}function Lx(r,e){const n=r.type.name;switch(n){case"NONE":return new Dd;case"null":return new Dd;case"binary":return new Cy;case"largebinary":return new Dy;case"utf8":return new Ry;case"largeutf8":return new Py;case"bool":return new zy;case"list":return new Uy((e||[])[0]);case"struct":return new Ts(e||[]);case"struct_":return new Ts(e||[])}switch(n){case"int":{const h=r.type;return new jf(h.isSigned,h.bitWidth)}case"floatingpoint":{const h=r.type;return new Iy(is[h.precision])}case"decimal":{const h=r.type;return new ky(h.scale,h.precision,h.bitWidth)}case"date":{const h=r.type;return new Oy(ml[h.unit])}case"time":{const h=r.type;return new By(di[h.unit],h.bitWidth)}case"timestamp":{const h=r.type;return new Ly(di[h.unit],h.timezone)}case"interval":{const h=r.type;return new Fy(ou[h.unit])}case"duration":{const h=r.type;return new Ny(di[h.unit])}case"union":{const h=r.type,[_,...T]=(h.mode+"").toLowerCase(),S=_.toUpperCase()+T.join("");return new jy(rs[S],h.typeIds||[],e||[])}case"fixedsizebinary":{const h=r.type;return new Vy(h.byteWidth)}case"fixedsizelist":{const h=r.type;return new Zy(h.listSize,(e||[])[0])}case"map":{const h=r.type;return new Gy((e||[])[0],h.keysSorted)}}throw new Error(`Unrecognized type: "${n}"`)}var HC=tw,YC=mm;class Es{static fromJSON(e,n){const h=new Es(0,Gr.V5,n);return h._createHeader=XC(e,n),h}static decode(e){e=new YC(Qi(e));const n=Sd.getRootAsMessage(e),h=n.bodyLength(),_=n.version(),T=n.headerType(),S=new Es(h,_,T);return S._createHeader=KC(n,T),S}static encode(e){const n=new HC;let h=-1;return e.isSchema()?h=Mn.encode(n,e.header()):e.isRecordBatch()?h=Ro.encode(n,e.header()):e.isDictionaryBatch()&&(h=lu.encode(n,e.header())),Sd.startMessage(n),Sd.addVersion(n,Gr.V5),Sd.addHeader(n,h),Sd.addHeaderType(n,e.headerType),Sd.addBodyLength(n,BigInt(e.bodyLength)),Sd.finishMessageBuffer(n,Sd.endMessage(n)),n.asUint8Array()}static from(e,n=0){if(e instanceof Mn)return new Es(0,Gr.V5,dn.Schema,e);if(e instanceof Ro)return new Es(n,Gr.V5,dn.RecordBatch,e);if(e instanceof lu)return new Es(n,Gr.V5,dn.DictionaryBatch,e);throw new Error(`Unrecognized Message header: ${e}`)}get type(){return this.headerType}get version(){return this._version}get headerType(){return this._headerType}get bodyLength(){return this._bodyLength}header(){return this._createHeader()}isSchema(){return this.headerType===dn.Schema}isRecordBatch(){return this.headerType===dn.RecordBatch}isDictionaryBatch(){return this.headerType===dn.DictionaryBatch}constructor(e,n,h,_){this._version=n,this._headerType=h,this.body=new Uint8Array(0),_&&(this._createHeader=()=>_),this._bodyLength=Kn(e)}}class Ro{get nodes(){return this._nodes}get length(){return this._length}get buffers(){return this._buffers}constructor(e,n,h){this._nodes=n,this._buffers=h,this._length=Kn(e)}}class lu{get id(){return this._id}get data(){return this._data}get isDelta(){return this._isDelta}get length(){return this.data.length}get nodes(){return this.data.nodes}get buffers(){return this.data.buffers}constructor(e,n,h=!1){this._data=e,this._isDelta=h,this._id=Kn(n)}}class nu{constructor(e,n){this.offset=Kn(e),this.length=Kn(n)}}class zd{constructor(e,n){this.length=Kn(e),this.nullCount=Kn(n)}}function XC(r,e){return()=>{switch(e){case dn.Schema:return Mn.fromJSON(r);case dn.RecordBatch:return Ro.fromJSON(r);case dn.DictionaryBatch:return lu.fromJSON(r)}throw new Error(`Unrecognized Message type: { name: ${dn[e]}, type: ${e} }`)}}function KC(r,e){return()=>{switch(e){case dn.Schema:return Mn.decode(r.header(new Wc),new Map,r.version());case dn.RecordBatch:return Ro.decode(r.header(new ch),r.version());case dn.DictionaryBatch:return lu.decode(r.header(new Yp),r.version())}throw new Error(`Unrecognized Message type: { name: ${dn[e]}, type: ${e} }`)}}hr.encode=oD;hr.decode=aD;hr.fromJSON=$C;Mn.encode=sD;Mn.decode=WC;Mn.fromJSON=VC;Ro.encode=lD;Ro.decode=QC;Ro.fromJSON=LS;lu.encode=cD;lu.decode=JC;lu.fromJSON=ZC;zd.encode=uD;zd.decode=tD;nu.encode=hD;nu.decode=eD;function WC(r,e=new Map,n=Gr.V5){const h=rD(r,e);return new Mn(h,fy(r),e,n)}function QC(r,e=Gr.V5){if(r.compression()!==null)throw new Error("Record batch compression not implemented");return new Ro(r.length(),iD(r),nD(r,e))}function JC(r,e=Gr.V5){return new lu(Ro.decode(r.data(),e),r.id(),r.isDelta())}function eD(r){return new nu(r.offset(),r.length())}function tD(r){return new zd(r.length(),r.nullCount())}function iD(r){const e=[];for(let n,h=-1,_=-1,T=r.nodesLength();++h<T;)(n=r.nodes(h))&&(e[++_]=zd.decode(n));return e}function nD(r,e){const n=[];for(let h,_=-1,T=-1,S=r.buffersLength();++_<S;)(h=r.buffers(_))&&(e<Gr.V4&&(h.bb_pos+=8*(_+1)),n[++T]=nu.decode(h));return n}function rD(r,e){const n=[];for(let h,_=-1,T=-1,S=r.fieldsLength();++_<S;)(h=r.fields(_))&&(n[++T]=hr.decode(h,e));return n}function Fx(r,e){const n=[];for(let h,_=-1,T=-1,S=r.childrenLength();++_<S;)(h=r.children(_))&&(n[++T]=hr.decode(h,e));return n}function aD(r,e){let n,h,_,T,S,u;return!e||!(u=r.dictionary())?(_=Ux(r,Fx(r,e)),h=new hr(r.name(),_,r.nullable(),fy(r))):e.has(n=Kn(u.id()))?(T=(T=u.indexType())?Nx(T):new Jg,S=new _m(e.get(n),T,n,u.isOrdered()),h=new hr(r.name(),S,r.nullable(),fy(r))):(T=(T=u.indexType())?Nx(T):new Jg,e.set(n,_=Ux(r,Fx(r,e))),S=new _m(_,T,n,u.isOrdered()),h=new hr(r.name(),S,r.nullable(),fy(r))),h||null}function fy(r){const e=new Map;if(r)for(let n,h,_=-1,T=Math.trunc(r.customMetadataLength());++_<T;)(n=r.customMetadata(_))&&(h=n.key())!=null&&e.set(h,n.value());return e}function Nx(r){return new jf(r.isSigned(),r.bitWidth())}function Ux(r,e){const n=r.typeType();switch(n){case rr.NONE:return new Dd;case rr.Null:return new Dd;case rr.Binary:return new Cy;case rr.LargeBinary:return new Dy;case rr.Utf8:return new Ry;case rr.LargeUtf8:return new Py;case rr.Bool:return new zy;case rr.List:return new Uy((e||[])[0]);case rr.Struct_:return new Ts(e||[])}switch(n){case rr.Int:{const h=r.type(new Do);return new jf(h.isSigned(),h.bitWidth())}case rr.FloatingPoint:{const h=r.type(new eu);return new Iy(h.precision())}case rr.Decimal:{const h=r.type(new Kp);return new ky(h.scale(),h.precision(),h.bitWidth())}case rr.Date:{const h=r.type(new ay);return new Oy(h.unit())}case rr.Time:{const h=r.type(new dl);return new By(h.unit(),h.bitWidth())}case rr.Timestamp:{const h=r.type(new fl);return new Ly(h.unit(),h.timezone())}case rr.Interval:{const h=r.type(new tu);return new Fy(h.unit())}case rr.Duration:{const h=r.type(new sy);return new Ny(h.unit())}case rr.Union:{const h=r.type(new Js);return new jy(h.mode(),h.typeIdsArray()||[],e||[])}case rr.FixedSizeBinary:{const h=r.type(new oy);return new Vy(h.byteWidth())}case rr.FixedSizeList:{const h=r.type(new ly);return new Zy(h.listSize(),(e||[])[0])}case rr.Map:{const h=r.type(new cy);return new Gy((e||[])[0],h.keysSorted())}}throw new Error(`Unrecognized type: "${rr[n]}" (${n})`)}function sD(r,e){const n=e.fields.map(T=>hr.encode(r,T));Wc.startFieldsVector(r,n.length);const h=Wc.createFieldsVector(r,n),_=e.metadata&&e.metadata.size>0?Wc.createCustomMetadataVector(r,[...e.metadata].map(([T,S])=>{const u=r.createString(`${T}`),k=r.createString(`${S}`);return ha.startKeyValue(r),ha.addKey(r,u),ha.addValue(r,k),ha.endKeyValue(r)})):-1;return Wc.startSchema(r),Wc.addFields(r,h),Wc.addEndianness(r,dD?gm.Little:gm.Big),_!==-1&&Wc.addCustomMetadata(r,_),Wc.endSchema(r)}function oD(r,e){let n=-1,h=-1,_=-1;const T=e.type;let S=e.typeId;Qt.isDictionary(T)?(S=T.dictionary.typeId,_=Xv.visit(T,r),h=Xv.visit(T.dictionary,r)):h=Xv.visit(T,r);const u=(T.children||[]).map(q=>hr.encode(r,q)),k=ul.createChildrenVector(r,u),B=e.metadata&&e.metadata.size>0?ul.createCustomMetadataVector(r,[...e.metadata].map(([q,oe])=>{const ne=r.createString(`${q}`),K=r.createString(`${oe}`);return ha.startKeyValue(r),ha.addKey(r,ne),ha.addValue(r,K),ha.endKeyValue(r)})):-1;return e.name&&(n=r.createString(e.name)),ul.startField(r),ul.addType(r,h),ul.addTypeType(r,S),ul.addChildren(r,k),ul.addNullable(r,!!e.nullable),n!==-1&&ul.addName(r,n),_!==-1&&ul.addDictionary(r,_),B!==-1&&ul.addCustomMetadata(r,B),ul.endField(r)}function lD(r,e){const n=e.nodes||[],h=e.buffers||[];ch.startNodesVector(r,n.length);for(const S of n.slice().reverse())zd.encode(r,S);const _=r.endVector();ch.startBuffersVector(r,h.length);for(const S of h.slice().reverse())nu.encode(r,S);const T=r.endVector();return ch.startRecordBatch(r),ch.addLength(r,BigInt(e.length)),ch.addNodes(r,_),ch.addBuffers(r,T),ch.endRecordBatch(r)}function cD(r,e){const n=Ro.encode(r,e.data);return Yp.startDictionaryBatch(r),Yp.addId(r,BigInt(e.id)),Yp.addIsDelta(r,e.isDelta),Yp.addData(r,n),Yp.endDictionaryBatch(r)}function uD(r,e){return rw.createFieldNode(r,BigInt(e.length),BigInt(e.nullCount))}function hD(r,e){return nw.createBuffer(r,BigInt(e.offset),BigInt(e.length))}const dD=(()=>{const r=new ArrayBuffer(2);return new DataView(r).setInt16(0,256,!0),new Int16Array(r)[0]===256})(),cb=r=>`Expected ${dn[r]} Message in stream, but was null or length 0.`,ub=r=>`Header pointer of flatbuffer-encoded ${dn[r]} Message is null or length 0.`,US=(r,e)=>`Expected to read ${r} metadata bytes, but only read ${e}.`,jS=(r,e)=>`Expected to read ${r} bytes for message body, but only read ${e}.`;class VS{constructor(e){this.source=e instanceof Ky?e:new Ky(e)}[Symbol.iterator](){return this}next(){let e;return(e=this.readMetadataLength()).done||e.value===-1&&(e=this.readMetadataLength()).done||(e=this.readMetadata(e.value)).done?Mr:e}throw(e){return this.source.throw(e)}return(e){return this.source.return(e)}readMessage(e){let n;if((n=this.next()).done)return null;if(e!=null&&n.value.headerType!==e)throw new Error(cb(e));return n.value}readMessageBody(e){if(e<=0)return new Uint8Array(0);const n=Qi(this.source.read(e));if(n.byteLength<e)throw new Error(jS(e,n.byteLength));return n.byteOffset%8===0&&n.byteOffset+n.byteLength<=n.buffer.byteLength?n:n.slice()}readSchema(e=!1){const n=dn.Schema,h=this.readMessage(n),_=h==null?void 0:h.header();if(e&&!_)throw new Error(ub(n));return _}readMetadataLength(){const e=this.source.read(hv),n=e&&new mm(e),h=(n==null?void 0:n.readInt32(0))||0;return{done:h===0,value:h}}readMetadata(e){const n=this.source.read(e);if(!n)return Mr;if(n.byteLength<e)throw new Error(US(e,n.byteLength));return{done:!1,value:Es.decode(n)}}}class fD{constructor(e,n){this.source=e instanceof ym?e:X1(e)?new Wy(e,n):new ym(e)}[Symbol.asyncIterator](){return this}next(){return Ti(this,void 0,void 0,function*(){let e;return(e=yield this.readMetadataLength()).done||e.value===-1&&(e=yield this.readMetadataLength()).done||(e=yield this.readMetadata(e.value)).done?Mr:e})}throw(e){return Ti(this,void 0,void 0,function*(){return yield this.source.throw(e)})}return(e){return Ti(this,void 0,void 0,function*(){return yield this.source.return(e)})}readMessage(e){return Ti(this,void 0,void 0,function*(){let n;if((n=yield this.next()).done)return null;if(e!=null&&n.value.headerType!==e)throw new Error(cb(e));return n.value})}readMessageBody(e){return Ti(this,void 0,void 0,function*(){if(e<=0)return new Uint8Array(0);const n=Qi(yield this.source.read(e));if(n.byteLength<e)throw new Error(jS(e,n.byteLength));return n.byteOffset%8===0&&n.byteOffset+n.byteLength<=n.buffer.byteLength?n:n.slice()})}readSchema(){return Ti(this,arguments,void 0,function*(e=!1){const n=dn.Schema,h=yield this.readMessage(n),_=h==null?void 0:h.header();if(e&&!_)throw new Error(ub(n));return _})}readMetadataLength(){return Ti(this,void 0,void 0,function*(){const e=yield this.source.read(hv),n=e&&new mm(e),h=(n==null?void 0:n.readInt32(0))||0;return{done:h===0,value:h}})}readMetadata(e){return Ti(this,void 0,void 0,function*(){const n=yield this.source.read(e);if(!n)return Mr;if(n.byteLength<e)throw new Error(US(e,n.byteLength));return{done:!1,value:Es.decode(n)}})}}class pD extends VS{constructor(e){super(new Uint8Array(0)),this._schema=!1,this._body=[],this._batchIndex=0,this._dictionaryIndex=0,this._json=e instanceof Px?e:new Px(e)}next(){const{_json:e}=this;if(!this._schema)return this._schema=!0,{done:!1,value:Es.fromJSON(e.schema,dn.Schema)};if(this._dictionaryIndex<e.dictionaries.length){const n=e.dictionaries[this._dictionaryIndex++];return this._body=n.data.columns,{done:!1,value:Es.fromJSON(n,dn.DictionaryBatch)}}if(this._batchIndex<e.batches.length){const n=e.batches[this._batchIndex++];return this._body=n.columns,{done:!1,value:Es.fromJSON(n,dn.RecordBatch)}}return this._body=[],Mr}readMessageBody(e){return n(this._body);function n(h){return(h||[]).reduce((_,T)=>[..._,...T.VALIDITY&&[T.VALIDITY]||[],...T.TYPE_ID&&[T.TYPE_ID]||[],...T.OFFSET&&[T.OFFSET]||[],...T.DATA&&[T.DATA]||[],...n(T.children)],[])}}readMessage(e){let n;if((n=this.next()).done)return null;if(e!=null&&n.value.headerType!==e)throw new Error(cb(e));return n.value}readSchema(){const e=dn.Schema,n=this.readMessage(e),h=n==null?void 0:n.header();if(!n||!h)throw new Error(ub(e));return h}}const hv=4,D0="ARROW1",t_=new Uint8Array(D0.length);for(let r=0;r<D0.length;r+=1)t_[r]=D0.codePointAt(r);function hb(r,e=0){for(let n=-1,h=t_.length;++n<h;)if(t_[n]!==r[e+n])return!1;return!0}const l_=t_.length,ZS=l_+hv,mD=l_*2+hv;class pl extends nb{constructor(e){super(),this._impl=e}get closed(){return this._impl.closed}get schema(){return this._impl.schema}get autoDestroy(){return this._impl.autoDestroy}get dictionaries(){return this._impl.dictionaries}get numDictionaries(){return this._impl.numDictionaries}get numRecordBatches(){return this._impl.numRecordBatches}get footer(){return this._impl.isFile()?this._impl.footer:null}isSync(){return this._impl.isSync()}isAsync(){return this._impl.isAsync()}isFile(){return this._impl.isFile()}isStream(){return this._impl.isStream()}next(){return this._impl.next()}throw(e){return this._impl.throw(e)}return(e){return this._impl.return(e)}cancel(){return this._impl.cancel()}reset(e){return this._impl.reset(e),this._DOMStream=void 0,this._nodeStream=void 0,this}open(e){const n=this._impl.open(e);return Uf(n)?n.then(()=>this):this}readRecordBatch(e){return this._impl.isFile()?this._impl.readRecordBatch(e):null}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}toDOMStream(){return hl.toDOMStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this})}toNodeStream(){return hl.toNodeStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this},{objectMode:!0})}static throughNode(e){throw new Error('"throughNode" not available in this environment')}static throughDOM(e,n){throw new Error('"throughDOM" not available in this environment')}static from(e){return e instanceof pl?e:b0(e)?vD(e):X1(e)?wD(e):Uf(e)?Ti(this,void 0,void 0,function*(){return yield pl.from(yield e)}):K1(e)||$0(e)||W1(e)||wm(e)?xD(new ym(e)):bD(new Ky(e))}static readAll(e){return e instanceof pl?e.isSync()?jx(e):Vx(e):b0(e)||ArrayBuffer.isView(e)||r_(e)||Y1(e)?jx(e):Vx(e)}}class Qy extends pl{constructor(e){super(e),this._impl=e}readAll(){return[...this]}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return iu(this,arguments,function*(){yield Ni(yield*ry(Ff(this[Symbol.iterator]())))})}}class Jy extends pl{constructor(e){super(e),this._impl=e}readAll(){return Ti(this,void 0,void 0,function*(){var e,n,h,_;const T=new Array;try{for(var S=!0,u=Ff(this),k;k=yield u.next(),e=k.done,!e;S=!0){_=k.value,S=!1;const B=_;T.push(B)}}catch(B){n={error:B}}finally{try{!S&&!e&&(h=u.return)&&(yield h.call(u))}finally{if(n)throw n.error}}return T})}[Symbol.iterator](){throw new Error("AsyncRecordBatchStreamReader is not Iterable")}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}}class GS extends Qy{constructor(e){super(e),this._impl=e}}class gD extends Jy{constructor(e){super(e),this._impl=e}}class qS{get numDictionaries(){return this._dictionaryIndex}get numRecordBatches(){return this._recordBatchIndex}constructor(e=new Map){this.closed=!1,this.autoDestroy=!0,this._dictionaryIndex=0,this._recordBatchIndex=0,this.dictionaries=e}isSync(){return!1}isAsync(){return!1}isFile(){return!1}isStream(){return!1}reset(e){return this._dictionaryIndex=0,this._recordBatchIndex=0,this.schema=e,this.dictionaries=new Map,this}_loadRecordBatch(e,n){const h=this._loadVectors(e,n,this.schema.fields),_=Hi({type:new Ts(this.schema.fields),length:e.length,children:h});return new eo(this.schema,_)}_loadDictionaryBatch(e,n){const{id:h,isDelta:_}=e,{dictionaries:T,schema:S}=this,u=T.get(h),k=S.dictionaries.get(h),B=this._loadVectors(e.data,n,[k]);return(u&&_?u.concat(new En(B)):new En(B)).memoize()}_loadVectors(e,n,h){return new zS(n,e.nodes,e.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(h)}}class ev extends qS{constructor(e,n){super(n),this._reader=b0(e)?new pD(this._handle=e):new VS(this._handle=e)}isSync(){return!0}isStream(){return!0}[Symbol.iterator](){return this}cancel(){!this.closed&&(this.closed=!0)&&(this.reset()._reader.return(),this._reader=null,this.dictionaries=null)}open(e){return this.closed||(this.autoDestroy=HS(this,e),this.schema||(this.schema=this._reader.readSchema())||this.cancel()),this}throw(e){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.throw(e):Mr}return(e){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.return(e):Mr}next(){if(this.closed)return Mr;let e;const{_reader:n}=this;for(;e=this._readNextMessageAndValidate();)if(e.isSchema())this.reset(e.header());else if(e.isRecordBatch()){this._recordBatchIndex++;const h=e.header(),_=n.readMessageBody(e.bodyLength);return{done:!1,value:this._loadRecordBatch(h,_)}}else if(e.isDictionaryBatch()){this._dictionaryIndex++;const h=e.header(),_=n.readMessageBody(e.bodyLength),T=this._loadDictionaryBatch(h,_);this.dictionaries.set(h.id,T)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new lb(this.schema)}):this.return()}_readNextMessageAndValidate(e){return this._reader.readMessage(e)}}class tv extends qS{constructor(e,n){super(n),this._reader=new fD(this._handle=e)}isAsync(){return!0}isStream(){return!0}[Symbol.asyncIterator](){return this}cancel(){return Ti(this,void 0,void 0,function*(){!this.closed&&(this.closed=!0)&&(yield this.reset()._reader.return(),this._reader=null,this.dictionaries=null)})}open(e){return Ti(this,void 0,void 0,function*(){return this.closed||(this.autoDestroy=HS(this,e),this.schema||(this.schema=yield this._reader.readSchema())||(yield this.cancel())),this})}throw(e){return Ti(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.throw(e):Mr})}return(e){return Ti(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.return(e):Mr})}next(){return Ti(this,void 0,void 0,function*(){if(this.closed)return Mr;let e;const{_reader:n}=this;for(;e=yield this._readNextMessageAndValidate();)if(e.isSchema())yield this.reset(e.header());else if(e.isRecordBatch()){this._recordBatchIndex++;const h=e.header(),_=yield n.readMessageBody(e.bodyLength);return{done:!1,value:this._loadRecordBatch(h,_)}}else if(e.isDictionaryBatch()){this._dictionaryIndex++;const h=e.header(),_=yield n.readMessageBody(e.bodyLength),T=this._loadDictionaryBatch(h,_);this.dictionaries.set(h.id,T)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new lb(this.schema)}):yield this.return()})}_readNextMessageAndValidate(e){return Ti(this,void 0,void 0,function*(){return yield this._reader.readMessage(e)})}}class $S extends ev{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(e,n){super(e instanceof zx?e:new zx(e),n)}isSync(){return!0}isFile(){return!0}open(e){if(!this.closed&&!this._footer){this.schema=(this._footer=this._readFooter()).schema;for(const n of this._footer.dictionaryBatches())n&&this._readDictionaryBatch(this._dictionaryIndex++)}return super.open(e)}readRecordBatch(e){var n;if(this.closed)return null;this._footer||this.open();const h=(n=this._footer)===null||n===void 0?void 0:n.getRecordBatch(e);if(h&&this._handle.seek(h.offset)){const _=this._reader.readMessage(dn.RecordBatch);if(_!=null&&_.isRecordBatch()){const T=_.header(),S=this._reader.readMessageBody(_.bodyLength);return this._loadRecordBatch(T,S)}}return null}_readDictionaryBatch(e){var n;const h=(n=this._footer)===null||n===void 0?void 0:n.getDictionaryBatch(e);if(h&&this._handle.seek(h.offset)){const _=this._reader.readMessage(dn.DictionaryBatch);if(_!=null&&_.isDictionaryBatch()){const T=_.header(),S=this._reader.readMessageBody(_.bodyLength),u=this._loadDictionaryBatch(T,S);this.dictionaries.set(T.id,u)}}}_readFooter(){const{_handle:e}=this,n=e.size-ZS,h=e.readInt32(n),_=e.readAt(n-h,h);return e_.decode(_)}_readNextMessageAndValidate(e){var n;if(this._footer||this.open(),this._footer&&this._recordBatchIndex<this.numRecordBatches){const h=(n=this._footer)===null||n===void 0?void 0:n.getRecordBatch(this._recordBatchIndex);if(h&&this._handle.seek(h.offset))return this._reader.readMessage(e)}return null}}class _D extends tv{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(e,...n){const h=typeof n[0]!="number"?n.shift():void 0,_=n[0]instanceof Map?n.shift():void 0;super(e instanceof Wy?e:new Wy(e,h),_)}isFile(){return!0}isAsync(){return!0}open(e){const n=Object.create(null,{open:{get:()=>super.open}});return Ti(this,void 0,void 0,function*(){if(!this.closed&&!this._footer){this.schema=(this._footer=yield this._readFooter()).schema;for(const h of this._footer.dictionaryBatches())h&&(yield this._readDictionaryBatch(this._dictionaryIndex++))}return yield n.open.call(this,e)})}readRecordBatch(e){return Ti(this,void 0,void 0,function*(){var n;if(this.closed)return null;this._footer||(yield this.open());const h=(n=this._footer)===null||n===void 0?void 0:n.getRecordBatch(e);if(h&&(yield this._handle.seek(h.offset))){const _=yield this._reader.readMessage(dn.RecordBatch);if(_!=null&&_.isRecordBatch()){const T=_.header(),S=yield this._reader.readMessageBody(_.bodyLength);return this._loadRecordBatch(T,S)}}return null})}_readDictionaryBatch(e){return Ti(this,void 0,void 0,function*(){var n;const h=(n=this._footer)===null||n===void 0?void 0:n.getDictionaryBatch(e);if(h&&(yield this._handle.seek(h.offset))){const _=yield this._reader.readMessage(dn.DictionaryBatch);if(_!=null&&_.isDictionaryBatch()){const T=_.header(),S=yield this._reader.readMessageBody(_.bodyLength),u=this._loadDictionaryBatch(T,S);this.dictionaries.set(T.id,u)}}})}_readFooter(){return Ti(this,void 0,void 0,function*(){const{_handle:e}=this;e._pending&&(yield e._pending);const n=e.size-ZS,h=yield e.readInt32(n),_=yield e.readAt(n-h,h);return e_.decode(_)})}_readNextMessageAndValidate(e){return Ti(this,void 0,void 0,function*(){if(this._footer||(yield this.open()),this._footer&&this._recordBatchIndex<this.numRecordBatches){const n=this._footer.getRecordBatch(this._recordBatchIndex);if(n&&(yield this._handle.seek(n.offset)))return yield this._reader.readMessage(e)}return null})}}class yD extends ev{constructor(e,n){super(e,n)}_loadVectors(e,n,h){return new RC(n,e.nodes,e.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(h)}}function HS(r,e){return e&&typeof e.autoDestroy=="boolean"?e.autoDestroy:r.autoDestroy}function*jx(r){const e=pl.from(r);try{if(!e.open({autoDestroy:!1}).closed)do yield e;while(!e.reset().open().closed)}finally{e.cancel()}}function Vx(r){return iu(this,arguments,function*(){const n=yield Ni(pl.from(r));try{if(!(yield Ni(n.open({autoDestroy:!1}))).closed)do yield yield Ni(n);while(!(yield Ni(n.reset().open())).closed)}finally{yield Ni(n.cancel())}})}function vD(r){return new Qy(new yD(r))}function bD(r){const e=r.peek(l_+7&-8);return e&&e.byteLength>=4?hb(e)?new GS(new $S(r.read())):new Qy(new ev(r)):new Qy(new ev(function*(){}()))}function xD(r){return Ti(this,void 0,void 0,function*(){const e=yield r.peek(l_+7&-8);return e&&e.byteLength>=4?hb(e)?new GS(new $S(yield r.read())):new Jy(new tv(r)):new Jy(new tv(function(){return iu(this,arguments,function*(){})}()))})}function wD(r){return Ti(this,void 0,void 0,function*(){const{size:e}=yield r.stat(),n=new Wy(r,e);return e>=mD&&hb(yield n.readAt(0,l_+7&-8))?new gD(new _D(n)):new Jy(new tv(n))})}class Ar extends Gi{static assemble(...e){const n=_=>_.flatMap(T=>Array.isArray(T)?n(T):T instanceof eo?T.data.children:T.data),h=new Ar;return h.visitMany(n(e)),h}constructor(){super(),this._byteLength=0,this._nodes=[],this._buffers=[],this._bufferRegions=[]}visit(e){if(e instanceof En)return this.visitMany(e.data),this;const{type:n}=e;if(!Qt.isDictionary(n)){const{length:h}=e;if(h>2147483647)throw new RangeError("Cannot write arrays larger than 2^31 - 1 in length");if(Qt.isUnion(n))this.nodes.push(new zd(h,0));else{const{nullCount:_}=e;Qt.isNull(n)||gc.call(this,_<=0?new Uint8Array(0):qy(e.offset,h,e.nullBitmap)),this.nodes.push(new zd(h,_))}}return super.visit(e)}visitNull(e){return this}visitDictionary(e){return this.visit(e.clone(e.type.indices))}get nodes(){return this._nodes}get buffers(){return this._buffers}get byteLength(){return this._byteLength}get bufferRegions(){return this._bufferRegions}}function gc(r){const e=r.byteLength+7&-8;return this.buffers.push(r),this.bufferRegions.push(new nu(this._byteLength,e)),this._byteLength+=e,this}function SD(r){var e;const{type:n,length:h,typeIds:_,valueOffsets:T}=r;if(gc.call(this,_),n.mode===rs.Sparse)return R0.call(this,r);if(n.mode===rs.Dense){if(r.offset<=0)return gc.call(this,T),R0.call(this,r);{const S=new Int32Array(h),u=Object.create(null),k=Object.create(null);for(let B,q,oe=-1;++oe<h;)(B=_[oe])!==void 0&&((q=u[B])===void 0&&(q=u[B]=T[oe]),S[oe]=T[oe]-q,k[B]=((e=k[B])!==null&&e!==void 0?e:0)+1);gc.call(this,S),this.visitMany(r.children.map((B,q)=>{const oe=n.typeIds[q],ne=u[oe],K=k[oe];return B.slice(ne,Math.min(h,K))}))}}return this}function TD(r){let e;return r.nullCount>=r.length?gc.call(this,new Uint8Array(0)):(e=r.values)instanceof Uint8Array?gc.call(this,qy(r.offset,r.length,e)):gc.call(this,$y(r.values))}function Sh(r){return gc.call(this,r.values.subarray(0,r.length*r.stride))}function dv(r){const{length:e,values:n,valueOffsets:h}=r,_=Kn(h[0]),T=Kn(h[e]),S=Math.min(T-_,n.byteLength-_);return gc.call(this,J1(-_,e+1,h)),gc.call(this,n.subarray(_,_+S)),this}function db(r){const{length:e,valueOffsets:n}=r;if(n){const{[0]:h,[e]:_}=n;return gc.call(this,J1(-h,e+1,n)),this.visit(r.children[0].slice(h,_-h))}return this.visit(r.children[0])}function R0(r){return this.visitMany(r.type.children.map((e,n)=>r.children[n]).filter(Boolean))[0]}Ar.prototype.visitBool=TD;Ar.prototype.visitInt=Sh;Ar.prototype.visitFloat=Sh;Ar.prototype.visitUtf8=dv;Ar.prototype.visitLargeUtf8=dv;Ar.prototype.visitBinary=dv;Ar.prototype.visitLargeBinary=dv;Ar.prototype.visitFixedSizeBinary=Sh;Ar.prototype.visitDate=Sh;Ar.prototype.visitTimestamp=Sh;Ar.prototype.visitTime=Sh;Ar.prototype.visitDecimal=Sh;Ar.prototype.visitList=db;Ar.prototype.visitStruct=R0;Ar.prototype.visitUnion=SD;Ar.prototype.visitInterval=Sh;Ar.prototype.visitDuration=Sh;Ar.prototype.visitFixedSizeList=db;Ar.prototype.visitMap=db;class YS extends nb{static throughNode(e){throw new Error('"throughNode" not available in this environment')}static throughDOM(e,n){throw new Error('"throughDOM" not available in this environment')}constructor(e){super(),this._position=0,this._started=!1,this._sink=new hy,this._schema=null,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._seenDictionaries=new Map,this._dictionaryDeltaOffsets=new Map,to(e)||(e={autoDestroy:!0,writeLegacyIpcFormat:!1}),this._autoDestroy=typeof e.autoDestroy=="boolean"?e.autoDestroy:!0,this._writeLegacyIpcFormat=typeof e.writeLegacyIpcFormat=="boolean"?e.writeLegacyIpcFormat:!1}toString(e=!1){return this._sink.toString(e)}toUint8Array(e=!1){return this._sink.toUint8Array(e)}writeAll(e){return Uf(e)?e.then(n=>this.writeAll(n)):wm(e)?gb(this,e):mb(this,e)}get closed(){return this._sink.closed}[Symbol.asyncIterator](){return this._sink[Symbol.asyncIterator]()}toDOMStream(e){return this._sink.toDOMStream(e)}toNodeStream(e){return this._sink.toNodeStream(e)}close(){return this.reset()._sink.close()}abort(e){return this.reset()._sink.abort(e)}finish(){return this._autoDestroy?this.close():this.reset(this._sink,this._schema),this}reset(e=this._sink,n=null){return e===this._sink||e instanceof hy?this._sink=e:(this._sink=new hy,e&&tI(e)?this.toDOMStream({type:"bytes"}).pipeTo(e):e&&iI(e)&&this.toNodeStream({objectMode:!1}).pipe(e)),this._started&&this._schema&&this._writeFooter(this._schema),this._started=!1,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._seenDictionaries=new Map,this._dictionaryDeltaOffsets=new Map,(!n||!C0(n,this._schema))&&(n==null?(this._position=0,this._schema=null):(this._started=!0,this._schema=n,this._writeSchema(n))),this}write(e){let n=null;if(this._sink){if(e==null)return this.finish()&&void 0;if(e instanceof Ss&&!(n=e.schema))return this.finish()&&void 0;if(e instanceof eo&&!(n=e.schema))return this.finish()&&void 0}else throw new Error("RecordBatchWriter is closed");if(n&&!C0(n,this._schema)){if(this._started&&this._autoDestroy)return this.close();this.reset(this._sink,n)}e instanceof eo?e instanceof lb||this._writeRecordBatch(e):e instanceof Ss?this.writeAll(e.batches):r_(e)&&this.writeAll(e)}_writeMessage(e,n=8){const h=n-1,_=Es.encode(e),T=_.byteLength,S=this._writeLegacyIpcFormat?4:8,u=T+S+h&~h,k=u-T-S;return e.headerType===dn.RecordBatch?this._recordBatchBlocks.push(new Rd(u,e.bodyLength,this._position)):e.headerType===dn.DictionaryBatch&&this._dictionaryBlocks.push(new Rd(u,e.bodyLength,this._position)),this._writeLegacyIpcFormat||this._write(Int32Array.of(-1)),this._write(Int32Array.of(u-S)),T>0&&this._write(_),this._writePadding(k)}_write(e){if(this._started){const n=Qi(e);n&&n.byteLength>0&&(this._sink.write(n),this._position+=n.byteLength)}return this}_writeSchema(e){return this._writeMessage(Es.from(e))}_writeFooter(e){return this._writeLegacyIpcFormat?this._write(Int32Array.of(0)):this._write(Int32Array.of(-1,0))}_writeMagic(){return this._write(t_)}_writePadding(e){return e>0?this._write(new Uint8Array(e)):this}_writeRecordBatch(e){const{byteLength:n,nodes:h,bufferRegions:_,buffers:T}=Ar.assemble(e),S=new Ro(e.numRows,h,_),u=Es.from(S,n);return this._writeDictionaries(e)._writeMessage(u)._writeBodyBuffers(T)}_writeDictionaryBatch(e,n,h=!1){const{byteLength:_,nodes:T,bufferRegions:S,buffers:u}=Ar.assemble(new En([e])),k=new Ro(e.length,T,S),B=new lu(k,n,h),q=Es.from(B,_);return this._writeMessage(q)._writeBodyBuffers(u)}_writeBodyBuffers(e){let n,h,_;for(let T=-1,S=e.length;++T<S;)(n=e[T])&&(h=n.byteLength)>0&&(this._write(n),(_=(h+7&-8)-h)>0&&this._writePadding(_));return this}_writeDictionaries(e){var n,h;for(const[_,T]of e.dictionaries){const S=(n=T==null?void 0:T.data)!==null&&n!==void 0?n:[],u=this._seenDictionaries.get(_),k=(h=this._dictionaryDeltaOffsets.get(_))!==null&&h!==void 0?h:0;if(!u||u.data[0]!==S[0])for(const[B,q]of S.entries())this._writeDictionaryBatch(q,_,B>0);else if(k<S.length)for(const B of S.slice(k))this._writeDictionaryBatch(B,_,!0);this._seenDictionaries.set(_,T),this._dictionaryDeltaOffsets.set(_,S.length)}return this}}class fb extends YS{static writeAll(e,n){const h=new fb(n);return Uf(e)?e.then(_=>h.writeAll(_)):wm(e)?gb(h,e):mb(h,e)}}class pb extends YS{static writeAll(e){const n=new pb;return Uf(e)?e.then(h=>n.writeAll(h)):wm(e)?gb(n,e):mb(n,e)}constructor(){super(),this._autoDestroy=!0}_writeSchema(e){return this._writeMagic()._writePadding(2)}_writeDictionaryBatch(e,n,h=!1){if(!h&&this._seenDictionaries.has(n))throw new Error("The Arrow File format does not support replacement dictionaries. ");return super._writeDictionaryBatch(e,n,h)}_writeFooter(e){const n=e_.encode(new e_(e,Gr.V5,this._recordBatchBlocks,this._dictionaryBlocks));return super._writeFooter(e)._write(n)._write(Int32Array.of(n.byteLength))._writeMagic()}}function mb(r,e){let n=e;e instanceof Ss&&(n=e.batches,r.reset(void 0,e.schema));for(const h of n)r.write(h);return r.finish()}function gb(r,e){return Ti(this,void 0,void 0,function*(){var n,h,_,T,S,u,k;try{for(n=!0,h=Ff(e);_=yield h.next(),T=_.done,!T;n=!0){k=_.value,n=!1;const B=k;r.write(B)}}catch(B){S={error:B}}finally{try{!n&&!T&&(u=h.return)&&(yield u.call(h))}finally{if(S)throw S.error}}return r.finish()})}function ED(r,e="stream"){return(e==="stream"?fb:pb).writeAll(r).toUint8Array(!0)}var MD=Object.create,XS=Object.defineProperty,AD=Object.getOwnPropertyDescriptor,ID=Object.getOwnPropertyNames,CD=Object.getPrototypeOf,DD=Object.prototype.hasOwnProperty,RD=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),PD=(r,e,n,h)=>{if(e&&typeof e=="object"||typeof e=="function")for(let _ of ID(e))!DD.call(r,_)&&_!==n&&XS(r,_,{get:()=>e[_],enumerable:!(h=AD(e,_))||h.enumerable});return r},zD=(r,e,n)=>(n=r!=null?MD(CD(r)):{},PD(!r||!r.__esModule?XS(n,"default",{value:r,enumerable:!0}):n,r)),kD=RD((r,e)=>{e.exports=Worker}),OD=(r=>(r[r.UNDEFINED=0]="UNDEFINED",r[r.AUTOMATIC=1]="AUTOMATIC",r[r.READ_ONLY=2]="READ_ONLY",r[r.READ_WRITE=3]="READ_WRITE",r))(OD||{}),BD=(r=>(r[r.IDENTIFIER=0]="IDENTIFIER",r[r.NUMERIC_CONSTANT=1]="NUMERIC_CONSTANT",r[r.STRING_CONSTANT=2]="STRING_CONSTANT",r[r.OPERATOR=3]="OPERATOR",r[r.KEYWORD=4]="KEYWORD",r[r.COMMENT=5]="COMMENT",r))(BD||{}),LD=(r=>(r[r.NONE=0]="NONE",r[r.DEBUG=1]="DEBUG",r[r.INFO=2]="INFO",r[r.WARNING=3]="WARNING",r[r.ERROR=4]="ERROR",r))(LD||{}),FD=(r=>(r[r.NONE=0]="NONE",r[r.CONNECT=1]="CONNECT",r[r.DISCONNECT=2]="DISCONNECT",r[r.OPEN=3]="OPEN",r[r.QUERY=4]="QUERY",r[r.INSTANTIATE=5]="INSTANTIATE",r))(FD||{}),ND=(r=>(r[r.NONE=0]="NONE",r[r.OK=1]="OK",r[r.ERROR=2]="ERROR",r[r.START=3]="START",r[r.RUN=4]="RUN",r[r.CAPTURE=5]="CAPTURE",r))(ND||{}),UD=(r=>(r[r.NONE=0]="NONE",r[r.WEB_WORKER=1]="WEB_WORKER",r[r.NODE_WORKER=2]="NODE_WORKER",r[r.BINDINGS=3]="BINDINGS",r[r.ASYNC_DUCKDB=4]="ASYNC_DUCKDB",r))(UD||{}),jD=class{constructor(r=2){this.level=r}log(r){r.level>=this.level&&console.log(r)}},VD=(r=>(r[r.SUCCESS=0]="SUCCESS",r))(VD||{}),ZD=class{constructor(r,e){this._bindings=r,this._conn=e}get bindings(){return this._bindings}async close(){return this._bindings.disconnect(this._conn)}useUnsafe(r){return r(this._bindings,this._conn)}async query(r){this._bindings.logger.log({timestamp:new Date,level:2,origin:4,topic:4,event:4,value:r});let e=await this._bindings.runQuery(this._conn,r),n=pl.from(e);return console.assert(n.isSync(),"Reader is not sync"),console.assert(n.isFile(),"Reader is not file"),new Ss(n)}async send(r,e=!1){this._bindings.logger.log({timestamp:new Date,level:2,origin:4,topic:4,event:4,value:r});let n=await this._bindings.startPendingQuery(this._conn,r,e);for(;n==null;)n=await this._bindings.pollPendingQuery(this._conn);let h=new KS(this._bindings,this._conn,n),_=await pl.from(h);return console.assert(_.isAsync()),console.assert(_.isStream()),_}async cancelSent(){return await this._bindings.cancelPendingQuery(this._conn)}async getTableNames(r){return await this._bindings.getTableNames(this._conn,r)}async prepare(r){let e=await this._bindings.createPrepared(this._conn,r);return new GD(this._bindings,this._conn,e)}async insertArrowTable(r,e){let n=ED(r,"stream");await this.insertArrowFromIPCStream(n,e)}async insertArrowFromIPCStream(r,e){await this._bindings.insertArrowFromIPCStream(this._conn,r,e)}async insertCSVFromPath(r,e){await this._bindings.insertCSVFromPath(this._conn,r,e)}async insertJSONFromPath(r,e){await this._bindings.insertJSONFromPath(this._conn,r,e)}},KS=class{constructor(r,e,n){this.db=r,this.conn=e,this.header=n,this._first=!0,this._depleted=!1,this._inFlight=null}async next(){if(this._first)return this._first=!1,{done:!1,value:this.header};if(this._depleted)return{done:!0,value:null};let r;return this._inFlight!=null?(r=await this._inFlight,this._inFlight=null):r=await this.db.fetchQueryResults(this.conn),this._depleted=r.length==0,this._depleted||(this._inFlight=this.db.fetchQueryResults(this.conn)),{done:this._depleted,value:r}}[Symbol.asyncIterator](){return this}},GD=class{constructor(r,e,n){this.bindings=r,this.connectionId=e,this.statementId=n}async close(){await this.bindings.closePrepared(this.connectionId,this.statementId)}async query(...r){let e=await this.bindings.runPrepared(this.connectionId,this.statementId,r),n=pl.from(e);return console.assert(n.isSync()),console.assert(n.isFile()),new Ss(n)}async send(...r){let e=await this.bindings.sendPrepared(this.connectionId,this.statementId,r),n=new KS(this.bindings,this.connectionId,e),h=await pl.from(n);return console.assert(h.isAsync()),console.assert(h.isStream()),h}},qD=(r=>(r.CANCEL_PENDING_QUERY="CANCEL_PENDING_QUERY",r.CLOSE_PREPARED="CLOSE_PREPARED",r.COLLECT_FILE_STATISTICS="COLLECT_FILE_STATISTICS",r.REGISTER_OPFS_FILE_NAME="REGISTER_OPFS_FILE_NAME",r.CONNECT="CONNECT",r.COPY_FILE_TO_BUFFER="COPY_FILE_TO_BUFFER",r.COPY_FILE_TO_PATH="COPY_FILE_TO_PATH",r.CREATE_PREPARED="CREATE_PREPARED",r.DISCONNECT="DISCONNECT",r.DROP_FILE="DROP_FILE",r.DROP_FILES="DROP_FILES",r.EXPORT_FILE_STATISTICS="EXPORT_FILE_STATISTICS",r.FETCH_QUERY_RESULTS="FETCH_QUERY_RESULTS",r.FLUSH_FILES="FLUSH_FILES",r.GET_FEATURE_FLAGS="GET_FEATURE_FLAGS",r.GET_TABLE_NAMES="GET_TABLE_NAMES",r.GET_VERSION="GET_VERSION",r.GLOB_FILE_INFOS="GLOB_FILE_INFOS",r.INSERT_ARROW_FROM_IPC_STREAM="INSERT_ARROW_FROM_IPC_STREAM",r.INSERT_CSV_FROM_PATH="IMPORT_CSV_FROM_PATH",r.INSERT_JSON_FROM_PATH="IMPORT_JSON_FROM_PATH",r.INSTANTIATE="INSTANTIATE",r.OPEN="OPEN",r.PING="PING",r.POLL_PENDING_QUERY="POLL_PENDING_QUERY",r.REGISTER_FILE_BUFFER="REGISTER_FILE_BUFFER",r.REGISTER_FILE_HANDLE="REGISTER_FILE_HANDLE",r.REGISTER_FILE_URL="REGISTER_FILE_URL",r.RESET="RESET",r.RUN_PREPARED="RUN_PREPARED",r.RUN_QUERY="RUN_QUERY",r.SEND_PREPARED="SEND_PREPARED",r.START_PENDING_QUERY="START_PENDING_QUERY",r.TOKENIZE="TOKENIZE",r))(qD||{}),$D=(r=>(r.CONNECTION_INFO="CONNECTION_INFO",r.ERROR="ERROR",r.FEATURE_FLAGS="FEATURE_FLAGS",r.FILE_BUFFER="FILE_BUFFER",r.FILE_INFOS="FILE_INFOS",r.FILE_SIZE="FILE_SIZE",r.FILE_STATISTICS="FILE_STATISTICS",r.INSTANTIATE_PROGRESS="INSTANTIATE_PROGRESS",r.LOG="LOG",r.PROGRESS_UPDATE="PROGRESS_UPDATE",r.OK="OK",r.PREPARED_STATEMENT_ID="PREPARED_STATEMENT_ID",r.QUERY_PLAN="QUERY_PLAN",r.QUERY_RESULT="QUERY_RESULT",r.QUERY_RESULT_CHUNK="QUERY_RESULT_CHUNK",r.QUERY_RESULT_HEADER="QUERY_RESULT_HEADER",r.QUERY_RESULT_HEADER_OR_NULL="QUERY_RESULT_HEADER_OR_NULL",r.REGISTERED_FILE="REGISTERED_FILE",r.SCRIPT_TOKENS="SCRIPT_TOKENS",r.SUCCESS="SUCCESS",r.TABLE_NAMES="TABLE_NAMES",r.VERSION_STRING="VERSION_STRING",r))($D||{}),nn=class{constructor(r,e){this.promiseResolver=()=>{},this.promiseRejecter=()=>{},this.type=r,this.data=e,this.promise=new Promise((n,h)=>{this.promiseResolver=n,this.promiseRejecter=h})}};function py(r){switch(r.typeId){case Te.Binary:return{sqlType:"binary"};case Te.Bool:return{sqlType:"bool"};case Te.Date:return{sqlType:"date"};case Te.DateDay:return{sqlType:"date32[d]"};case Te.DateMillisecond:return{sqlType:"date64[ms]"};case Te.Decimal:{let e=r;return{sqlType:"decimal",precision:e.precision,scale:e.scale}}case Te.Float:return{sqlType:"float"};case Te.Float16:return{sqlType:"float16"};case Te.Float32:return{sqlType:"float32"};case Te.Float64:return{sqlType:"float64"};case Te.Int:return{sqlType:"int32"};case Te.Int16:return{sqlType:"int16"};case Te.Int32:return{sqlType:"int32"};case Te.Int64:return{sqlType:"int64"};case Te.Uint16:return{sqlType:"uint16"};case Te.Uint32:return{sqlType:"uint32"};case Te.Uint64:return{sqlType:"uint64"};case Te.Uint8:return{sqlType:"uint8"};case Te.IntervalDayTime:return{sqlType:"interval[dt]"};case Te.IntervalYearMonth:return{sqlType:"interval[m]"};case Te.List:return{sqlType:"list",valueType:py(r.valueType)};case Te.FixedSizeBinary:return{sqlType:"fixedsizebinary",byteWidth:r.byteWidth};case Te.Null:return{sqlType:"null"};case Te.Utf8:return{sqlType:"utf8"};case Te.Struct:return{sqlType:"struct",fields:r.children.map(e=>P0(e.name,e.type))};case Te.Map:{let e=r;return{sqlType:"map",keyType:py(e.keyType),valueType:py(e.valueType)}}case Te.Time:return{sqlType:"time[s]"};case Te.TimeMicrosecond:return{sqlType:"time[us]"};case Te.TimeMillisecond:return{sqlType:"time[ms]"};case Te.TimeNanosecond:return{sqlType:"time[ns]"};case Te.TimeSecond:return{sqlType:"time[s]"};case Te.Timestamp:return{sqlType:"timestamp",timezone:r.timezone||void 0};case Te.TimestampSecond:return{sqlType:"timestamp[s]",timezone:r.timezone||void 0};case Te.TimestampMicrosecond:return{sqlType:"timestamp[us]",timezone:r.timezone||void 0};case Te.TimestampNanosecond:return{sqlType:"timestamp[ns]",timezone:r.timezone||void 0};case Te.TimestampMillisecond:return{sqlType:"timestamp[ms]",timezone:r.timezone||void 0}}throw new Error("unsupported arrow type: ".concat(r.toString()))}function P0(r,e){let n=py(e);return n.name=r,n}var HD=new TextEncoder,YD=class{constructor(r,e=null){this._onInstantiationProgress=[],this._onExecutionProgress=[],this._worker=null,this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{},this._nextMessageId=0,this._pendingRequests=new Map,this._logger=r,this._onMessageHandler=this.onMessage.bind(this),this._onErrorHandler=this.onError.bind(this),this._onCloseHandler=this.onClose.bind(this),e!=null&&this.attach(e)}get logger(){return this._logger}attach(r){this._worker=r,this._worker.addEventListener("message",this._onMessageHandler),this._worker.addEventListener("error",this._onErrorHandler),this._worker.addEventListener("close",this._onCloseHandler),this._workerShutdownPromise=new Promise((e,n)=>{this._workerShutdownResolver=e})}detach(){this._worker&&(this._worker.removeEventListener("message",this._onMessageHandler),this._worker.removeEventListener("error",this._onErrorHandler),this._worker.removeEventListener("close",this._onCloseHandler),this._worker=null,this._workerShutdownResolver(null),this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{})}async terminate(){this._worker&&(this._worker.terminate(),this._worker=null,this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{})}async postTask(r,e=[]){if(!this._worker){console.error("cannot send a message since the worker is not set!");return}let n=this._nextMessageId++;return this._pendingRequests.set(n,r),this._worker.postMessage({messageId:n,type:r.type,data:r.data},e),await r.promise}onMessage(r){var e;let n=r.data;switch(n.type){case"PROGRESS_UPDATE":{for(let _ of this._onExecutionProgress)_(n.data);return}case"LOG":{this._logger.log(n.data);return}case"INSTANTIATE_PROGRESS":{for(let _ of this._onInstantiationProgress)_(n.data);return}}let h=this._pendingRequests.get(n.requestId);if(!h){console.warn("unassociated response: [".concat(n.requestId,", ").concat(n.type.toString(),"]"));return}if(this._pendingRequests.delete(n.requestId),n.type=="ERROR"){let _=new Error(n.data.message);_.name=n.data.name,(e=Object.getOwnPropertyDescriptor(_,"stack"))!=null&&e.writable&&(_.stack=n.data.stack),h.promiseRejecter(_);return}switch(h.type){case"CLOSE_PREPARED":case"COLLECT_FILE_STATISTICS":case"REGISTER_OPFS_FILE_NAME":case"COPY_FILE_TO_PATH":case"DISCONNECT":case"DROP_FILE":case"DROP_FILES":case"FLUSH_FILES":case"INSERT_ARROW_FROM_IPC_STREAM":case"IMPORT_CSV_FROM_PATH":case"IMPORT_JSON_FROM_PATH":case"OPEN":case"PING":case"REGISTER_FILE_BUFFER":case"REGISTER_FILE_HANDLE":case"REGISTER_FILE_URL":case"RESET":if(n.type=="OK"){h.promiseResolver(n.data);return}break;case"INSTANTIATE":if(this._onInstantiationProgress=[],n.type=="OK"){h.promiseResolver(n.data);return}break;case"GLOB_FILE_INFOS":if(n.type=="FILE_INFOS"){h.promiseResolver(n.data);return}break;case"GET_VERSION":if(n.type=="VERSION_STRING"){h.promiseResolver(n.data);return}break;case"GET_FEATURE_FLAGS":if(n.type=="FEATURE_FLAGS"){h.promiseResolver(n.data);return}break;case"GET_TABLE_NAMES":if(n.type=="TABLE_NAMES"){h.promiseResolver(n.data);return}break;case"TOKENIZE":if(n.type=="SCRIPT_TOKENS"){h.promiseResolver(n.data);return}break;case"COPY_FILE_TO_BUFFER":if(n.type=="FILE_BUFFER"){h.promiseResolver(n.data);return}break;case"EXPORT_FILE_STATISTICS":if(n.type=="FILE_STATISTICS"){h.promiseResolver(n.data);return}break;case"CONNECT":if(n.type=="CONNECTION_INFO"){h.promiseResolver(n.data);return}break;case"RUN_PREPARED":case"RUN_QUERY":if(n.type=="QUERY_RESULT"){h.promiseResolver(n.data);return}break;case"SEND_PREPARED":if(n.type=="QUERY_RESULT_HEADER"){h.promiseResolver(n.data);return}break;case"START_PENDING_QUERY":if(n.type=="QUERY_RESULT_HEADER_OR_NULL"){h.promiseResolver(n.data);return}break;case"POLL_PENDING_QUERY":if(n.type=="QUERY_RESULT_HEADER_OR_NULL"){h.promiseResolver(n.data);return}break;case"CANCEL_PENDING_QUERY":if(this._onInstantiationProgress=[],n.type=="SUCCESS"){h.promiseResolver(n.data);return}break;case"FETCH_QUERY_RESULTS":if(n.type=="QUERY_RESULT_CHUNK"){h.promiseResolver(n.data);return}break;case"CREATE_PREPARED":if(n.type=="PREPARED_STATEMENT_ID"){h.promiseResolver(n.data);return}break}h.promiseRejecter(new Error("unexpected response type: ".concat(n.type.toString())))}onError(r){console.error(r),console.error("error in duckdb worker: ".concat(r.message)),this._pendingRequests.clear()}onClose(){if(this._workerShutdownResolver(null),this._pendingRequests.size!=0){console.warn("worker terminated with ".concat(this._pendingRequests.size," pending requests"));return}this._pendingRequests.clear()}async reset(){let r=new nn("RESET",null);return await this.postTask(r)}async ping(){let r=new nn("PING",null);await this.postTask(r)}async dropFile(r){let e=new nn("DROP_FILE",r);return await this.postTask(e)}async dropFiles(){let r=new nn("DROP_FILES",null);return await this.postTask(r)}async flushFiles(){let r=new nn("FLUSH_FILES",null);return await this.postTask(r)}async instantiate(r,e=null,n=h=>{}){this._onInstantiationProgress.push(n);let h=new nn("INSTANTIATE",[r,e]);return await this.postTask(h)}async getVersion(){let r=new nn("GET_VERSION",null);return await this.postTask(r)}async getFeatureFlags(){let r=new nn("GET_FEATURE_FLAGS",null);return await this.postTask(r)}async open(r){let e=new nn("OPEN",r);await this.postTask(e)}async tokenize(r){let e=new nn("TOKENIZE",r);return await this.postTask(e)}async connectInternal(){let r=new nn("CONNECT",null);return await this.postTask(r)}async connect(){let r=await this.connectInternal();return new ZD(this,r)}async disconnect(r){let e=new nn("DISCONNECT",r);await this.postTask(e)}async runQuery(r,e){let n=new nn("RUN_QUERY",[r,e]);return await this.postTask(n)}async startPendingQuery(r,e,n=!1){let h=new nn("START_PENDING_QUERY",[r,e,n]);return await this.postTask(h)}async pollPendingQuery(r){let e=new nn("POLL_PENDING_QUERY",r);return await this.postTask(e)}async cancelPendingQuery(r){let e=new nn("CANCEL_PENDING_QUERY",r);return await this.postTask(e)}async fetchQueryResults(r){let e=new nn("FETCH_QUERY_RESULTS",r);return await this.postTask(e)}async getTableNames(r,e){let n=new nn("GET_TABLE_NAMES",[r,e]);return await this.postTask(n)}async createPrepared(r,e){let n=new nn("CREATE_PREPARED",[r,e]);return await this.postTask(n)}async closePrepared(r,e){let n=new nn("CLOSE_PREPARED",[r,e]);await this.postTask(n)}async runPrepared(r,e,n){let h=new nn("RUN_PREPARED",[r,e,n]);return await this.postTask(h)}async sendPrepared(r,e,n){let h=new nn("SEND_PREPARED",[r,e,n]);return await this.postTask(h)}async globFiles(r){let e=new nn("GLOB_FILE_INFOS",r);return await this.postTask(e)}async registerFileText(r,e){let n=HD.encode(e);await this.registerFileBuffer(r,n)}async registerFileURL(r,e,n,h){e===void 0&&(e=r);let _=new nn("REGISTER_FILE_URL",[r,e,n,h]);await this.postTask(_)}async registerEmptyFileBuffer(r){}async registerFileBuffer(r,e){let n=new nn("REGISTER_FILE_BUFFER",[r,e]);await this.postTask(n,[e.buffer])}async registerFileHandle(r,e,n,h){let _=new nn("REGISTER_FILE_HANDLE",[r,e,n,h]);await this.postTask(_,[])}async registerOPFSFileName(r){let e=new nn("REGISTER_OPFS_FILE_NAME",[r]);await this.postTask(e,[])}async collectFileStatistics(r,e){let n=new nn("COLLECT_FILE_STATISTICS",[r,e]);await this.postTask(n,[])}async exportFileStatistics(r){let e=new nn("EXPORT_FILE_STATISTICS",r);return await this.postTask(e,[])}async copyFileToBuffer(r){let e=new nn("COPY_FILE_TO_BUFFER",r);return await this.postTask(e)}async copyFileToPath(r,e){let n=new nn("COPY_FILE_TO_PATH",[r,e]);await this.postTask(n)}async insertArrowFromIPCStream(r,e,n){if(e.length==0)return;let h=new nn("INSERT_ARROW_FROM_IPC_STREAM",[r,e,n]);await this.postTask(h,[e.buffer])}async insertCSVFromPath(r,e,n){if(n.columns!==void 0){let _=[];for(let T in n.columns){let S=n.columns[T];_.push(P0(T,S))}n.columnsFlat=_,delete n.columns}let h=new nn("IMPORT_CSV_FROM_PATH",[r,e,n]);await this.postTask(h)}async insertJSONFromPath(r,e,n){if(n.columns!==void 0){let _=[];for(let T in n.columns){let S=n.columns[T];_.push(P0(T,S))}n.columnsFlat=_,delete n.columns}let h=new nn("IMPORT_JSON_FROM_PATH",[r,e,n]);await this.postTask(h)}};function XD(){let r=new TextDecoder;return e=>(typeof SharedArrayBuffer<"u"&&e.buffer instanceof SharedArrayBuffer&&(e=new Uint8Array(e)),r.decode(e))}XD();var KD=(r=>(r[r.BUFFER=0]="BUFFER",r[r.NODE_FS=1]="NODE_FS",r[r.BROWSER_FILEREADER=2]="BROWSER_FILEREADER",r[r.BROWSER_FSACCESS=3]="BROWSER_FSACCESS",r[r.HTTP=4]="HTTP",r[r.S3=5]="S3",r))(KD||{}),WD=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,3,1,0,1,10,14,1,12,0,65,0,65,0,65,0,252,10,0,0,11])),QD=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,8,1,6,0,6,64,25,11,11])),JD=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),eR=()=>(async r=>{try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(r)}catch{return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])),tR={version:"1.29.1-dev132.0"},_b=tR.version.split(".");_b[0];_b[1];_b[2];var iR=()=>typeof navigator>"u",Kv=null,Wv=null,Qv=null,Jv=null,e0=null;async function nR(){return Kv==null&&(Kv=typeof BigInt64Array<"u"),Wv==null&&(Wv=await QD()),Qv==null&&(Qv=await eR()),Jv==null&&(Jv=await JD()),e0==null&&(e0=await WD()),{bigInt64Array:Kv,crossOriginIsolated:iR()||globalThis.crossOriginIsolated||!1,wasmExceptions:Wv,wasmSIMD:Jv,wasmThreads:Qv,wasmBulkMemory:e0}}async function rR(r){let e=await nR();if(e.wasmExceptions){if(e.wasmSIMD&&e.wasmThreads&&e.crossOriginIsolated&&r.coi)return{mainModule:r.coi.mainModule,mainWorker:r.coi.mainWorker,pthreadWorker:r.coi.pthreadWorker};if(r.eh)return{mainModule:r.eh.mainModule,mainWorker:r.eh.mainWorker,pthreadWorker:null}}return{mainModule:r.mvp.mainModule,mainWorker:r.mvp.mainWorker,pthreadWorker:null}}zD(kD());const aR="/duckdb-wasm-prototype/assets/duckdb-browser-eh.worker-Dr8caoCF.js",sR="/duckdb-wasm-prototype/assets/duckdb-browser-mvp.worker-BU4f-ubc.js",oR="/duckdb-wasm-prototype/assets/duckdb-eh-CY01qZ36.wasm",lR="/duckdb-wasm-prototype/assets/duckdb-mvp-Cx8s1fVm.wasm",cR={mvp:{mainModule:lR,mainWorker:sR},eh:{mainModule:oR,mainWorker:aR}};function uR(){const[r,e]=Je.useState(null),[n,h]=Je.useState(null),_=Je.useRef(!1);return Je.useEffect(()=>{async function T(){try{const S=await rR(cR),u=new Worker(S.mainWorker),k=new jD,B=new YD(k,u);await B.instantiate(S.mainModule,S.pthreadWorker),await B.open({}),console.log("Database opened successfully.");const q=await B.connect();try{await q.query("INSTALL spatial;"),await q.query("LOAD spatial;")}catch(oe){throw console.error("Error installing spatial extension:",oe),oe}finally{await q.close()}e(B)}catch(S){h(S instanceof Error?S:new Error("Failed to initialize DuckDB"))}}return _.current||(console.log("Initializing DuckDB..."),T(),_.current=!0),()=>{r&&r.terminate()}},[r]),{db:r,error:n}}function hR(){const{db:r}=uR(),[e,n]=Je.useState(null),[h,_]=Je.useState({}),[T,S]=Je.useState(0),u=(k,B)=>{_(q=>({...q,[k]:B}))};return Tt.jsxs("div",{style:{display:"flex",height:"100vh",width:"100vw",overflow:"hidden",margin:0,padding:0},children:[Tt.jsx("div",{style:{width:"50%",height:"100vh",borderRight:"1px solid #ddd",display:"flex",flexDirection:"column",overflow:"hidden"},children:r&&Tt.jsx(bA,{db:r})}),Tt.jsxs("div",{style:{width:"50%",height:"100vh",display:"flex",flexDirection:"column",overflow:"hidden"},children:[Tt.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"15px",padding:"10px",flexShrink:0,backgroundColor:"white"},children:[r&&Tt.jsx(KA,{db:r,onTableCreated:()=>S(k=>k+1)}),r&&Tt.jsx(WA,{db:r,selectedTable:e,onTableSelect:n,selectedColumns:h,onColumnSelect:u},T)]}),Tt.jsx("div",{style:{flex:1,overflow:"hidden"},children:r&&Tt.jsx(XA,{db:r,selectedTable:e,selectedColumns:h[e||""]||[]},e||"no-table")})]})]})}o2.createRoot(document.getElementById("root")).render(Tt.jsx(Je.StrictMode,{children:Tt.jsx(wT,{children:Tt.jsx(hR,{})})}));
